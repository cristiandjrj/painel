<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventProDJ - Gestão Financeira para Eventos</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@300;400;500&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- jsPDF para geração de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            width: 100%;
        }

        :root {
            --primary: #FF6B35;
            --primary-dark: #E85A2B;
            --secondary: #004E89;
            --accent: #FFD23F;
            --success: #06D6A0;
            --danger: #EF476F;
            --bg-dark: #0A0E27;
            --bg-card: #141B3D;
            --bg-card-hover: #1A2249;
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --border: #2D3561;
        }
        
        /* TEMA CLARO - Cores otimizadas */
        [data-theme="light"] {
            --primary: #FF6B35;
            --primary-dark: #E85A2B;
            --secondary: #2563EB;
            --accent: #F59E0B;
            --success: #10B981;
            --danger: #EF4444;
            --bg-dark: #F8FAFC;
            --bg-card: #FFFFFF;
            --bg-card-hover: #F1F5F9;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --border: #E2E8F0;
        }
        
        /* Estilos específicos do tema claro */
        [data-theme="light"] .stat-card,
        [data-theme="light"] .card,
        [data-theme="light"] .client-card,
        [data-theme="light"] .event-card-full {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        [data-theme="light"] .stat-card:hover,
        [data-theme="light"] .card:hover,
        [data-theme="light"] .client-card:hover,
        [data-theme="light"] .event-card-full:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        [data-theme="light"] header {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        /* TEMA ESCURO (padrão) */
        [data-theme="dark"] {
            --primary: #FF6B35;
            --primary-dark: #E85A2B;
            --secondary: #004E89;
            --accent: #FFD23F;
            --success: #06D6A0;
            --danger: #EF476F;
            --bg-dark: #0A0E27;
            --bg-card: #141B3D;
            --bg-card-hover: #1A2249;
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --border: #2D3561;
        }
        
        /* Transições suaves apenas em elementos específicos */
        body, 
        header,
        .card, 
        .stat-card,
        .client-card,
        .event-card,
        .modal-content,
        .btn {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            overflow-x: hidden;
        }

        /* Header */
        header {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--border);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            gap: 20px;
        }

        .logo {
            font-family: 'Syne', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: -1px;
            flex-shrink: 0;
        }

        .main-nav {
            display: flex;
            gap: 8px;
            flex: 1;
            justify-content: center;
            align-items: center;
        }

        .nav-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: var(--primary);
            background: rgba(255, 107, 53, 0.15);
        }

        /* Status de Sincronização */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
        }

        .sync-text {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sync-button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 16px;
            padding: 0 4px;
        }

        /* Menu Mobile */
        .mobile-menu-toggle {
            display: none;
            position: relative;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 32px;
            cursor: pointer;
            padding: 8px;
            z-index: 1001;
            flex-shrink: 0;
            line-height: 1;
        }

        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-menu-overlay.active {
            display: block;
            opacity: 1;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--bg-card);
            border-right: 2px solid var(--border);
            z-index: 1002;
            overflow-y: auto;
            transition: left 0.3s ease;
            padding: 20px;
        }
        
        @media (min-width: 1025px) {
            .mobile-menu {
                display: none;
            }
        }

        .mobile-menu.active {
            left: 0;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        .mobile-menu-close {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mobile-nav .nav-tab {
            width: 100%;
            text-align: left;
            padding: 14px 16px;
            font-size: 14px;
        }

        .mobile-sync {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .main-nav {
                gap: 4px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 1024px) {
            .header-content {
                position: relative;
                justify-content: flex-start;
                padding: 0 15px;
            }
            
            .mobile-menu-toggle {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                position: relative !important;
                z-index: 1003 !important;
                order: -1;
                margin-right: auto;
            }
            
            .logo {
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1002;
                pointer-events: none;
            }
            
            .main-nav {
                display: none;
            }
            
            .sync-status {
                display: none !important;
            }
            
            .sync-text {
                display: none;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 12px 0;
            }
            
            .header-content {
                padding: 0 16px !important;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .sync-text {
                display: none;
            }
            
            /* Mostrar menu mobile */
            .mobile-menu-toggle {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
                position: relative !important;
            }
            
            .main-nav {
                display: none !important;
            }
            
            /* Dashboard mais clean no mobile */
            .dashboard-header {
                padding: 20px 0;
            }
            
            .dashboard-title {
                font-size: 24px;
            }
            
            .dashboard-subtitle {
                font-size: 13px;
            }
            
            /* Cards menores no mobile */
            .stat-card {
                padding: 16px;
                border-radius: 12px;
            }
            
            .stat-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
                margin-bottom: 12px;
            }
            
            .stat-label {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .stat-value {
                font-size: 22px;
                margin-bottom: 6px;
            }
            
            .stat-change {
                font-size: 11px;
            }
            
            /* Cards de conteúdo mais compactos */
            .card {
                padding: 16px;
                border-radius: 12px;
            }
            
            .card-header {
                margin-bottom: 16px;
                padding-bottom: 12px;
            }
            
            .card-title {
                font-size: 16px;
            }
            
            /* Transações menores */
            .transaction-item {
                padding: 12px;
            }
            
            .transaction-icon {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            
            .transaction-details h4 {
                font-size: 13px;
            }
            
            .transaction-date {
                font-size: 11px;
            }
            
            .transaction-amount {
                font-size: 16px;
            }
            
            /* Eventos menores */
            .event-card {
                padding: 12px;
            }
            
            .event-title {
                font-size: 14px;
            }
            
            .event-client {
                font-size: 12px;
            }
            
            .event-detail {
                font-size: 12px;
            }
            
            /* Quick actions menores */
            .action-btn {
                padding: 12px;
            }
            
            .action-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .action-text h4 {
                font-size: 13px;
            }
            
            .action-text p {
                font-size: 11px;
            }
        }
        
        /* OTIMIZAÇÃO ESPECÍFICA PARA iPHONE 15 / 15 Pro Max */
        @media (max-width: 430px) {
            html, body {
                overflow-x: hidden !important;
                max-width: 100vw !important;
            }
            
            .container {
                padding: 12px;
                max-width: 100vw !important;
                overflow-x: hidden !important;
            }
            
            /* Stats grid - 1 coluna no mobile */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }
            
            /* Cards ainda mais compactos */
            .stat-card {
                padding: 14px !important;
                border-radius: 10px !important;
            }
            
            .stat-icon {
                width: 32px !important;
                height: 32px !important;
                font-size: 16px !important;
                margin-bottom: 10px !important;
            }
            
            .stat-label {
                font-size: 10px !important;
                margin-bottom: 4px !important;
            }
            
            .stat-value {
                font-size: 20px !important;
                margin-bottom: 4px !important;
            }
            
            .stat-change {
                font-size: 10px !important;
            }
            
            /* Cards principais */
            .card {
                padding: 14px !important;
                border-radius: 10px !important;
                margin-bottom: 12px !important;
            }
            
            .card-header {
                margin-bottom: 12px !important;
                padding-bottom: 10px !important;
            }
            
            .card-title {
                font-size: 15px !important;
            }
            
            /* Dashboard header compacto */
            .dashboard-header {
                padding: 16px 0 !important;
            }
            
            .dashboard-title {
                font-size: 22px !important;
            }
            
            .dashboard-subtitle {
                font-size: 12px !important;
            }
            
            /* Transações ultra compactas */
            .transaction-item {
                padding: 10px !important;
                border-radius: 8px !important;
            }
            
            .transaction-icon {
                width: 28px !important;
                height: 28px !important;
                font-size: 14px !important;
            }
            
            .transaction-details {
                flex: 1;
                min-width: 0;
            }
            
            .transaction-details h4 {
                font-size: 12px !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .transaction-date {
                font-size: 10px !important;
            }
            
            .transaction-amount {
                font-size: 14px !important;
                white-space: nowrap;
            }
            
            /* Event cards compactos */
            .event-card {
                padding: 10px !important;
                border-radius: 8px !important;
            }
            
            .event-title {
                font-size: 13px !important;
            }
            
            .event-client {
                font-size: 11px !important;
            }
            
            .event-detail {
                font-size: 11px !important;
            }
            
            /* Client cards */
            /* Client cards otimizados */
            .client-card {
                padding: 14px !important;
                border-radius: 10px !important;
                margin-bottom: 12px !important;
            }
            
            .client-card-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                margin-bottom: 12px !important;
            }
            
            .client-main-info {
                width: 100% !important;
                margin-bottom: 10px !important;
            }
            
            .client-avatar {
                width: 42px !important;
                height: 42px !important;
                font-size: 18px !important;
                margin-right: 12px !important;
            }
            
            .client-details-main h3 {
                font-size: 15px !important;
                line-height: 1.3 !important;
            }
            
            .client-email, .client-phone {
                font-size: 11px !important;
                display: block !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                white-space: nowrap !important;
            }
            
            /* Ocultar email no mobile */
            .client-email {
                display: none !important;
            }
            
            .client-badges {
                width: 100% !important;
                justify-content: flex-start !important;
            }
            
            .client-badge {
                font-size: 10px !important;
                padding: 4px 8px !important;
            }
            
            /* Ocultar grid de informações no mobile (aniversário, CPF, endereço) */
            .client-info-grid {
                display: none !important;
            }
            
            .client-actions {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
                margin-top: 12px !important;
                padding-top: 12px !important;
            }
            
            .client-action-btn {
                padding: 10px 8px !important;
                font-size: 11px !important;
                text-align: center !important;
                white-space: nowrap !important;
            }
            
            /* Botões menores */
            .btn {
                padding: 10px 18px !important;
                font-size: 12px !important;
            }
            
            /* Action buttons */
            .action-btn {
                padding: 10px !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .action-icon {
                width: 32px !important;
                height: 32px !important;
                font-size: 16px !important;
                flex-shrink: 0 !important;
            }
            
            .action-text {
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .action-text h4 {
                font-size: 12px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            .action-text p {
                font-size: 10px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* Transações recentes */
            .transaction-item {
                padding: 10px !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .transaction-info {
                max-width: 60% !important;
                overflow: hidden !important;
            }
            
            .transaction-details h4 {
                font-size: 12px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            .transaction-date {
                font-size: 10px !important;
            }
            
            .transaction-amount {
                font-size: 14px !important;
                white-space: nowrap !important;
            }
            
            /* Cards do dashboard */
            .card {
                padding: 14px !important;
                margin-bottom: 16px !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .card-header {
                margin-bottom: 12px !important;
                padding-bottom: 10px !important;
                flex-wrap: wrap !important;
                gap: 8px !important;
            }
            
            .card-title {
                font-size: 14px !important;
                word-wrap: break-word !important;
            }
            
            /* Event cards no dashboard */
            .event-card {
                padding: 12px !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .event-header {
                flex-wrap: wrap !important;
                gap: 8px !important;
            }
            
            .event-title {
                font-size: 13px !important;
                word-wrap: break-word !important;
            }
            
            .event-client {
                font-size: 11px !important;
                word-wrap: break-word !important;
            }
            
            .event-details {
                gap: 8px !important;
            }
            
            .event-detail {
                font-size: 11px !important;
            }
            
            /* Origem dos clientes */
            #origemStats {
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            #origemStats > div {
                max-width: 100% !important;
                overflow: hidden !important;
                word-wrap: break-word !important;
            }
            
            /* Performance de Serviços - ocultar Ticket Médio no mobile */
            .servico-ticket-medio {
                display: none !important;
            }
            
            .servico-stats-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }
            
            /* Botões de ação dos serviços no mobile - pequenos e abaixo */
            .servico-actions {
                justify-content: center !important;
                gap: 6px !important;
            }
            
            .btn-editar-servico,
            .btn-excluir-servico {
                padding: 5px 12px !important;
                font-size: 10px !important;
                border-radius: 5px !important;
                white-space: nowrap !important;
            }
            
            /* Form inputs menores */
            .form-input, .form-select {
                padding: 10px 12px !important;
                font-size: 13px !important;
            }
            
            .form-label {
                font-size: 11px !important;
                margin-bottom: 6px !important;
            }
            
            /* Modal mais compacto */
            .modal-content {
                padding: 16px !important;
                margin: 20px 12px !important;
                max-height: calc(100vh - 40px) !important;
            }
            
            .modal-title {
                font-size: 18px !important;
            }
            
            /* Tabs menores */
            .nav-tab {
                padding: 10px 14px !important;
                font-size: 12px !important;
            }
            
            /* Calendário responsivo otimizado */
            .calendar-header {
                flex-direction: column !important;
                gap: 12px !important;
                margin-bottom: 16px !important;
            }
            
            .calendar-month {
                font-size: 20px !important;
            }
            
            .calendar-nav {
                width: 100% !important;
                justify-content: center !important;
            }
            
            .calendar-nav-btn {
                padding: 10px 20px !important;
                font-size: 14px !important;
            }
            
            .calendar-grid {
                gap: 4px !important;
            }
            
            .calendar-day-header {
                padding: 8px 4px !important;
                font-size: 10px !important;
            }
            
            .calendar-day {
                aspect-ratio: 1 !important;
                padding: 4px !important;
                border-radius: 6px !important;
                min-height: 45px !important;
            }
            
            .calendar-day-number {
                font-size: 13px !important;
                margin-bottom: 2px !important;
            }
            
            .calendar-day-events {
                font-size: 8px !important;
                display: -webkit-box !important;
                -webkit-line-clamp: 2 !important;
                -webkit-box-orient: vertical !important;
                overflow: hidden !important;
            }
            
            .calendar-event-dot {
                width: 4px !important;
                height: 4px !important;
            }
            
            /* Event cards na lista */
            .event-card-full {
                padding: 14px !important;
                margin-bottom: 12px !important;
                max-width: 100% !important;
                overflow: hidden !important;
                word-wrap: break-word !important;
            }
            
            .event-card-main {
                flex-direction: column !important;
                gap: 8px !important;
                align-items: flex-start !important;
                max-width: 100% !important;
            }
            
            .event-card-info {
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .event-card-info h3 {
                font-size: 16px !important;
                margin-bottom: 4px !important;
                line-height: 1.3 !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            
            .event-card-client {
                font-size: 12px !important;
                margin-bottom: 10px !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            
            /* Estilos para os divs inline dentro do card */
            .event-card-full div[style*="display: flex"] {
                flex-wrap: wrap !important;
                gap: 8px !important;
                font-size: 11px !important;
                max-width: 100% !important;
            }
            
            .event-card-full div[style*="display: flex"] > div {
                font-size: 11px !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
            }
            
            .event-card-full strong {
                font-size: 12px !important;
                word-wrap: break-word !important;
            }
            
            .event-status {
                font-size: 10px !important;
                padding: 4px 10px !important;
                white-space: nowrap !important;
                align-self: flex-start !important;
            }
            
            .event-card-actions {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 6px !important;
                margin-top: 12px !important;
                padding-top: 12px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .event-action-btn {
                padding: 8px 10px !important;
                font-size: 10px !important;
                width: 100% !important;
                min-width: unset !important;
                text-align: center !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* Event observations no mobile */
            .event-observations {
                margin-top: 10px !important;
                padding-top: 10px !important;
            }
            
            .event-observations-text {
                font-size: 11px !important;
                line-height: 1.5 !important;
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
                white-space: normal !important;
                max-width: 100% !important;
                text-align: left !important;
                display: block !important;
            }
            
            .event-card-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 8px !important;
            }
            
            .event-info h3 {
                font-size: 14px !important;
            }
            
            .event-info p {
                font-size: 11px !important;
            }
            
            .event-details-grid {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
            }
            
            .event-detail-item {
                font-size: 11px !important;
            }
            
            /* Financial cards compactos */
            .client-financial {
                padding: 12px !important;
                border-radius: 8px !important;
                margin-top: 12px !important;
            }
            
            .financial-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 8px !important;
                margin-bottom: 10px !important;
                padding-bottom: 10px !important;
            }
            
            .financial-title {
                font-size: 13px !important;
            }
            
            .financial-status {
                font-size: 10px !important;
                padding: 3px 8px !important;
            }
            
            .financial-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 10px !important;
            }
            
            .financial-item {
                padding: 10px !important;
                background: rgba(255, 255, 255, 0.02) !important;
                border-radius: 6px !important;
            }
            
            .financial-label {
                font-size: 10px !important;
                margin-bottom: 4px !important;
            }
            
            .financial-value {
                font-size: 14px !important;
                font-weight: 600 !important;
            }
            
            .progress-bar {
                margin-top: 10px !important;
                height: 6px !important;
            }
            
            .progress-fill {
                height: 6px !important;
            }
            
            /* Filtros e controles */
            .filters-row {
                flex-direction: column !important;
                gap: 10px !important;
            }
            
            .filter-group {
                width: 100% !important;
            }
            
            /* Empty state */
            .empty-state {
                padding: 40px 20px !important;
            }
            
            .empty-state-icon {
                font-size: 60px !important;
            }
            
            .empty-state-title {
                font-size: 18px !important;
            }
            
            .empty-state-text {
                font-size: 13px !important;
            }
        }
        

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Dashboard Grid */
        .dashboard {
            margin-top: 30px;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-family: 'Syne', sans-serif;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeIn 0.6s ease-out both;
        }

        .stat-card:nth-child(2) { animation-delay: 0.1s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.3s; }

        .stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* No desktop: Transactions à esquerda, Actions à direita */
        .dashboard-column-transactions {
            order: 1;
        }
        
        .dashboard-column-actions {
            order: 2;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            animation: fadeIn 0.6s ease-out 0.4s both;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-family: 'Syne', sans-serif;
            font-size: 22px;
            font-weight: 600;
        }

        /* Transactions */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .transaction-details h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .transaction-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .transaction-amount {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 600;
        }

        .transaction-amount.positive { color: var(--success); }
        .transaction-amount.negative { color: var(--danger); }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            gap: 12px;
        }

        .action-btn {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .action-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .action-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .action-text h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .action-text p {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Events Section */
        .events-grid {
            display: grid;
            gap: 15px;
        }

        .event-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .event-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .event-client {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .event-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-confirmed {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        .status-pending {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }
        
        .status-completed {
            background: rgba(79, 70, 229, 0.2);
            color: #4F46E5;
        }
        
        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .event-details {
            display: flex;
            gap: 20px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .event-detail {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-submit {
            width: 100%;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .content-grid {
                grid-template-columns: 1fr;
                display: flex;
                flex-direction: column;
            }
            
            /* Ordem no mobile:
               1. Ações Rápidas
               2. Transações Recentes
               3. Próximos Eventos
               4. Origem dos Clientes
            */
            .card-acoes-rapidas {
                order: 1;
            }
            
            .dashboard-column-transactions {
                order: 2;
            }
            
            .card-proximos-eventos {
                order: 3;
            }
            
            .card-origem-clientes {
                order: 4;
            }
            
            .dashboard-column-actions {
                display: contents; /* Permite que os filhos sejam reordenados individualmente */
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-title {
                font-size: 32px;
            }
        }

        /* Color variants */
        .bg-primary { background: rgba(255, 107, 53, 0.15); color: var(--primary); }
        .bg-secondary { background: rgba(0, 78, 137, 0.15); color: var(--secondary); }
        .bg-success { background: rgba(6, 214, 160, 0.15); color: var(--success); }
        .bg-accent { background: rgba(255, 210, 63, 0.15); color: var(--accent); }
        .bg-danger { background: rgba(239, 71, 111, 0.15); color: var(--danger); }

        /* Serviços Styles */
        .servico-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .servico-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .servico-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .servico-nome {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .servico-categoria {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255, 107, 53, 0.2);
            color: var(--primary);
            border-radius: 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .servico-valor {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
        }

        .servico-descricao {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 8px;
            line-height: 1.5;
        }

        .servico-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .btn-delete {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .btn-delete:hover {
            background: var(--danger);
            color: white;
        }

        /* Checkbox personalizado */
        .servico-checkbox {
            display: flex;
            align-items: start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .servico-checkbox:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .servico-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .servico-checkbox-content {
            flex: 1;
        }

        .servico-checkbox-nome {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .servico-checkbox-info {
            display: flex;
            gap: 15px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .servico-selecionado-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(6, 214, 160, 0.2);
            font-size: 13px;
        }

        .servico-selecionado-item:last-child {
            border-bottom: none;
        }

        /* Birthday Alert */
        /* Origem Stats */
        .origem-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .origem-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(3px);
        }

        .origem-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .origem-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .origem-label {
            font-weight: 600;
            font-size: 14px;
        }

        .origem-count {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .origem-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 8px;
            overflow: hidden;
        }

        .origem-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Birthday Card Compact */
        .birthday-card-compact {
            background: linear-gradient(135deg, rgba(255, 210, 63, 0.15), rgba(255, 107, 53, 0.15));
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 20px;
        }

        .birthday-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 210, 63, 0.3);
        }

        .birthday-icon {
            font-size: 32px;
            animation: bounce 2s infinite;
        }

        .birthday-card-title {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }

        .birthday-list {
            display: grid;
            gap: 10px;
        }

        .birthday-item-compact {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .birthday-item-compact:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .birthday-item-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .birthday-item-contact {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .birthday-badge-compact {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .badge-today {
            background: var(--accent);
            color: #0A0E27;
        }

        .badge-tomorrow {
            background: rgba(255, 210, 63, 0.3);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .badge-soon {
            background: rgba(255, 210, 63, 0.2);
            color: var(--text-secondary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Events Page */
        .events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .events-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .events-view-toggle {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 8px;
        }

        .view-toggle-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Calendar View */
        .calendar-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .calendar-day.has-event {
            border-color: var(--success);
            background: rgba(6, 214, 160, 0.1);
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day-events {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .calendar-event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            display: inline-block;
            margin-right: 2px;
        }

        /* List View */
        .events-list-container {
            display: grid;
            gap: 15px;
        }

        .event-card-full {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            max-width: 100%;
            overflow: hidden;
        }

        .event-card-full:hover {
            background: var(--bg-card-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .event-card-full.status-confirmado {
            border-left-color: var(--success);
        }

        .event-card-full.status-pendente {
            border-left-color: var(--accent);
        }

        .event-card-full.status-cancelado {
            border-left-color: var(--danger);
        }

        .event-card-main {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .event-card-info h3 {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .event-card-client {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .event-card-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
        }

        .event-detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .event-detail-item strong {
            color: var(--text-primary);
        }

        .event-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .event-action-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Event Observations */
        .event-observations {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .event-observations-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            text-align: left;
            display: block;
        }

        /* Kanban View */
        .kanban-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .kanban-column {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }

        .kanban-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .kanban-title {
            font-family: 'Syne', sans-serif;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kanban-count {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .kanban-cards {
            display: grid;
            gap: 12px;
            min-height: 200px;
        }

        .kanban-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .kanban-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: scale(1.02);
        }

        .kanban-card-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .kanban-card-info {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        /* Clientes Page */
        .clients-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-bar {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        .clients-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .client-stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .client-stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .client-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .client-stat-info {
            flex: 1;
        }

        .client-stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .client-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clients-grid {
            display: grid;
            gap: 15px;
        }

        .client-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .client-card:hover {
            background: var(--bg-card-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .client-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .client-avatar {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .client-main-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .client-details-main h3 {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .client-email {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 4px;
        }

        .client-phone {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .client-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .client-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-birthday {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }

        .badge-origem {
            background: rgba(0, 78, 137, 0.2);
            color: var(--secondary);
        }

        .client-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .client-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .client-info-item strong {
            color: var(--text-primary);
        }

        .client-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .client-action-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .client-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .empty-state-text {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* Client Financial Info */
        .client-financial {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-top: 16px;
            transition: all 0.3s ease;
        }

        .client-financial:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }

        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .financial-title {
            font-family: 'Syne', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }

        .financial-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        .status-pending {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }

        .status-overdue {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .financial-item {
            text-align: center;
        }

        .financial-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .financial-value {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 700;
        }

        .financial-value.total {
            color: var(--text-primary);
        }

        .financial-value.paid {
            color: var(--success);
        }

        .financial-value.pending {
            color: var(--primary);
        }

        .financial-date {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .payment-progress {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        /* THEME SWITCH TOGGLE */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.4s;
            border-radius: 30px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "🌙";
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: var(--bg-card);
            transition: 0.4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .theme-switch input:checked + .theme-slider {
            background-color: var(--primary);
        }
        
        .theme-switch input:checked + .theme-slider:before {
            content: "🌙";
            transform: translateX(30px);
        }
        
        .theme-switch input:not(:checked) + .theme-slider:before {
            content: "☀️";
        }
        
        /* ============================================
           RODAPÉ
           ============================================ */
        .footer {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255, 107, 53, 0.05) 100%);
            border-top: 1px solid var(--border);
            padding: 40px 20px 20px;
            margin-top: 60px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-brand {
            font-family: 'Syne', sans-serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .footer-signature {
            font-family: 'Dancing Script', 'Pacifico', 'Great Vibes', cursive;
            font-size: 20px;
            font-weight: 500;
            color: var(--primary);
            opacity: 0.95;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }
        
        .footer-social {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 50px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .social-link:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }
        
        .social-icon {
            font-size: 20px;
        }
        
        .footer-copyright {
            font-size: 13px;
            color: var(--text-secondary);
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .footer-heart {
            color: var(--primary);
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @media (max-width: 768px) {
            .footer {
                padding: 30px 16px 15px;
                margin-top: 40px;
            }
            
            .footer-content {
                padding: 0 !important;
            }
            
            .footer-brand {
                font-size: 22px;
            }
            
            .footer-signature {
                font-size: 16px;
                margin-bottom: 20px;
            }
            
            .footer-social {
                gap: 10px;
                flex-direction: column;
                align-items: stretch;
            }
            
            .social-link {
                padding: 12px 20px;
                font-size: 13px;
                justify-content: center;
            }
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <!-- Botão Menu Mobile -->
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">☰</button>
            
            <!-- Logo Centralizada -->
            <div class="logo">
                EventProDJ
                <div style="font-family: 'Dancing Script', 'Pacifico', 'Great Vibes', cursive; font-size: 14px; font-weight: 500; color: var(--primary); opacity: 0.95; margin-top: 0px; letter-spacing: 1px;">
                    by Cristian Dj
                </div>
            </div>
            
            <!-- Navegação Desktop -->
            <nav class="main-nav">
                <button class="nav-tab active" onclick="switchTab('dashboard')">🏢 Empresa</button>
                <button class="nav-tab" onclick="switchTab('pessoal')">👤 Pessoal</button>
                <button class="nav-tab" onclick="switchTab('eventos')">Eventos</button>
                <button class="nav-tab" onclick="switchTab('clientes')">Clientes</button>
                <button class="nav-tab" onclick="switchTab('financeiro')">💰 Financeiro</button>
                <button class="nav-tab" onclick="switchTab('custos')">Custos</button>
                <button class="nav-tab" onclick="switchTab('servicos')">📦 Serviços</button>
                <button class="nav-tab" onclick="switchTab('configuracoes')">⚙️ Config</button>
            </nav>
            
            <!-- Status de Sincronização -->
            <div class="sync-status" id="syncStatus">
                <div class="sync-indicator" id="syncIndicator"></div>
                <span class="sync-text" id="syncText">Offline</span>
                <button class="sync-button" onclick="sincronizarAgora('manual')" title="Sincronizar agora">🔄</button>
            </div>
        </div>
    </header>

    <!-- Menu Mobile Lateral -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
    <nav class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <div class="logo" style="font-size: 24px;">
                EventProDJ
                <div style="font-family: 'Dancing Script', 'Pacifico', 'Great Vibes', cursive; font-size: 14px; font-weight: 500; color: var(--primary); opacity: 0.95; margin-top: 0px; letter-spacing: 1px;">
                    by Cristian Dj
                </div>
            </div>
            <button class="mobile-menu-close" onclick="closeMobileMenu()">✕</button>
        </div>
        
        <div class="mobile-nav">
            <button class="nav-tab active" onclick="switchTabMobile('dashboard')">🏢 Empresa</button>
            <button class="nav-tab" onclick="switchTabMobile('pessoal')">👤 Pessoal</button>
            <button class="nav-tab" onclick="switchTabMobile('eventos')">📅 Eventos</button>
            <button class="nav-tab" onclick="switchTabMobile('clientes')">👥 Clientes</button>
            <button class="nav-tab" onclick="switchTabMobile('financeiro')">💰 Financeiro</button>
            <button class="nav-tab" onclick="switchTabMobile('custos')">💸 Custos</button>
            <button class="nav-tab" onclick="switchTabMobile('servicos')">📦 Serviços</button>
            <button class="nav-tab" onclick="switchTabMobile('configuracoes')">⚙️ Configurações</button>
        </div>
        
        <div class="mobile-sync">
            <div class="sync-status" style="width: 100%; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="sync-indicator" id="syncIndicatorMobile"></div>
                    <span class="sync-text" id="syncTextMobile">Offline</span>
                </div>
                <button class="sync-button" onclick="sincronizarAgora('manual')" title="Sincronizar agora">🔄</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
        <div class="dashboard">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard Financeiro</h1>
                <p class="dashboard-subtitle">Gestão completa para sua empresa de eventos</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                <div class="stat-card">
                    <div class="stat-icon bg-success">💰</div>
                    <div class="stat-label">Receitas do Mês</div>
                    <div class="stat-value" id="totalReceitas">R$ 0,00</div>
                    <div class="stat-change positive">
                        <span>↗</span>
                        <span id="percentReceitas">0%</span> vs mês anterior
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(79, 70, 229, 0.2); color: #4F46E5;">⏳</div>
                    <div class="stat-label">Valores a Receber</div>
                    <div class="stat-value" id="valoresAReceberDashboard">R$ 0,00</div>
                    <div class="stat-change" style="color: #4F46E5;">
                        <span>📅</span>
                        <span id="numClientesPendentes">0</span> clientes
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-danger">💸</div>
                    <div class="stat-label">Despesas do Mês</div>
                    <div class="stat-value" id="totalDespesas">R$ 0,00</div>
                    <div class="stat-change negative">
                        <span>↘</span>
                        <span id="percentDespesas">0%</span> vs mês anterior
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(255, 107, 53, 0.2); color: var(--primary);">🎯</div>
                    <div class="stat-label">Custos de Eventos</div>
                    <div class="stat-value" id="totalCustosEventos">R$ 0,00</div>
                    <div class="stat-change" style="color: var(--primary);">
                        <span>📊</span>
                        <span id="numeroCustosEventos">0</span> lançamentos
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-primary">📈</div>
                    <div class="stat-label">Lucro Líquido</div>
                    <div class="stat-value" id="lucroLiquido">R$ 0,00</div>
                    <div class="stat-change positive">
                        <span>↗</span>
                        <span id="percentLucro">0%</span> margem
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-accent">🎉</div>
                    <div class="stat-label">Eventos em Andamento</div>
                    <div class="stat-value" id="totalEventosAndamento">0</div>
                    <div class="stat-change positive">
                        <span>📅</span>
                        <span id="eventosDoMes">0</span> neste mês
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(6, 214, 160, 0.2); color: var(--success);">✅</div>
                    <div class="stat-label">Eventos Concluídos</div>
                    <div class="stat-value" id="totalEventosConcluidos">0</div>
                    <div class="stat-change" style="color: var(--success);">
                        <span>📊</span>
                        <span id="eventosConcluidosAno">0</span> em 2026
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="content-grid">
                <!-- Quick Actions & Events -->
                <div class="dashboard-column-actions">
                    <div class="card card-acoes-rapidas" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <h2 class="card-title">Ações Rápidas</h2>
                        </div>
                        <div class="quick-actions">
                            <button class="action-btn" onclick="openModal('cliente')">
                                <div class="action-icon bg-accent">👥</div>
                                <div class="action-text">
                                    <h4>Cliente</h4>
                                    <p>Cadastrar cliente</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('orcamento')">
                                <div class="action-icon bg-secondary">📋</div>
                                <div class="action-text">
                                    <h4>Orçamento</h4>
                                    <p>Criar orçamento</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('evento')">
                                <div class="action-icon bg-primary">🎉</div>
                                <div class="action-text">
                                    <h4>Novo Evento</h4>
                                    <p>Cadastrar evento</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('servico')">
                                <div class="action-icon bg-success">🛠️</div>
                                <div class="action-text">
                                    <h4>Serviços</h4>
                                    <p>Gerenciar serviços</p>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="card card-proximos-eventos">
                        <div class="card-header">
                            <h2 class="card-title">Próximos Eventos</h2>
                        </div>
                        <div class="events-grid" id="eventsList">
                            <!-- Events will be inserted here -->
                        </div>
                    </div>

                    <!-- Origem dos Clientes -->
                    <div class="card card-origem-clientes" style="margin-top: 20px;">
                        <div class="card-header">
                            <h2 class="card-title">Origem dos Clientes</h2>
                        </div>
                        <div id="origemStats">
                            <!-- Origem stats will be inserted here -->
                        </div>
                    </div>

                    <!-- Aniversariantes Card Compacto -->
                    <div id="birthdayAlertsCompact" style="margin-top: 20px;"></div>
                </div>
                
                <!-- Transactions -->
                <div class="card dashboard-column-transactions">
                    <div class="card-header">
                        <h2 class="card-title">Transações Recentes</h2>
                        <button class="btn btn-secondary" onclick="openModal('custoGeral')">+ Despesa</button>
                    </div>
                    <div id="transactionsList">
                        <!-- Transactions will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Eventos Tab -->
        <div id="eventosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gestão de Eventos</h1>
                    <p class="dashboard-subtitle">Organize e gerencie todos os seus eventos</p>
                </div>

                <div class="events-header">
                    <div class="events-filters">
                        <button class="filter-btn active" onclick="filterEvents('andamento')">Em Andamento</button>
                        <button class="filter-btn" onclick="filterEvents('aguardando')">Aguardando Aprovação</button>
                        <button class="filter-btn" onclick="filterEvents('concluido')">Concluído</button>
                        <button class="filter-btn" onclick="filterEvents('todos')">Todos</button>
                        <button class="filter-btn" onclick="filterEvents('cancelado')">Cancelados</button>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="events-view-toggle">
                            <button class="view-toggle-btn active" onclick="switchEventView('list')" title="Lista">📋</button>
                            <button class="view-toggle-btn" onclick="switchEventView('calendar')" title="Calendário">📅</button>
                            <button class="view-toggle-btn" onclick="switchEventView('kanban')" title="Kanban">📊</button>
                        </div>
                        <button class="btn btn-primary" onclick="openModal('evento')">+ Novo Evento</button>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendarView" style="display: none;">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h3 class="calendar-month" id="calendarMonth">Janeiro 2026</h3>
                            <div class="calendar-nav">
                                <button class="calendar-nav-btn" onclick="previousMonth()">◀</button>
                                <button class="calendar-nav-btn" onclick="todayMonth()">Hoje</button>
                                <button class="calendar-nav-btn" onclick="nextMonth()">▶</button>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- List View -->
                <div id="listView">
                    <div class="events-list-container" id="eventsListFull">
                        <!-- Events will be rendered here -->
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanbanView" style="display: none;">
                    <div class="kanban-container">
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--accent);">⏳ Pendentes</span>
                                <span class="kanban-count" id="kanbanPendenteCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanPendente">
                                <!-- Pendente cards -->
                            </div>
                        </div>
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--success);">✅ Confirmados</span>
                                <span class="kanban-count" id="kanbanConfirmadoCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanConfirmado">
                                <!-- Confirmado cards -->
                            </div>
                        </div>
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--danger);">❌ Cancelados</span>
                                <span class="kanban-count" id="kanbanCanceladoCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanCancelado">
                                <!-- Cancelado cards -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Eventos Tab -->

        <!-- Clientes Tab -->
        <div id="clientesTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gestão de Clientes</h1>
                    <p class="dashboard-subtitle">Mantenha todos os seus clientes organizados</p>
                </div>

                <div class="clients-header">
                    <div class="search-bar">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" id="clientSearch" placeholder="Buscar cliente por nome, email ou telefone..." oninput="searchClients()">
                    </div>
                    <button class="btn btn-primary" onclick="openModal('cliente')">+ Novo Cliente</button>
                </div>

                <!-- Client Stats -->
                <div class="stats-grid" style="margin-bottom: 25px;">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary">👥</div>
                        <div class="stat-label">Total de Clientes</div>
                        <div class="stat-value" id="totalClientes">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-success">🎂</div>
                        <div class="stat-label">Aniversários Este Mês</div>
                        <div class="stat-value" id="aniversariantesProximos">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-accent">📸</div>
                        <div class="stat-label">Via Instagram</div>
                        <div class="stat-value" id="clientesInstagram">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-secondary">🤝</div>
                        <div class="stat-label">Via Facebook</div>
                        <div class="stat-value" id="clientesFacebook">0</div>
                    </div>
                </div>

                <!-- Clients List -->
                <div class="clients-grid" id="clientsList">
                    <!-- Clients will be rendered here -->
                </div>
            </div>
        </div>
        <!-- End Clientes Tab -->

        <!-- Financeiro Tab -->
        <div id="financeiroTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">💰 Gestão Financeira</h1>
                    <p class="dashboard-subtitle">Controle completo de receitas, despesas e contas bancárias</p>
                </div>
                
                <!-- Filtros de Período -->
                <div style="background: var(--card-bg); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📅 Mês</label>
                            <select id="filtroMesFinanceiro" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <option value="todos">Todos os meses</option>
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Março</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📆 Ano</label>
                            <select id="filtroAnoFinanceiro" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <!-- Será preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📊 Visualização</label>
                            <select id="tipoVisualizacao" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="resetarFiltrosFinanceiro()" style="height: 42px;">
                            🔄 Limpar
                        </button>
                    </div>
                </div>

                <!-- Sub-navegação Financeira -->
                <div style="display: flex; gap: 12px; margin-bottom: 24px; background: var(--card-bg); padding: 16px; border-radius: 12px;">
                    <button class="btn btn-primary" id="btnFinanceiroVisaoGeral" onclick="mostrarFinanceiroVisaoGeral()" style="flex: 1;">
                        📊 Visão Geral
                    </button>
                    <button class="btn btn-secondary" id="btnFinanceiroPorConta" onclick="mostrarFinanceiroPorConta()" style="flex: 1;">
                        🏦 Por Conta
                    </button>
                    <button class="btn btn-secondary" id="btnFinanceiroContas" onclick="mostrarFinanceiroContas()" style="flex: 1;">
                        ⚙️ Gerenciar Contas
                    </button>
                </div>

                <!-- Visão Geral -->
                <div id="financeiroVisaoGeral">
                    <!-- Cards de Resumo -->
                    <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                        <!-- 1. Total de Receitas -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(6, 214, 160, 0.2), rgba(6, 214, 160, 0.05));">
                            <div class="stat-icon">💰</div>
                            <div class="stat-info">
                                <div class="stat-label">Total de Receitas</div>
                                <div class="stat-value" id="financeiroTotalReceitas">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <!-- 2. Valores a Receber -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(79, 70, 229, 0.05));">
                            <div class="stat-icon">⏳</div>
                            <div class="stat-info">
                                <div class="stat-label">Valores a Receber</div>
                                <div class="stat-value" id="financeiroValoresAReceber">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <!-- 3. Despesas do Mês (NOVO) -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(239, 71, 111, 0.2), rgba(239, 71, 111, 0.05));">
                            <div class="stat-icon">💸</div>
                            <div class="stat-info">
                                <div class="stat-label">Despesas do Mês</div>
                                <div class="stat-value" id="financeiroDespesasMes">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <!-- 4. Custos de Eventos -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.05));">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-info">
                                <div class="stat-label">Custos de Eventos</div>
                                <div class="stat-value" id="financeiroCustosEventos">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <!-- 5. Total de Despesas -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.05));">
                            <div class="stat-icon">📊</div>
                            <div class="stat-info">
                                <div class="stat-label">Total de Despesas</div>
                                <div class="stat-value" id="financeiroTotalDespesas">R$ 0,00</div>
                            </div>
                        </div>
                        
                        <!-- 6. Lucro Líquido -->
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 210, 63, 0.2), rgba(255, 210, 63, 0.05));">
                            <div class="stat-icon">📈</div>
                            <div class="stat-info">
                                <div class="stat-label">Lucro Líquido</div>
                                <div class="stat-value" id="financeiroLucro">R$ 0,00</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card de Origem dos Pagamentos -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2 class="card-title">💳 Origem dos Pagamentos</h2>
                        </div>
                        <div id="origemPagamentosContainer" style="padding: 0 20px 20px;">
                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>
                        </div>
                    </div>
                    
                    <!-- Breakdown Anual (quando filtrar por ano) -->
                    <div id="breakdownAnual" style="display: none;"></div>

                    <!-- Gráfico de Pizza Formas de Pagamento -->
                    <div class="card" style="margin-top: 24px;">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">📊 Receitas por Forma de Pagamento</h3>
                        <div id="graficoFormasPagamento" style="display: grid; gap: 12px;">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>

                    <!-- Últimas Transações -->
                    <div class="card" style="margin-top: 24px;">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">📝 Últimas Transações</h3>
                        <div id="ultimasTransacoes">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Visão Por Conta -->
                <div id="financeiroPorConta" style="display: none;">
                    <div class="card">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">💳 Saldo por Conta Bancária</h3>
                        <div id="listaContasComSaldo">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>

                    <!-- Detalhes da Conta Selecionada -->
                    <div id="detalhesConta" style="margin-top: 24px; display: none;">
                        <div class="card">
                            <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;" id="detalheContaTitulo">
                                <!-- Nome da conta -->
                            </h3>
                            
                            <div class="stats-grid" style="margin-bottom: 24px;">
                                <div class="stat-card" style="background: rgba(6, 214, 160, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Total Recebido</div>
                                        <div class="stat-value" id="detalheContaReceitas">R$ 0,00</div>
                                    </div>
                                </div>
                                <div class="stat-card" style="background: rgba(239, 71, 111, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Total Pago</div>
                                        <div class="stat-value" id="detalheContaDespesas">R$ 0,00</div>
                                    </div>
                                </div>
                                <div class="stat-card" style="background: rgba(255, 210, 63, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Saldo Atual</div>
                                        <div class="stat-value" id="detalheContaSaldo">R$ 0,00</div>
                                    </div>
                                </div>
                            </div>

                            <h4 style="font-size: 16px; margin-bottom: 12px; color: var(--text-secondary);">Transações desta Conta</h4>
                            <div id="detalheContaTransacoes">
                                <!-- Será preenchido dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gerenciar Contas -->
                <div id="financeiroContas" style="display: none;">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="font-family: 'Syne', sans-serif;">🏦 Contas Bancárias</h3>
                            <button class="btn btn-primary" onclick="openModal('conta')">+ Nova Conta</button>
                        </div>
                        <div id="listaContasBancarias">
                            <!-- Será preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Financeiro Tab -->

        <!-- Custos Tab -->
        <div id="custosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gestão de Custos</h1>
                    <p class="dashboard-subtitle">Controle todos os gastos da empresa e dos eventos</p>
                </div>

                <!-- Filtros de Período -->
                <div style="background: var(--card-bg); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📅 Mês</label>
                            <select id="filtroMesCustos" class="form-select" onchange="atualizarCustosPorPeriodo()">
                                <option value="todos">Todos os meses</option>
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Março</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📆 Ano</label>
                            <select id="filtroAnoCustos" class="form-select" onchange="atualizarCustosPorPeriodo()">
                                <!-- Será preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📊 Visualização</label>
                            <select id="tipoVisualizacaoCustos" class="form-select" onchange="atualizarCustosPorPeriodo()">
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="resetarFiltrosCustos()" style="height: 42px;">
                            🔄 Limpar
                        </button>
                    </div>
                </div>

                <!-- Toggle entre Custos Gerais e Por Evento -->
                <div style="display: flex; gap: 15px; margin-bottom: 25px; background: var(--bg-card); padding: 8px; border-radius: 12px; width: fit-content;">
                    <button class="filter-btn active" onclick="toggleCustosView('gerais')">
                        🏢 Custos Gerais da Empresa
                    </button>
                    <button class="filter-btn" onclick="toggleCustosView('eventos')">
                        🎉 Custos por Evento
                    </button>
                </div>

                <!-- Custos Gerais View -->
                <div id="custosGeraisView">
                    <div class="events-header" style="margin-bottom: 20px;">
                        <h2 style="font-family: 'Syne', sans-serif; font-size: 22px; color: var(--primary);">
                            💼 Custos Gerais da Empresa
                        </h2>
                        <button class="btn btn-primary" onclick="openModal('custoGeral')">+ Novo Custo</button>
                    </div>

                    <!-- Stats Custos Gerais -->
                    <div class="stats-grid" style="margin-bottom: 25px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <div class="stat-card">
                            <div class="stat-icon bg-danger">💸</div>
                            <div class="stat-label">Total do Mês</div>
                            <div class="stat-value" id="totalCustosGeraisMes">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-accent">⛽</div>
                            <div class="stat-label">Combustível</div>
                            <div class="stat-value" id="totalCombustivel">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-secondary">📋</div>
                            <div class="stat-label">Impostos</div>
                            <div class="stat-value" id="totalImpostos">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(79, 70, 229, 0.2); color: #4F46E5;">📣</div>
                            <div class="stat-label">Marketing</div>
                            <div class="stat-value" id="totalMarketing">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">🏪</div>
                            <div class="stat-label">Outros</div>
                            <div class="stat-value" id="totalOutrosCustos">R$ 0,00</div>
                        </div>
                    </div>

                    <!-- Lista de Custos Gerais -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Histórico de Custos Gerais</h3>
                        </div>
                        <div id="custosGeraisList" style="display: grid; gap: 12px;">
                            <!-- Custos gerais serão renderizados aqui -->
                        </div>
                    </div>
                </div>

                <!-- Custos por Evento View -->
                <div id="custosEventosView" style="display: none;">
                    <!-- Card de Total Geral -->
                    <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.05));">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 4px; color: var(--primary);">
                                    📊 Total Geral de Custos
                                </h3>
                                <p style="font-size: 13px; color: var(--text-secondary); margin: 0;">
                                    Soma de todos os custos de eventos
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 28px; font-weight: 700; color: var(--primary);" id="totalGeralCustosEventos">
                                    R$ 0,00
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);" id="quantidadeEventosComCustos">
                                    0 eventos com custos
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="events-header" style="margin-bottom: 20px;">
                        <h2 style="font-family: 'Syne', sans-serif; font-size: 22px; color: var(--primary);">
                            🎉 Detalhes por Evento
                        </h2>
                        <select class="form-select" id="eventoSelecionado" onchange="renderCustosEvento()" style="max-width: 400px; background: var(--bg-card); color: var(--text-primary);">
                            <option value="todos" selected>📊 Todos os Eventos</option>
                            <option value="">Selecione um evento específico...</option>
                        </select>
                    </div>

                    <div id="custoEventoContent" style="display: none;">
                        <!-- Info do Evento Selecionado -->
                        <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 210, 63, 0.1));">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h3 id="eventoNome" style="font-family: 'Syne', sans-serif; font-size: 20px; margin-bottom: 8px;"></h3>
                                    <div id="eventoInfo" style="color: var(--text-secondary); font-size: 14px;"></div>
                                </div>
                                <button class="btn btn-primary" onclick="openModalCustoEvento()">+ Adicionar Custo</button>
                            </div>
                        </div>

                        <!-- Resumo Financeiro do Evento -->
                        <div class="stats-grid" style="margin-bottom: 25px;">
                            <div class="stat-card">
                                <div class="stat-icon bg-success">💰</div>
                                <div class="stat-label">Valor do Evento</div>
                                <div class="stat-value" id="eventoValorTotal">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-danger">💸</div>
                                <div class="stat-label">Total de Custos</div>
                                <div class="stat-value" id="eventoTotalCustos">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-primary">📊</div>
                                <div class="stat-label">Lucro Líquido</div>
                                <div class="stat-value" id="eventoLucro">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-accent">📈</div>
                                <div class="stat-label">Margem de Lucro</div>
                                <div class="stat-value" id="eventoMargem">0%</div>
                            </div>
                        </div>

                        <!-- Lista de Custos do Evento -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Detalhamento de Custos</h3>
                            </div>
                            <div id="custosEventoList" style="display: grid; gap: 12px;">
                                <!-- Custos do evento serão renderizados aqui -->
                            </div>
                        </div>
                    </div>

                    <div id="custoEventoEmpty" style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.5;">📊</div>
                        <h3 style="color: var(--text-secondary); margin-bottom: 8px;">Selecione um evento</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Escolha um evento acima para ver e gerenciar seus custos
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Custos Tab -->
        <!-- End Custos Tab -->

        <!-- Serviços Tab -->
        <div id="servicosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">📦 Gestão de Serviços</h1>
                    <p class="dashboard-subtitle">Análise completa de performance e rentabilidade dos seus serviços</p>
                </div>

                <!-- Filtros de Período -->
                <div style="background: var(--card-bg); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📅 Mês</label>
                            <select id="filtroMesServicos" class="form-select" onchange="atualizarServicosPorPeriodo()">
                                <option value="todos">Todos os meses</option>
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Março</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📆 Ano</label>
                            <select id="filtroAnoServicos" class="form-select" onchange="atualizarServicosPorPeriodo()">
                                <!-- Será preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">📊 Visualização</label>
                            <select id="tipoVisualizacaoServicos" class="form-select" onchange="atualizarServicosPorPeriodo()">
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="resetarFiltrosServicos()" style="height: 42px;">
                            🔄 Limpar
                        </button>
                    </div>
                </div>

                <!-- Cards de Resumo -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(6, 214, 160, 0.2), rgba(6, 214, 160, 0.05));">
                        <div class="stat-icon">📦</div>
                        <div class="stat-info">
                            <div class="stat-label">Total de Serviços</div>
                            <div class="stat-value" id="totalServicos">0</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 210, 63, 0.2), rgba(255, 210, 63, 0.05));">
                        <div class="stat-icon">📊</div>
                        <div class="stat-info">
                            <div class="stat-label">Total de Locações</div>
                            <div class="stat-value" id="totalLocacoes">0</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(79, 70, 229, 0.05));">
                        <div class="stat-icon">💰</div>
                        <div class="stat-info">
                            <div class="stat-label">Receita Total</div>
                            <div class="stat-value" id="receitaTotalServicos">R$ 0,00</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.05));">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-info">
                            <div class="stat-label">Serviço Mais Popular</div>
                            <div class="stat-value" id="servicoMaisPopular" style="font-size: 16px;">-</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Serviços com Estatísticas -->
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="card-title">📊 Performance dos Serviços</h2>
                        <button class="btn btn-primary" onclick="openModal('servico')">+ Novo Serviço</button>
                    </div>
                    <div id="servicosPerformanceList">
                        <!-- Será preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Top 5 Serviços -->
                <div class="content-grid" style="margin-top: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">🏆 Top 5 Mais Contratados</h2>
                        </div>
                        <div id="topServicosContratados"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">💎 Top 5 Mais Rentáveis</h2>
                        </div>
                        <div id="topServicosRentaveis"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Serviços Tab -->

        <!-- Configurações Tab -->
        <div id="configuracoesTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">⚙️ Configurações</h1>
                    <p class="dashboard-subtitle">Personalize seu sistema e configure dados da empresa</p>
                </div>

                <!-- Sub-navegação Configurações -->
                <div style="display: flex; gap: 12px; margin-bottom: 24px; background: var(--card-bg); padding: 16px; border-radius: 12px; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="btnConfigPerfil" onclick="mostrarConfigSecao('perfil')" style="flex: 1; min-width: 150px;">
                        👤 Perfil da Empresa
                    </button>
                    <button class="btn btn-secondary" id="btnConfigDocumentos" onclick="mostrarConfigSecao('documentos')" style="flex: 1; min-width: 150px;">
                        📄 Documentos
                    </button>
                    <button class="btn btn-secondary" id="btnConfigLogo" onclick="mostrarConfigSecao('logo')" style="flex: 1; min-width: 150px;">
                        🎨 Logo
                    </button>
                    <button class="btn btn-secondary" id="btnConfigTema" onclick="console.log('🌓 Botão TEMA clicado!'); mostrarConfigSecao('tema');" style="flex: 1; min-width: 150px;">
                        🌓 Tema
                    </button>
                    <button class="btn btn-secondary" id="btnConfigSync" onclick="mostrarConfigSecao('sync')" style="flex: 1; min-width: 150px;">
                        ☁️ Sincronização
                    </button>
                </div>

                <!-- Seção: Perfil da Empresa -->
                <div id="configPerfilSecao">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">👤 Perfil da Empresa</h2>
                        </div>
                        <form onsubmit="salvarConfigEmpresa(event)" style="padding: 24px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Nome da Empresa *</label>
                                    <input type="text" class="form-input" id="configNomeEmpresa" required placeholder="Ex: EventProDJ Produções">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nome Corporativo</label>
                                    <input type="text" class="form-input" id="configNomeCorporativo" placeholder="Ex: EventProDJ Produções LTDA">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">CNPJ</label>
                                    <input type="text" class="form-input" id="configCNPJ" placeholder="00.000.000/0000-00" maxlength="18" oninput="formatCNPJ(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telefone *</label>
                                    <input type="text" class="form-input" id="configTelefone" required placeholder="(00) 00000-0000" maxlength="15" oninput="formatTelefone(this)">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">WhatsApp Business</label>
                                    <input type="text" class="form-input" id="configWhatsapp" placeholder="(00) 00000-0000" maxlength="15" oninput="formatTelefone(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">E-mail</label>
                                    <input type="email" class="form-input" id="configEmail" placeholder="contato@eventpro.com">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Cidade</label>
                                    <input type="text" class="form-input" id="configCidade" placeholder="Ex: Rio de Janeiro">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Estado</label>
                                    <input type="text" class="form-input" id="configEstado" placeholder="Ex: RJ" maxlength="2">
                                </div>
                            </div>

                            <div style="background: rgba(79, 70, 229, 0.1); padding: 16px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #4F46E5;">
                                <h4 style="margin-bottom: 12px; color: #4F46E5;">🌐 Redes Sociais</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Instagram</label>
                                        <input type="text" class="form-input" id="configInstagram" placeholder="@eventpro">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Facebook</label>
                                        <input type="text" class="form-input" id="configFacebook" placeholder="facebook.com/eventpro">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">YouTube</label>
                                        <input type="text" class="form-input" id="configYoutube" placeholder="youtube.com/@eventpro">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="url" class="form-input" id="configSite" placeholder="https://eventpro.com">
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                                <button type="submit" class="btn btn-primary">
                                    ✅ Salvar Configurações
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Seção: Documentos -->
                <div id="configDocumentosSecao" style="display: none;">
                    <!-- Contrato -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h2 class="card-title">📝 Contrato</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Configure o texto do contrato que será enviado aos seus clientes
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <div class="form-group">
                                <label class="form-label">Texto do Contrato</label>
                                <textarea 
                                    id="configClausulasContratuais" 
                                    class="form-input" 
                                    rows="15" 
                                    style="font-family: 'IBM Plex Mono', monospace; font-size: 13px; line-height: 1.6;"
                                    placeholder="Digite aqui as cláusulas do contrato...

Exemplo:

CONTRATO DE PRESTAÇÃO DE SERVIÇOS DE EVENTOS

1. DO OBJETO
O presente contrato tem por objeto a prestação de serviços de [TIPO DE SERVIÇO] pela CONTRATADA em favor do CONTRATANTE.

2. DAS CONDIÇÕES
2.1. Data do Evento: [DATA]
2.2. Horário: [HORÁRIO]
2.3. Local: [ENDEREÇO]

3. DO VALOR E FORMA DE PAGAMENTO
3.1. O valor total do serviço é de R$ [VALOR]
3.2. Sinal de R$ [SINAL] pago em [DATA]
3.3. Restante de R$ [RESTANTE] até [VENCIMENTO]

4. DAS OBRIGAÇÕES DA CONTRATADA
...

5. DAS OBRIGAÇÕES DO CONTRATANTE
...

6. DO CANCELAMENTO
...

7. DISPOSIÇÕES GERAIS
..."
                                ></textarea>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                                    💡 Dica: Use placeholders como [DATA], [VALOR], [CLIENTE] que serão substituídos automaticamente
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="salvarClausulasContratuais()" class="btn btn-primary">
                                    ✅ Salvar Contrato
                                </button>
                                <button onclick="resetarClausulas()" class="btn btn-secondary">
                                    🔄 Resetar para Padrão
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Orçamento -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h2 class="card-title">💼 Orçamento</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Configure o modelo de orçamento que será enviado aos seus clientes
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <div class="form-group">
                                <label class="form-label">Texto do Orçamento</label>
                                <textarea 
                                    id="configModeloOrcamento" 
                                    class="form-input" 
                                    rows="15" 
                                    style="font-family: 'IBM Plex Mono', monospace; font-size: 13px; line-height: 1.6;"
                                    placeholder="Digite aqui o modelo do orçamento...

Exemplo:

ORÇAMENTO DE SERVIÇOS

Prezado(a) [CLIENTE],

Segue orçamento para os serviços solicitados:

DADOS DO EVENTO:
- Tipo: [TIPO]
- Data: [DATA]
- Horário: [HORARIO]
- Local: [LOCAL]

SERVIÇOS INCLUSOS:
[SERVICOS]

VALOR TOTAL: R$ [VALOR]

CONDIÇÕES DE PAGAMENTO:
- Sinal: R$ [SINAL] (50%)
- Restante: R$ [RESTANTE] até [VENCIMENTO]

VALIDADE DO ORÇAMENTO: [VALIDADE]

Atenciosamente,
[EMPRESA]"
                                ></textarea>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                                    💡 Placeholders: [CLIENTE], [DATA], [VALOR], [EMPRESA], etc.
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="salvarModeloOrcamento()" class="btn btn-primary">
                                    ✅ Salvar Orçamento
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Recibo -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">🧾 Recibo</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Configure o modelo de recibo que será emitido aos seus clientes
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <div class="form-group">
                                <label class="form-label">Texto do Recibo</label>
                                <textarea 
                                    id="configModeloRecibo" 
                                    class="form-input" 
                                    rows="15" 
                                    style="font-family: 'IBM Plex Mono', monospace; font-size: 13px; line-height: 1.6;"
                                    placeholder="Digite aqui o modelo do recibo...

Exemplo:

RECIBO DE PAGAMENTO

Recebi de [CLIENTE], CPF/CNPJ [CPF], a quantia de R$ [VALOR] ([VALOR_EXTENSO]), referente a [DESCRICAO].

DADOS DO PAGAMENTO:
- Forma: [FORMA_PAGAMENTO]
- Data: [DATA]
- Referente a: [EVENTO]

Local e Data: [CIDADE], [DATA_COMPLETA]

_______________________________
[EMPRESA]
CNPJ: [CNPJ]"
                                ></textarea>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                                    💡 Placeholders: [CLIENTE], [VALOR], [DATA], [EMPRESA], [CNPJ], etc.
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="salvarModeloRecibo()" class="btn btn-primary">
                                    ✅ Salvar Recibo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção: Logo -->
                <div id="configLogoSecao" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">🎨 Logo da Empresa</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Adicione a logo da sua empresa para usar em orçamentos e documentos
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <!-- Preview da Logo -->
                            <div style="text-align: center; margin-bottom: 30px;">
                                <div id="logoPreview" style="min-height: 200px; background: rgba(255, 255, 255, 0.05); border: 2px dashed var(--border); border-radius: 12px; display: flex; align-items: center; justify-content: center; padding: 40px;">
                                    <div id="logoPlaceholder" style="text-align: center; color: var(--text-secondary);">
                                        <div style="font-size: 48px; margin-bottom: 16px;">🎨</div>
                                        <div style="font-size: 14px;">Nenhuma logo carregada</div>
                                        <div style="font-size: 12px; margin-top: 8px;">Clique no botão abaixo para adicionar</div>
                                    </div>
                                    <img id="logoImage" style="max-width: 100%; max-height: 300px; display: none; border-radius: 8px;">
                                </div>
                            </div>

                            <!-- Upload -->
                            <div style="text-align: center;">
                                <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                                <button onclick="document.getElementById('logoUpload').click()" class="btn btn-primary" style="margin-right: 12px;">
                                    📤 Carregar Logo
                                </button>
                                <button onclick="removerLogo()" class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                                    🗑️ Remover Logo
                                </button>
                            </div>

                            <div style="background: rgba(255, 210, 63, 0.1); padding: 16px; border-radius: 8px; margin-top: 24px; border-left: 4px solid var(--accent);">
                                <strong style="color: var(--accent);">⚠️ Requisitos da Imagem:</strong>
                                <ul style="margin: 8px 0 0 20px; font-size: 13px; color: var(--text-secondary);">
                                    <li>Formato: JPG, PNG ou SVG</li>
                                    <li>Tamanho máximo: 2MB</li>
                                    <li>Recomendado: Fundo transparente (PNG)</li>
                                    <li>Proporção ideal: 2:1 (horizontal)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Seção: Tema -->
                <div id="configTemaSecao" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">🌓 Aparência do Sistema</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Escolha entre tema claro ou escuro para uma melhor experiência visual
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <!-- Toggle de Tema -->
                            <div style="background: rgba(79, 70, 229, 0.1); padding: 24px; border-radius: 12px; border: 1px solid var(--border);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <div>
                                        <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 8px;">
                                            Modo Escuro
                                        </h3>
                                        <p style="font-size: 13px; color: var(--text-secondary);">
                                            Ative para reduzir o cansaço visual em ambientes com pouca luz
                                        </p>
                                    </div>
                                    
                                    <!-- Switch Toggle -->
                                    <label class="theme-switch">
                                        <input type="checkbox" id="themeToggle" onchange="toggleTheme()" checked>
                                        <span class="theme-slider"></span>
                                    </label>
                                </div>
                                
                                <!-- Preview dos Temas -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 24px;">
                                    <!-- Tema Claro -->
                                    <div style="border: 2px solid var(--border); border-radius: 8px; overflow: hidden; cursor: pointer;" onclick="console.log('☀️ Card CLARO clicado'); setTheme('light', true);">
                                        <div style="background: #F5F7FA; padding: 16px; text-align: center;">
                                            <div style="font-size: 32px; margin-bottom: 8px;">☀️</div>
                                            <div style="font-weight: 600; color: #1A202C;">Tema Claro</div>
                                            <div style="font-size: 11px; color: #718096; margin-top: 4px;">Ideal para ambientes claros</div>
                                        </div>
                                        <div style="background: #FFFFFF; padding: 12px;">
                                            <div style="background: #E2E8F0; height: 4px; border-radius: 2px; margin-bottom: 6px;"></div>
                                            <div style="background: #E2E8F0; height: 4px; border-radius: 2px; width: 70%;"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tema Escuro -->
                                    <div style="border: 2px solid var(--primary); border-radius: 8px; overflow: hidden; cursor: pointer;" onclick="console.log('🌙 Card ESCURO clicado'); setTheme('dark', true);">
                                        <div style="background: #0A0E27; padding: 16px; text-align: center;">
                                            <div style="font-size: 32px; margin-bottom: 8px;">🌙</div>
                                            <div style="font-weight: 600; color: #FFFFFF;">Tema Escuro</div>
                                            <div style="font-size: 11px; color: #A0AEC0; margin-top: 4px;">Reduz cansaço visual</div>
                                        </div>
                                        <div style="background: #141B3D; padding: 12px;">
                                            <div style="background: #2D3561; height: 4px; border-radius: 2px; margin-bottom: 6px;"></div>
                                            <div style="background: #2D3561; height: 4px; border-radius: 2px; width: 70%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Seção: Sincronização com Nuvem -->
                <div id="configSyncSecao" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">☁️ Sincronização com Nuvem</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Configure o Firebase para sincronizar seus dados na nuvem e acessar de qualquer dispositivo
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <!-- Status da Conexão -->
                            <div id="firebaseStatus" style="background: rgba(239, 71, 111, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 24px; border-left: 4px solid var(--danger);">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="font-size: 32px;">❌</div>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">Firebase não configurado</div>
                                        <div style="font-size: 13px; color: var(--text-secondary);">
                                            Preencha os dados abaixo para ativar a sincronização
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Instruções -->
                            <div style="background: rgba(79, 70, 229, 0.1); padding: 16px; border-radius: 8px; margin-bottom: 24px; border-left: 4px solid #4F46E5;">
                                <h4 style="margin-bottom: 12px; color: #4F46E5;">📖 Como Configurar:</h4>
                                <ol style="margin: 0 0 0 20px; font-size: 13px; color: var(--text-secondary); line-height: 1.8;">
                                    <li>Acesse <a href="https://console.firebase.google.com" target="_blank" style="color: var(--primary);">Firebase Console</a></li>
                                    <li>Crie um novo projeto ou selecione um existente</li>
                                    <li>Vá em "Realtime Database" e crie um banco de dados</li>
                                    <li>Em "Configurações do Projeto" → "Geral", role até "Seus aplicativos"</li>
                                    <li>Clique em "Adicionar app" → Web (&lt;/&gt;)</li>
                                    <li>Copie as credenciais do Firebase Config</li>
                                    <li>Cole os valores nos campos abaixo</li>
                                </ol>
                            </div>

                            <!-- Formulário de Configuração -->
                            <form onsubmit="salvarConfigFirebase(event)">
                                <div class="form-group">
                                    <label class="form-label">API Key *</label>
                                    <input type="text" class="form-input" id="firebaseApiKey" placeholder="AIzaSy...">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Auth Domain *</label>
                                    <input type="text" class="form-input" id="firebaseAuthDomain" placeholder="seu-projeto.firebaseapp.com">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Database URL *</label>
                                    <input type="text" class="form-input" id="firebaseDatabaseURL" placeholder="https://seu-projeto.firebaseio.com">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Project ID *</label>
                                    <input type="text" class="form-input" id="firebaseProjectId" placeholder="seu-projeto">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Storage Bucket</label>
                                    <input type="text" class="form-input" id="firebaseStorageBucket" placeholder="seu-projeto.appspot.com">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Messaging Sender ID</label>
                                    <input type="text" class="form-input" id="firebaseMessagingSenderId" placeholder="123456789">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">App ID *</label>
                                    <input type="text" class="form-input" id="firebaseAppId" placeholder="1:123456789:web:abc123">
                                </div>

                                <div style="display: flex; gap: 12px; margin-top: 24px;">
                                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                                        💾 Salvar e Conectar
                                    </button>
                                    <button type="button" onclick="testarConexaoFirebase()" class="btn btn-secondary" style="flex: 1;">
                                        🔌 Testar Conexão
                                    </button>
                                    <button type="button" onclick="limparConfigFirebase()" class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                                        🗑️ Limpar
                                    </button>
                                </div>
                            </form>

                            <!-- Ações de Sincronização -->
                            <div style="margin-top: 32px; padding-top: 24px; border-top: 2px solid var(--border);">
                                <h4 style="margin-bottom: 16px;">⚡ Ações Rápidas</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                                    <button onclick="sincronizarAgora('manual')" class="btn btn-primary" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                        🔄 Sincronizar Agora
                                    </button>
                                    <button onclick="baixarDaNuvem()" class="btn btn-secondary" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                        ☁️ Baixar da Nuvem
                                    </button>
                                    <button onclick="enviarParaNuvem()" class="btn btn-secondary" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                        ⬆️ Enviar para Nuvem
                                    </button>
                                </div>
                            </div>

                            <!-- Info sobre Sincronização Automática -->
                            <div style="background: rgba(6, 214, 160, 0.1); padding: 16px; border-radius: 8px; margin-top: 24px; border-left: 4px solid var(--success);">
                                <strong style="color: var(--success);">✨ Sincronização Automática:</strong>
                                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                    Quando conectado, seus dados serão sincronizados automaticamente sempre que você:
                                </p>
                                <ul style="margin: 8px 0 0 20px; font-size: 13px; color: var(--text-secondary);">
                                    <li>Adicionar ou editar um evento</li>
                                    <li>Cadastrar ou modificar um cliente</li>
                                    <li>Registrar receitas ou despesas</li>
                                    <li>Alterar configurações</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ZONA DE PERIGO: Reset do Sistema -->
                <div class="card" style="margin-top: 40px; border: 2px solid var(--danger); background: rgba(239, 71, 111, 0.05);">
                    <div class="card-header" style="background: rgba(239, 71, 111, 0.1);">
                        <h2 class="card-title" style="color: var(--danger);">⚠️ Zona de Perigo</h2>
                    </div>
                    
                    <div style="padding: 24px;">
                        <!-- Aviso Importante -->
                        <div style="background: rgba(239, 71, 111, 0.1); padding: 20px; border-radius: 8px; border-left: 4px solid var(--danger); margin-bottom: 24px;">
                            <div style="display: flex; align-items: start; gap: 12px;">
                                <div style="font-size: 32px;">⚠️</div>
                                <div>
                                    <h3 style="color: var(--danger); margin-bottom: 8px;">ATENÇÃO: Ação Irreversível!</h3>
                                    <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">
                                        O botão abaixo irá <strong>apagar TODOS os dados</strong> do sistema de forma permanente:
                                    </p>
                                    <ul style="font-size: 13px; color: var(--text-secondary); margin-left: 20px; line-height: 1.8;">
                                        <li>Todos os eventos, clientes e serviços</li>
                                        <li>Todas as receitas, despesas e custos</li>
                                        <li>Contas bancárias e contas a pagar</li>
                                        <li>Configurações da empresa</li>
                                        <li><strong style="color: var(--danger);">SE ESTIVER USANDO FIREBASE: Também apagará os dados da nuvem!</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Explicação do Firebase -->
                        <div style="background: rgba(255, 210, 63, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent); margin-bottom: 24px;">
                            <strong style="color: var(--accent);">☁️ Sobre Sincronização com Firebase:</strong>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                • Se você estiver usando sincronização na nuvem, o reset irá apagar tanto os dados <strong>locais</strong> quanto os dados da <strong>nuvem</strong>.<br>
                                • Isso significa que os dados NÃO voltarão automaticamente após o reset.<br>
                                • Esta ação é útil para começar do zero ou limpar dados de teste.
                            </p>
                        </div>
                        
                        <!-- Quando usar o Reset -->
                        <div style="background: rgba(79, 70, 229, 0.1); padding: 16px; border-radius: 8px; border-left: 4px solid #4F46E5; margin-bottom: 24px;">
                            <strong style="color: #4F46E5;">💡 Quando usar o Reset:</strong>
                            <ul style="font-size: 13px; color: var(--text-secondary); margin: 8px 0 0 20px; line-height: 1.8;">
                                <li>Você estava testando o sistema e quer começar com dados reais</li>
                                <li>Quer começar do zero por qualquer motivo</li>
                                <li>O sistema está com problemas graves de dados</li>
                            </ul>
                        </div>
                        
                        <!-- Botão de Reset -->
                        <div style="text-align: center; padding-top: 20px; border-top: 2px dashed var(--danger);">
                            <button 
                                onclick="confirmarResetCompleto()" 
                                class="btn" 
                                style="
                                    background: var(--danger);
                                    color: white;
                                    padding: 16px 32px;
                                    font-size: 16px;
                                    font-weight: 600;
                                    border: none;
                                    cursor: pointer;
                                    transition: all 0.3s;
                                "
                                onmouseover="this.style.background='#D32F2F'; this.style.transform='scale(1.05)'"
                                onmouseout="this.style.background='var(--danger)'; this.style.transform='scale(1)'"
                            >
                                🗑️ Resetar Sistema Completo
                            </button>
                            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 12px;">
                                Você será solicitado a confirmar esta ação duas vezes
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Configurações Tab -->
        <!-- Pessoal Tab -->
        <div id="pessoalTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">👤 Financeiro Pessoal</h1>
                    <p class="dashboard-subtitle">Controle suas finanças pessoais separado da empresa</p>
                </div>

                <!-- Stats Cards Pessoal -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-icon bg-success">💵</div>
                        <div class="stat-label">Receitas Pessoais</div>
                        <div class="stat-value" id="receitasPessoais">R$ 0,00</div>
                        <div class="stat-change positive">
                            <span>↗</span>
                            Este mês
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon bg-danger">💳</div>
                        <div class="stat-label">Despesas Pessoais</div>
                        <div class="stat-value" id="despesasPessoais">R$ 0,00</div>
                        <div class="stat-change negative">
                            <span>↘</span>
                            Este mês
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 107, 53, 0.2); color: var(--primary);">📊</div>
                        <div class="stat-label">Saldo Pessoal</div>
                        <div class="stat-value" id="saldoPessoal">R$ 0,00</div>
                        <div class="stat-change" style="color: var(--primary);">
                            <span>💰</span>
                            Disponível
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon bg-accent">🏦</div>
                        <div class="stat-label">Contas/Cartões</div>
                        <div class="stat-value" id="totalContasPessoais">0</div>
                        <div class="stat-change" style="color: var(--accent);">
                            <span>📋</span>
                            Ativas
                        </div>
                    </div>
                </div>

                <!-- Ações Rápidas -->
                <div class="content-grid" style="margin-top: 30px;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">💰 Receitas Pessoais</h2>
                            <button class="btn btn-primary" onclick="openModal('receitaPessoal')">+ Nova Receita</button>
                        </div>
                        <div id="listaReceitasPessoais"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">💳 Despesas Pessoais</h2>
                            <button class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);" onclick="openModal('despesaPessoal')">+ Nova Despesa</button>
                        </div>
                        <div id="listaDespesasPessoais"></div>
                    </div>
                </div>

                <!-- Contas e Cartões Pessoais -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">🏦 Minhas Contas e Cartões</h2>
                        <button class="btn btn-primary" onclick="openModal('contaPessoal')">+ Nova Conta/Cartão</button>
                    </div>
                    <div id="listaContasPessoais"></div>
                </div>

                <!-- CONTAS A PAGAR -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">📅 Contas a Pagar</h2>
                        <button class="btn btn-primary" onclick="openModal('contaPagar')">+ Nova Conta</button>
                    </div>
                    
                    <!-- Resumo de Contas -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 20px; background: rgba(255, 255, 255, 0.02); border-radius: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">Vencidas</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--danger);" id="contasVencidas">0</div>
                            <div style="font-size: 12px; color: var(--danger);" id="valorVencidas">R$ 0,00</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">Vencem em 7 dias</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--accent);" id="contasProximas">0</div>
                            <div style="font-size: 12px; color: var(--accent);" id="valorProximas">R$ 0,00</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">Futuras</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--success);" id="contasFuturas">0</div>
                            <div style="font-size: 12px; color: var(--success);" id="valorFuturas">R$ 0,00</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 5px;">Total a Pagar</div>
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary);" id="totalAPagar">0</div>
                            <div style="font-size: 12px; color: var(--primary);" id="valorTotalAPagar">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <!-- Filtros -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="filtrarContasPagar('todas')" id="filtroContasTodas" style="background: var(--primary);">
                            📋 Todas
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarContasPagar('vencidas')" id="filtroContasVencidas">
                            ⚠️ Vencidas
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarContasPagar('hoje')" id="filtroContasHoje">
                            📅 Hoje
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarContasPagar('proximas')" id="filtroContasProximas">
                            🔔 Próximas (7 dias)
                        </button>
                        <button class="btn btn-secondary" onclick="filtrarContasPagar('pagas')" id="filtroContasPagas">
                            ✅ Pagas
                        </button>
                    </div>
                    
                    <!-- Lista de Contas -->
                    <div id="listaContasPagar"></div>
                </div>

                <!-- Despesas por Categoria -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">📊 Despesas por Categoria</h2>
                    </div>
                    <div id="despesasPorCategoria" style="padding: 20px;"></div>
                </div>
            </div>
        </div>
        <!-- End Pessoal Tab -->
    </div>

    <!-- RODAPÉ -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Brand -->
            <div class="footer-brand">EventProDJ</div>
            <div class="footer-signature">by Cristian Dj</div>
            
            <!-- Redes Sociais -->
            <div class="footer-social">
                <a href="https://www.instagram.com/cristiandj.rj" target="_blank" class="social-link" title="Instagram">
                    <span class="social-icon">📸</span>
                    <span>@cristiandj.rj</span>
                </a>
                
                <a href="https://www.facebook.com/cristiandj.rj" target="_blank" class="social-link" title="Facebook">
                    <span class="social-icon">👥</span>
                    <span>cristiandj.rj</span>
                </a>
                
                <a href="https://cristiandj.com.br" target="_blank" class="social-link" title="Website">
                    <span class="social-icon">🎧</span>
                    <span>cristiandj.com.br</span>
                </a>
            </div>
            
            <!-- Copyright -->
            <div class="footer-copyright">
                <p style="margin: 0;">
                    Criado com <span class="footer-heart">❤️</span> por <strong>Cristian Dj</strong> © 2026
                </p>
                <p style="margin: 8px 0 0 0; font-size: 12px; opacity: 0.7;">
                    Sistema de Gestão para DJs e Produtores de Eventos
                </p>
            </div>
        </div>
    </footer>

    <!-- Modal Receita Pessoal -->
    <div id="modalReceitaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">💵 Nova Receita Pessoal</h2>
                <button class="close-btn" onclick="closeModal('receitaPessoal')">×</button>
            </div>
            <form onsubmit="addReceitaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="receitaPessoalDesc" required placeholder="Ex: Salário, Freelance, Venda">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="receitaPessoalCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="salario">💼 Salário</option>
                            <option value="freelance">💻 Freelance</option>
                            <option value="investimentos">📈 Investimentos</option>
                            <option value="aluguel">🏠 Aluguel Recebido</option>
                            <option value="venda">💰 Venda</option>
                            <option value="retirada_empresa">🏢 Retirada da Empresa</option>
                            <option value="outros">📌 Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="receitaPessoalValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="receitaPessoalData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta/Cartão</label>
                        <select class="form-select" id="receitaPessoalConta">
                            <option value="">Não informado</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Receita</button>
            </form>
        </div>
    </div>

    <!-- Modal Despesa Pessoal -->
    <div id="modalDespesaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">💳 Nova Despesa Pessoal</h2>
                <button class="close-btn" onclick="closeModal('despesaPessoal')">×</button>
            </div>
            <form onsubmit="addDespesaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="despesaPessoalDesc" required placeholder="Ex: Mercado, Conta de Luz, Aluguel">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="despesaPessoalCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="moradia">🏠 Moradia</option>
                            <option value="alimentacao">🍔 Alimentação</option>
                            <option value="transporte">🚗 Transporte</option>
                            <option value="saude">⚕️ Saúde</option>
                            <option value="educacao">📚 Educação</option>
                            <option value="lazer">🎮 Lazer</option>
                            <option value="vestuario">👕 Vestuário</option>
                            <option value="contas">📄 Contas e Serviços</option>
                            <option value="cartao">💳 Cartão de Crédito</option>
                            <option value="prestacao">📊 Prestação/Parcelamento</option>
                            <option value="outros">📌 Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="despesaPessoalValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="despesaPessoalData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta/Cartão</label>
                        <select class="form-select" id="despesaPessoalConta">
                            <option value="">Não informado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="despesaPessoalObs" placeholder="Detalhes adicionais..." rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Despesa</button>
            </form>
        </div>
    </div>

    <!-- Modal Conta Pessoal -->
    <div id="modalContaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🏦 Nova Conta/Cartão Pessoal</h2>
                <button class="close-btn" onclick="closeModal('contaPessoal')">×</button>
            </div>
            <form onsubmit="addContaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Nome da Conta/Cartão</label>
                    <input type="text" class="form-input" id="contaPessoalNome" required placeholder="Ex: Conta Corrente, Cartão Nubank">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="contaPessoalTipo" required>
                            <option value="">Selecione...</option>
                            <option value="corrente">🏦 Conta Corrente</option>
                            <option value="poupanca">💰 Poupança</option>
                            <option value="cartao_credito">💳 Cartão de Crédito</option>
                            <option value="cartao_debito">💳 Cartão de Débito</option>
                            <option value="investimento">📈 Investimento</option>
                            <option value="dinheiro">💵 Dinheiro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Saldo Inicial</label>
                        <input type="number" step="0.01" class="form-input" id="contaPessoalSaldo" placeholder="0,00">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Banco/Instituição</label>
                    <input type="text" class="form-input" id="contaPessoalBanco" placeholder="Ex: Nubank, Inter, Banco do Brasil">
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Conta/Cartão</button>
            </form>
        </div>
    </div>

    <!-- Modal Conta a Pagar -->
    <div id="modalContaPagar" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">📅 Nova Conta a Pagar</h2>
                <button class="close-btn" onclick="closeModal('contaPagar')">×</button>
            </div>
            <form onsubmit="addContaPagar(event)">
                <div class="form-group">
                    <label class="form-label">Descrição da Conta</label>
                    <input type="text" class="form-input" id="contaPagarDesc" required placeholder="Ex: Fatura Cartão Nubank, Prestação do Carro">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="contaPagarTipo" required>
                            <option value="">Selecione...</option>
                            <option value="cartao">💳 Fatura de Cartão</option>
                            <option value="prestacao">🚗 Prestação</option>
                            <option value="seguro">🛡️ Seguro</option>
                            <option value="aluguel">🏠 Aluguel</option>
                            <option value="condominio">🏢 Condomínio</option>
                            <option value="luz">💡 Conta de Luz</option>
                            <option value="agua">💧 Conta de Água</option>
                            <option value="internet">📡 Internet</option>
                            <option value="telefone">📱 Telefone</option>
                            <option value="streaming">📺 Streaming</option>
                            <option value="escola">🎓 Escola/Faculdade</option>
                            <option value="saude">⚕️ Plano de Saúde</option>
                            <option value="academia">🏋️ Academia</option>
                            <option value="emprestimo">💰 Empréstimo</option>
                            <option value="financiamento">🏦 Financiamento</option>
                            <option value="boleto">📄 Boleto</option>
                            <option value="outros">📌 Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="contaPagarValor" required placeholder="0,00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data de Vencimento</label>
                        <input type="date" class="form-input" id="contaPagarVencimento" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recorrência</label>
                        <select class="form-select" id="contaPagarRecorrencia">
                            <option value="unica">Única (não repete)</option>
                            <option value="mensal">Mensal</option>
                            <option value="anual">Anual</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observações (opcional)</label>
                    <textarea class="form-input" id="contaPagarObs" rows="2" placeholder="Ex: Código de barras, número da fatura..."></textarea>
                </div>
                
                <div class="form-group" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: rgba(255, 255, 255, 0.02); border-radius: 8px;">
                    <input type="checkbox" id="contaPagarNotificar" checked style="width: 18px; height: 18px; cursor: pointer;">
                    <label for="contaPagarNotificar" style="margin: 0; cursor: pointer; font-size: 13px;">
                        🔔 Ativar alertas de vencimento
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Conta</button>
            </form>
        </div>
    </div>

    <!-- Modal Financeiro do Cliente -->
    <!-- Modal Gerar Documentos -->
    <div id="modalDocumentos" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">📄 Gerar Documento</h2>
                <button class="close-btn" onclick="closeModal('documentos')">×</button>
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(255, 107, 53, 0.1); border-radius: 8px;">
                <strong id="documentosClienteNome" style="color: var(--primary); font-size: 16px;">Cliente</strong>
            </div>
            <input type="hidden" id="documentosClienteId">
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button class="btn btn-primary" onclick="gerarDocumento('orcamento')" style="padding: 16px; font-size: 16px; display: flex; align-items: center; gap: 12px; justify-content: center;">
                    <span style="font-size: 24px;">💼</span>
                    <span>Gerar Orçamento</span>
                </button>
                
                <button class="btn btn-primary" onclick="gerarDocumento('contrato')" style="padding: 16px; font-size: 16px; display: flex; align-items: center; gap: 12px; justify-content: center;">
                    <span style="font-size: 24px;">📝</span>
                    <span>Gerar Contrato</span>
                </button>
                
                <button class="btn btn-primary" onclick="gerarDocumento('recibo')" style="padding: 16px; font-size: 16px; display: flex; align-items: center; gap: 12px; justify-content: center;">
                    <span style="font-size: 24px;">🧾</span>
                    <span>Emitir Recibo</span>
                </button>
                
                <!-- Botão de compartilhar (aparece após gerar um documento) -->
                <div id="compartilharDocArea" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <button class="btn btn-secondary" onclick="compartilharPDF()" style="padding: 16px; font-size: 16px; display: flex; align-items: center; gap: 12px; justify-content: center; background: var(--success);">
                        <span style="font-size: 24px;">🔗</span>
                        <span>Compartilhar Último Documento</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalFinanceiro" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">💰 Dados Financeiros</h2>
                <button class="close-btn" onclick="closeModal('financeiro')">×</button>
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(255, 107, 53, 0.1); border-radius: 8px;">
                <strong id="financeiroClienteNome" style="color: var(--primary); font-size: 16px;">Cliente</strong>
            </div>
            
            <!-- Mensagem informativa para novo cliente -->
            <div id="financeiroNovoClienteMsg" style="display: none; margin-bottom: 20px; padding: 16px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                    ✅ Cliente cadastrado com sucesso!
                </div>
                <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
                    Escolha uma opção:<br>
                    • <strong>Adicionar Financeiro:</strong> Registre valores e prazos<br>
                    • <strong>Criar Orçamento:</strong> Monte um orçamento completo com serviços<br>
                    • <strong>Criar Evento:</strong> Cadastre direto sem orçamento<br>
                    • <strong>Pular:</strong> Adicione depois
                </div>
            </div>
            
            <form onsubmit="saveFinanceiro(event)">
                <input type="hidden" id="financeiroClienteId">
                
                <div class="form-group">
                    <label class="form-label">Valor Total do Serviço</label>
                    <input type="number" step="0.01" class="form-input" id="financeiroValorTotal" placeholder="0,00" oninput="calcularSaldoFinanceiro()">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor do Sinal</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroSinalValor" placeholder="0,00" oninput="calcularSaldoFinanceiro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data do Sinal</label>
                        <input type="date" class="form-input" id="financeiroSinalData">
                    </div>
                </div>

                <div class="form-group" id="formaPagamentoSinalGroup" style="display: none;">
                    <label class="form-label">Forma de Pagamento do Sinal 💳</label>
                    <select class="form-select" id="financeiroSinalFormaPagamento">
                        <option value="">Selecione...</option>
                        <option value="pix">💳 PIX</option>
                        <option value="dinheiro">💵 Dinheiro</option>
                        <option value="debito">💳 Débito</option>
                        <option value="credito">💳 Cartão de Crédito</option>
                        <option value="transferencia">🏦 Transferência</option>
                        <option value="boleto">📄 Boleto</option>
                    </select>
                </div>
                
                <div class="form-group" id="contaSinalGroup" style="display: none;">
                    <label class="form-label">Conta Bancária 🏦</label>
                    <select class="form-select" id="financeiroSinalConta">
                        <option value="">Selecione a conta...</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor a Pagar</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroValorPagar" placeholder="0,00" readonly style="background: rgba(255, 107, 53, 0.1); font-weight: 600; font-size: 18px; color: var(--primary);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Vencimento</label>
                        <input type="date" class="form-input" id="financeiroVencimento">
                    </div>
                </div>


                <!-- Seção de Pagamento do Restante -->
                <div id="secaoPagamentoRestante" style="display: none; padding: 16px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 12px;">
                        💰 Registrar Pagamento
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Valor do Pagamento</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroValorPagamentoRestante" placeholder="Digite o valor ou deixe vazio para pagar tudo" oninput="atualizarBotaoPagamentoRestante()">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            💡 Deixe vazio para pagar o valor total restante (<strong id="valorRestanteDisplay">R$ 0,00</strong>)
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data do Pagamento</label>
                            <input type="date" class="form-input" id="financeiroDataPagamentoRestante">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Forma de Pagamento 💳</label>
                            <select class="form-select" id="financeiroFormaPagamentoRestante">
                                <option value="">Selecione...</option>
                                <option value="pix">💳 PIX</option>
                                <option value="dinheiro">💵 Dinheiro</option>
                                <option value="debito">💳 Débito</option>
                                <option value="credito">💳 Cartão de Crédito</option>
                                <option value="transferencia">🏦 Transferência</option>
                                <option value="boleto">📄 Boleto</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Conta Bancária 🏦</label>
                        <select class="form-select" id="financeiroContaPagamentoRestante">
                            <option value="">Selecione a conta...</option>
                        </select>
                    </div>
                    
                    <button type="button" onclick="registrarPagamentoRestante()" class="btn btn-primary" id="btnPagamentoRestante" style="width: 100%;">
                        ✅ Confirmar Pagamento
                    </button>
                </div>
                <div id="resumoFinanceiroModal" style="background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; padding: 16px; margin-top: 16px; display: none;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 12px;">📊 Resumo Financeiro:</div>
                    <div style="display: grid; gap: 8px; font-size: 14px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Valor Total:</span>
                            <strong id="resumoTotalModal">R$ 0,00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Sinal Recebido:</span>
                            <strong id="resumoSinalModal" style="color: var(--success);">R$ 0,00</strong>
                        </div>
                        
                        <!-- Histórico de Pagamentos Adicionais -->
                        <div id="historicoPagamentosAdicionais" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(6, 214, 160, 0.2);">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 600;">
                                💰 Pagamentos Adicionais:
                            </div>
                            <div id="listaPagamentosAdicionais" style="display: grid; gap: 4px; font-size: 12px;">
                                <!-- Será preenchido dinamicamente -->
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid rgba(6, 214, 160, 0.3);">
                            <span style="font-weight: 600;">Total Pago:</span>
                            <strong id="resumoTotalPagoModal" style="color: var(--success); font-size: 16px;">R$ 0,00</strong>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span>Saldo Devedor:</span>
                            <strong id="resumoSaldoModal" style="color: var(--primary); font-size: 16px;">R$ 0,00</strong>
                        </div>
                    </div>
                    <div class="progress-bar" style="margin-top: 12px; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                        <div id="progressBarModal" class="progress-fill" style="height: 100%; background: linear-gradient(90deg, var(--success), var(--accent)); transition: width 0.5s ease;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        <span id="progressPercentModal">0%</span> pago
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-submit" style="width: 100%; margin-top: 20px;">
                    💰 Salvar Dados Financeiros
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Custo Geral -->
    <div id="modalCustoGeral" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">💼 Novo Custo Geral</h2>
                <button class="close-btn" onclick="closeModal('custoGeral')">×</button>
            </div>
            <form onsubmit="addCustoGeral(event)">
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="custoGeralDescricao" required placeholder="Ex: Combustível, Impostos, Manutenção">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="custoGeralCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="retirada_lucros">💰 Retirada de Lucros</option>
                            <option value="combustivel">⛽ Combustível</option>
                            <option value="impostos">📋 Impostos e Taxas</option>
                            <option value="aluguel">🏢 Aluguel/Espaço</option>
                            <option value="manutencao">🔧 Manutenção</option>
                            <option value="equipamentos">📦 Equipamentos/Materiais</option>
                            <option value="marketing">📢 Marketing</option>
                            <option value="administrativo">📊 Administrativo</option>
                            <option value="pessoal">👥 Pessoal Fixo</option>
                            <option value="outros">📌 Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="custoGeralValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="custoGeralData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta Bancária 🏦</label>
                        <select class="form-select" id="custoGeralConta">
                            <option value="">Não informado</option>
                            <!-- Será preenchido dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="custoGeralObs" placeholder="Informações adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Custo</button>
            </form>
        </div>
    </div>

    <!-- Modal Custo de Evento -->
    <div id="modalCustoEvento" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🎉 Novo Custo do Evento</h2>
                <button class="close-btn" onclick="closeModal('custoEvento')">×</button>
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(255, 107, 53, 0.1); border-radius: 8px;">
                <strong id="custoEventoNome" style="color: var(--primary); font-size: 16px;">Evento</strong>
            </div>
            <form onsubmit="addCustoEvento(event)">
                <input type="hidden" id="custoEventoId">
                
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="custoEventoDescricao" required placeholder="Ex: Ajudante, Equipamento, Material">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="custoEventoCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="ajudantes">👷 Ajudantes/Equipe</option>
                            <option value="equipamentos">📦 Equipamentos Alugados</option>
                            <option value="materiais">🛠️ Materiais/Consumíveis</option>
                            <option value="transporte">🚚 Transporte</option>
                            <option value="alimentacao">🍽️ Alimentação</option>
                            <option value="decoracao">🎨 Decoração</option>
                            <option value="terceiros">🤝 Serviços Terceiros</option>
                            <option value="outros">📌 Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="custoEventoValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="custoEventoData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta Bancária 🏦</label>
                        <select class="form-select" id="custoEventoConta">
                            <option value="">Não informado</option>
                            <!-- Será preenchido dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="custoEventoObs" placeholder="Detalhes do custo..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Custo</button>
            </form>
        </div>
    </div>

    <!-- Modal Receita -->

    <!-- Modal Conta Bancária -->
    <div id="modalConta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🏦 Nova Conta Bancária</h2>
                <button class="close-btn" onclick="closeModal('conta')">×</button>
            </div>
            <form onsubmit="addContaBancaria(event)">
                <div class="form-group">
                    <label class="form-label">Nome da Conta</label>
                    <input type="text" class="form-input" id="contaNome" required placeholder="Ex: Banco Inter - Conta Corrente">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Banco</label>
                        <input type="text" class="form-input" id="contaBanco" required placeholder="Ex: Banco Inter">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Conta</label>
                        <select class="form-select" id="contaTipo" required>
                            <option value="">Selecione...</option>
                            <option value="corrente">Conta Corrente</option>
                            <option value="poupanca">Conta Poupança</option>
                            <option value="digital">Conta Digital</option>
                            <option value="empresarial">Conta Empresarial</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Agência</label>
                        <input type="text" class="form-input" id="contaAgencia" placeholder="0000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Número da Conta</label>
                        <input type="text" class="form-input" id="contaNumero" placeholder="00000-0">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Saldo Inicial (opcional)</label>
                    <input type="number" step="0.01" class="form-input" id="contaSaldoInicial" placeholder="0,00">
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="contaObservacoes" placeholder="Ex: Conta principal para recebimentos"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Conta</button>
            </form>
        </div>
    </div>

    <!-- Modal Receita -->
    <div id="modalReceita" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Receita</h2>
                <button class="close-btn" onclick="closeModal('receita')">×</button>
            </div>
            <form onsubmit="addReceita(event)">
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="receitaDescricao" required placeholder="Ex: Pagamento Evento - João">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="receitaValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="receitaData" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="receitaCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="evento">Pagamento de Evento</option>
                            <option value="sinal">Sinal/Entrada</option>
                            <option value="extra">Serviços Extras</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Forma de Pagamento 💳</label>
                        <select class="form-select" id="receitaFormaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="pix">💳 PIX</option>
                            <option value="dinheiro">💵 Dinheiro</option>
                            <option value="debito">💳 Débito</option>
                            <option value="credito">💳 Cartão de Crédito</option>
                            <option value="transferencia">🏦 Transferência</option>
                            <option value="boleto">📄 Boleto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Conta Bancária 🏦</label>
                    <select class="form-select" id="receitaConta" required>
                        <option value="">Selecione a conta...</option>
                        <!-- Será preenchido dinamicamente -->
                    </select>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        Não tem conta cadastrada? <a href="#" onclick="event.preventDefault(); closeModal('receita'); openModal('conta');" style="color: var(--primary);">Cadastre aqui</a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="receitaObservacoes" placeholder="Informações adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Receita</button>
            </form>
        </div>
    </div>

    <!-- Modal Despesa -->
    <div id="modalDespesa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Despesa</h2>
                <button class="close-btn" onclick="closeModal('despesa')">×</button>
            </div>
            <form onsubmit="addDespesa(event)">
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="despesaDescricao" required placeholder="Ex: Aluguel de Som">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="despesaValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="despesaData" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="despesaCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="equipamento">Equipamentos</option>
                            <option value="pessoal">Pessoal/Equipe</option>
                            <option value="transporte">Transporte</option>
                            <option value="alimentacao">Alimentação</option>
                            <option value="marketing">Marketing</option>
                            <option value="aluguel">Aluguel/Local</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Forma de Pagamento 💳</label>
                        <select class="form-select" id="despesaFormaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="pix">💳 PIX</option>
                            <option value="dinheiro">💵 Dinheiro</option>
                            <option value="debito">💳 Débito</option>
                            <option value="credito">💳 Cartão de Crédito</option>
                            <option value="transferencia">🏦 Transferência</option>
                            <option value="boleto">📄 Boleto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Conta Bancária 🏦</label>
                    <select class="form-select" id="despesaConta" required>
                        <option value="">Selecione a conta...</option>
                        <!-- Será preenchido dinamicamente -->
                    </select>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        Não tem conta cadastrada? <a href="#" onclick="event.preventDefault(); closeModal('despesa'); openModal('conta');" style="color: var(--primary);">Cadastre aqui</a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="despesaObservacoes" placeholder="Informações adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Despesa</button>
            </form>
        </div>
    </div>

    <!-- Modal Evento -->
    <div id="modalEvento" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Novo Evento</h2>
                <button class="close-btn" onclick="closeModal('evento')">×</button>
            </div>
            <form onsubmit="addEvento(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo de Evento</label>
                        <select class="form-select" id="eventoTipo" required>
                            <option value="">Selecione o tipo...</option>
                            <option value="Casamento">Casamento</option>
                            <option value="Aniversário">Aniversário</option>
                            <option value="Aniversário 15 Anos">Aniversário 15 Anos</option>
                            <option value="Formatura">Formatura</option>
                            <option value="Corporativo">Evento Corporativo</option>
                            <option value="Confraternização">Confraternização</option>
                            <option value="Batizado">Batizado</option>
                            <option value="Chá de Bebê">Chá de Bebê</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cliente</label>
                        <select class="form-select" id="eventoCliente" required onchange="mostrarEnderecoCliente()">
                            <option value="">Selecione um cliente...</option>
                        </select>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            💡 Não encontrou? <a href="#" onclick="event.preventDefault(); switchTab('clientes'); setTimeout(() => openModal('cliente'), 300);" style="color: var(--success);">Cadastre um novo cliente</a>
                        </div>
                    </div>
                </div>

                <!-- Data e Horários -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data do Evento</label>
                        <input type="date" class="form-input" id="eventoData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hora de Início</label>
                        <input type="time" class="form-input" id="eventoHoraInicio" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Hora de Término</label>
                        <input type="time" class="form-input" id="eventoHoraFim" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duração do Serviço</label>
                        <input type="text" class="form-input" id="eventoDuracao" readonly style="background: rgba(255, 255, 255, 0.05);" placeholder="Calculado automaticamente">
                    </div>
                </div>

                <!-- Opções de Endereço -->
                <div id="opcoesEnderecoEvento" style="display: none; margin-bottom: 16px; padding: 12px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                        📍 Endereço do Cliente Cadastrado
                    </div>
                    <div id="enderecoClienteDisplay" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                        <!-- Endereço será inserido aqui -->
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button type="button" onclick="usarEnderecoCliente()" class="btn btn-secondary" style="flex: 1;">
                            ✅ Usar Este Endereço
                        </button>
                        <button type="button" onclick="limparOpcoesEndereco()" class="btn" style="flex: 1; background: transparent; border: 1px solid var(--border);">
                            📝 Digitar Outro Endereço
                        </button>
                    </div>
                </div>

                <!-- Endereço com CEP -->
                <div class="form-group">
                    <label class="form-label">Endereço do Evento</label>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">CEP 📮</label>
                            <input type="text" class="form-input" id="eventoCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCepEvento()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Número</label>
                            <input type="text" class="form-input" id="eventoNumero" placeholder="Nº" required>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label class="form-label">Rua/Avenida</label>
                        <input type="text" class="form-input" id="eventoRua" placeholder="Digite a rua ou preencha pelo CEP" required>
                    </div>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Bairro</label>
                            <input type="text" class="form-input" id="eventoBairro" placeholder="Digite o bairro" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="eventoComplemento" placeholder="Salão, Quadra, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Cidade</label>
                            <input type="text" class="form-input" id="eventoCidade" placeholder="Digite a cidade" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Estado</label>
                            <input type="text" class="form-input" id="eventoEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2" required>
                        </div>
                    </div>
                    <div id="cepEventoLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                        🔍 Buscando endereço...
                    </div>
                    <div id="cepEventoError" style="display: none; text-align: center; padding: 8px; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--danger);">
                        ❌ CEP não encontrado. Verifique o número digitado.
                    </div>
                    <div id="cepEventoSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                        ✅ Endereço encontrado!
                    </div>
                </div>

                <!-- Valor e Status -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor Total 💰</label>
                        <input type="number" step="0.01" class="form-input" id="eventoValor" required placeholder="0,00">
                        <div id="valorClienteInfo" style="display: none; margin-top: 6px; padding: 8px; background: rgba(6, 214, 160, 0.1); border-radius: 6px; font-size: 12px; color: var(--success);">
                            💡 Valor do orçamento do cliente: <strong id="valorClienteDisplay">R$ 0,00</strong>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="eventoStatus" required>
                            <option value="aguardando">⏳ Aguardando Aprovação</option>
                            <option value="andamento">🔄 Em Andamento</option>
                            <option value="concluido">✅ Concluído</option>
                            <option value="cancelado">❌ Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="eventoObservacoes" placeholder="Detalhes do evento..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal Orçamento -->
    <div id="modalOrcamento" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">💼 Novo Orçamento Completo</h2>
                <button class="close-btn" onclick="closeModal('orcamento')">×</button>
            </div>
            <form id="orcamentoForm" onsubmit="addOrcamento(event)">
                
                <!-- SEÇÃO 1: DADOS DO CLIENTE -->
                <div style="background: rgba(255, 107, 53, 0.1); border-left: 4px solid var(--primary); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--primary);">
                        👤 Dados do Cliente
                    </h3>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Cliente</label>
                        <input type="text" class="form-input" id="orcCliente" required placeholder="Nome do cliente">
                    </div>
                </div>

                <!-- SEÇÃO 2: DADOS DO EVENTO -->
                <div style="background: rgba(0, 78, 137, 0.1); border-left: 4px solid var(--secondary); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--secondary);">
                        🎉 Dados do Evento
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tipo de Evento</label>
                            <select class="form-select" id="orcTipoEvento" required>
                                <option value="">Selecione o tipo...</option>
                                <option value="Casamento">Casamento</option>
                                <option value="Aniversário">Aniversário</option>
                                <option value="Aniversário 15 Anos">Aniversário 15 Anos</option>
                                <option value="Formatura">Formatura</option>
                                <option value="Corporativo">Evento Corporativo</option>
                                <option value="Confraternização">Confraternização</option>
                                <option value="Batizado">Batizado</option>
                                <option value="Chá de Bebê">Chá de Bebê</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Prevista</label>
                            <input type="date" class="form-input" id="orcData" required>
                        </div>
                    </div>

                    <!-- Horários com Duração -->
                    <div style="background: rgba(0, 78, 137, 0.1); border: 1px solid var(--secondary); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                        <div style="font-size: 13px; color: var(--secondary); font-weight: 600; margin-bottom: 8px;">
                            ⏰ Horário do Evento
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Hora de Início</label>
                                <input type="time" class="form-input" id="orcHoraInicio" oninput="calcularDuracaoOrcamento()" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hora de Término</label>
                                <input type="time" class="form-input" id="orcHoraFim" oninput="calcularDuracaoOrcamento()" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Duração do Serviço</label>
                                <input type="text" class="form-input" id="orcDuracao" readonly style="background: rgba(0, 78, 137, 0.2); font-weight: 600; color: var(--secondary);" placeholder="Automático">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Opções de Endereço do Cliente -->
                    <div id="opcoesEnderecoOrcamento" style="display: none; margin-bottom: 16px; padding: 12px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                        <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                            📍 Endereço do Cliente Cadastrado
                        </div>
                        <div id="enderecoClienteDisplayOrc" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                            <!-- Endereço será inserido aqui -->
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" onclick="usarEnderecoClienteOrcamento()" class="btn btn-secondary" style="flex: 1;">
                                ✅ Usar Este Endereço
                            </button>
                            <button type="button" onclick="limparOpcoesEnderecoOrcamento()" class="btn" style="flex: 1; background: transparent; border: 1px solid var(--border);">
                                📝 Digitar Outro Endereço
                            </button>
                        </div>
                    </div>

                    <!-- Endereço com CEP -->
                    <div class="form-group">
                        <label class="form-label">Endereço do Evento</label>
                        <div class="form-row" style="margin-bottom: 12px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">CEP 📮</label>
                                <input type="text" class="form-input" id="orcCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCepOrcamento()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Número</label>
                                <input type="text" class="form-input" id="orcNumero" placeholder="Nº" required>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label">Rua/Avenida</label>
                            <input type="text" class="form-input" id="orcRua" placeholder="Digite a rua ou preencha pelo CEP" required>
                        </div>
                        <div class="form-row" style="margin-bottom: 12px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Bairro</label>
                                <input type="text" class="form-input" id="orcBairro" placeholder="Digite o bairro" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Complemento</label>
                                <input type="text" class="form-input" id="orcComplemento" placeholder="Salão, Quadra, etc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" id="orcCidade" placeholder="Digite a cidade" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Estado</label>
                                <input type="text" class="form-input" id="orcEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2" required>
                            </div>
                        </div>
                        <div id="cepOrcLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                            🔍 Buscando endereço...
                        </div>
                        <div id="cepOrcSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                            ✅ Endereço encontrado!
                        </div>
                    </div>
                </div>

                <!-- SEÇÃO 3: SERVIÇOS E VALORES -->
                <div style="background: rgba(6, 214, 160, 0.1); border-left: 4px solid var(--success); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--success);">
                        💰 Serviços e Valores
                    </h3>
                    
                    <!-- Seleção de Serviços -->
                    <div class="form-group">
                        <label class="form-label">Serviços Inclusos</label>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">Selecione os serviços:</span>
                                <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;" onclick="openModal('servico')">
                                    + Novo Serviço
                                </button>
                            </div>
                            <div id="orcamentosServicosList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Lista de checkboxes de serviços -->
                            </div>
                        </div>
                        <div id="servicosSelecionados" style="background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; padding: 12px; display: none;">
                            <div style="font-size: 13px; color: var(--success); margin-bottom: 8px; font-weight: 600;">✓ Serviços Selecionados:</div>
                            <div id="servicosSelecionadosList"></div>
                        </div>
                    </div>

                    <!-- Outras Taxas -->
                    <div class="form-group">
                        <label class="form-label">Outras Taxas 📋</label>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 16px;">
                            <!-- Taxa Deslocamento Pré-preenchida -->
                            <div style="background: rgba(255, 210, 63, 0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 13px; color: var(--accent); font-weight: 600; margin-bottom: 4px;">
                                            🚗 Deslocamento
                                        </div>
                                        <input type="number" step="0.01" class="form-input" id="taxaDeslocamentoValor" placeholder="Valor (R$)" oninput="atualizarTaxaDeslocamento()" style="background: rgba(255, 255, 255, 0.05);">
                                    </div>
                                    <button type="button" onclick="removerTaxaDeslocamento()" style="background: none; border: none; color: var(--danger); cursor: pointer; font-size: 20px; padding: 8px;">
                                        🗑️
                                    </button>
                                </div>
                            </div>
                            
                            <div id="outrasTaxasList">
                                <!-- Taxas adicionadas aparecerão aqui -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="adicionarTaxa()" style="width: 100%; margin-top: 8px;">
                                + Adicionar Taxa
                            </button>
                        </div>
                    </div>

                    <!-- Desconto -->
                    <div class="form-group">
                        <label class="form-label">Desconto 🏷️</label>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="number" step="0.01" class="form-input" id="orcDesconto" placeholder="0,00" oninput="calcularTotalOrcamento()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <select class="form-select" id="orcDescontoTipo" onchange="calcularTotalOrcamento()">
                                    <option value="valor">R$ (Valor)</option>
                                    <option value="percentual">% (Percentual)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Financeiro -->
                    <div style="background: rgba(255, 107, 53, 0.1); border: 2px solid var(--primary); border-radius: 12px; padding: 16px; margin-top: 16px;">
                        <div style="font-size: 14px; color: var(--primary); font-weight: 600; margin-bottom: 12px;">💰 Resumo Financeiro:</div>
                        <div style="display: grid; gap: 8px; font-size: 14px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Subtotal (Serviços):</span>
                                <strong id="orcSubtotalServicos">R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Outras Taxas:</span>
                                <strong id="orcTotalTaxas">R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; color: var(--danger);">
                                <span>Desconto:</span>
                                <strong id="orcTotalDesconto">- R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-top: 12px; border-top: 2px solid var(--primary); font-size: 18px;">
                                <span style="font-weight: 700;">VALOR TOTAL:</span>
                                <strong id="orcValorTotalDisplay" style="color: var(--success);">R$ 0,00</strong>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="orcValorTotal">
                </div>

                <!-- SEÇÃO 4: INFORMAÇÕES ADICIONAIS -->
                <div style="background: rgba(255, 210, 63, 0.1); border-left: 4px solid var(--accent); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--accent);">
                        📝 Informações Adicionais
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Status do Evento</label>
                        <select class="form-select" id="orcStatus" required>
                            <option value="aguardando" selected>⏳ Aguardando Aprovação</option>
                            <option value="andamento">🔄 Em Andamento</option>
                            <option value="concluido">✅ Concluído</option>
                            <option value="cancelado">❌ Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observações do Orçamento</label>
                        <textarea class="form-textarea" id="orcObservacoes" placeholder="Detalhes, condições especiais, etc..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Criação</label>
                            <input type="date" class="form-input" id="orcDataCriacao" readonly style="background: rgba(255, 255, 255, 0.03);">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validade do Orçamento (30 dias)</label>
                            <input type="date" class="form-input" id="orcValidade" readonly style="background: rgba(255, 255, 255, 0.03);">
                        </div>
                    </div>
                </div>

                <button type="submit" id="btnSubmitOrcamento" class="btn btn-primary btn-submit">💼 Gerar Orçamento e Criar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal Sucesso Cliente -->
    <div id="modalSucessoCliente" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">✅ Cliente Cadastrado!</h2>
                <button class="close-btn" onclick="document.getElementById('modalSucessoCliente').classList.remove('active')">×</button>
            </div>
            
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 64px; margin-bottom: 16px; animation: bounce 1s;">🎉</div>
                <h3 style="font-family: 'Syne', sans-serif; font-size: 20px; margin-bottom: 8px; color: var(--success);">
                    Cliente cadastrado com sucesso!
                </h3>
                <p id="sucessoClienteNome" style="color: var(--text-secondary); margin-bottom: 24px; font-size: 16px;">
                    <!-- Nome do cliente será inserido aqui -->
                </p>
                
                <div style="background: rgba(255, 210, 63, 0.1); border: 1px solid var(--accent); border-radius: 12px; padding: 16px; margin-bottom: 24px; text-align: left;">
                    <div style="font-size: 14px; color: var(--accent); font-weight: 600; margin-bottom: 8px;">
                        💡 Próximo Passo
                    </div>
                    <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                        Escolha uma das opções abaixo para continuar o cadastro:
                    </div>
                </div>
                
                <div style="display: grid; gap: 12px;">
                    <button onclick="atalhoOrcamento()" class="btn" style="background: linear-gradient(135deg, var(--accent), #FFA500); color: var(--bg-dark); font-weight: 600; padding: 16px; font-size: 15px; border: none;">
                        💼 Criar Orçamento Completo
                        <div style="font-size: 11px; opacity: 0.8; margin-top: 4px; font-weight: 400;">
                            Monte um orçamento com serviços, taxas e descontos
                        </div>
                    </button>
                    
                    <button onclick="atalhoEvento()" class="btn btn-secondary" style="padding: 16px; font-size: 15px;">
                        🎉 Criar Evento Direto
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 4px; font-weight: 400;">
                            Cadastre o evento sem orçamento
                        </div>
                    </button>
                    
                    <button onclick="atalhoFinanceiro()" class="btn" style="background: rgba(0, 78, 137, 0.2); color: var(--secondary); border: 1px solid var(--secondary); padding: 16px; font-size: 15px;">
                        💰 Adicionar Dados Financeiros
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 4px; font-weight: 400;">
                            Registre valores, sinais e prazos
                        </div>
                    </button>
                    
                    <button onclick="document.getElementById('modalSucessoCliente').classList.remove('active')" class="btn" style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 12px;">
                        ⏭️ Adicionar Depois
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Cliente</h2>
                <button class="close-btn" onclick="closeModal('cliente')">×</button>
            </div>
            <form onsubmit="addCliente(event)">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="clienteNome" required placeholder="Nome do cliente">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="clienteEmail" placeholder="email@exemplo.com (opcional)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-input" id="clienteTelefone" required placeholder="(00) 00000-0000">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF/CNPJ</label>
                        <input type="text" class="form-input" id="clienteCpf" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Aniversário 🎂</label>
                        <input type="date" class="form-input" id="clienteAniversario" placeholder="DD/MM/AAAA">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Como nos conheceu? 📢</label>
                        <select class="form-select" id="clienteOrigem" required>
                            <option value="">Selecione...</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="google">Google</option>
                            <option value="indicacao">Indicação</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group" id="indicacaoDetalhes" style="display: none;">
                        <label class="form-label">Quem indicou?</label>
                        <input type="text" class="form-input" id="clienteIndicacao" placeholder="Nome de quem indicou">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endereço</label>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">CEP 📮</label>
                            <input type="text" class="form-input" id="clienteCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCep()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Número</label>
                            <input type="text" class="form-input" id="clienteNumero" placeholder="Nº">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label class="form-label">Rua/Avenida</label>
                        <input type="text" class="form-input" id="clienteRua" placeholder="Digite a rua ou preencha pelo CEP">
                    </div>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Bairro</label>
                            <input type="text" class="form-input" id="clienteBairro" placeholder="Digite o bairro">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="clienteComplemento" placeholder="Apto, Bloco, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Cidade</label>
                            <input type="text" class="form-input" id="clienteCidade" placeholder="Digite a cidade">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Estado</label>
                            <input type="text" class="form-input" id="clienteEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2">
                        </div>
                    </div>
                    <div id="cepLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                        🔍 Buscando endereço...
                    </div>
                    <div id="cepError" style="display: none; text-align: center; padding: 8px; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--danger);">
                        ❌ CEP não encontrado. Verifique o número digitado.
                    </div>
                    <div id="cepSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                        ✅ Endereço encontrado! Preencha o número da residência.
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observações</label>
                    <textarea class="form-textarea" id="clienteObservacoes" placeholder="Informações adicionais sobre o cliente..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Cliente</button>
            </form>
        </div>
    </div>

    <!-- Modal Serviços -->
    <div id="modalServico" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Gerenciar Serviços</h2>
                <button class="close-btn" onclick="closeModal('servico')">×</button>
            </div>
            
            <!-- Form para adicionar serviço -->
            <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 16px; color: var(--primary);">Adicionar Novo Serviço</h3>
                <form onsubmit="addServico(event)">
                    <div class="form-group">
                        <label class="form-label">Nome do Serviço</label>
                        <input type="text" class="form-input" id="servicoNome" required placeholder="Ex: DJ Profissional, Decoração Completa">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-select" id="servicoCategoria" required>
<option value="">Selecione a categoria...</option>
                                <option value="som_iluminacao">Som e Iluminação</option>
                                <option value="decoracao">Decoração</option>
                                <option value="audiovisual">Audiovisual</option>
                                <option value="servicos">Serviços</option>
                                <option value="estruturas">Estruturas</option>
                                <option value="mao_obra">Mão de Obra</option>
                                <option value="pirotecnia">Pirotecnia e Efeitos</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor Padrão</label>
                            <input type="number" step="0.01" class="form-input" id="servicoValor" required placeholder="0,00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-textarea" id="servicoDescricao" placeholder="Detalhes do serviço, equipamentos inclusos, tempo de duração..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">+ Adicionar Serviço</button>
                </form>
            </div>

            <!-- Lista de serviços -->
            <div>
                <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 16px;">Seus Serviços Cadastrados</h3>
                <div id="servicosList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Serviços serão inseridos aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database simulation using localStorage
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '[]'),
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
            add: (key, item) => {
                const data = DB.get(key);
                const newItem = { ...item, id: Date.now() };
                data.push(newItem);
                DB.set(key, data);
                return newItem; // RETORNAR O ITEM CRIADO
            }
        };

        // ============================================
        // VARIÁVEIS GLOBAIS PARA EDIÇÃO DE EVENTOS
        // ============================================
        let servicosSelecionados = [];
        let outrasTaxas = [];
        
        // Função para atualizar lista visual de serviços
        function atualizarListaServicos() {
            const container = document.getElementById('servicosSelecionadosList');
            if (!container) return;
            
            if (servicosSelecionados.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 10px;">Nenhum serviço selecionado</p>';
                return;
            }
            
            const html = servicosSelecionados.map((s, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
                    <div>
                        <strong>${s.nome}</strong>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatMoney(s.valor)}</div>
                    </div>
                    <button type="button" onclick="removerServico(${index})" style="background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                        🗑️
                    </button>
                </div>
            `).join('');
            
            container.innerHTML = html;
            atualizarTotalOrcamento();
        }
        
        // Função para atualizar lista visual de taxas
        function atualizarListaTaxas() {
            const container = document.getElementById('outrasTaxasList');
            if (!container) return;
            
            if (outrasTaxas.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const html = outrasTaxas.map((t, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px;">
                    <div>
                        <strong>${t.descricao}</strong>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatMoney(t.valor)}</div>
                    </div>
                    <button type="button" onclick="removerTaxa(${index})" style="background: var(--danger); color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                        🗑️
                    </button>
                </div>
            `).join('');
            
            container.innerHTML = html;
            atualizarTotalOrcamento();
        }
        
        // Função para remover serviço
        function removerServico(index) {
            servicosSelecionados.splice(index, 1);
            atualizarListaServicos();
        }
        
        // Função para remover taxa
        function removerTaxa(index) {
            outrasTaxas.splice(index, 1);
            atualizarListaTaxas();
        }
        
        // Função para atualizar total do orçamento
        function atualizarTotalOrcamento() {
            const totalServicos = servicosSelecionados.reduce((sum, s) => sum + s.valor, 0);
            const totalTaxas = outrasTaxas.reduce((sum, t) => sum + t.valor, 0);
            const total = totalServicos + totalTaxas;
            
            const totalElement = document.getElementById('totalOrcamentoDisplay');
            if (totalElement) {
                totalElement.textContent = formatMoney(total);
            }
        }

        // ============================================
        // FUNÇÕES DO FINANCEIRO PESSOAL
        // ============================================

        function addReceitaPessoal(e) {
            e.preventDefault();
            
            const receita = {
                descricao: document.getElementById('receitaPessoalDesc').value,
                categoria: document.getElementById('receitaPessoalCategoria').value,
                valor: parseFloat(document.getElementById('receitaPessoalValor').value),
                data: document.getElementById('receitaPessoalData').value,
                contaId: document.getElementById('receitaPessoalConta').value || null
            };
            
            DB.add('receitasPessoais', receita);
            
            // Atualizar saldo da conta se selecionada
            if (receita.contaId) {
                const contas = DB.get('contasPessoais');
                const conta = contas.find(c => c.id === parseInt(receita.contaId));
                if (conta) {
                    conta.saldoAtual = (conta.saldoAtual || conta.saldoInicial || 0) + receita.valor;
                    DB.set('contasPessoais', contas);
                }
            }
            
            alert('✅ Receita pessoal adicionada com sucesso!');
            closeModal('receitaPessoal');
            e.target.reset();
            renderReceitasPessoais();
            updateStatsPessoal();
        }
        
        function addDespesaPessoal(e) {
            e.preventDefault();
            
            const despesa = {
                descricao: document.getElementById('despesaPessoalDesc').value,
                categoria: document.getElementById('despesaPessoalCategoria').value,
                valor: parseFloat(document.getElementById('despesaPessoalValor').value),
                data: document.getElementById('despesaPessoalData').value,
                contaId: document.getElementById('despesaPessoalConta').value || null,
                observacoes: document.getElementById('despesaPessoalObs').value
            };
            
            DB.add('despesasPessoais', despesa);
            
            // Atualizar saldo da conta se selecionada
            if (despesa.contaId) {
                const contas = DB.get('contasPessoais');
                const conta = contas.find(c => c.id === parseInt(despesa.contaId));
                if (conta) {
                    conta.saldoAtual = (conta.saldoAtual || conta.saldoInicial || 0) - despesa.valor;
                    DB.set('contasPessoais', contas);
                }
            }
            
            alert('✅ Despesa pessoal adicionada com sucesso!');
            closeModal('despesaPessoal');
            e.target.reset();
            renderDespesasPessoais();
            updateStatsPessoal();
            renderDespesasPorCategoria();
        }
        
        function addContaPessoal(e) {
            e.preventDefault();
            
            const conta = {
                nome: document.getElementById('contaPessoalNome').value,
                tipo: document.getElementById('contaPessoalTipo').value,
                saldoInicial: parseFloat(document.getElementById('contaPessoalSaldo').value) || 0,
                saldoAtual: parseFloat(document.getElementById('contaPessoalSaldo').value) || 0,
                banco: document.getElementById('contaPessoalBanco').value,
                ativa: true
            };
            
            DB.add('contasPessoais', conta);
            
            alert('✅ Conta/Cartão adicionado com sucesso!');
            closeModal('contaPessoal');
            e.target.reset();
            renderContasPessoais();
            carregarContasPessoaisNosSelects();
            updateStatsPessoal();
        }
        
        function renderReceitasPessoais() {
            const receitas = DB.get('receitasPessoais');
            const container = document.getElementById('listaReceitasPessoais');
            
            if (!container) return;
            
            if (receitas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma receita pessoal cadastrada.</p>';
                return;
            }
            
            // Ordenar por data decrescente
            const receitasOrdenadas = receitas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            container.innerHTML = receitasOrdenadas.map(r => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${r.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(r.data)} • ${getCategoriaLabelPessoal(r.categoria, 'receita')}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--success);">
                        + ${formatMoney(r.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        function renderDespesasPessoais() {
            const despesas = DB.get('despesasPessoais');
            const container = document.getElementById('listaDespesasPessoais');
            
            if (!container) return;
            
            if (despesas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma despesa pessoal cadastrada.</p>';
                return;
            }
            
            // Ordenar por data decrescente
            const despesasOrdenadas = despesas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            container.innerHTML = despesasOrdenadas.map(d => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${d.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(d.data)} • ${getCategoriaLabelPessoal(d.categoria, 'despesa')}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--danger);">
                        - ${formatMoney(d.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        function renderContasPessoais() {
            const contas = DB.get('contasPessoais');
            const container = document.getElementById('listaContasPessoais');
            
            if (!container) return;
            
            if (contas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma conta/cartão cadastrado.</p>';
                return;
            }
            
            container.innerHTML = contas.map(c => {
                const saldoColor = c.saldoAtual >= 0 ? 'var(--success)' : 'var(--danger)';
                const tipoIcons = {
                    'corrente': '🏦',
                    'poupanca': '💰',
                    'cartao_credito': '💳',
                    'cartao_debito': '💳',
                    'investimento': '📈',
                    'dinheiro': '💵'
                };
                
                return `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 8px;">${tipoIcons[c.tipo] || '🏦'} ${c.nome}</h4>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    ${c.banco || 'Sem banco informado'}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${saldoColor};">
                                    ${formatMoney(c.saldoAtual || 0)}
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Saldo Atual</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderDespesasPorCategoria() {
            const despesas = DB.get('despesasPessoais');
            const container = document.getElementById('despesasPorCategoria');
            
            if (!container) return;
            
            if (despesas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma despesa para análise.</p>';
                return;
            }
            
            // Agrupar por categoria
            const porCategoria = {};
            let totalDespesas = 0;
            
            despesas.forEach(d => {
                if (!porCategoria[d.categoria]) {
                    porCategoria[d.categoria] = 0;
                }
                porCategoria[d.categoria] += d.valor;
                totalDespesas += d.valor;
            });
            
            // Ordenar por valor
            const categorias = Object.entries(porCategoria)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            container.innerHTML = categorias.map(([cat, valor]) => {
                const percent = ((valor / totalDespesas) * 100).toFixed(1);
                return `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${getCategoriaLabelPessoal(cat, 'despesa')}</span>
                            <span style="color: var(--danger); font-weight: 700;">${formatMoney(valor)} (${percent}%)</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="width: ${percent}%; height: 100%; background: var(--danger); transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStatsPessoal() {
            const receitas = DB.get('receitasPessoais');
            const despesas = DB.get('despesasPessoais');
            const contas = DB.get('contasPessoais');
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const saldo = totalReceitas - totalDespesas;
            
            const receitasEl = document.getElementById('receitasPessoais');
            const despesasEl = document.getElementById('despesasPessoais');
            const saldoEl = document.getElementById('saldoPessoal');
            const contasEl = document.getElementById('totalContasPessoais');
            
            if (receitasEl) receitasEl.textContent = formatMoney(totalReceitas);
            if (despesasEl) despesasEl.textContent = formatMoney(totalDespesas);
            if (saldoEl) {
                saldoEl.textContent = formatMoney(saldo);
                saldoEl.style.color = saldo >= 0 ? 'var(--success)' : 'var(--danger)';
            }
            if (contasEl) contasEl.textContent = contas.filter(c => c.ativa).length;
        }
        
        function carregarContasPessoaisNosSelects() {
            const contas = DB.get('contasPessoais').filter(c => c.ativa);
            
            const selectReceita = document.getElementById('receitaPessoalConta');
            const selectDespesa = document.getElementById('despesaPessoalConta');
            
            if (selectReceita) {
                selectReceita.innerHTML = '<option value="">Não informado</option>';
                contas.forEach(c => {
                    selectReceita.innerHTML += `<option value="${c.id}">${c.nome}</option>`;
                });
            }
            
            if (selectDespesa) {
                selectDespesa.innerHTML = '<option value="">Não informado</option>';
                contas.forEach(c => {
                    selectDespesa.innerHTML += `<option value="${c.id}">${c.nome}</option>`;
                });
            }
        }
        
        function getCategoriaLabelPessoal(categoria, tipo) {
            const labelsReceita = {
                'salario': '💼 Salário',
                'freelance': '💻 Freelance',
                'investimentos': '📈 Investimentos',
                'aluguel': '🏠 Aluguel',
                'venda': '💰 Venda',
                'retirada_empresa': '🏢 Retirada da Empresa',
                'outros': '📌 Outros'
            };
            
            const labelsDespesa = {
                'moradia': '🏠 Moradia',
                'alimentacao': '🍔 Alimentação',
                'transporte': '🚗 Transporte',
                'saude': '⚕️ Saúde',
                'educacao': '📚 Educação',
                'lazer': '🎮 Lazer',
                'vestuario': '👕 Vestuário',
                'contas': '📄 Contas',
                'cartao': '💳 Cartão',
                'prestacao': '📊 Prestação',
                'outros': '📌 Outros'
            };
            
            return tipo === 'receita' ? (labelsReceita[categoria] || categoria) : (labelsDespesa[categoria] || categoria);
        }
        
        // Inicializar dados pessoais se não existirem
        if (!DB.get('receitasPessoais') || DB.get('receitasPessoais').length === 0) {
            DB.set('receitasPessoais', []);
        }
        if (!DB.get('despesasPessoais') || DB.get('despesasPessoais').length === 0) {
            DB.set('despesasPessoais', []);
        }
        if (!DB.get('contasPessoais') || DB.get('contasPessoais').length === 0) {
            DB.set('contasPessoais', []);
        }
        
        // ============================================
        // SISTEMA DE CONTAS A PAGAR
        // ============================================
        
        // Inicializar contas a pagar
        if (!DB.get('contasPagar')) {
            DB.set('contasPagar', []);
        }
        
        let filtroContasPagarAtual = 'todas';
        
        function addContaPagar(e) {
            e.preventDefault();
            
            const conta = {
                id: Date.now(),
                descricao: document.getElementById('contaPagarDesc').value,
                tipo: document.getElementById('contaPagarTipo').value,
                valor: parseFloat(document.getElementById('contaPagarValor').value),
                vencimento: document.getElementById('contaPagarVencimento').value,
                recorrencia: document.getElementById('contaPagarRecorrencia').value,
                observacoes: document.getElementById('contaPagarObs').value,
                notificar: document.getElementById('contaPagarNotificar').checked,
                paga: false,
                dataPagamento: null,
                dataCadastro: new Date().toISOString()
            };
            
            const contas = DB.get('contasPagar');
            contas.push(conta);
            DB.set('contasPagar', contas);
            
            closeModal('contaPagar');
            e.target.reset();
            
            renderContasPagar();
            updateResumoContasPagar();
            
            alert('✅ Conta cadastrada com sucesso!');
        }
        
        function renderContasPagar() {
            const todasContas = DB.get('contasPagar');
            const container = document.getElementById('listaContasPagar');
            
            if (!container) return;
            
            // Filtrar contas
            let contas = [...todasContas];
            const hoje = new Date().setHours(0, 0, 0, 0);
            
            if (filtroContasPagarAtual === 'vencidas') {
                contas = contas.filter(c => !c.paga && new Date(c.vencimento) < hoje);
            } else if (filtroContasPagarAtual === 'hoje') {
                contas = contas.filter(c => !c.paga && new Date(c.vencimento).setHours(0,0,0,0) === hoje);
            } else if (filtroContasPagarAtual === 'proximas') {
                const seteDias = new Date(hoje);
                seteDias.setDate(seteDias.getDate() + 7);
                contas = contas.filter(c => !c.paga && new Date(c.vencimento) >= hoje && new Date(c.vencimento) <= seteDias);
            } else if (filtroContasPagarAtual === 'pagas') {
                contas = contas.filter(c => c.paga);
            }
            
            // Ordenar por vencimento
            contas.sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));
            
            if (contas.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                    Nenhuma conta ${filtroContasPagarAtual === 'todas' ? '' : filtroContasPagarAtual} encontrada.
                </p>`;
                return;
            }
            
            container.innerHTML = contas.map(c => {
                const diasRestantes = calcularDiasRestantes(c.vencimento);
                const status = getStatusConta(c, diasRestantes);
                
                const tipoIcons = {
                    'cartao': '💳', 'prestacao': '🚗', 'seguro': '🛡️',
                    'aluguel': '🏠', 'condominio': '🏢', 'luz': '💡',
                    'agua': '💧', 'internet': '📡', 'telefone': '📱',
                    'streaming': '📺', 'escola': '🎓', 'saude': '⚕️',
                    'academia': '🏋️', 'emprestimo': '💰', 'financiamento': '🏦',
                    'boleto': '📄', 'outros': '📌'
                };
                
                return `
                    <div class="card" style="margin-bottom: 12px; border-left: 4px solid ${status.color}; ${c.paga ? 'opacity: 0.6;' : ''}">
                        <div style="padding: 16px;">
                            <!-- Header -->
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <div style="flex: 1;">
                                    <h4 style="margin-bottom: 4px; ${c.paga ? 'text-decoration: line-through;' : ''}">
                                        ${tipoIcons[c.tipo] || '📄'} ${c.descricao}
                                    </h4>
                                    <div style="font-size: 12px; color: var(--text-secondary);">
                                        ${getTipoLabel(c.tipo)}
                                        ${c.recorrencia !== 'unica' ? ` • ${c.recorrencia === 'mensal' ? '📆 Mensal' : '📅 Anual'}` : ''}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 20px; font-weight: 700; color: ${c.paga ? 'var(--success)' : 'var(--text-primary)'};">
                                        ${formatMoney(c.valor)}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status e Vencimento -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 10px; background: rgba(255, 255, 255, 0.02); border-radius: 6px;">
                                <div>
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 2px;">VENCIMENTO</div>
                                    <div style="font-size: 14px; font-weight: 600;">
                                        📅 ${formatDate(c.vencimento)}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    ${!c.paga ? `
                                        <div style="padding: 6px 12px; background: ${status.bgColor}; color: ${status.color}; border-radius: 6px; font-size: 12px; font-weight: 600;">
                                            ${status.icon} ${status.text}
                                        </div>
                                    ` : `
                                        <div style="padding: 6px 12px; background: rgba(6, 214, 160, 0.2); color: var(--success); border-radius: 6px; font-size: 12px; font-weight: 600;">
                                            ✅ PAGA
                                        </div>
                                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                            ${formatDate(c.dataPagamento)}
                                        </div>
                                    `}
                                </div>
                            </div>
                            
                            ${c.observacoes ? `
                                <div style="padding: 8px; background: rgba(255, 255, 255, 0.02); border-radius: 6px; margin-bottom: 12px;">
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">OBSERVAÇÕES</div>
                                    <div style="font-size: 13px;">${c.observacoes}</div>
                                </div>
                            ` : ''}
                            
                            <!-- Ações -->
                            <div style="display: flex; gap: 8px; justify-content: flex-end;">
                                ${!c.paga ? `
                                    <button class="btn" style="padding: 8px 16px; font-size: 12px; background: var(--success); color: white;" onclick="marcarComoPaga(${c.id})">
                                        ✅ Marcar como Paga
                                    </button>
                                ` : `
                                    <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;" onclick="desmarcarPaga(${c.id})">
                                        ↩️ Desmarcar
                                    </button>
                                `}
                                <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;" onclick="editarContaPagar(${c.id})">
                                    ✏️ Editar
                                </button>
                                <button class="btn" style="padding: 8px 16px; font-size: 12px; background: rgba(239, 71, 111, 0.2); color: var(--danger);" onclick="excluirContaPagar(${c.id})">
                                    🗑️ Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function calcularDiasRestantes(vencimento) {
            const hoje = new Date().setHours(0, 0, 0, 0);
            const dataVenc = new Date(vencimento).setHours(0, 0, 0, 0);
            const diff = dataVenc - hoje;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }
        
        function getStatusConta(conta, diasRestantes) {
            if (conta.paga) {
                return {
                    text: 'PAGA',
                    icon: '✅',
                    color: 'var(--success)',
                    bgColor: 'rgba(6, 214, 160, 0.2)'
                };
            }
            
            if (diasRestantes < 0) {
                return {
                    text: `VENCIDA HÁ ${Math.abs(diasRestantes)} DIAS`,
                    icon: '⚠️',
                    color: 'var(--danger)',
                    bgColor: 'rgba(239, 71, 111, 0.2)'
                };
            } else if (diasRestantes === 0) {
                return {
                    text: 'VENCE HOJE',
                    icon: '🔔',
                    color: 'var(--danger)',
                    bgColor: 'rgba(239, 71, 111, 0.2)'
                };
            } else if (diasRestantes <= 3) {
                return {
                    text: `VENCE EM ${diasRestantes} DIAS`,
                    icon: '⏰',
                    color: 'var(--danger)',
                    bgColor: 'rgba(239, 71, 111, 0.2)'
                };
            } else if (diasRestantes <= 7) {
                return {
                    text: `VENCE EM ${diasRestantes} DIAS`,
                    icon: '🔔',
                    color: 'var(--accent)',
                    bgColor: 'rgba(255, 210, 63, 0.2)'
                };
            } else {
                return {
                    text: `VENCE EM ${diasRestantes} DIAS`,
                    icon: '📅',
                    color: 'var(--success)',
                    bgColor: 'rgba(6, 214, 160, 0.1)'
                };
            }
        }
        
        function getTipoLabel(tipo) {
            const labels = {
                'cartao': '💳 Cartão', 'prestacao': '🚗 Prestação', 'seguro': '🛡️ Seguro',
                'aluguel': '🏠 Aluguel', 'condominio': '🏢 Condomínio', 'luz': '💡 Luz',
                'agua': '💧 Água', 'internet': '📡 Internet', 'telefone': '📱 Telefone',
                'streaming': '📺 Streaming', 'escola': '🎓 Escola', 'saude': '⚕️ Saúde',
                'academia': '🏋️ Academia', 'emprestimo': '💰 Empréstimo', 'financiamento': '🏦 Financiamento',
                'boleto': '📄 Boleto', 'outros': '📌 Outros'
            };
            return labels[tipo] || tipo;
        }
        
        function updateResumoContasPagar() {
            const contas = DB.get('contasPagar').filter(c => !c.paga);
            const hoje = new Date().setHours(0, 0, 0, 0);
            
            let vencidas = 0, valorVencidas = 0;
            let proximas = 0, valorProximas = 0;
            let futuras = 0, valorFuturas = 0;
            
            contas.forEach(c => {
                const diasRestantes = calcularDiasRestantes(c.vencimento);
                
                if (diasRestantes < 0) {
                    vencidas++;
                    valorVencidas += c.valor;
                } else if (diasRestantes <= 7) {
                    proximas++;
                    valorProximas += c.valor;
                } else {
                    futuras++;
                    valorFuturas += c.valor;
                }
            });
            
            const totalContas = contas.length;
            const totalValor = valorVencidas + valorProximas + valorFuturas;
            
            // Atualizar elementos
            const els = {
                contasVencidas: document.getElementById('contasVencidas'),
                valorVencidas: document.getElementById('valorVencidas'),
                contasProximas: document.getElementById('contasProximas'),
                valorProximas: document.getElementById('valorProximas'),
                contasFuturas: document.getElementById('contasFuturas'),
                valorFuturas: document.getElementById('valorFuturas'),
                totalAPagar: document.getElementById('totalAPagar'),
                valorTotalAPagar: document.getElementById('valorTotalAPagar')
            };
            
            if (els.contasVencidas) els.contasVencidas.textContent = vencidas;
            if (els.valorVencidas) els.valorVencidas.textContent = formatMoney(valorVencidas);
            if (els.contasProximas) els.contasProximas.textContent = proximas;
            if (els.valorProximas) els.valorProximas.textContent = formatMoney(valorProximas);
            if (els.contasFuturas) els.contasFuturas.textContent = futuras;
            if (els.valorFuturas) els.valorFuturas.textContent = formatMoney(valorFuturas);
            if (els.totalAPagar) els.totalAPagar.textContent = totalContas;
            if (els.valorTotalAPagar) els.valorTotalAPagar.textContent = formatMoney(totalValor);
            
            // Mostrar alertas se houver contas vencidas ou próximas
            mostrarAlertasVencimento(vencidas, proximas);
        }
        
        function mostrarAlertasVencimento(vencidas, proximas) {
            // Remover alertas anteriores
            const alertaAnterior = document.getElementById('alertaContasPagar');
            if (alertaAnterior) alertaAnterior.remove();
            
            if (vencidas === 0 && proximas === 0) return;
            
            // Criar alerta
            const alerta = document.createElement('div');
            alerta.id = 'alertaContasPagar';
            alerta.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                max-width: 350px;
                background: ${vencidas > 0 ? 'var(--danger)' : 'var(--accent)'};
                color: white;
                padding: 16px;
                border-radius: 12px;
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
                z-index: 9999;
                animation: slideIn 0.3s ease;
                cursor: pointer;
            `;
            
            alerta.innerHTML = `
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="font-size: 32px;">${vencidas > 0 ? '⚠️' : '🔔'}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; margin-bottom: 4px; font-size: 15px;">
                            ${vencidas > 0 ? 'Contas Vencidas!' : 'Contas Próximas!'}
                        </div>
                        <div style="font-size: 13px; opacity: 0.9;">
                            ${vencidas > 0 ? `${vencidas} conta(s) vencida(s)` : ''}
                            ${vencidas > 0 && proximas > 0 ? ' • ' : ''}
                            ${proximas > 0 ? `${proximas} vence(m) em 7 dias` : ''}
                        </div>
                        <div style="font-size: 11px; margin-top: 8px; opacity: 0.8;">
                            Clique para ver detalhes
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); this.parentElement.parentElement.remove();" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 0; line-height: 1;">×</button>
                </div>
            `;
            
            alerta.onclick = () => {
                switchTab('pessoal');
                setTimeout(() => {
                    document.getElementById('listaContasPagar').scrollIntoView({ behavior: 'smooth' });
                    if (vencidas > 0) {
                        filtrarContasPagar('vencidas');
                    }
                }, 300);
                alerta.remove();
            };
            
            document.body.appendChild(alerta);
            
            // Remover após 10 segundos
            setTimeout(() => alerta.remove(), 10000);
        }
        
        function filtrarContasPagar(filtro) {
            filtroContasPagarAtual = filtro;
            
            // Atualizar botões
            ['todas', 'vencidas', 'hoje', 'proximas', 'pagas'].forEach(f => {
                const btn = document.getElementById(`filtroContas${f.charAt(0).toUpperCase() + f.slice(1)}`);
                if (btn) {
                    if (f === filtro) {
                        btn.style.background = 'var(--primary)';
                        btn.style.color = 'white';
                    } else {
                        btn.style.background = '';
                        btn.style.color = '';
                    }
                }
            });
            
            renderContasPagar();
        }
        
        function marcarComoPaga(id) {
            if (!confirm('Marcar esta conta como paga?')) return;
            
            const contas = DB.get('contasPagar');
            const conta = contas.find(c => c.id === id);
            if (!conta) return;
            
            conta.paga = true;
            conta.dataPagamento = new Date().toISOString().split('T')[0];
            
            DB.set('contasPagar', contas);
            renderContasPagar();
            updateResumoContasPagar();
            
            alert('✅ Conta marcada como paga!');
        }
        
        function desmarcarPaga(id) {
            if (!confirm('Desmarcar pagamento desta conta?')) return;
            
            const contas = DB.get('contasPagar');
            const conta = contas.find(c => c.id === id);
            if (!conta) return;
            
            conta.paga = false;
            conta.dataPagamento = null;
            
            DB.set('contasPagar', contas);
            renderContasPagar();
            updateResumoContasPagar();
        }
        
        function editarContaPagar(id) {
            alert('Função de editar em desenvolvimento...');
        }
        
        function excluirContaPagar(id) {
            if (!confirm('Tem certeza que deseja excluir esta conta?')) return;
            
            let contas = DB.get('contasPagar');
            contas = contas.filter(c => c.id !== id);
            DB.set('contasPagar', contas);
            
            renderContasPagar();
            updateResumoContasPagar();
            
            alert('🗑️ Conta excluída!');
        }
        
        // Initialize sample data if empty
        function initSampleData() {
            // Inicializar estruturas vazias - SEM dados de exemplo
            if (!DB.get('receitas')) {
                DB.set('receitas', []);
            }
            if (!DB.get('despesas')) {
                DB.set('despesas', []);
            }
            if (!DB.get('eventos')) {
                DB.set('eventos', []);
            }
            if (!DB.get('clientes')) {
                DB.set('clientes', []);
            }
            if (!DB.get('servicos')) {
                DB.set('servicos', []);
            }
            if (!DB.get('custos')) {
                DB.set('custos', []);
            }
            
            // Criar contas bancárias padrão apenas se não existirem
            if (!DB.get('contas') || DB.get('contas').length === 0) {
                DB.set('contas', [
                    { id: 1, nome: 'Conta Principal', banco: 'Banco', tipo: 'corrente', agencia: '0001', numero: '12345-6', saldoInicial: 0, observacoes: '', ativa: true }
                ]);
            }
            
            // Inicializar custos vazios
            if (!DB.get('custosGerais')) {
                DB.set('custosGerais', []);
            }
            if (!DB.get('custosEventos')) {
                DB.set('custosEventos', []);
            }
        }

        // Check birthdays
        function checkBirthdays() {
            const clientes = DB.get('clientes');
            const hoje = new Date();
            const em7dias = new Date(hoje);
            em7dias.setDate(em7dias.getDate() + 7);
            
            const aniversariantes = clientes.filter(cliente => {
                if (!cliente.aniversario) return false;
                
                const aniversario = new Date(cliente.aniversario + 'T00:00:00');
                const anivMesDia = `${aniversario.getMonth()}-${aniversario.getDate()}`;
                
                // Verificar próximos 7 dias
                const proximosDias = [];
                for (let i = 0; i <= 7; i++) {
                    const dia = new Date(hoje);
                    dia.setDate(dia.getDate() + i);
                    proximosDias.push(`${dia.getMonth()}-${dia.getDate()}`);
                }
                
                return proximosDias.includes(anivMesDia);
            }).map(cliente => {
                const aniversario = new Date(cliente.aniversario + 'T00:00:00');
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                const anivEsteAno = new Date(hoje.getFullYear(), aniversario.getMonth(), aniversario.getDate());
                const diffDias = Math.ceil((anivEsteAno - hoje) / (1000 * 60 * 60 * 24));
                
                return {
                    ...cliente,
                    diasParaAniversario: diffDias,
                    isHoje: diffDias === 0,
                    isAmanha: diffDias === 1
                };
            }).sort((a, b) => a.diasParaAniversario - b.diasParaAniversario);
            
            renderBirthdayAlerts(aniversariantes);
        }

        // Render birthday alerts
        function renderBirthdayAlerts(aniversariantes) {
            const container = document.getElementById('birthdayAlertsCompact');
            
            if (!container) {
                console.warn('Container birthdayAlertsCompact não encontrado');
                return;
            }
            
            if (aniversariantes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const items = aniversariantes.map(cliente => {
                let badgeClass = 'badge-soon';
                let badgeText = `EM ${cliente.diasParaAniversario} DIAS`;
                
                if (cliente.isHoje) {
                    badgeClass = 'badge-today';
                    badgeText = 'HOJE! 🎊';
                } else if (cliente.isAmanha) {
                    badgeClass = 'badge-tomorrow';
                    badgeText = 'AMANHÃ';
                }
                
                return `
                    <div class="birthday-item-compact">
                        <div class="birthday-item-info">
                            <h4>🎂 ${cliente.nome}</h4>
                            <div class="birthday-item-contact">
                                📱 ${cliente.telefone} • 📧 ${cliente.email}
                            </div>
                        </div>
                        <div class="birthday-badge-compact ${badgeClass}">
                            ${badgeText}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div class="birthday-card-compact">
                    <div class="birthday-card-header">
                        <div class="birthday-icon">🎉</div>
                        <div>
                            <div class="birthday-card-title">Aniversariantes da Semana</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${aniversariantes.length} cliente${aniversariantes.length > 1 ? 's fazem' : ' faz'} aniversário nos próximos 7 dias
                            </div>
                        </div>
                    </div>
                    <div class="birthday-list">
                        ${items}
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255, 210, 63, 0.3); font-size: 12px; color: var(--text-secondary); text-align: center;">
                        💡 Envie uma mensagem de parabéns para fortalecer o relacionamento!
                    </div>
                </div>
            `;
        }

        // Update dashboard stats
        function updateStats() {
            const receitas = DB.get('receitas');
            const todasDespesas = DB.get('despesas');
            const custosGerais = DB.get('custosGerais') || [];
            const custosEventos = DB.get('custosEventos') || [];
            const eventos = DB.get('eventos');
            const clientes = DB.get('clientes');

            // Obter mês e ano atual para filtrar
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();

            // Filtrar receitas do mês atual
            const receitasDoMes = receitas.filter(r => {
                if (!r.data) return false;
                const dataReceita = new Date(r.data + 'T00:00:00');
                return dataReceita.getMonth() === mesAtual && dataReceita.getFullYear() === anoAtual;
            });

            // Separar despesas gerais de despesas de eventos
            // Identifica por flag OU pela descrição (para dados antigos)
            const despesas = todasDespesas.filter(d => {
                // Se tem flag, usar a flag
                if (d.tipoDespesa) {
                    return d.tipoDespesa !== 'custo_evento';
                }
                // Se não tem flag, verificar pela descrição
                return !d.descricao.includes('[Custo Evento:');
            });

            // Filtrar despesas do mês atual
            const despesasDoMes = despesas.filter(d => {
                if (!d.data) return false;
                const dataDespesa = new Date(d.data + 'T00:00:00');
                return dataDespesa.getMonth() === mesAtual && dataDespesa.getFullYear() === anoAtual;
            });

            // Filtrar custos de eventos do mês atual
            const custosEventosDoMes = custosEventos.filter(c => {
                if (!c.data) return false;
                const dataCusto = new Date(c.data + 'T00:00:00');
                return dataCusto.getMonth() === mesAtual && dataCusto.getFullYear() === anoAtual;
            });
            
            const totalReceitas = receitasDoMes.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesasDoMes.reduce((sum, d) => sum + d.valor, 0);
            const totalCustosGerais = custosGerais.reduce((sum, c) => sum + c.valor, 0);
            const totalCustosEventos = custosEventosDoMes.reduce((sum, c) => sum + c.valor, 0);
            
            // DEBUG: Verificar valores
            console.log('📊 DEBUG Dashboard (Mês Atual):');
            console.log('Receitas do Mês:', totalReceitas, '(' + receitasDoMes.length + ' itens)');
            console.log('Despesas do Mês:', totalDespesas, '(' + despesasDoMes.length + ' itens)');
            console.log('Custos Gerais:', totalCustosGerais, '(' + custosGerais.length + ' itens) - NÃO são subtraídos separadamente');
            console.log('Custos Eventos do Mês:', totalCustosEventos, '(' + custosEventosDoMes.length + ' itens)');
            
            // Alert temporário para debug
            const lucroCalculado = totalReceitas - totalDespesas - totalCustosEventos;
            console.log('🔍 ANÁLISE DETALHADA:');
            console.log('Fórmula: Receitas - Despesas - Custos Eventos');
            console.log(`${totalReceitas} - ${totalDespesas} - ${totalCustosEventos} = ${lucroCalculado}`);
            console.log('ℹ️ Custos Gerais já estão incluídos nas Despesas quando pagos por uma conta');
            
            // Calcular valores a receber APENAS do mês atual
            let valoresAReceber = 0;
            let clientesPendentes = 0;
            clientes.forEach(cliente => {
                if (cliente.financeiro && cliente.financeiro.valorPagar > 0) {
                    // Verificar se o vencimento é do mês atual
                    if (cliente.financeiro.vencimento) {
                        const dataVenc = new Date(cliente.financeiro.vencimento + 'T00:00:00');
                        if (dataVenc.getMonth() === mesAtual && dataVenc.getFullYear() === anoAtual) {
                            valoresAReceber += cliente.financeiro.valorPagar;
                            clientesPendentes++;
                        }
                    }
                }
            });
            
            // Lucro = Receitas - Despesas - Custos Eventos
            // IMPORTANTE: Não subtrair custosGerais separadamente pois eles já viraram despesas
            // quando foram pagos por uma conta (evita duplicação)
            const lucro = totalReceitas - totalDespesas - totalCustosEventos;
            const margemLucro = totalReceitas > 0 ? ((lucro / totalReceitas) * 100).toFixed(1) : 0;
            
            // Eventos em andamento (aguardando + em andamento)
            const eventosAndamento = eventos.filter(e => e.status === 'aguardando' || e.status === 'andamento');
            const eventosAndamentoMes = eventosAndamento.filter(e => {
                const dataEvento = new Date(e.data);
                return dataEvento.getMonth() === mesAtual && dataEvento.getFullYear() === anoAtual;
            });
            
            // Eventos concluídos do ano atual
            const eventosConcluidos = eventos.filter(e => {
                if (e.status !== 'concluido') return false;
                const dataEvento = new Date(e.data);
                return dataEvento.getFullYear() === anoAtual;
            });

            const el = (id) => document.getElementById(id);
            
            if (el('totalReceitas')) el('totalReceitas').textContent = formatMoney(totalReceitas);
            // Despesas do mês = apenas despesas (custos gerais com conta já viraram despesas)
            if (el('totalDespesas')) el('totalDespesas').textContent = formatMoney(totalDespesas);
            if (el('totalCustosEventos')) el('totalCustosEventos').textContent = formatMoney(totalCustosEventos);
            if (el('numeroCustosEventos')) el('numeroCustosEventos').textContent = custosEventos.length;
            if (el('lucroLiquido')) el('lucroLiquido').textContent = formatMoney(lucro);
            if (el('percentLucro')) el('percentLucro').textContent = margemLucro;
            
            // Atualizar novos cards de eventos
            if (el('totalEventosAndamento')) el('totalEventosAndamento').textContent = eventosAndamento.length;
            if (el('eventosDoMes')) el('eventosDoMes').textContent = eventosAndamentoMes.length;
            if (el('totalEventosConcluidos')) el('totalEventosConcluidos').textContent = eventosConcluidos.length;
            if (el('eventosConcluidosAno')) el('eventosConcluidosAno').textContent = eventosConcluidos.length;
            
            // Atualizar valores a receber
            if (document.getElementById('valoresAReceberDashboard')) {
                document.getElementById('valoresAReceberDashboard').textContent = formatMoney(valoresAReceber);
            }
            if (document.getElementById('numClientesPendentes')) {
                document.getElementById('numClientesPendentes').textContent = clientesPendentes;
            }
        }

        // Render transactions
        function renderTransactions() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            
            // Não incluir custos gerais e de eventos diretamente
            // pois eles já aparecem como despesas quando têm conta bancária
            const transactions = [
                ...receitas.map(r => ({ ...r, type: 'receita' })),
                ...despesas.map(d => ({ ...d, type: 'despesa' }))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 6);

            const html = transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon ${t.type === 'receita' ? 'bg-success' : 'bg-danger'}">
                            ${t.type === 'receita' ? '💰' : '💸'}
                        </div>
                        <div class="transaction-details">
                            <h4>${t.descricao}</h4>
                            <div class="transaction-date">${formatDate(t.data)}</div>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type === 'receita' ? 'positive' : 'negative'}">
                        ${t.type === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');

            document.getElementById('transactionsList').innerHTML = html;
        }

        // Render events
        function renderEvents() {
            const eventos = DB.get('eventos')
                .sort((a, b) => new Date(a.data) - new Date(b.data))
                .slice(0, 3);

            const html = eventos.map(e => {
                // Definir classe CSS baseada no status
                let statusClass = 'status-pending';
                let statusText = e.status;
                
                if (e.status === 'confirmado' || e.status === 'andamento') {
                    statusClass = 'status-confirmed';
                    statusText = e.status === 'andamento' ? 'Em Andamento' : 'Confirmado';
                } else if (e.status === 'concluido' || e.status === 'finalizado') {
                    statusClass = 'status-completed';
                    statusText = 'Concluído';
                } else if (e.status === 'cancelado') {
                    statusClass = 'status-cancelled';
                    statusText = 'Cancelado';
                } else if (e.status === 'aguardando' || e.status === 'pendente') {
                    statusClass = 'status-pending';
                    statusText = 'Aguardando';
                }
                
                return `
                <div class="event-card" onclick="irParaEvento(${e.id})" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div class="event-header">
                        <div>
                            <div class="event-title">${e.nome}</div>
                            <div class="event-client">${e.cliente}</div>
                        </div>
                        <div class="event-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="event-details">
                        <div class="event-detail">
                            <span>📅</span>
                            <span>${formatDate(e.data)}</span>
                        </div>
                        <div class="event-detail">
                            <span>🕐</span>
                            <span>${e.horario || e.horaInicio || '-'}</span>
                        </div>
                        <div class="event-detail">
                            <span>💰</span>
                            <span>${e.valor ? formatMoney(e.valor) : 'R$ 0,00'}</span>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            document.getElementById('eventsList').innerHTML = html || '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Nenhum evento cadastrado</p>';
        }

        // Update origem stats
        function updateOrigemStats() {
            const clientes = DB.get('clientes');
            const container = document.getElementById('origemStats');
            
            if (clientes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum cliente cadastrado ainda.</p>';
                return;
            }

            // Contar origens
            const origens = {
                facebook: { label: 'Facebook', icon: '📘', count: 0, color: 'rgba(0, 78, 137, 0.15)' },
                instagram: { label: 'Instagram', icon: '📸', count: 0, color: 'rgba(255, 107, 53, 0.15)' },
                google: { label: 'Google', icon: '🔍', count: 0, color: 'rgba(6, 214, 160, 0.15)' },
                indicacao: { label: 'Indicação', icon: '👥', count: 0, color: 'rgba(255, 210, 63, 0.15)' },
                outros: { label: 'Outros', icon: '📌', count: 0, color: 'rgba(160, 174, 192, 0.15)' }
            };

            clientes.forEach(cliente => {
                if (cliente.origem && origens[cliente.origem]) {
                    origens[cliente.origem].count++;
                }
            });

            const total = clientes.length;
            const html = Object.entries(origens)
                .filter(([key, data]) => data.count > 0)
                .sort((a, b) => b[1].count - a[1].count)
                .map(([key, data]) => {
                    const percentage = ((data.count / total) * 100).toFixed(1);
                    return `
                        <div class="origem-item">
                            <div class="origem-info">
                                <div class="origem-icon" style="background: ${data.color};">
                                    ${data.icon}
                                </div>
                                <div>
                                    <div class="origem-label">${data.label}</div>
                                    <div class="origem-bar" style="width: 150px;">
                                        <div class="origem-bar-fill" style="width: ${percentage}%;"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="origem-count">${data.count}</div>
                                <div style="font-size: 11px; color: var(--text-secondary); text-align: right;">
                                    ${percentage}%
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            container.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhuma origem registrada.</p>';
        }

        // Modal functions
        // Add receita
        function addReceita(e) {
            e.preventDefault();
            const receita = {
                descricao: document.getElementById('receitaDescricao').value,
                valor: parseFloat(document.getElementById('receitaValor').value),
                data: document.getElementById('receitaData').value,
                categoria: document.getElementById('receitaCategoria').value,
                formaPagamento: document.getElementById('receitaFormaPagamento').value,
                contaId: parseInt(document.getElementById('receitaConta').value),
                observacoes: document.getElementById('receitaObservacoes').value
            };
            DB.add('receitas', receita);
            e.target.reset();
            closeModal('receita');
            updateDashboard();
            renderFinanceiro();
        }

        // Add despesa
        function addDespesa(e) {
            e.preventDefault();
            const despesa = {
                descricao: document.getElementById('despesaDescricao').value,
                valor: parseFloat(document.getElementById('despesaValor').value),
                data: document.getElementById('despesaData').value,
                categoria: document.getElementById('despesaCategoria').value,
                formaPagamento: document.getElementById('despesaFormaPagamento').value,
                contaId: parseInt(document.getElementById('despesaConta').value),
                observacoes: document.getElementById('despesaObservacoes').value
            };
            
            DB.add('despesas', despesa);
            
            // ✅ Atualizar saldo da conta (DÉBITO)
            if (despesa.contaId && !isNaN(despesa.contaId)) {
                atualizarSaldoConta(despesa.contaId.toString(), despesa.valor, 'debito');
            }
            
            e.target.reset();
            closeModal('despesa');
            updateDashboard();
            renderFinanceiro();
        }

        // Add evento
        function addEvento(e) {
            e.preventDefault();
            
            // Se estiver editando, chamar função de edição
            if (window.eventoEditandoId) {
                salvarEdicaoEvento();
                return;
            }
            
            // Montar endereço completo do evento
            const cep = document.getElementById('eventoCep').value;
            const rua = document.getElementById('eventoRua').value;
            const numero = document.getElementById('eventoNumero').value;
            const complemento = document.getElementById('eventoComplemento').value;
            const bairro = document.getElementById('eventoBairro').value;
            const cidade = document.getElementById('eventoCidade').value;
            const estado = document.getElementById('eventoEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento + '\n';
                if (bairro) enderecoCompleto += bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            const evento = {
                tipo: document.getElementById('eventoTipo').value,
                nome: document.getElementById('eventoTipo').value, // Manter compatibilidade
                cliente: document.getElementById('eventoCliente').value,
                data: document.getElementById('eventoData').value,
                horaInicio: document.getElementById('eventoHoraInicio').value,
                horaFim: document.getElementById('eventoHoraFim').value,
                duracao: document.getElementById('eventoDuracao').value,
                horario: document.getElementById('eventoHoraInicio').value, // Manter compatibilidade
                local: enderecoCompleto,
                cep: cep,
                rua: rua,
                numero: numero,
                complemento: complemento,
                bairro: bairro,
                cidade: cidade,
                estado: estado,
                valor: parseFloat(document.getElementById('eventoValor').value),
                status: document.getElementById('eventoStatus').value,
                observacoes: document.getElementById('eventoObservacoes').value
            };
            
            DB.add('eventos', evento);
            e.target.reset();
            limparCamposEnderecoEvento();
            document.getElementById('valorClienteInfo').style.display = 'none';
            closeModal('evento');
            updateDashboard();
            renderEventsList();
            alert('✅ Evento cadastrado com sucesso!');
        }

        // Add orçamento
        function addOrcamento(e) {
            e.preventDefault();
            
            // Verificar se está editando
            const form = e.target;
            const editingEventId = form.getAttribute('data-editing-event-id');
            const isEditing = !!editingEventId;
            
            console.log('🔍 DEBUG addOrcamento:');
            console.log('  Form:', form);
            console.log('  editingEventId:', editingEventId);
            console.log('  isEditing:', isEditing);
            
            // Coletar dados do orçamento
            const cliente = document.getElementById('orcCliente').value;
            const tipoEvento = document.getElementById('orcTipoEvento').value;
            const data = document.getElementById('orcData').value;
            const horaInicio = document.getElementById('orcHoraInicio').value;
            const horaFim = document.getElementById('orcHoraFim').value;
            
            // Calcular duração
            const [hI, mI] = horaInicio.split(':').map(Number);
            const [hF, mF] = horaFim.split(':').map(Number);
            let minutosInicio = hI * 60 + mI;
            let minutosFim = hF * 60 + mF;
            if (minutosFim < minutosInicio) minutosFim += 24 * 60;
            const diffMinutos = minutosFim - minutosInicio;
            const horas = Math.floor(diffMinutos / 60);
            const minutos = diffMinutos % 60;
            let duracao = '';
            if (horas > 0) duracao += `${horas}h`;
            if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
            
            // Montar endereço
            const cep = document.getElementById('orcCep').value;
            const rua = document.getElementById('orcRua').value;
            const numero = document.getElementById('orcNumero').value;
            const complemento = document.getElementById('orcComplemento').value;
            const bairro = document.getElementById('orcBairro').value;
            const cidade = document.getElementById('orcCidade').value;
            const estado = document.getElementById('orcEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento + '\n';
                if (bairro) enderecoCompleto += bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            // Coletar serviços selecionados (usar global + checkboxes marcados)
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            
            // Limpar e recoletar serviços dos checkboxes
            const servicosCheckboxes = [];
            checkboxes.forEach(cb => {
                servicosCheckboxes.push({
                    id: parseInt(cb.dataset.id),
                    nome: cb.dataset.nome,
                    valor: parseFloat(cb.dataset.valor)
                });
            });
            
            // Combinar serviços dos checkboxes com serviços já na lista global
            const todosServicos = [...servicosCheckboxes];
            // Adicionar serviços da global que não estão nos checkboxes
            servicosSelecionados.forEach(s => {
                if (!servicosCheckboxes.find(sc => sc.nome === s.nome)) {
                    todosServicos.push(s);
                }
            });
            
            const valorTotal = parseFloat(document.getElementById('orcValorTotal').value);
            const observacoes = document.getElementById('orcObservacoes').value;
            const dataCriacao = document.getElementById('orcDataCriacao').value;
            const validade = document.getElementById('orcValidade').value;
            const status = document.getElementById('orcStatus').value; // ✅ Novo campo
            
            // Criar orçamento
            const orcamento = {
                cliente,
                tipoEvento,
                data,
                horaInicio,
                horaFim,
                duracao,
                endereco: enderecoCompleto,
                cep, rua, numero, complemento, bairro, cidade, estado,
                servicos: todosServicos,
                outrasTaxas: [...outrasTaxas],
                desconto: {
                    valor: parseFloat(document.getElementById('orcDesconto').value) || 0,
                    tipo: document.getElementById('orcDescontoTipo').value
                },
                valorTotal,
                observacoes,
                dataCriacao,
                validade,
                status: status // ✅ Usar status selecionado
            };
            
            // Salvar orçamento (opcional - pode criar tabela de orçamentos)
            // DB.add('orcamentos', orcamento);
            
            // Criar evento automaticamente com dados do orçamento
            const evento = {
                tipo: tipoEvento,
                nome: tipoEvento,
                cliente,
                data,
                horaInicio,
                horaFim,
                duracao,
                horario: horaInicio,
                local: enderecoCompleto,
                cep, rua, numero, complemento, bairro, cidade, estado,
                valor: valorTotal,
                servicos: todosServicos,
                status: status,
                observacoes: `Orçamento criado em ${formatDate(dataCriacao)}\n\nServiços:\n${todosServicos.map(s => `• ${s.nome} - ${formatMoney(s.valor)}`).join('\n')}${outrasTaxas.length > 0 ? '\n\nOutras Taxas:\n' + outrasTaxas.map(t => `• ${t.descricao} - ${formatMoney(t.valor)}`).join('\n') : ''}${observacoes ? '\n\nObservações:\n' + observacoes : ''}`
            };
            
            // Verificar se está editando ou criando novo
            if (isEditing) {
                // EDITANDO evento existente
                const eventos = DB.get('eventos');
                const index = eventos.findIndex(ev => ev.id == editingEventId);
                
                if (index !== -1) {
                    // Manter ID e data de criação
                    evento.id = eventos[index].id;
                    evento.dataCadastro = eventos[index].dataCadastro;
                    
                    // Atualizar evento
                    eventos[index] = evento;
                    DB.set('eventos', eventos);
                    
                    console.log('✓ Evento atualizado:', evento.tipo);
                    
                    // Limpar atributo de edição
                    form.removeAttribute('data-editing-event-id');
                    
                    // Restaurar botão
                    const btnSubmit = document.getElementById('btnSubmitOrcamento');
                    if (btnSubmit) {
                        btnSubmit.innerHTML = '💼 Gerar Orçamento e Criar Evento';
                    }
                    
                    // Atualizar dados financeiros do cliente na edição
                    const clientes = DB.get('clientes');
                    const clienteExistente = clientes.find(c => c.nome.toLowerCase() === cliente.toLowerCase());
                    
                    if (clienteExistente) {
                        // Atualizar valores financeiros
                        clienteExistente.financeiro = clienteExistente.financeiro || {};
                        clienteExistente.financeiro.valorTotal = valorTotal;
                        clienteExistente.financeiro.valorPagar = valorTotal - (clienteExistente.financeiro.sinalValor || 0);
                        clienteExistente.financeiro.vencimento = data;
                        DB.set('clientes', clientes);
                        console.log('✓ Dados financeiros do cliente atualizados:', clienteExistente.nome);
                    }
                    
                    // Limpar formulário
                    e.target.reset();
                    outrasTaxas = [];
                    servicosSelecionados = [];
                    document.getElementById('outrasTaxasList').innerHTML = '';
                    limparCamposEnderecoOrcamento();
                    closeModal('orcamento');
                    
                    // Mensagem de sucesso para EDIÇÃO
                    alert('✅ Evento editado com sucesso!\n\nOs dados do evento e valores financeiros foram atualizados.');
                    
                    switchTabProgramatically('eventos');
                    renderEventsList();
                    updateDashboard();
                    return; // Importante: sair da função aqui
                }
            } else {
                // CRIANDO novo evento
                DB.add('eventos', evento);
                console.log('✓ Novo evento criado:', evento.tipo);
            }
            
            // Atualizar dados financeiros do cliente se já existir (apenas para CRIAÇÃO)
            const clientes = DB.get('clientes');
            const clienteExistente = clientes.find(c => c.nome.toLowerCase() === cliente.toLowerCase());
            
            if (clienteExistente) {
                // Na criação, só atualizar se não tiver valores ou estiver zerado
                if (!clienteExistente.financeiro || clienteExistente.financeiro.valorTotal === 0) {
                    clienteExistente.financeiro = {
                        valorTotal,
                        sinalValor: 0,
                        sinalData: '',
                        valorPagar: valorTotal,
                        vencimento: data
                    };
                    DB.set('clientes', clientes);
                    console.log('✓ Dados financeiros do cliente criados:', clienteExistente.nome);
                }
            }
            
            // Limpar formulário
            e.target.reset();
            outrasTaxas = [];
            servicosSelecionados = [];
            document.getElementById('outrasTaxasList').innerHTML = '';
            limparCamposEnderecoOrcamento();
            closeModal('orcamento');
            
            // Mensagem de sucesso para CRIAÇÃO
            alert('✅ Orçamento gerado e evento criado com sucesso!\n\nO evento foi criado com status "Aguardando Aprovação".');
            
            switchTabProgramatically('eventos');
            renderEventsList();
            updateDashboard();
        }

        // Add cliente
        function addCliente(e) {
            e.preventDefault();
            
            const origem = document.getElementById('clienteOrigem').value;
            const nomeCliente = document.getElementById('clienteNome').value;
            
            // Montar endereço completo
            const cep = document.getElementById('clienteCep').value;
            const rua = document.getElementById('clienteRua').value;
            const numero = document.getElementById('clienteNumero').value;
            const complemento = document.getElementById('clienteComplemento').value;
            const bairro = document.getElementById('clienteBairro').value;
            const cidade = document.getElementById('clienteCidade').value;
            const estado = document.getElementById('clienteEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento + '\n';
                if (bairro) enderecoCompleto += bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            const cliente = {
                nome: nomeCliente,
                email: document.getElementById('clienteEmail').value,
                telefone: document.getElementById('clienteTelefone').value,
                cpf: document.getElementById('clienteCpf').value,
                aniversario: document.getElementById('clienteAniversario').value,
                origem: origem,
                indicacao: origem === 'indicacao' ? document.getElementById('clienteIndicacao').value : '',
                endereco: enderecoCompleto,
                cep: cep,
                rua: rua,
                numero: numero,
                complemento: complemento,
                bairro: bairro,
                cidade: cidade,
                estado: estado,
                observacoes: document.getElementById('clienteObservacoes').value,
                financeiro: {
                    valorTotal: 0,
                    sinalValor: 0,
                    sinalData: '',
                    valorPagar: 0,
                    vencimento: ''
                }
            };
            
            // Verificar se está editando
            const editingId = e.target.getAttribute('data-editing-id');
            let novoCliente;
            
            if (editingId) {
                const clientes = DB.get('clientes');
                const index = clientes.findIndex(c => c.id === editingId);
                if (index !== -1) {
                    cliente.id = editingId;
                    cliente.financeiro = clientes[index].financeiro || {
                        valorTotal: 0,
                        sinalValor: 0,
                        sinalData: '',
                        valorPagar: 0,
                        vencimento: ''
                    };
                    cliente.dataCadastro = clientes[index].dataCadastro;
                    clientes[index] = cliente;
                    DB.set('clientes', clientes);
                    novoCliente = cliente;
                }
                e.target.removeAttribute('data-editing-id');
            } else {
                cliente.financeiro = {
                    valorTotal: 0,
                    sinalValor: 0,
                    sinalData: '',
                    valorPagar: 0,
                    vencimento: ''
                };
                novoCliente = DB.add('clientes', cliente);
            }
            
            window.ultimoClienteId = novoCliente.id;
            
            // Limpar formulário
            e.target.reset();
            document.getElementById('indicacaoDetalhes').style.display = 'none';
            limparCamposEndereco();
            
            // Fechar modal
            closeModal('cliente');
            
            // Atualizar interface
            checkBirthdays();
            updateOrigemStats();
            updateDashboard(); // ✅ Atualizar dashboard
            renderClientsList(); // ✅ Atualizar lista de clientes
            updateClientsStats(); // ✅ Atualizar stats
            
            // Ir para aba clientes
            switchTabProgramatically('clientes');
            
            // Abrir modal de sucesso
            setTimeout(function() {
                const modalSucesso = document.getElementById('modalSucessoCliente');
                const nomeElement = document.getElementById('sucessoClienteNome');
                
                if (modalSucesso && nomeElement) {
                    nomeElement.innerHTML = '<strong style="color: var(--primary);">' + nomeCliente + '</strong> foi adicionado à sua base de clientes!';
                    modalSucesso.classList.add('active');
                }
            }, 500);
        }
        
        // Switch tab programatically (sem event)
        function switchTabProgramatically(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(tabName)) {
                    tab.classList.add('active');
                }
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load tab-specific content
            if (tabName === 'eventos') {
                renderEventsList();
                renderKanbanView();
            } else if (tabName === 'clientes') {
                renderClientsList();
                updateClientsStats();
            } else if (tabName === 'custos') {
                toggleCustosView('gerais');
            }
        }

        // Format CEP
        function formatCep(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            input.value = value;
        }

        // Buscar CEP
        let cepTimeout;
        function buscarCep() {
            clearTimeout(cepTimeout);
            
            const cep = document.getElementById('clienteCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepLoading').style.display = 'none';
            document.getElementById('cepError').style.display = 'none';
            document.getElementById('cepSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEndereco();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepLoading').style.display = 'block';
            
            // Delay para não fazer muitas requisições
            cepTimeout = setTimeout(() => {
                // Usar JSONP para evitar problemas de CORS em arquivo local
                const script = document.createElement('script');
                const callbackName = 'viaCepCallback' + Date.now();
                
                // Criar callback global temporário
                window[callbackName] = function(data) {
                    document.getElementById('cepLoading').style.display = 'none';
                    
                    if (data.erro) {
                        document.getElementById('cepError').style.display = 'block';
                        limparCamposEndereco();
                    } else {
                        // Preencher campos
                        document.getElementById('clienteRua').value = data.logradouro || '';
                        document.getElementById('clienteBairro').value = data.bairro || '';
                        document.getElementById('clienteCidade').value = data.localidade || '';
                        document.getElementById('clienteEstado').value = data.uf || '';
                        
                        // Mostrar sucesso
                        document.getElementById('cepSuccess').style.display = 'block';
                        
                        // Focar no campo de número
                        document.getElementById('clienteNumero').focus();
                        
                        // Ocultar mensagem de sucesso após 3 segundos
                        setTimeout(() => {
                            document.getElementById('cepSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    // Limpar script e callback
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                // Criar script com JSONP
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepLoading').style.display = 'none';
                    document.getElementById('cepError').style.display = 'block';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endereço
        function limparCamposEndereco() {
            document.getElementById('clienteRua').value = '';
            document.getElementById('clienteBairro').value = '';
            document.getElementById('clienteCidade').value = '';
            document.getElementById('clienteEstado').value = '';
        }

        // Calcular duração do serviço
        function calcularDuracaoEvento() {
            const horaInicio = document.getElementById('eventoHoraInicio').value;
            const horaFim = document.getElementById('eventoHoraFim').value;
            
            if (horaInicio && horaFim) {
                const [hI, mI] = horaInicio.split(':').map(Number);
                const [hF, mF] = horaFim.split(':').map(Number);
                
                let minutosInicio = hI * 60 + mI;
                let minutosFim = hF * 60 + mF;
                
                // Se fim for menor que início, evento vai até dia seguinte
                if (minutosFim < minutosInicio) {
                    minutosFim += 24 * 60;
                }
                
                const diffMinutos = minutosFim - minutosInicio;
                const horas = Math.floor(diffMinutos / 60);
                const minutos = diffMinutos % 60;
                
                let duracao = '';
                if (horas > 0) duracao += `${horas}h`;
                if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
                
                document.getElementById('eventoDuracao').value = duracao || '0min';
            }
        }

        // Calcular duração no orçamento
        function calcularDuracaoOrcamento() {
            const horaInicio = document.getElementById('orcHoraInicio').value;
            const horaFim = document.getElementById('orcHoraFim').value;
            
            if (horaInicio && horaFim) {
                const [hI, mI] = horaInicio.split(':').map(Number);
                const [hF, mF] = horaFim.split(':').map(Number);
                
                let minutosInicio = hI * 60 + mI;
                let minutosFim = hF * 60 + mF;
                
                // Se fim for menor que início, evento vai até dia seguinte
                if (minutosFim < minutosInicio) {
                    minutosFim += 24 * 60;
                }
                
                const diffMinutos = minutosFim - minutosInicio;
                const horas = Math.floor(diffMinutos / 60);
                const minutos = diffMinutos % 60;
                
                let duracao = '';
                if (horas > 0) duracao += `${horas}h`;
                if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
                
                document.getElementById('orcDuracao').value = duracao || '0min';
            }
        }

        // Adicionar listeners para calcular duração

        // Buscar CEP para evento
        let cepEventoTimeout;
        function buscarCepEvento() {
            clearTimeout(cepEventoTimeout);
            
            const cep = document.getElementById('eventoCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepEventoLoading').style.display = 'none';
            document.getElementById('cepEventoError').style.display = 'none';
            document.getElementById('cepEventoSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEnderecoEvento();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepEventoLoading').style.display = 'block';
            
            // Delay para não fazer muitas requisições
            cepEventoTimeout = setTimeout(() => {
                // Usar JSONP para evitar problemas de CORS em arquivo local
                const script = document.createElement('script');
                const callbackName = 'viaCepEventoCallback' + Date.now();
                
                // Criar callback global temporário
                window[callbackName] = function(data) {
                    document.getElementById('cepEventoLoading').style.display = 'none';
                    
                    if (data.erro) {
                        document.getElementById('cepEventoError').style.display = 'block';
                        limparCamposEnderecoEvento();
                    } else {
                        // Preencher campos
                        document.getElementById('eventoRua').value = data.logradouro || '';
                        document.getElementById('eventoBairro').value = data.bairro || '';
                        document.getElementById('eventoCidade').value = data.localidade || '';
                        document.getElementById('eventoEstado').value = data.uf || '';
                        
                        // Mostrar sucesso
                        document.getElementById('cepEventoSuccess').style.display = 'block';
                        
                        // Focar no campo de número
                        document.getElementById('eventoNumero').focus();
                        
                        // Ocultar mensagem de sucesso após 3 segundos
                        setTimeout(() => {
                            document.getElementById('cepEventoSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    // Limpar script e callback
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                // Criar script com JSONP
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepEventoLoading').style.display = 'none';
                    document.getElementById('cepEventoError').style.display = 'block';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endereço do evento
        function limparCamposEnderecoEvento() {
            document.getElementById('eventoRua').value = '';
            document.getElementById('eventoBairro').value = '';
            document.getElementById('eventoCidade').value = '';
            document.getElementById('eventoEstado').value = '';
        }

        // Usar endereço do cliente no evento
        function usarEnderecoCliente() {
            if (window.enderecoCliente) {
                document.getElementById('eventoCep').value = window.enderecoCliente.cep;
                document.getElementById('eventoRua').value = window.enderecoCliente.rua;
                document.getElementById('eventoNumero').value = window.enderecoCliente.numero;
                document.getElementById('eventoComplemento').value = window.enderecoCliente.complemento;
                document.getElementById('eventoBairro').value = window.enderecoCliente.bairro;
                document.getElementById('eventoCidade').value = window.enderecoCliente.cidade;
                document.getElementById('eventoEstado').value = window.enderecoCliente.estado;
                
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            }
        }

        // Limpar opções de endereço e permitir novo endereço
        function limparOpcoesEndereco() {
            document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            // Focar no campo CEP
            document.getElementById('eventoCep').focus();
        }

        // Carregar valor do cliente no evento
        function carregarValorCliente() {
            const nomeCliente = document.getElementById('eventoCliente').value.trim();
            
            if (!nomeCliente) {
                document.getElementById('valorClienteInfo').style.display = 'none';
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.nome.toLowerCase() === nomeCliente.toLowerCase());
            
            if (cliente && cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                document.getElementById('valorClienteDisplay').textContent = formatMoney(cliente.financeiro.valorTotal);
                document.getElementById('valorClienteInfo').style.display = 'block';
                
                // Preencher automaticamente se campo estiver vazio
                const valorInput = document.getElementById('eventoValor');
                if (!valorInput.value || valorInput.value == 0) {
                    valorInput.value = cliente.financeiro.valorTotal;
                }
            } else {
                document.getElementById('valorClienteInfo').style.display = 'none';
            }
        }

        // Adicionar listener para verificar valor do cliente ao digitar

        // Definir datas do orçamento automaticamente
        function definirDatasOrcamento() {
            const hoje = new Date();
            const dataHoje = hoje.toISOString().split('T')[0];
            
            // Data de criação = hoje
            document.getElementById('orcDataCriacao').value = dataHoje;
            
            // Validade = hoje + 30 dias
            const validade = new Date(hoje);
            validade.setDate(validade.getDate() + 30);
            const dataValidade = validade.toISOString().split('T')[0];
            document.getElementById('orcValidade').value = dataValidade;
        }

        // Variável global para taxas
        let taxasCounter = 0;
        // outrasTaxas já declarado globalmente no início
        let taxaDeslocamentoIncluida = true; // Controla se a taxa de deslocamento está ativa

        // Atualizar taxa de deslocamento
        function atualizarTaxaDeslocamento() {
            const valorInput = document.getElementById('taxaDeslocamentoValor');
            const valor = parseFloat(valorInput.value) || 0;
            
            // Remover taxa de deslocamento antiga
            outrasTaxas = outrasTaxas.filter(t => t.id !== 'taxa_deslocamento');
            
            // Adicionar nova se tiver valor
            if (valor > 0) {
                outrasTaxas.push({ id: 'taxa_deslocamento', descricao: 'Deslocamento', valor });
                taxaDeslocamentoIncluida = true;
            }
            
            calcularTotalOrcamento();
        }
        
        // Remover taxa de deslocamento
        function removerTaxaDeslocamento() {
            if (confirm('Deseja remover a taxa de deslocamento?')) {
                document.getElementById('taxaDeslocamentoValor').value = '';
                outrasTaxas = outrasTaxas.filter(t => t.id !== 'taxa_deslocamento');
                taxaDeslocamentoIncluida = false;
                calcularTotalOrcamento();
            }
        }

        // Adicionar nova taxa
        function adicionarTaxa() {
            taxasCounter++;
            const taxaId = 'taxa_' + taxasCounter;
            
            const taxaHtml = `
                <div class="taxa-item" id="${taxaId}" style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; gap: 8px; align-items: end;">
                        <div style="flex: 2;">
                            <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">Descrição</label>
                            <input type="text" class="form-input" placeholder="Ex: Taxa de deslocamento" style="margin: 0;" onchange="atualizarTaxa('${taxaId}')">
                        </div>
                        <div style="flex: 1;">
                            <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">Valor</label>
                            <input type="number" step="0.01" class="form-input" placeholder="0,00" style="margin: 0;" oninput="atualizarTaxa('${taxaId}')">
                        </div>
                        <button type="button" onclick="removerTaxa('${taxaId}')" class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger); padding: 10px 16px; margin: 0;">
                            🗑️
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('outrasTaxasList').insertAdjacentHTML('beforeend', taxaHtml);
        }

        // Atualizar taxa no array
        function atualizarTaxa(taxaId) {
            const taxaDiv = document.getElementById(taxaId);
            const descricao = taxaDiv.querySelector('input[type="text"]').value;
            const valor = parseFloat(taxaDiv.querySelector('input[type="number"]').value) || 0;
            
            // Remover taxa antiga com mesmo ID
            outrasTaxas = outrasTaxas.filter(t => t.id !== taxaId);
            
            // Adicionar taxa atualizada
            if (descricao && valor > 0) {
                outrasTaxas.push({ id: taxaId, descricao, valor });
            }
            
            calcularTotalOrcamento();
        }

        // Remover taxa
        function removerTaxa(taxaId) {
            document.getElementById(taxaId).remove();
            outrasTaxas = outrasTaxas.filter(t => t.id !== taxaId);
            calcularTotalOrcamento();
        }

        // Calcular total do orçamento
        function calcularTotalOrcamento() {
            // Somar serviços selecionados
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            let subtotalServicos = 0;
            checkboxes.forEach(cb => {
                subtotalServicos += parseFloat(cb.dataset.valor) || 0;
            });
            
            // Somar outras taxas
            const totalTaxas = outrasTaxas.reduce((sum, taxa) => sum + taxa.valor, 0);
            
            // Calcular desconto
            const descontoValor = parseFloat(document.getElementById('orcDesconto').value) || 0;
            const descontoTipo = document.getElementById('orcDescontoTipo').value;
            
            let desconto = 0;
            if (descontoTipo === 'percentual') {
                desconto = (subtotalServicos + totalTaxas) * (descontoValor / 100);
            } else {
                desconto = descontoValor;
            }
            
            // Calcular total
            const total = Math.max(0, subtotalServicos + totalTaxas - desconto);
            
            // Atualizar display
            document.getElementById('orcSubtotalServicos').textContent = formatMoney(subtotalServicos);
            document.getElementById('orcTotalTaxas').textContent = formatMoney(totalTaxas);
            document.getElementById('orcTotalDesconto').textContent = '- ' + formatMoney(desconto);
            document.getElementById('orcValorTotalDisplay').textContent = formatMoney(total);
            document.getElementById('orcValorTotal').value = total;
        }

        // Buscar CEP para orçamento
        let cepOrcTimeout;
        function buscarCepOrcamento() {
            clearTimeout(cepOrcTimeout);
            
            const cep = document.getElementById('orcCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepOrcLoading').style.display = 'none';
            document.getElementById('cepOrcSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEnderecoOrcamento();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepOrcLoading').style.display = 'block';
            
            cepOrcTimeout = setTimeout(() => {
                const script = document.createElement('script');
                const callbackName = 'viaCepOrcCallback' + Date.now();
                
                window[callbackName] = function(data) {
                    document.getElementById('cepOrcLoading').style.display = 'none';
                    
                    if (data.erro) {
                        limparCamposEnderecoOrcamento();
                    } else {
                        document.getElementById('orcRua').value = data.logradouro || '';
                        document.getElementById('orcBairro').value = data.bairro || '';
                        document.getElementById('orcCidade').value = data.localidade || '';
                        document.getElementById('orcEstado').value = data.uf || '';
                        
                        document.getElementById('cepOrcSuccess').style.display = 'block';
                        document.getElementById('orcNumero').focus();
                        
                        setTimeout(() => {
                            document.getElementById('cepOrcSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepOrcLoading').style.display = 'none';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endereço do orçamento
        function limparCamposEnderecoOrcamento() {
            document.getElementById('orcRua').value = '';
            document.getElementById('orcBairro').value = '';
            document.getElementById('orcCidade').value = '';
            document.getElementById('orcEstado').value = '';
            document.getElementById('orcDuracao').value = '';
        }

        // Open financeiro modal
        function openFinanceiroModal(clienteId, isNewClient = false) {
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            if (!cliente) return;
            
            // Preencher nome do cliente
            document.getElementById('financeiroClienteNome').textContent = `💼 ${cliente.nome}`;
            document.getElementById('financeiroClienteId').value = clienteId;
            
            // Mostrar mensagem se for novo cliente
            if (isNewClient) {
                document.getElementById('financeiroNovoClienteMsg').style.display = 'block';
            } else {
                document.getElementById('financeiroNovoClienteMsg').style.display = 'none';
            }
            
            // Carregar contas bancárias nos selects
            carregarContasNosSelects();
            
            // Preencher dados financeiros se existirem
            if (cliente.financeiro) {
                document.getElementById('financeiroValorTotal').value = cliente.financeiro.valorTotal || '';
                document.getElementById('financeiroSinalValor').value = cliente.financeiro.sinalValor || '';
                document.getElementById('financeiroSinalData').value = cliente.financeiro.sinalData || '';
                document.getElementById('financeiroVencimento').value = cliente.financeiro.vencimento || '';
                
                // Preencher forma de pagamento do sinal se existir
                if (cliente.financeiro.sinalFormaPagamento && document.getElementById('financeiroSinalFormaPagamento')) {
                    document.getElementById('financeiroSinalFormaPagamento').value = cliente.financeiro.sinalFormaPagamento;
                }
                
                // Preencher conta do sinal se existir
                if (cliente.financeiro.sinalConta && document.getElementById('financeiroSinalConta')) {
                    document.getElementById('financeiroSinalConta').value = cliente.financeiro.sinalConta;
                }
                
                // Calcular e mostrar resumo
                calcularSaldoFinanceiro();
            } else {
                // Limpar campos
                document.getElementById('financeiroValorTotal').value = '';
                document.getElementById('financeiroSinalValor').value = '';
                document.getElementById('financeiroSinalData').value = '';
                document.getElementById('financeiroValorPagar').value = '';
                document.getElementById('financeiroVencimento').value = '';
                document.getElementById('resumoFinanceiroModal').style.display = 'none';
                
                // Limpar forma de pagamento
                if (document.getElementById('financeiroSinalFormaPagamento')) {
                    document.getElementById('financeiroSinalFormaPagamento').value = '';
                }
            }
            
            openModal('financeiro');
        }

        // Criar evento do cliente (atalho do modal financeiro)
        function criarEventoDoCliente() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal financeiro
            closeModal('financeiro');
            
            // Ir para aba de eventos
            switchTabProgramatically('eventos');
            
            // Abrir modal de novo evento
            setTimeout(() => {
                openModal('evento');
                
                // Pré-preencher APENAS nome do cliente
                const clienteInput = document.getElementById('eventoCliente');
                if (clienteInput) {
                    clienteInput.value = cliente.nome;
                }
                
                // Guardar dados do cliente para opção de usar endereço
                window.enderecoCliente = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar opção de usar endereço do cliente se ele tiver endereço
                if (cliente.cep) {
                    document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                    document.getElementById('enderecoClienteDisplay').textContent = cliente.endereco || `${cliente.rua}, ${cliente.numero} - ${cliente.bairro}`;
                }
                
                // Pré-preencher valor se tiver financeiro
                if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                    document.getElementById('eventoValor').value = cliente.financeiro.valorTotal;
                    document.getElementById('valorClienteDisplay').textContent = formatMoney(cliente.financeiro.valorTotal);
                    document.getElementById('valorClienteInfo').style.display = 'block';
                }
            }, 300);
        }

        // Criar orçamento do cliente (atalho do modal financeiro)
        function criarOrcamentoDoCliente() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal financeiro
            closeModal('financeiro');
            
            // Pequeno delay para transição suave
            setTimeout(() => {
                // Abrir modal de orçamento
                openModal('orcamento');
                
                // Pré-preencher nome do cliente
                const clienteInput = document.getElementById('orcCliente');
                if (clienteInput) {
                    clienteInput.value = cliente.nome;
                }
                
                // Pré-preencher endereço se disponível
                if (cliente.cep) {
                    document.getElementById('orcCep').value = cliente.cep;
                    document.getElementById('orcRua').value = cliente.rua || '';
                    document.getElementById('orcNumero').value = cliente.numero || '';
                    document.getElementById('orcComplemento').value = cliente.complemento || '';
                    document.getElementById('orcBairro').value = cliente.bairro || '';
                    document.getElementById('orcCidade').value = cliente.cidade || '';
                    document.getElementById('orcEstado').value = cliente.estado || '';
                }
                
                // Carregar serviços disponíveis
                renderOrcamentoServicos();
            }, 300);
        }

        // Atalhos do modal de sucesso de cliente
        function atalhoOrcamento() {
            const clienteId = window.ultimoClienteId;
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            setTimeout(function() {
                openModal('orcamento');
                
                // Pré-preencher APENAS o nome do cliente
                document.getElementById('orcCliente').value = cliente.nome;
                
                // Guardar dados do cliente para opção de usar endereço (se necessário)
                window.enderecoClienteOrcamento = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar opção de usar endereço se cliente tiver endereço
                if (cliente.endereco && cliente.endereco.trim() !== '') {
                    const opcoesDiv = document.getElementById('opcoesEnderecoOrcamento');
                    if (opcoesDiv) {
                        const enderecoDisplay = document.getElementById('enderecoClienteDisplayOrc');
                        if (enderecoDisplay) {
                            enderecoDisplay.innerHTML = `<strong>${cliente.endereco}</strong>`;
                            opcoesDiv.style.display = 'block';
                        }
                    }
                }
                
                renderOrcamentoServicos();
            }, 300);
        }

        function atalhoEvento() {
            const clienteId = window.ultimoClienteId;
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            switchTabProgramatically('eventos');
            
            setTimeout(function() {
                openModal('evento');
                document.getElementById('eventoCliente').value = cliente.nome;
                
                // Guardar dados do cliente para opção de usar endereço
                window.enderecoCliente = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar opção de usar endereço do cliente
                if (cliente.cep) {
                    document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                    document.getElementById('enderecoClienteDisplay').textContent = cliente.endereco || `${cliente.rua}, ${cliente.numero} - ${cliente.bairro}`;
                }
            }, 300);
        }

        function atalhoFinanceiro() {
            const clienteId = window.ultimoClienteId;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            setTimeout(function() {
                openFinanceiroModal(clienteId, true);
            }, 300);
        }

        // Calcular saldo devedor no modal financeiro
        function calcularSaldoFinanceiro() {
            const valorTotal = parseFloat(document.getElementById('financeiroValorTotal').value) || 0;
            const sinalValor = parseFloat(document.getElementById('financeiroSinalValor').value) || 0;
            
            // Buscar cliente para pegar pagamentos adicionais
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            let totalPagamentosAdicionais = 0;
            if (cliente && cliente.financeiro && cliente.financeiro.pagamentosAdicionais) {
                totalPagamentosAdicionais = cliente.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            }
            
            const valorPagar = valorTotal - sinalValor - totalPagamentosAdicionais;
            
            document.getElementById('financeiroValorPagar').value = valorPagar.toFixed(2);
            
            // Mostrar forma de pagamento do sinal se tiver valor
            const formaPagamentoSinalGroup = document.getElementById('formaPagamentoSinalGroup');
            const contaSinalGroup = document.getElementById('contaSinalGroup');
            if (formaPagamentoSinalGroup) {
                formaPagamentoSinalGroup.style.display = sinalValor > 0 ? 'block' : 'none';
                if (contaSinalGroup) {
                    contaSinalGroup.style.display = sinalValor > 0 ? 'block' : 'none';
                }
            }
            
            // Mostrar seção de pagamento do restante se já tiver sinal e houver saldo
            const secaoPagamento = document.getElementById('secaoPagamentoRestante');
            if (secaoPagamento) {
                if (cliente && cliente.financeiro && cliente.financeiro.sinalValor > 0 && valorPagar > 0) {
                    secaoPagamento.style.display = 'block';
                    // Atualizar display do valor restante
                    const valorRestanteDisplay = document.getElementById('valorRestanteDisplay');
                    if (valorRestanteDisplay) {
                        valorRestanteDisplay.textContent = formatMoney(valorPagar);
                    }
                } else {
                    secaoPagamento.style.display = 'none';
                }
            }
            
            // Mostrar resumo se houver valores
            if (valorTotal > 0) {
                const totalPago = sinalValor + totalPagamentosAdicionais;
                const percentPaid = (totalPago / valorTotal) * 100;
                
                document.getElementById('resumoFinanceiroModal').style.display = 'block';
                document.getElementById('resumoTotalModal').textContent = formatMoney(valorTotal);
                document.getElementById('resumoSinalModal').textContent = formatMoney(sinalValor);
                document.getElementById('resumoTotalPagoModal').textContent = formatMoney(totalPago);
                document.getElementById('resumoSaldoModal').textContent = formatMoney(valorPagar);
                document.getElementById('progressBarModal').style.width = percentPaid + '%';
                document.getElementById('progressPercentModal').textContent = percentPaid.toFixed(0) + '%';
                
                // Mostrar histórico de pagamentos adicionais
                const historico = document.getElementById('historicoPagamentosAdicionais');
                const lista = document.getElementById('listaPagamentosAdicionais');
                
                if (cliente && cliente.financeiro && cliente.financeiro.pagamentosAdicionais && cliente.financeiro.pagamentosAdicionais.length > 0) {
                    historico.style.display = 'block';
                    lista.innerHTML = cliente.financeiro.pagamentosAdicionais.map((p, index) => {
                        const nomeForma = {
                            'pix': '💳 PIX',
                            'dinheiro': '💵 Dinheiro',
                            'debito': '💳 Débito',
                            'credito': '💳 Crédito',
                            'transferencia': '🏦 Transferência',
                            'boleto': '📄 Boleto'
                        }[p.formaPagamento] || p.formaPagamento;
                        
                        return `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0;">
                                <span>${formatDate(p.data)} - ${nomeForma}</span>
                                <strong style="color: var(--success);">+${formatMoney(p.valor)}</strong>
                            </div>
                        `;
                    }).join('');
                } else {
                    historico.style.display = 'none';
                }
            } else {
                document.getElementById('resumoFinanceiroModal').style.display = 'none';
            }
        }

        // Atualizar botão de pagamento do restante
        function atualizarBotaoPagamentoRestante() {
            const valorDigitado = parseFloat(document.getElementById('financeiroValorPagamentoRestante').value) || 0;
            const btn = document.getElementById('btnPagamentoRestante');
            
            if (valorDigitado > 0) {
                btn.textContent = `✅ Pagar ${formatMoney(valorDigitado)}`;
            } else {
                btn.textContent = '✅ Pagar Valor Total Restante';
            }
        }

        // Registrar pagamento do restante
        function registrarPagamentoRestante() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const dataPagamento = document.getElementById('financeiroDataPagamentoRestante').value;
            const formaPagamento = document.getElementById('financeiroFormaPagamentoRestante').value;
            const contaId = document.getElementById('financeiroContaPagamentoRestante') ? document.getElementById('financeiroContaPagamentoRestante').value : '';
            const valorPagarTotal = parseFloat(document.getElementById('financeiroValorPagar').value) || 0;
            const valorPagamentoDigitado = parseFloat(document.getElementById('financeiroValorPagamentoRestante').value) || 0;
            
            // Se não digitou valor, usa o total restante
            const valorPagamento = valorPagamentoDigitado > 0 ? valorPagamentoDigitado : valorPagarTotal;
            
            if (!dataPagamento || !formaPagamento) {
                alert('⚠️ Por favor, preencha a data e a forma de pagamento.');
                return;
            }
            
            if (valorPagarTotal <= 0) {
                alert('⚠️ Não há valor a pagar.');
                return;
            }
            
            if (valorPagamento > valorPagarTotal) {
                alert('⚠️ O valor do pagamento não pode ser maior que o valor restante.');
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Inicializar array de pagamentos adicionais se não existir
            if (!cliente.financeiro.pagamentosAdicionais) {
                cliente.financeiro.pagamentosAdicionais = [];
            }
            
            // Adicionar novo pagamento ao histórico
            cliente.financeiro.pagamentosAdicionais.push({
                valor: valorPagamento,
                data: dataPagamento,
                formaPagamento: formaPagamento,
                contaId: contaId,
                dataRegistro: new Date().toISOString()
            });
            
            // Registrar pagamento como receita
            const receitaPagamento = {
                descricao: `Pagamento - ${cliente.nome}`,
                valor: valorPagamento,
                data: dataPagamento,
                categoria: 'pagamento',
                clienteId: clienteId,
                formaPagamento: formaPagamento || 'nao-informado'
            };
            
            // Adicionar contaId apenas se foi selecionado
            if (contaId && contaId !== '') {
                receitaPagamento.contaId = contaId;
                console.log('Registrando pagamento com conta:', contaId);
            }
            
            DB.add('receitas', receitaPagamento);
            
            // Atualizar saldo da conta se houver conta selecionada
            if (contaId && contaId !== '') {
                atualizarSaldoConta(contaId, valorPagamento, 'credito');
            }
            
            // Calcular total de pagamentos adicionais
            const totalPagamentosAdicionais = cliente.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            
            // Atualizar valor a pagar
            cliente.financeiro.valorPagar = cliente.financeiro.valorTotal - cliente.financeiro.sinalValor - totalPagamentosAdicionais;
            
            // Se pagou tudo, marcar como pago completamente
            if (cliente.financeiro.valorPagar <= 0) {
                cliente.financeiro.valorPagar = 0;
                cliente.financeiro.pagamentoCompleto = true;
                cliente.financeiro.dataPagamentoCompleto = dataPagamento;
            }
            
            DB.set('clientes', clientes);
            
            // Limpar campos
            document.getElementById('financeiroValorPagamentoRestante').value = '';
            document.getElementById('financeiroDataPagamentoRestante').value = '';
            document.getElementById('financeiroFormaPagamentoRestante').value = '';
            
            // Recalcular
            calcularSaldoFinanceiro();
            
            // Atualizar visualização
            renderClientsList();
            updateClientsStats();
            updateDashboard();
            atualizarFinanceiroPorPeriodo();
            
            alert(`✅ Pagamento de ${formatMoney(valorPagamento)} registrado com sucesso!`);
        }

        // Save financeiro
        function saveFinanceiro(e) {
            e.preventDefault();
            
            // Prevenir múltiplas submissões
            const submitBtn = e.target.querySelector('button[type="submit"]');
            if (submitBtn.disabled) return;
            submitBtn.disabled = true;
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Salvando...';
            
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                alert('❌ Erro: Cliente não encontrado!');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                return;
            }
            
            const valorTotal = parseFloat(document.getElementById('financeiroValorTotal').value) || 0;
            const sinalValor = parseFloat(document.getElementById('financeiroSinalValor').value) || 0;
            const sinalFormaPagamento = document.getElementById('financeiroSinalFormaPagamento') ? document.getElementById('financeiroSinalFormaPagamento').value : '';
            const sinalContaElement = document.getElementById('financeiroSinalConta');
            const sinalConta = sinalContaElement ? sinalContaElement.value : '';
            
            console.log('Salvando financeiro - Conta selecionada:', sinalConta);
            
            // Preservar pagamentos adicionais existentes
            const pagamentosAdicionais = cliente.financeiro && cliente.financeiro.pagamentosAdicionais ? cliente.financeiro.pagamentosAdicionais : [];
            
            // Recalcular valor a pagar considerando pagamentos adicionais
            const totalPagamentosAdicionais = pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            const valorPagar = valorTotal - sinalValor - totalPagamentosAdicionais;
            
            // Verificar se o sinal mudou (novo sinal ou valor diferente)
            const sinalAnterior = cliente.financeiro && cliente.financeiro.sinalValor ? cliente.financeiro.sinalValor : 0;
            const sinalMudou = sinalValor !== sinalAnterior;
            
            cliente.financeiro = {
                valorTotal: valorTotal,
                sinalValor: sinalValor,
                sinalData: document.getElementById('financeiroSinalData').value,
                sinalFormaPagamento: sinalFormaPagamento,
                sinalConta: sinalConta,
                pagamentosAdicionais: pagamentosAdicionais, // Preservar pagamentos
                valorPagar: valorPagar,
                vencimento: document.getElementById('financeiroVencimento').value,
                pagamentoCompleto: valorPagar <= 0,
                dataPagamentoCompleto: cliente.financeiro && cliente.financeiro.dataPagamentoCompleto ? cliente.financeiro.dataPagamentoCompleto : null,
                sinalReceitaRegistrada: cliente.financeiro && cliente.financeiro.sinalReceitaRegistrada ? cliente.financeiro.sinalReceitaRegistrada : false
            };
            
            // Registrar sinal como receita se houver valor e ainda não foi registrado
            if (sinalValor > 0 && cliente.financeiro.sinalData && (sinalMudou || !cliente.financeiro.sinalReceitaRegistrada)) {
                // Se o sinal mudou e já tinha receita registrada, precisamos atualizar ou criar nova
                const receitaData = {
                    descricao: `Sinal - ${cliente.nome}`,
                    valor: sinalValor,
                    data: cliente.financeiro.sinalData,
                    categoria: 'sinal',
                    clienteId: clienteId,
                    formaPagamento: sinalFormaPagamento || 'nao-informado'
                };
                
                // Adicionar contaId apenas se foi selecionado
                if (sinalConta && sinalConta !== '') {
                    receitaData.contaId = sinalConta;
                    console.log('Registrando receita com conta:', sinalConta);
                }
                
                DB.add('receitas', receitaData);
                
                // Marcar que a receita foi registrada
                cliente.financeiro.sinalReceitaRegistrada = true;
                
                // Atualizar saldo da conta se houver conta selecionada
                if (sinalConta && sinalConta !== '') {
                    atualizarSaldoConta(sinalConta, sinalValor, 'credito');
                }
            }
            
            DB.set('clientes', clientes);
            
            closeModal('financeiro');
            renderClientsList(currentClientSearch);
            updateClientsStats();
            updateDashboard();
            atualizarFinanceiroPorPeriodo();
            
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            
            alert('✅ Dados financeiros salvos com sucesso!');
        }

        // Render serviços
        function renderServicos() {
            const servicos = DB.get('servicos');
            const container = document.getElementById('servicosList');

            if (servicos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum serviço cadastrado ainda.</p>';
                return;
            }

            const html = servicos.map(s => `
                <div class="servico-item">
                    <div class="servico-header">
                        <div>
                            <div class="servico-nome">${s.nome}</div>
                            <span class="servico-categoria">${getCategoriaLabel(s.categoria)}</span>
                        </div>
                        <div class="servico-valor">${formatMoney(s.valor)}</div>
                    </div>
                    ${s.descricao ? `<div class="servico-descricao">${s.descricao}</div>` : ''}
                    <div class="servico-actions">
                        <button class="btn btn-small btn-delete" onclick="deleteServico(${s.id})">
                            🗑️ Excluir
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // Add servico
        function addServico(e) {
            e.preventDefault();
            const servico = {
                nome: document.getElementById('servicoNome').value,
                categoria: document.getElementById('servicoCategoria').value,
                valor: parseFloat(document.getElementById('servicoValor').value),
                descricao: document.getElementById('servicoDescricao').value
            };
            DB.add('servicos', servico);
            e.target.reset();
            renderServicos();
            renderOrcamentoServicos();
            renderServicosPerformance(); // Atualizar aba de gestão de serviços
            alert('✓ Serviço cadastrado com sucesso!');
        }

        // Delete servico
        function deleteServico(id) {
            if (confirm('Deseja realmente excluir este serviço?')) {
                const servicos = DB.get('servicos').filter(s => s.id !== id);
                DB.set('servicos', servicos);
                renderServicos();
                renderOrcamentoServicos();
                renderServicosPerformance(); // Atualizar aba de gestão de serviços
            }
        }
        
        // Edit servico
        function editServico(id) {
            const servicos = DB.get('servicos');
            const servico = servicos.find(s => s.id === id);
            
            if (!servico) {
                alert('❌ Serviço não encontrado!');
                return;
            }
            
            // Preencher o formulário com os dados do serviço
            document.getElementById('servicoNome').value = servico.nome;
            document.getElementById('servicoCategoria').value = servico.categoria;
            document.getElementById('servicoValor').value = servico.valor;
            document.getElementById('servicoDescricao').value = servico.descricao || '';
            
            // Abrir o modal
            openModal('servico');
            
            // Mudar o botão de submit para atualizar
            const form = document.querySelector('#modalServico form');
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.textContent = '💾 Atualizar Serviço';
            submitBtn.style.background = 'var(--accent)';
            
            // Remover evento anterior e adicionar novo para atualização
            const newForm = form.cloneNode(true);
            form.parentNode.replaceChild(newForm, form);
            
            newForm.onsubmit = (e) => {
                e.preventDefault();
                
                // Atualizar o serviço
                const servicoAtualizado = {
                    id: servico.id,
                    nome: document.getElementById('servicoNome').value,
                    categoria: document.getElementById('servicoCategoria').value,
                    valor: parseFloat(document.getElementById('servicoValor').value),
                    descricao: document.getElementById('servicoDescricao').value
                };
                
                const servicosAtualizados = servicos.map(s => 
                    s.id === id ? servicoAtualizado : s
                );
                
                DB.set('servicos', servicosAtualizados);
                
                // Resetar formulário
                newForm.reset();
                submitBtn.textContent = '+ Adicionar Serviço';
                submitBtn.style.background = '';
                
                // Restaurar evento original
                newForm.onsubmit = addServico;
                
                // Atualizar listas
                renderServicos();
                renderOrcamentoServicos();
                renderServicosPerformance();
                
                alert('✓ Serviço atualizado com sucesso!');
                closeModal('servico');
            };
        }

        // Get categoria label
        function getCategoriaLabel(categoria) {
            const labels = {
                'som': 'Som e Iluminação',
                'decoracao': 'Decoração',
                'buffet': 'Buffet',
                'fotografia': 'Fotografia/Filmagem',
                'animacao': 'Animação',
                'estrutura': 'Estrutura',
                'outros': 'Outros'
            };
            return labels[categoria] || categoria;
        }

        // Render servicos no orçamento
        function renderOrcamentoServicos() {
            const servicos = DB.get('servicos');
            const container = document.getElementById('orcamentosServicosList');

            if (servicos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum serviço cadastrado. Clique em "+ Novo Serviço" para adicionar.</p>';
                return;
            }

            const html = servicos.map(s => `
                <label class="servico-checkbox">
                    <input type="checkbox" 
                           value="${s.id}" 
                           data-id="${s.id}"
                           data-nome="${s.nome}"
                           data-valor="${s.valor}"
                           onchange="updateOrcamentoTotal()">
                    <div class="servico-checkbox-content">
                        <div class="servico-checkbox-nome">${s.nome}</div>
                        <div class="servico-checkbox-info">
                            <span>${getCategoriaLabel(s.categoria)}</span>
                            <span>•</span>
                            <span style="color: var(--success); font-weight: 600;">${formatMoney(s.valor)}</span>
                        </div>
                    </div>
                </label>
            `).join('');

            container.innerHTML = html;
        }

        // Update orçamento total
        function updateOrcamentoTotal() {
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            let total = 0;
            const selecionados = [];

            checkboxes.forEach(cb => {
                const valor = parseFloat(cb.dataset.valor);
                const nome = cb.dataset.nome;
                total += valor;
                selecionados.push({ nome, valor });
            });

            document.getElementById('orcValorTotal').value = total.toFixed(2);

            // Mostrar serviços selecionados
            const containerSelecionados = document.getElementById('servicosSelecionados');
            const listaSelecionados = document.getElementById('servicosSelecionadosList');

            if (selecionados.length > 0) {
                containerSelecionados.style.display = 'block';
                listaSelecionados.innerHTML = selecionados.map(s => `
                    <div class="servico-selecionado-item">
                        <span>${s.nome}</span>
                        <span style="font-weight: 600;">${formatMoney(s.valor)}</span>
                    </div>
                `).join('') + `
                    <div class="servico-selecionado-item" style="border-top: 2px solid var(--success); margin-top: 8px; padding-top: 8px; font-weight: 700; color: var(--success);">
                        <span>TOTAL:</span>
                        <span>${formatMoney(total)}</span>
                    </div>
                `;
            } else {
                containerSelecionados.style.display = 'none';
            }
        }

        // Modal functions
        function openModal(type) {
            console.log('🔵 openModal chamada com type:', type);
            
            try {
                if (type === 'servico') {
                    console.log('  → Renderizando serviços...');
                    renderServicos();
                } else if (type === 'orcamento') {
                    console.log('  → Renderizando orçamento...');
                    renderOrcamentoServicos();
                    
                    // Adicionar taxa Deslocamento padrão se não existir
                    setTimeout(() => {
                        const taxaNomeInput = document.getElementById('orcTaxaNome');
                        if (taxaNomeInput && !taxaNomeInput.value) {
                            taxaNomeInput.value = 'Deslocamento';
                        }
                    }, 100);
                } else if (type === 'cliente') {
                    console.log('  → Preparando modal de cliente...');
                    // Reset indicação field
                    const indicacaoField = document.getElementById('indicacaoDetalhes');
                    if (indicacaoField) {
                        indicacaoField.style.display = 'none';
                    }
                } else if (type === 'evento') {
                    console.log('  → Carregando clientes no evento...');
                    // Carregar lista de clientes
                    carregarClientesNoEvento();
                } else if (type === 'custoGeral' || type === 'custoEvento') {
                    console.log('  → Carregando contas...');
                    // Carregar contas nos selects de custo
                    carregarContasNosSelects();
                } else if (type === 'receitaPessoal' || type === 'despesaPessoal') {
                    console.log('  → Carregando contas pessoais...');
                    // Carregar contas pessoais nos selects
                    carregarContasPessoaisNosSelects();
                }
                
                // Construir ID do modal
                const modalId = 'modal' + type.charAt(0).toUpperCase() + type.slice(1);
                console.log('  → Procurando modal com ID:', modalId);
                
                const modalElement = document.getElementById(modalId);
                if (modalElement) {
                    console.log('  → ✅ Modal encontrado, abrindo...');
                    
                    // Adicionar classe
                    modalElement.classList.add('active');
                    
                    // Forçar estilos
                    modalElement.style.cssText = `
                        display: flex !important;
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        z-index: 999999 !important;
                        background: rgba(0, 0, 0, 0.9) !important;
                        align-items: center !important;
                        justify-content: center !important;
                    `;
                    
                    console.log('  → ✅ Modal aberto com sucesso!');
                } else {
                    console.error('  → ❌ ERRO: Modal não encontrado! ID:', modalId);
                }
            } catch (error) {
                console.error('❌ Erro em openModal:', error);
                alert('Erro ao abrir modal: ' + error.message);
            }
        }

        function closeModal(type) {
            console.log('🔵 Fechando modal:', type);
            
            const modalId = 'modal' + type.charAt(0).toUpperCase() + type.slice(1);
            const modalElement = document.getElementById(modalId);
            
            if (modalElement) {
                // Remover classe active
                modalElement.classList.remove('active');
                
                // Forçar display none com !important via cssText
                modalElement.style.cssText = 'display: none !important;';
                
                console.log('✅ Modal fechado:', modalId);
            } else {
                console.error('❌ Modal não encontrado:', modalId);
            }
            
            // Resetar campos específicos ao fechar modal de cliente
            if (type === 'cliente') {
                const indicacaoField = document.getElementById('indicacaoDetalhes');
                if (indicacaoField) indicacaoField.style.display = 'none';
                
                limparCamposEndereco();
                
                const cepLoading = document.getElementById('cepLoading');
                const cepError = document.getElementById('cepError');
                const cepSuccess = document.getElementById('cepSuccess');
                if (cepLoading) cepLoading.style.display = 'none';
                if (cepError) cepError.style.display = 'none';
                if (cepSuccess) cepSuccess.style.display = 'none';
            }
            
            // Resetar campos ao fechar modal financeiro
            if (type === 'financeiro') {
                const resumo = document.getElementById('resumoFinanceiroModal');
                if (resumo) resumo.style.display = 'none';
            }
            
            // Resetar modal de evento ao fechar
            if (type === 'evento') {
                window.eventoEditandoId = null;
                document.querySelector('#modalEvento .modal-title').textContent = 'Novo Evento';
                const submitBtn = document.querySelector('#modalEvento button[type="submit"]');
                submitBtn.textContent = 'Cadastrar Evento';
                submitBtn.onclick = null;
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            }
        }

        // === SISTEMA FINANCEIRO ===
        
        // Adicionar Conta Bancária
        function addContaBancaria(e) {
            e.preventDefault();
            const conta = {
                nome: document.getElementById('contaNome').value,
                banco: document.getElementById('contaBanco').value,
                tipo: document.getElementById('contaTipo').value,
                agencia: document.getElementById('contaAgencia').value,
                numero: document.getElementById('contaNumero').value,
                saldoInicial: parseFloat(document.getElementById('contaSaldoInicial').value) || 0,
                observacoes: document.getElementById('contaObservacoes').value,
                ativa: true
            };
            
            DB.add('contas', conta);
            e.target.reset();
            closeModal('conta');
            renderFinanceiro();
            carregarContasNosSelects();
            updateDashboard(); // ✅ Atualizar dashboard
            alert('✅ Conta bancária cadastrada com sucesso!');
        }
        
        // Carregar contas nos selects de receita e despesa
        function carregarContasNosSelects() {
            const contas = DB.get('contas');
            const contasAtivas = contas.filter(c => c.ativa);
            
            const selectReceita = document.getElementById('receitaConta');
            const selectDespesa = document.getElementById('despesaConta');
            const selectSinalConta = document.getElementById('financeiroSinalConta');
            const selectPagamentoConta = document.getElementById('financeiroContaPagamentoRestante');
            const selectCustoGeral = document.getElementById('custoGeralConta');
            const selectCustoEvento = document.getElementById('custoEventoConta');
            
            if (selectReceita) {
                selectReceita.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectReceita.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectDespesa) {
                selectDespesa.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectDespesa.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            // Carregar nos selects do modal financeiro
            if (selectSinalConta) {
                selectSinalConta.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectSinalConta.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectPagamentoConta) {
                selectPagamentoConta.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectPagamentoConta.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            // Carregar nos selects de custo
            if (selectCustoGeral) {
                selectCustoGeral.innerHTML = '<option value="">Não informado</option>';
                contasAtivas.forEach(c => {
                    selectCustoGeral.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectCustoEvento) {
                selectCustoEvento.innerHTML = '<option value="">Não informado</option>';
                contasAtivas.forEach(c => {
                    selectCustoEvento.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
        }
        
        // Navegação do Financeiro
        function mostrarFinanceiroVisaoGeral() {
            document.getElementById('financeiroVisaoGeral').style.display = 'block';
            document.getElementById('financeiroPorConta').style.display = 'none';
            document.getElementById('financeiroContas').style.display = 'none';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-secondary');
            
            renderFinanceiroVisaoGeral();
        }
        
        function mostrarFinanceiroPorConta() {
            document.getElementById('financeiroVisaoGeral').style.display = 'none';
            document.getElementById('financeiroPorConta').style.display = 'block';
            document.getElementById('financeiroContas').style.display = 'none';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-secondary');
            
            renderFinanceiroPorConta();
        }
        
        function mostrarFinanceiroContas() {
            document.getElementById('financeiroVisaoGeral').style.display = 'none';
            document.getElementById('financeiroPorConta').style.display = 'none';
            document.getElementById('financeiroContas').style.display = 'block';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-primary');
            
            renderContasBancarias();
        }
        
        // Render Financeiro
        function renderFinanceiro() {
            if (document.getElementById('financeiroTab').classList.contains('active')) {
                if (document.getElementById('financeiroVisaoGeral').style.display !== 'none') {
                    renderFinanceiroVisaoGeral();
                } else if (document.getElementById('financeiroPorConta').style.display !== 'none') {
                    renderFinanceiroPorConta();
                } else {
                    renderContasBancarias();
                }
            }
        }
        
        // Render Visão Geral
        function renderFinanceiroVisaoGeral() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const contas = DB.get('contas');
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const lucro = totalReceitas - totalDespesas;
            
            document.getElementById('financeiroTotalReceitas').textContent = formatMoney(totalReceitas);
            document.getElementById('financeiroTotalDespesas').textContent = formatMoney(totalDespesas);
            document.getElementById('financeiroLucro').textContent = formatMoney(lucro);
            document.getElementById('financeiroLucro').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            // Total de contas ativas comentado pois o elemento não existe
            // document.getElementById('financeiroTotalContas').textContent = contas.filter(c => c.ativa).length;
            
            // Formas de Pagamento
            const formasPagamento = {};
            receitas.forEach(r => {
                const forma = r.formaPagamento || 'nao-informado';
                formasPagamento[forma] = (formasPagamento[forma] || 0) + r.valor;
            });
            
            const graficoDiv = document.getElementById('graficoFormasPagamento');
            graficoDiv.innerHTML = '';
            
            Object.keys(formasPagamento).forEach(forma => {
                const valor = formasPagamento[forma];
                const percent = totalReceitas > 0 ? ((valor / totalReceitas) * 100).toFixed(1) : 0;
                
                const nomes = {
                    'pix': '💳 PIX',
                    'dinheiro': '💵 Dinheiro',
                    'debito': '💳 Débito',
                    'credito': '💳 Crédito',
                    'transferencia': '🏦 Transferência',
                    'boleto': '📄 Boleto',
                    'nao-informado': '❓ Não Informado'
                };
                
                graficoDiv.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 4px;">${nomes[forma] || forma}</div>
                            <div style="font-size: 20px; color: var(--primary);">${formatMoney(valor)}</div>
                        </div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--accent);">${percent}%</div>
                    </div>
                `;
            });
            
            // Últimas Transações
            const todasTransacoes = [
                ...receitas.map(r => ({...r, tipo: 'receita'})),
                ...despesas.map(d => ({...d, tipo: 'despesa'}))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            const transacoesDiv = document.getElementById('ultimasTransacoes');
            transacoesDiv.innerHTML = todasTransacoes.map(t => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${t.tipo === 'receita' ? '💰' : '💸'} ${t.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(t.data)}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: ${t.tipo === 'receita' ? 'var(--success)' : 'var(--danger)'};">
                        ${t.tipo === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        // Render Por Conta
        function renderFinanceiroPorConta() {
            const contas = DB.get('contas').filter(c => c.ativa);
            const todasReceitas = DB.get('receitas');
            const todasDespesas = DB.get('despesas');
            
            // Obter filtros de período
            const mesSelecionado = document.getElementById('filtroMesFinanceiro')?.value;
            const anoSelecionado = document.getElementById('filtroAnoFinanceiro')?.value;
            
            // Função para filtrar por período
            const filtrarPorPeriodo = (transacao) => {
                if (!transacao.data) return false;
                const data = new Date(transacao.data);
                const mes = data.getMonth() + 1;
                const ano = data.getFullYear();
                
                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                
                return mesMatch && anoMatch;
            };
            
            // Filtrar receitas e despesas pelo período
            const receitas = todasReceitas.filter(filtrarPorPeriodo);
            const despesas = todasDespesas.filter(filtrarPorPeriodo);
            
            const listaDiv = document.getElementById('listaContasComSaldo');
            listaDiv.innerHTML = contas.map(c => {
                // Comparar como string para garantir compatibilidade
                const receitasConta = receitas.filter(r => r.contaId && r.contaId.toString() === c.id.toString());
                const despesasConta = despesas.filter(d => d.contaId && d.contaId.toString() === c.id.toString());
                
                const totalReceitas = receitasConta.reduce((sum, r) => sum + r.valor, 0);
                const totalDespesas = despesasConta.reduce((sum, d) => sum + d.valor, 0);
                const saldo = (c.saldoInicial || 0) + totalReceitas - totalDespesas;
                
                return `
                    <div class="card" style="margin-bottom: 16px; cursor: pointer;" onclick="verDetalhesConta(${c.id})">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 4px;">${c.nome}</h4>
                                <div style="font-size: 13px; color: var(--text-secondary);">${c.banco} - ${c.tipo}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${saldo >= 0 ? 'var(--success)' : 'var(--danger)'};">
                                    ${formatMoney(saldo)}
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Saldo do Período</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Ver Detalhes da Conta
        function verDetalhesConta(contaId) {
            const conta = DB.get('contas').find(c => c.id === contaId);
            if (!conta) return;
            
            // Obter filtros de período
            const mesSelecionado = document.getElementById('filtroMesFinanceiro')?.value;
            const anoSelecionado = document.getElementById('filtroAnoFinanceiro')?.value;
            
            // Função para filtrar por período
            const filtrarPorPeriodo = (transacao) => {
                if (!transacao.data) return false;
                const data = new Date(transacao.data);
                const mes = data.getMonth() + 1;
                const ano = data.getFullYear();
                
                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                
                return mesMatch && anoMatch;
            };
            
            // Comparar como string para garantir compatibilidade
            const todasReceitas = DB.get('receitas').filter(r => r.contaId && r.contaId.toString() === contaId.toString());
            const todasDespesas = DB.get('despesas').filter(d => d.contaId && d.contaId.toString() === contaId.toString());
            
            // Filtrar pelo período
            const receitas = todasReceitas.filter(filtrarPorPeriodo);
            const despesas = todasDespesas.filter(filtrarPorPeriodo);
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const saldo = (conta.saldoInicial || 0) + totalReceitas - totalDespesas;
            
            document.getElementById('detalheContaTitulo').innerHTML = `🏦 ${conta.nome}`;
            document.getElementById('detalheContaReceitas').textContent = formatMoney(totalReceitas);
            document.getElementById('detalheContaDespesas').textContent = formatMoney(totalDespesas);
            document.getElementById('detalheContaSaldo').textContent = formatMoney(saldo);
            document.getElementById('detalheContaSaldo').style.color = saldo >= 0 ? 'var(--success)' : 'var(--danger)';
            
            const transacoes = [
                ...receitas.map(r => ({...r, tipo: 'receita'})),
                ...despesas.map(d => ({...d, tipo: 'despesa'}))
            ].sort((a, b) => new Date(b.data) - new Date(a.data));
            
            document.getElementById('detalheContaTransacoes').innerHTML = transacoes.map(t => `
                <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${t.tipo === 'receita' ? '💰' : '💸'} ${t.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(t.data)} • ${t.formaPagamento || 'N/A'}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: ${t.tipo === 'receita' ? 'var(--success)' : 'var(--danger)'};">
                        ${t.tipo === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('detalhesConta').style.display = 'block';
        }
        
        // Render Contas Bancárias
        function renderContasBancarias() {
            const contas = DB.get('contas');
            const listaDiv = document.getElementById('listaContasBancarias');
            
            if (contas.length === 0) {
                listaDiv.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma conta cadastrada. Clique em "+ Nova Conta" para começar.</p>';
                return;
            }
            
            listaDiv.innerHTML = contas.map(c => {
                // Calcular saldo atual baseado em receitas e despesas
                const saldoAtual = calcularSaldoRealConta(c.id);
                const saldoColor = saldoAtual >= 0 ? 'var(--success)' : 'var(--danger)';
                
                return `
                <div class="card" style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="margin-bottom: 12px;">
                                <h4 style="margin: 0 0 4px 0;">${c.nome}</h4>
                                <div style="font-size: 24px; font-weight: 700; color: ${saldoColor};">
                                    ${formatMoney(saldoAtual)}
                                </div>
                            </div>
                            <div style="display: grid; gap: 4px; font-size: 13px; color: var(--text-secondary);">
                                <div>🏦 <strong>${c.banco}</strong> - ${c.tipo}</div>
                                ${c.agencia ? `<div>Agência: ${c.agencia}</div>` : ''}
                                ${c.numero ? `<div>Conta: ${c.numero}</div>` : ''}
                                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); display: grid; grid-template-columns: auto auto; gap: 8px 16px; width: fit-content;">
                                    <span style="color: var(--text-secondary);">Saldo Inicial:</span>
                                    <strong>${formatMoney(c.saldoInicial || 0)}</strong>
                                    <span style="color: var(--text-secondary);">Saldo Atual:</span>
                                    <strong style="color: ${saldoColor};">${formatMoney(saldoAtual)}</strong>
                                </div>
                                ${c.observacoes ? `<div style="margin-top: 8px;">📝 ${c.observacoes}</div>` : ''}
                            </div>
                        </div>
                        <button class="btn" onclick="toggleContaAtiva(${c.id})" style="background: ${c.ativa ? 'rgba(239, 71, 111, 0.2)' : 'rgba(6, 214, 160, 0.2)'}; color: ${c.ativa ? 'var(--danger)' : 'var(--success)'}; border: 1px solid ${c.ativa ? 'var(--danger)' : 'var(--success)'}; flex-shrink: 0;">
                            ${c.ativa ? '🗑️ Desativar' : '✅ Ativar'}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        // Toggle Conta Ativa
        function toggleContaAtiva(contaId) {
            const contas = DB.get('contas');
            const conta = contas.find(c => c.id === contaId);
            if (conta) {
                conta.ativa = !conta.ativa;
                DB.set('contas', contas);
                renderContasBancarias();
                carregarContasNosSelects();
            }
        }

        // Export data
        function exportData() {
            const data = {
                receitas: DB.get('receitas'),
                despesas: DB.get('despesas'),
                eventos: DB.get('eventos'),
                servicos: DB.get('servicos'),
                clientes: DB.get('clientes'),
                custosGerais: DB.get('custosGerais'),
                custosEventos: DB.get('custosEventos'),
                contas: DB.get('contas')
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eventpro-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('📥 Backup exportado com sucesso!');
        }

        // Resetar todos os dados
        function resetarDados() {
            const confirmar = confirm(
                '⚠️ ATENÇÃO: Esta ação irá APAGAR TODOS OS DADOS do sistema!\n\n' +
                'Isso inclui:\n' +
                '• Todos os clientes\n' +
                '• Todos os eventos\n' +
                '• Todas as receitas e despesas\n' +
                '• Todos os custos\n' +
                '• Todos os serviços\n\n' +
                '❗ Esta ação NÃO PODE ser desfeita!\n\n' +
                'Deseja continuar?'
            );
            
            if (!confirmar) return;
            
            const confirmarNovamente = confirm(
                '🚨 ÚLTIMA CONFIRMAÇÃO!\n\n' +
                'Tem certeza ABSOLUTA que deseja apagar TUDO?\n\n' +
                'Recomendamos fazer um backup antes (botão 📊 Relatórios).'
            );
            
            if (!confirmarNovamente) return;
            
            // Limpar localStorage
            localStorage.clear();
            
            // Recarregar página
            alert('✅ Todos os dados foram apagados!\n\nA página será recarregada com dados de exemplo.');
            location.reload();
        }

        // Helper functions
        function formatMoney(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function formatDate(date) {
            return new Date(date + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function updateDashboard() {
            try {
                updateStats();
                renderTransactions();
                renderEvents();
                checkBirthdays();
                updateOrigemStats();
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }

        // ========================================
        // FUNÇÕES DE ENDEREÇO DO EVENTO
        // ========================================
        
        function carregarClientesNoEvento() {
            const clientes = DB.get('clientes');
            const select = document.getElementById('eventoCliente');
            
            if (select) {
                select.innerHTML = '<option value="">Selecione um cliente...</option>';
                clientes.forEach(c => {
                    select.innerHTML += `<option value="${c.nome}" data-cliente-id="${c.id}">${c.nome}</option>`;
                });
            }
        }
        
        function mostrarEnderecoCliente() {
            const select = document.getElementById('eventoCliente');
            const clienteNome = select.value;
            
            if (!clienteNome) {
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.nome === clienteNome);
            
            if (cliente && cliente.endereco && cliente.endereco.trim() !== '') {
                // Mostrar opção de usar endereço do cliente
                const enderecoDisplay = document.getElementById('enderecoClienteDisplay');
                enderecoDisplay.innerHTML = `<strong>${cliente.endereco}</strong>`;
                document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                
                // Salvar dados do cliente para uso posterior
                window.clienteSelecionadoEndereco = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
            } else {
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                limparCamposEnderecoEvento();
            }
        }
        
        function usarEnderecoCliente() {
            if (window.clienteSelecionadoEndereco) {
                const end = window.clienteSelecionadoEndereco;
                document.getElementById('eventoCep').value = end.cep;
                document.getElementById('eventoRua').value = end.rua;
                document.getElementById('eventoNumero').value = end.numero;
                document.getElementById('eventoComplemento').value = end.complemento;
                document.getElementById('eventoBairro').value = end.bairro;
                document.getElementById('eventoCidade').value = end.cidade;
                document.getElementById('eventoEstado').value = end.estado;
                
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                
                // Scroll suave até os campos de endereço
                document.getElementById('eventoCep').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function limparOpcoesEndereco() {
            document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            limparCamposEnderecoEvento();
            document.getElementById('eventoCep').focus();
        }
        
        function limparCamposEnderecoEvento() {
            document.getElementById('eventoCep').value = '';
            document.getElementById('eventoRua').value = '';
            document.getElementById('eventoNumero').value = '';
            document.getElementById('eventoComplemento').value = '';
            document.getElementById('eventoBairro').value = '';
            document.getElementById('eventoCidade').value = '';
            document.getElementById('eventoEstado').value = '';
        }
        
        function usarEnderecoClienteOrcamento() {
            if (window.enderecoClienteOrcamento) {
                const end = window.enderecoClienteOrcamento;
                document.getElementById('orcCep').value = end.cep;
                document.getElementById('orcRua').value = end.rua;
                document.getElementById('orcNumero').value = end.numero;
                document.getElementById('orcComplemento').value = end.complemento;
                document.getElementById('orcBairro').value = end.bairro;
                document.getElementById('orcCidade').value = end.cidade;
                document.getElementById('orcEstado').value = end.estado;
                
                document.getElementById('opcoesEnderecoOrcamento').style.display = 'none';
                document.getElementById('orcCep').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function limparOpcoesEnderecoOrcamento() {
            document.getElementById('opcoesEnderecoOrcamento').style.display = 'none';
            document.getElementById('orcCep').value = '';
            document.getElementById('orcRua').value = '';
            document.getElementById('orcNumero').value = '';
            document.getElementById('orcComplemento').value = '';
            document.getElementById('orcBairro').value = '';
            document.getElementById('orcCidade').value = '';
            document.getElementById('orcEstado').value = '';
            document.getElementById('orcCep').focus();
        }
        
        // ========================================
        // FUNÇÕES DE SALDO DAS CONTAS
        // ========================================
        
        function atualizarSaldoConta(contaId, valor, tipo) {
            if (!contaId || valor <= 0) return;
            
            const contas = DB.get('contas');
            const conta = contas.find(c => c.id === parseInt(contaId));
            
            if (!conta) return;
            
            // Inicializar saldo atual se não existir
            if (typeof conta.saldoAtual === 'undefined') {
                conta.saldoAtual = conta.saldoInicial || 0;
            }
            
            // Atualizar saldo
            if (tipo === 'credito') {
                conta.saldoAtual += valor;
            } else if (tipo === 'debito') {
                conta.saldoAtual -= valor;
            }
            
            DB.set('contas', contas);
            
            // Atualizar visualização se estiver na aba financeiro
            if (document.getElementById('listaContasBancarias')) {
                renderContasBancarias();
            }
        }
        
        function calcularSaldoRealConta(contaId) {
            const conta = DB.get('contas').find(c => c.id === parseInt(contaId));
            if (!conta) return 0;
            
            const receitas = DB.get('receitas').filter(r => r.contaId === contaId.toString());
            const despesas = DB.get('despesas').filter(d => d.contaId === contaId.toString());
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            
            return (conta.saldoInicial || 0) + totalReceitas - totalDespesas;
        }

        // ========================================
        // FILTROS FINANCEIROS POR PERÍODO
        // ========================================
        
        function inicializarFiltrosFinanceiro() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const todasTransacoes = [...receitas, ...despesas];
            
            const anos = new Set();
            const anoAtual = new Date().getFullYear();
            anos.add(anoAtual);
            
            todasTransacoes.forEach(t => {
                if (t.data) {
                    const ano = new Date(t.data).getFullYear();
                    anos.add(ano);
                }
            });
            
            const selectAno = document.getElementById('filtroAnoFinanceiro');
            if (selectAno) {
                selectAno.innerHTML = '<option value="todos">Todos os anos</option>';
                Array.from(anos).sort((a, b) => b - a).forEach(ano => {
                    selectAno.innerHTML += `<option value="${ano}"${ano === anoAtual ? ' selected' : ''}>${ano}</option>`;
                });
            }
            
            const mesAtual = new Date().getMonth() + 1;
            const selectMes = document.getElementById('filtroMesFinanceiro');
            if (selectMes) {
                selectMes.value = 'todos';
            }
        }
        
        function atualizarFinanceiroPorPeriodo() {
            const mesSelecionado = document.getElementById('filtroMesFinanceiro')?.value;
            const anoSelecionado = document.getElementById('filtroAnoFinanceiro')?.value;
            const tipoVis = document.getElementById('tipoVisualizacao')?.value || 'mensal';
            
            const receitas = DB.get('receitas');
            const todasDespesas = DB.get('despesas');
            const custosGerais = DB.get('custosGerais') || [];
            const custosEventos = DB.get('custosEventos') || [];
            const clientes = DB.get('clientes');
            
            // Separar despesas gerais de despesas de eventos
            // Identifica por flag OU pela descrição (para dados antigos)
            const despesas = todasDespesas.filter(d => {
                // Se tem flag, usar a flag
                if (d.tipoDespesa) {
                    return d.tipoDespesa !== 'custo_evento';
                }
                // Se não tem flag, verificar pela descrição
                return !d.descricao.includes('[Custo Evento:');
            });
            
            const filtrarPorPeriodo = (transacao) => {
                if (!transacao.data) return false;
                const data = new Date(transacao.data);
                const mes = data.getMonth() + 1;
                const ano = data.getFullYear();
                
                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                
                return mesMatch && anoMatch;
            };
            
            const receitasFiltradas = receitas.filter(filtrarPorPeriodo);
            const despesasFiltradas = despesas.filter(filtrarPorPeriodo);
            const custosGeraisFiltrados = custosGerais.filter(filtrarPorPeriodo);
            const custosEventosFiltrados = custosEventos.filter(filtrarPorPeriodo);
            
            const totalReceitas = receitasFiltradas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesasFiltradas.reduce((sum, d) => sum + d.valor, 0);
            const totalCustosGerais = custosGeraisFiltrados.reduce((sum, c) => sum + c.valor, 0);
            const totalCustosEventos = custosEventosFiltrados.reduce((sum, c) => sum + c.valor, 0);
            // IMPORTANTE: Não subtrair custosGerais separadamente pois eles já viraram despesas
            const lucro = totalReceitas - totalDespesas - totalCustosEventos;
            
            let valoresAReceber = 0;
            clientes.forEach(cliente => {
                if (cliente.financeiro && cliente.financeiro.valorPagar > 0) {
                    if (cliente.financeiro.vencimento) {
                        const dataVenc = new Date(cliente.financeiro.vencimento);
                        const mes = dataVenc.getMonth() + 1;
                        const ano = dataVenc.getFullYear();
                        
                        const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                        const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                        
                        if (mesMatch && anoMatch) {
                            valoresAReceber += cliente.financeiro.valorPagar;
                        }
                    }
                }
            });
            
            if (document.getElementById('financeiroTotalReceitas')) {
                document.getElementById('financeiroTotalReceitas').textContent = formatMoney(totalReceitas);
            }
            if (document.getElementById('financeiroValoresAReceber')) {
                document.getElementById('financeiroValoresAReceber').textContent = formatMoney(valoresAReceber);
            }
            // Despesas do Mês (só despesas gerais, sem custos de eventos)
            if (document.getElementById('financeiroDespesasMes')) {
                document.getElementById('financeiroDespesasMes').textContent = formatMoney(totalDespesas);
            }
            if (document.getElementById('financeiroCustosEventos')) {
                document.getElementById('financeiroCustosEventos').textContent = formatMoney(totalCustosEventos);
            }
            // Total de Despesas (despesas + custos eventos)
            // IMPORTANTE: Não somar custosGerais separadamente pois eles já viraram despesas
            // quando foram pagos por uma conta (evita duplicação)
            if (document.getElementById('financeiroTotalDespesas')) {
                document.getElementById('financeiroTotalDespesas').textContent = formatMoney(totalDespesas + totalCustosEventos);
            }
            if (document.getElementById('financeiroLucro')) {
                document.getElementById('financeiroLucro').textContent = formatMoney(lucro);
            }
            
            atualizarOrigemPagamentos(clientes, mesSelecionado, anoSelecionado);
            
            // Atualizar também a view "Por Conta" se estiver visível
            if (document.getElementById('financeiroPorConta').style.display !== 'none') {
                renderFinanceiroPorConta();
                
                // Se o modal de detalhes estiver aberto, atualizar também
                const detalhesConta = document.getElementById('detalhesConta');
                if (detalhesConta && detalhesConta.style.display === 'block') {
                    // Pegar o ID da conta do título
                    const titulo = document.getElementById('detalheContaTitulo').textContent;
                    const contas = DB.get('contas');
                    const conta = contas.find(c => titulo.includes(c.nome));
                    if (conta) {
                        verDetalhesConta(conta.id);
                    }
                }
            }
            
            if (tipoVis === 'anual' && anoSelecionado !== 'todos') {
                mostrarBreakdownAnual(anoSelecionado);
            } else {
                const container = document.getElementById('breakdownAnual');
                if (container) container.style.display = 'none';
            }
        }
        
        function resetarFiltrosFinanceiro() {
            const anoAtual = new Date().getFullYear();
            document.getElementById('filtroMesFinanceiro').value = 'todos';
            document.getElementById('filtroAnoFinanceiro').value = anoAtual;
            document.getElementById('tipoVisualizacao').value = 'mensal';
            atualizarFinanceiroPorPeriodo();
        }
        
        function atualizarOrigemPagamentos(clientes, mesSelecionado, anoSelecionado) {
            const origens = {
                'pix': { count: 0, valor: 0, label: 'PIX', icon: '💳' },
                'dinheiro': { count: 0, valor: 0, label: 'Dinheiro', icon: '💵' },
                'debito': { count: 0, valor: 0, label: 'Débito', icon: '💳' },
                'credito': { count: 0, valor: 0, label: 'Crédito', icon: '💳' },
                'transferencia': { count: 0, valor: 0, label: 'Transferência', icon: '🏦' },
                'boleto': { count: 0, valor: 0, label: 'Boleto', icon: '📄' }
            };
            
            let totalPagamentos = 0;
            
            clientes.forEach(cliente => {
                if (cliente.financeiro) {
                    if (cliente.financeiro.sinalValor > 0 && cliente.financeiro.sinalFormaPagamento) {
                        const forma = cliente.financeiro.sinalFormaPagamento;
                        const valor = cliente.financeiro.sinalValor;
                        
                        let incluir = true;
                        if (cliente.financeiro.sinalData) {
                            const data = new Date(cliente.financeiro.sinalData);
                            const mes = data.getMonth() + 1;
                            const ano = data.getFullYear();
                            
                            const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                            const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                            
                            incluir = mesMatch && anoMatch;
                        }
                        
                        if (incluir && origens[forma]) {
                            origens[forma].count++;
                            origens[forma].valor += valor;
                            totalPagamentos += valor;
                        }
                    }
                    
                    if (cliente.financeiro.pagamentosAdicionais) {
                        cliente.financeiro.pagamentosAdicionais.forEach(pag => {
                            let incluir = true;
                            if (pag.data) {
                                const data = new Date(pag.data);
                                const mes = data.getMonth() + 1;
                                const ano = data.getFullYear();
                                
                                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                                
                                incluir = mesMatch && anoMatch;
                            }
                            
                            if (incluir && pag.formaPagamento && origens[pag.formaPagamento]) {
                                origens[pag.formaPagamento].count++;
                                origens[pag.formaPagamento].valor += pag.valor;
                                totalPagamentos += pag.valor;
                            }
                        });
                    }
                }
            });
            
            const container = document.getElementById('origemPagamentosContainer');
            if (container && totalPagamentos > 0) {
                const html = Object.entries(origens)
                    .filter(([_, data]) => data.count > 0)
                    .sort((a, b) => b[1].valor - a[1].valor)
                    .map(([forma, data]) => {
                        const percent = ((data.valor / totalPagamentos) * 100).toFixed(1);
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 24px;">${data.icon}</span>
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">${data.label}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${data.count} pagamento${data.count > 1 ? 's' : ''}</div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: var(--success);">${formatMoney(data.valor)}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">${percent}%</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                
                container.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>';
            } else if (container) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>';
            }
        }
        
        function mostrarBreakdownAnual(ano) {
            // Implementação simplificada - mostrar apenas totais do ano
            const breakdownDiv = document.getElementById('breakdownAnual');
            if (breakdownDiv) {
                breakdownDiv.innerHTML = `<div style="margin-top: 20px; padding: 20px; background: var(--card-bg); border-radius: 12px;"><h3>📊 Visualização Anual ${ano}</h3><p style="color: var(--text-secondary);">Breakdown detalhado por mês em desenvolvimento</p></div>`;
                breakdownDiv.style.display = 'block';
            }
        }


// ============================================
// FUNÇÕES DA ABA DE SERVIÇOS
// ============================================

function renderServicosPerformance() {
    const servicos = DB.get('servicos');
    let eventos = DB.get('eventos');
    const clientes = DB.get('clientes');
    
    // Aplicar filtros de período
    const filtroMes = document.getElementById('filtroMesServicos')?.value;
    const filtroAno = document.getElementById('filtroAnoServicos')?.value;
    const tipoVisualizacao = document.getElementById('tipoVisualizacaoServicos')?.value;
    
    if (filtroMes && filtroAno && tipoVisualizacao) {
        eventos = eventos.filter(evento => {
            const dataEvento = new Date(evento.data);
            const anoEvento = dataEvento.getFullYear();
            const mesEvento = dataEvento.getMonth() + 1;
            
            if (tipoVisualizacao === 'mensal') {
                // Filtrar por mês e ano específicos
                if (filtroMes === 'todos') {
                    return anoEvento === parseInt(filtroAno);
                } else {
                    return anoEvento === parseInt(filtroAno) && mesEvento === parseInt(filtroMes);
                }
            } else {
                // Visualização anual - apenas ano
                return anoEvento === parseInt(filtroAno);
            }
        });
    }
    
    if (servicos.length === 0) {
        document.getElementById('servicosPerformanceList').innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum serviço cadastrado ainda.</p>';
        return;
    }
    
    // Calcular estatísticas de cada serviço
    const servicosComStats = servicos.map(servico => {
        let vezesContratado = 0;
        let receitaTotal = 0;
        
        // Contar em eventos (já filtrados)
        eventos.forEach(evento => {
            if (evento.servicos && Array.isArray(evento.servicos)) {
                evento.servicos.forEach(s => {
                    // Comparar por nome (mais confiável) ou ID
                    if (s.nome === servico.nome || s.id === servico.id) {
                        vezesContratado++;
                        receitaTotal += (s.valor || servico.valor);
                    }
                });
            }
        });
        
        // Contar em orçamentos salvos nos clientes (também filtrar se tiver data)
        clientes.forEach(cliente => {
            if (cliente.orcamento && cliente.orcamento.servicos && Array.isArray(cliente.orcamento.servicos)) {
                // Se o cliente tem evento associado, verificar se está no período
                let incluirCliente = true;
                if (filtroMes && filtroAno && cliente.orcamento.dataEvento) {
                    const dataOrcamento = new Date(cliente.orcamento.dataEvento);
                    const anoOrcamento = dataOrcamento.getFullYear();
                    const mesOrcamento = dataOrcamento.getMonth() + 1;
                    
                    if (tipoVisualizacao === 'mensal') {
                        if (filtroMes === 'todos') {
                            incluirCliente = anoOrcamento === parseInt(filtroAno);
                        } else {
                            incluirCliente = anoOrcamento === parseInt(filtroAno) && mesOrcamento === parseInt(filtroMes);
                        }
                    } else {
                        incluirCliente = anoOrcamento === parseInt(filtroAno);
                    }
                }
                
                if (incluirCliente) {
                    cliente.orcamento.servicos.forEach(s => {
                        if (s.nome === servico.nome || s.id === servico.id) {
                            vezesContratado++;
                            receitaTotal += (s.valor || servico.valor);
                        }
                    });
                }
            }
        });
        
        return {
            ...servico,
            vezesContratado,
            receitaTotal,
            ticketMedio: vezesContratado > 0 ? receitaTotal / vezesContratado : servico.valor
        };
    });
    
    // Ordenar por mais contratado
    servicosComStats.sort((a, b) => b.vezesContratado - a.vezesContratado);
    
    const html = servicosComStats.map(s => `
        <div style="border-bottom: 1px solid var(--border); padding: 16px;">
            <!-- Cabeçalho -->
            <div style="margin-bottom: 12px;">
                <h3 style="margin-bottom: 6px; font-size: 17px; line-height: 1.3;">${s.nome}</h3>
                <div style="display: flex; gap: 12px; flex-wrap: wrap; font-size: 12px;">
                    <span style="color: var(--text-secondary);">
                        📦 ${getCategoriaLabel(s.categoria)}
                    </span>
                    <span style="color: var(--text-secondary);">
                        💰 ${formatMoney(s.valor)}
                    </span>
                </div>
            </div>
            
            <!-- Estatísticas -->
            <div class="servico-stats-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                <div style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);">${s.vezesContratado}</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 2px; line-height: 1.2;">Vezes Contratado</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--accent);">${formatMoney(s.receitaTotal)}</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 2px; line-height: 1.2;">Receita Total</div>
                </div>
                <div class="servico-ticket-medio" style="text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--primary);">${formatMoney(s.ticketMedio)}</div>
                    <div style="font-size: 10px; color: var(--text-secondary); margin-top: 2px; line-height: 1.2;">Ticket Médio</div>
                </div>
            </div>
            
            <!-- Botões de ação - pequenos abaixo -->
            <div class="servico-actions" style="display: flex; gap: 8px; justify-content: center;">
                <button onclick="editServico(${s.id})" class="btn btn-small btn-editar-servico" style="background: rgba(79, 70, 229, 0.2); color: var(--primary); border: 1px solid var(--primary); padding: 6px 16px; font-size: 11px; border-radius: 6px;">
                    ✏️ Editar
                </button>
                <button onclick="deleteServico(${s.id})" class="btn btn-small btn-excluir-servico" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger); padding: 6px 16px; font-size: 11px; border-radius: 6px;">
                    🗑️ Excluir
                </button>
            </div>
        </div>
    `).join('');
    
    document.getElementById('servicosPerformanceList').innerHTML = html;
    
    // Atualizar cards de resumo
    const totalServicos = servicos.length;
    const totalLocacoes = servicosComStats.reduce((sum, s) => sum + s.vezesContratado, 0);
    const receitaTotal = servicosComStats.reduce((sum, s) => sum + s.receitaTotal, 0);
    const maisPopular = servicosComStats[0];
    
    document.getElementById('totalServicos').textContent = totalServicos;
    document.getElementById('totalLocacoes').textContent = totalLocacoes;
    document.getElementById('receitaTotalServicos').textContent = formatMoney(receitaTotal);
    document.getElementById('servicoMaisPopular').textContent = maisPopular ? maisPopular.nome : '-';
    
    // Renderizar tops
    renderTopServicos(servicosComStats);
}

function renderTopServicos(servicosComStats) {
    // Top 5 Mais Contratados
    const topContratados = servicosComStats
        .filter(s => s.vezesContratado > 0)
        .slice(0, 5);
    
    const htmlContratados = topContratados.map((s, index) => {
        const medals = ['🥇', '🥈', '🥉', '4️⃣', '5️⃣'];
        return `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border);">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <span style="font-size: 24px;">${medals[index]}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${s.nome}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${s.vezesContratado} contratações</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 600; color: var(--success);">${formatMoney(s.receitaTotal)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('topServicosContratados').innerHTML = htmlContratados || '<p style="text-align: center; padding: 20px; color: var(--text-secondary);">Nenhuma contratação ainda</p>';
    
    // Top 5 Mais Rentáveis
    const topRentaveis = [...servicosComStats]
        .filter(s => s.receitaTotal > 0)
        .sort((a, b) => b.receitaTotal - a.receitaTotal)
        .slice(0, 5);
    
    const htmlRentaveis = topRentaveis.map((s, index) => {
        const medals = ['🥇', '🥈', '🥉', '4️⃣', '5️⃣'];
        return `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border);">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <span style="font-size: 24px;">${medals[index]}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${s.nome}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${s.vezesContratado} contratações</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 600; color: var(--accent);">${formatMoney(s.receitaTotal)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('topServicosRentaveis').innerHTML = htmlRentaveis || '<p style="text-align: center; padding: 20px; color: var(--text-secondary);">Nenhuma receita ainda</p>';
}

// ============================================
// FUNÇÕES DA ABA DE CONFIGURAÇÕES
// ============================================

function mostrarConfigSecao(secao) {
    console.log('⚙️ Mostrando seção:', secao);
    
    // Esconder todas as seções
    document.getElementById('configPerfilSecao').style.display = 'none';
    document.getElementById('configDocumentosSecao').style.display = 'none';
    document.getElementById('configLogoSecao').style.display = 'none';
    if (document.getElementById('configTemaSecao')) {
        document.getElementById('configTemaSecao').style.display = 'none';
    }
    if (document.getElementById('configSyncSecao')) {
        document.getElementById('configSyncSecao').style.display = 'none';
    }
    
    // Resetar botões
    document.getElementById('btnConfigPerfil').classList.remove('btn-primary');
    document.getElementById('btnConfigPerfil').classList.add('btn-secondary');
    document.getElementById('btnConfigDocumentos').classList.remove('btn-primary');
    document.getElementById('btnConfigDocumentos').classList.add('btn-secondary');
    document.getElementById('btnConfigLogo').classList.remove('btn-primary');
    document.getElementById('btnConfigLogo').classList.add('btn-secondary');
    if (document.getElementById('btnConfigTema')) {
        document.getElementById('btnConfigTema').classList.remove('btn-primary');
        document.getElementById('btnConfigTema').classList.add('btn-secondary');
    }
    if (document.getElementById('btnConfigSync')) {
        document.getElementById('btnConfigSync').classList.remove('btn-primary');
        document.getElementById('btnConfigSync').classList.add('btn-secondary');
    }
    
    // Mostrar seção selecionada
    if (secao === 'perfil') {
        document.getElementById('configPerfilSecao').style.display = 'block';
        document.getElementById('btnConfigPerfil').classList.remove('btn-secondary');
        document.getElementById('btnConfigPerfil').classList.add('btn-primary');
    } else if (secao === 'documentos') {
        document.getElementById('configDocumentosSecao').style.display = 'block';
        document.getElementById('btnConfigDocumentos').classList.remove('btn-secondary');
        document.getElementById('btnConfigDocumentos').classList.add('btn-primary');
    } else if (secao === 'logo') {
        document.getElementById('configLogoSecao').style.display = 'block';
        document.getElementById('btnConfigLogo').classList.remove('btn-secondary');
        document.getElementById('btnConfigLogo').classList.add('btn-primary');
    } else if (secao === 'tema') {
        console.log('🌓 Tentando mostrar seção de tema...');
        const temaSecao = document.getElementById('configTemaSecao');
        console.log('📍 Seção de tema encontrada:', temaSecao ? 'SIM' : 'NÃO');
        
        if (temaSecao) {
            temaSecao.style.display = 'block';
            console.log('✅ Seção de tema mostrada');
            
            const btnTema = document.getElementById('btnConfigTema');
            if (btnTema) {
                btnTema.classList.remove('btn-secondary');
                btnTema.classList.add('btn-primary');
                console.log('✅ Botão tema ativado');
            }
        }
    } else if (secao === 'sync') {
        if (document.getElementById('configSyncSecao')) {
            document.getElementById('configSyncSecao').style.display = 'block';
            document.getElementById('btnConfigSync').classList.remove('btn-secondary');
            document.getElementById('btnConfigSync').classList.add('btn-primary');
        }
    }
}

// ========================================
// FUNÇÕES DE TEMA (CLARO/ESCURO)
// ========================================

function initTheme() {
    // Carregar tema salvo ou usar padrão (escuro)
    const savedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(savedTheme, false); // false = não mostrar alert
    
    // Atualizar toggle
    const toggle = document.getElementById('themeToggle');
    if (toggle) {
        toggle.checked = savedTheme === 'dark';
    }
}

function toggleTheme() {
    const toggle = document.getElementById('themeToggle');
    const newTheme = toggle.checked ? 'dark' : 'light';
    setTheme(newTheme, true); // true = mostrar alert
}

function setTheme(theme, showAlert = true) {
    console.log('🎨 === SETTHEME CHAMADO ===');
    console.log('Tema solicitado:', theme);
    console.log('Mostrar alert:', showAlert);
    
    // Aplicar tema no HTML
    document.documentElement.setAttribute('data-theme', theme);
    
    // Verificar se aplicou
    const aplicado = document.documentElement.getAttribute('data-theme');
    console.log('✅ Atributo aplicado:', aplicado);
    
    // Verificar variável CSS
    const style = getComputedStyle(document.documentElement);
    const bgDark = style.getPropertyValue('--bg-dark').trim();
    const bgCard = style.getPropertyValue('--bg-card').trim();
    console.log('📊 Variáveis CSS:');
    console.log('  --bg-dark:', bgDark);
    console.log('  --bg-card:', bgCard);
    
    // Salvar preferência
    localStorage.setItem('theme', theme);
    
    // Atualizar toggle se existir
    const toggle = document.getElementById('themeToggle');
    if (toggle) {
        toggle.checked = theme === 'dark';
        console.log('🔘 Toggle atualizado:', theme === 'dark' ? 'checked' : 'unchecked');
    }
    
    console.log('✅ Tema aplicado com sucesso!');
    
    // Alert visual apenas se showAlert for true
    if (showAlert) {
        const alertMsg = document.createElement('div');
        alertMsg.textContent = `Tema ${theme === 'dark' ? 'Escuro 🌙' : 'Claro ☀️'} ativado!`;
        alertMsg.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(alertMsg);
        setTimeout(() => alertMsg.remove(), 2000);
        console.log('💬 Alert mostrado');
    }
}

function carregarConfigEmpresa() {
    const config = DB.get('configuracoes')[0] || {};
    
    document.getElementById('configNomeEmpresa').value = config.nomeEmpresa || '';
    document.getElementById('configNomeCorporativo').value = config.nomeCorporativo || '';
    document.getElementById('configCNPJ').value = config.cnpj || '';
    document.getElementById('configTelefone').value = config.telefone || '';
    document.getElementById('configWhatsapp').value = config.whatsapp || '';
    document.getElementById('configEmail').value = config.email || '';
    if (document.getElementById('configCidade')) {
        document.getElementById('configCidade').value = config.cidade || '';
    }
    if (document.getElementById('configEstado')) {
        document.getElementById('configEstado').value = config.estado || '';
    }
    document.getElementById('configInstagram').value = config.instagram || '';
    document.getElementById('configFacebook').value = config.facebook || '';
    document.getElementById('configYoutube').value = config.youtube || '';
    document.getElementById('configSite').value = config.site || '';
    document.getElementById('configClausulasContratuais').value = config.clausulasContratuais || '';
    
    // Carregar modelos de documentos
    if (document.getElementById('configModeloOrcamento')) {
        document.getElementById('configModeloOrcamento').value = config.modeloOrcamento || '';
    }
    if (document.getElementById('configModeloRecibo')) {
        document.getElementById('configModeloRecibo').value = config.modeloRecibo || '';
    }
    
    // Carregar logo se existir
    if (config.logoBase64) {
        document.getElementById('logoImage').src = config.logoBase64;
        document.getElementById('logoImage').style.display = 'block';
        document.getElementById('logoPlaceholder').style.display = 'none';
    }
}

function salvarConfigEmpresa(e) {
    e.preventDefault();
    
    const config = {
        nomeEmpresa: document.getElementById('configNomeEmpresa').value,
        nomeCorporativo: document.getElementById('configNomeCorporativo').value,
        cnpj: document.getElementById('configCNPJ').value,
        telefone: document.getElementById('configTelefone').value,
        whatsapp: document.getElementById('configWhatsapp').value,
        email: document.getElementById('configEmail').value,
        cidade: document.getElementById('configCidade')?.value || '',
        estado: document.getElementById('configEstado')?.value || '',
        instagram: document.getElementById('configInstagram').value,
        facebook: document.getElementById('configFacebook').value,
        youtube: document.getElementById('configYoutube').value,
        site: document.getElementById('configSite').value
    };
    
    // Preservar logo e cláusulas se existirem
    const configExistente = DB.get('configuracoes')[0];
    if (configExistente) {
        config.logoBase64 = configExistente.logoBase64 || null;
        config.clausulasContratuais = configExistente.clausulasContratuais || '';
        config.modeloOrcamento = configExistente.modeloOrcamento || '';
        config.modeloRecibo = configExistente.modeloRecibo || '';
    }
    
    // Salvar (sobrescrever ou criar)
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0] = { ...configuracoes[0], ...config };
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [config]);
    }
    
    alert('✅ Configurações salvas com sucesso!');
}

function salvarClausulasContratuais() {
    const texto = document.getElementById('configClausulasContratuais').value;
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].clausulasContratuais = texto;
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [{ clausulasContratuais: texto }]);
    }
    
    alert('✅ Cláusulas contratuais salvas com sucesso!');
}

// Salvar modelo de orçamento
function salvarModeloOrcamento() {
    const texto = document.getElementById('configModeloOrcamento').value;
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].modeloOrcamento = texto;
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [{ modeloOrcamento: texto }]);
    }
    
    alert('✅ Modelo de orçamento salvo com sucesso!');
}

// Salvar modelo de recibo
function salvarModeloRecibo() {
    const texto = document.getElementById('configModeloRecibo').value;
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].modeloRecibo = texto;
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [{ modeloRecibo: texto }]);
    }
    
    alert('✅ Modelo de recibo salvo com sucesso!');
}

function resetarClausulas() {
    const textoDefault = `CONTRATO DE PRESTAÇÃO DE SERVIÇOS DE EVENTOS

1. DO OBJETO
O presente contrato tem por objeto a prestação de serviços de [TIPO DE SERVIÇO] pela CONTRATADA em favor do CONTRATANTE.

2. DAS CONDIÇÕES
2.1. Data do Evento: [DATA]
2.2. Horário: [HORÁRIO]
2.3. Local: [ENDEREÇO]

3. DO VALOR E FORMA DE PAGAMENTO
3.1. O valor total do serviço é de R$ [VALOR]
3.2. Sinal de R$ [SINAL] pago em [DATA_SINAL]
3.3. Restante de R$ [RESTANTE] até [VENCIMENTO]

4. DAS OBRIGAÇÕES DA CONTRATADA
4.1. Fornecer os serviços contratados com qualidade e pontualidade
4.2. Disponibilizar os equipamentos e materiais necessários

5. DAS OBRIGAÇÕES DO CONTRATANTE
5.1. Efetuar os pagamentos nas datas acordadas
5.2. Fornecer as informações necessárias para execução do serviço

6. DO CANCELAMENTO
6.1. Em caso de cancelamento pela CONTRATANTE com até 30 dias de antecedência, haverá devolução de 50% do sinal
6.2. Cancelamentos com menos de 30 dias não haverá devolução do sinal

7. DISPOSIÇÕES GERAIS
Este contrato é regido pelas leis brasileiras.

Data: [DATA_CONTRATO]

_________________________________
CONTRATADA

_________________________________
CONTRATANTE`;

    if (confirm('Deseja resetar as cláusulas para o texto padrão?')) {
        document.getElementById('configClausulasContratuais').value = textoDefault;
    }
}

// ============================================
// RESET COMPLETO DO SISTEMA
// ============================================

function confirmarResetCompleto() {
    // PRIMEIRA CONFIRMAÇÃO
    const primeiraConfirmacao = confirm(
        '⚠️ ATENÇÃO! AÇÃO IRREVERSÍVEL!\n\n' +
        'Você está prestes a APAGAR TODOS OS DADOS do sistema!\n\n' +
        '❌ Isso incluirá:\n' +
        '• Todos os eventos e clientes\n' +
        '• Todas as receitas e despesas\n' +
        '• Todos os custos e serviços\n' +
        '• Contas bancárias e contas a pagar\n' +
        '• Configurações da empresa\n' +
        '• DADOS DA NUVEM (se estiver usando Firebase)\n\n' +
        'Deseja realmente continuar?'
    );
    
    if (!primeiraConfirmacao) {
        alert('✅ Reset cancelado. Seus dados estão seguros!');
        return;
    }
    
    // SEGUNDA CONFIRMAÇÃO (mais específica)
    const segundaConfirmacao = confirm(
        '🔴 ÚLTIMA CHANCE!\n\n' +
        'Para confirmar que você realmente deseja apagar TUDO, clique em OK.\n\n' +
        '⚠️ LEMBRE-SE:\n' +
        '• Esta ação NÃO pode ser desfeita\n' +
        '• Se estiver usando Firebase, os dados da nuvem TAMBÉM serão apagados\n' +
        '• Você terá que começar do zero\n\n' +
        'Tem ABSOLUTA CERTEZA?'
    );
    
    if (!segundaConfirmacao) {
        alert('✅ Reset cancelado. Seus dados estão seguros!');
        return;
    }
    
    // Se chegou aqui, executar o reset
    executarResetCompleto();
}

async function executarResetCompleto() {
    console.log('🗑️ Iniciando reset completo do sistema...');
    
    // Mostrar loading
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'resetLoading';
    loadingDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 999999;
        color: white;
    `;
    loadingDiv.innerHTML = `
        <div style="font-size: 64px; margin-bottom: 20px;">🗑️</div>
        <div style="font-size: 24px; margin-bottom: 10px;">Resetando Sistema...</div>
        <div id="resetStatus" style="font-size: 14px; color: var(--accent);">Apagando dados locais...</div>
    `;
    document.body.appendChild(loadingDiv);
    
    const updateStatus = (msg) => {
        const statusEl = document.getElementById('resetStatus');
        if (statusEl) statusEl.textContent = msg;
    };
    
    try {
        // 1. APAGAR DADOS LOCAIS (localStorage)
        updateStatus('🗑️ Apagando dados locais...');
        await new Promise(resolve => setTimeout(resolve, 500));
        
        const keysToDelete = [
            'eventos', 'clientes', 'receitas', 'despesas', 'contas',
            'servicos', 'custosGerais', 'custosEventos',
            'receitasPessoais', 'despesasPessoais', 'contasPessoais', 'contasPagar',
            'configuracoes', 'lastSyncLocal'
        ];
        
        keysToDelete.forEach(key => {
            localStorage.removeItem(key);
        });
        
        console.log('✅ Dados locais apagados');
        
        // 2. APAGAR DADOS DO FIREBASE (se conectado)
        if (isFirebaseConnected && firebaseDatabase) {
            updateStatus('☁️ Apagando dados da nuvem (Firebase)...');
            await new Promise(resolve => setTimeout(resolve, 500));
            
            try {
                await firebaseDatabase.ref('eventprodj').remove();
                console.log('✅ Dados do Firebase apagados');
                updateStatus('✅ Dados da nuvem apagados com sucesso!');
            } catch (error) {
                console.error('❌ Erro ao apagar dados do Firebase:', error);
                updateStatus('⚠️ Erro ao apagar dados da nuvem (mas dados locais foram apagados)');
            }
            
            await new Promise(resolve => setTimeout(resolve, 1000));
        } else {
            console.log('ℹ️ Firebase não conectado, apenas dados locais foram apagados');
        }
        
        // 3. REINICIALIZAR ARRAYS VAZIOS
        updateStatus('🔄 Reinicializando sistema...');
        await new Promise(resolve => setTimeout(resolve, 500));
        
        keysToDelete.forEach(key => {
            if (key === 'configuracoes') {
                DB.set(key, []);
            } else if (key !== 'lastSyncLocal') {
                DB.set(key, []);
            }
        });
        
        // 4. FINALIZAR
        updateStatus('✅ Reset concluído!');
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Remover loading
        document.body.removeChild(loadingDiv);
        
        // Mostrar mensagem final
        alert(
            '✅ RESET COMPLETO REALIZADO!\n\n' +
            '🗑️ Todos os dados foram apagados:\n' +
            '• Dados locais: ✅ Apagados\n' +
            (isFirebaseConnected ? '• Dados da nuvem: ✅ Apagados\n' : '') +
            '\n' +
            '🔄 A página será recarregada para aplicar as mudanças.'
        );
        
        // Recarregar página
        setTimeout(() => {
            window.location.reload();
        }, 1000);
        
    } catch (error) {
        console.error('❌ Erro durante o reset:', error);
        
        // Remover loading
        const loadingEl = document.getElementById('resetLoading');
        if (loadingEl) document.body.removeChild(loadingEl);
        
        alert(
            '❌ Erro durante o reset!\n\n' +
            'Detalhes: ' + error.message + '\n\n' +
            'Alguns dados podem não ter sido apagados completamente.\n' +
            'Tente novamente ou entre em contato com o suporte.'
        );
    }
}

function handleLogoUpload(event) {
    const file = event.target.files[0];
    
    if (!file) return;
    
    // Validar tamanho (2MB)
    if (file.size > 2 * 1024 * 1024) {
        alert('❌ Arquivo muito grande! Máximo 2MB.');
        return;
    }
    
    // Validar tipo
    if (!file.type.match('image.*')) {
        alert('❌ Apenas imagens são permitidas!');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const base64 = e.target.result;
        
        // Mostrar preview
        document.getElementById('logoImage').src = base64;
        document.getElementById('logoImage').style.display = 'block';
        document.getElementById('logoPlaceholder').style.display = 'none';
        
        // Salvar no DB
        const configuracoes = DB.get('configuracoes');
        if (configuracoes.length > 0) {
            configuracoes[0].logoBase64 = base64;
            DB.set('configuracoes', configuracoes);
        } else {
            DB.set('configuracoes', [{ logoBase64: base64 }]);
        }
        
        alert('✅ Logo carregada com sucesso!');
    };
    
    reader.readAsDataURL(file);
}

function removerLogo() {
    if (!confirm('Deseja realmente remover a logo?')) return;
    
    document.getElementById('logoImage').style.display = 'none';
    document.getElementById('logoPlaceholder').style.display = 'block';
    document.getElementById('logoImage').src = '';
    document.getElementById('logoUpload').value = '';
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].logoBase64 = null;
        DB.set('configuracoes', configuracoes);
    }
    
    alert('✅ Logo removida!');
}

function formatCNPJ(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 14) {
        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
        input.value = value;
    }
}

function formatTelefone(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
        value = value.replace(/(\d)(\d{4})$/, '$1-$2');
        input.value = value;
    }
}

// Inicializar configurações ao carregar
if (!DB.get('configuracoes')) {
    DB.set('configuracoes', []);
}
        // Aguardar DOM estar completamente carregado
        // ============================================
        // FUNÇÃO DE TESTE GLOBAL
        // ============================================
        window.testarModal = function() {
            console.log('🧪 TESTE MANUAL DE MODAL');
            const modal = document.getElementById('modalCliente');
            
            if (!modal) {
                console.error('❌ Modal não encontrado!');
                return;
            }
            
            console.log('✅ Modal encontrado');
            
            // Aplicar estilos agressivos
            console.log('Aplicando estilos...');
            modal.style.cssText = `
                display: flex !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                z-index: 999999 !important;
                opacity: 1 !important;
                visibility: visible !important;
                background: red !important;
                align-items: center !important;
                justify-content: center !important;
            `;
            
            console.log('✅ Estilos aplicados');
            console.log('VOCÊ VÊ UMA TELA VERMELHA?');
        };
        
        console.log('💡 Para testar: digite testarModal() no console');
        
        // ============================================
        // SISTEMA DE SINCRONIZAÇÃO COM FIREBASE
        // ============================================
        
        let firebaseApp = null;
        let firebaseDatabase = null;
        let isFirebaseConnected = false;
        let autoSyncEnabled = true;
        
        // ============================================
        // ⚠️ CONFIGURAÇÃO DO FIREBASE
        // ============================================
        // Cole suas credenciais do Firebase aqui:
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyB3isxgzmM5PJnoW9Cn0uzOmQLpHm5WABI",                    // Cole aqui: AIzaSy...
            authDomain: "eventprodj.firebaseapp.com",                // Cole aqui: seu-projeto.firebaseapp.com
            databaseURL: "https://eventprodj-default-rtdb.firebaseio.com",               // Cole aqui: https://seu-projeto.firebaseio.com
            projectId: "eventprodj",                 // Cole aqui: seu-projeto
            storageBucket: "eventprodj.firebasestorage.app",             // Cole aqui: seu-projeto.appspot.com
            messagingSenderId: "343258228418",         // Cole aqui: 123456789
            appId: "1:343258228418:web:3f4437336c8c35fe943d5b"                      // Cole aqui: 1:123456789:web:abc123
        };
        // ============================================
        
        // Inicializar Firebase com configurações embutidas ou localStorage
        function initFirebase() {
            // Verificar se há config embutida no código
            const hasEmbeddedConfig = FIREBASE_CONFIG.apiKey && 
                                     FIREBASE_CONFIG.databaseURL && 
                                     FIREBASE_CONFIG.projectId;
            
            let firebaseConfig;
            
            if (hasEmbeddedConfig) {
                // Usar config embutida
                console.log('✅ Usando configuração Firebase embutida no código');
                firebaseConfig = FIREBASE_CONFIG;
                
                // Salvar no localStorage para aparecer na interface
                localStorage.setItem('firebaseConfig', JSON.stringify(FIREBASE_CONFIG));
            } else {
                // Tentar pegar do localStorage (config manual)
                const config = localStorage.getItem('firebaseConfig');
                if (!config) {
                    console.log('Firebase não configurado');
                    atualizarStatusSync('offline', 'Não configurado');
                    return false;
                }
                firebaseConfig = JSON.parse(config);
            }
            
            try {
                
                // Validar configuração mínima
                if (!firebaseConfig.apiKey || !firebaseConfig.databaseURL || !firebaseConfig.projectId) {
                    console.error('Configuração Firebase incompleta');
                    atualizarStatusSync('error', 'Config inválida');
                    return false;
                }
                
                // Inicializar Firebase apenas uma vez
                if (!firebaseApp) {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                    firebaseDatabase = firebase.database();
                    
                    console.log('Firebase inicializado');
                }
                
                // Testar conexão
                firebaseDatabase.ref('.info/connected').on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        isFirebaseConnected = true;
                        atualizarStatusSync('online', 'Conectado');
                        console.log('✅ Firebase conectado');
                        
                        // Iniciar sincronização automática
                        iniciarSincronizacaoAutomatica();
                        
                        // Verificar se deve baixar dados da nuvem ao conectar
                        verificarSincronizacaoInicial();
                    } else {
                        isFirebaseConnected = false;
                        atualizarStatusSync('offline', 'Desconectado');
                        console.log('⚠️ Firebase desconectado');
                        
                        // Parar sincronização automática
                        pararSincronizacaoAutomatica();
                    }
                });
                
                return true;
            } catch (error) {
                console.error('Erro ao inicializar Firebase:', error);
                atualizarStatusSync('error', 'Erro');
                
                // Mostrar erro detalhado apenas uma vez
                if (error.code === 'app/duplicate-app') {
                    console.log('Firebase já foi inicializado anteriormente');
                    return true;
                }
                
                return false;
            }
        }
        
        // Sincronizar todos os dados
        async function sincronizarAgora() {
            if (!firebaseDatabase || !isFirebaseConnected) {
                alert('⚠️ Firebase não está conectado!\n\nConfigure o Firebase em Configurações → Sincronização');
                return;
            }
            
            atualizarStatusSync('syncing', 'Sincronizando...');
            
            try {
                // Pegar todos os dados do localStorage
                const dados = {
                    eventos: DB.get('eventos') || [],
                    clientes: DB.get('clientes') || [],
                    receitas: DB.get('receitas') || [],
                    despesas: DB.get('despesas') || [],
                    contas: DB.get('contas') || [],
                    servicos: DB.get('servicos') || [],
                    custosGerais: DB.get('custosGerais') || [],
                    custosEventos: DB.get('custosEventos') || [],
                    receitasPessoais: DB.get('receitasPessoais') || [],
                    despesasPessoais: DB.get('despesasPessoais') || [],
                    contasPessoais: DB.get('contasPessoais') || [],
                    contasPagar: DB.get('contasPagar') || [],
                    configuracoes: DB.get('configuracoes') || {},
                    lastSync: new Date().toISOString()
                };
                
                // Enviar para Firebase
                await firebaseDatabase.ref('eventprodj').set(dados);
                
                // Salvar timestamp local
                localStorage.setItem('lastSyncLocal', dados.lastSync);
                
                atualizarStatusSync('online', 'Sincronizado');
                
                console.log('✅ Dados sincronizados com sucesso!');
                
                // Mostrar feedback visual APENAS se for sincronização manual
                if (arguments[0] === 'manual') {
                    setTimeout(() => {
                        alert('✅ Dados sincronizados com sucesso!');
                    }, 100);
                }
                
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                atualizarStatusSync('error', 'Erro');
                
                // Só mostrar alert se for sincronização manual
                if (arguments[0] === 'manual') {
                    alert('❌ Erro ao sincronizar dados:\n\n' + error.message + '\n\nVerifique sua conexão e as configurações do Firebase.');
                }
            }
        }
        
        // Sincronização automática a cada 2 minutos
        let autoSyncInterval = null;
        
        function iniciarSincronizacaoAutomatica() {
            // Limpar intervalo anterior se existir
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            // Sincronizar a cada 2 minutos (120000 ms)
            autoSyncInterval = setInterval(() => {
                if (isFirebaseConnected && autoSyncEnabled) {
                    console.log('🔄 Sincronização automática...');
                    sincronizarAgora(); // Sem parâmetro = silenciosa
                }
            }, 120000); // 2 minutos
            
            console.log('✅ Sincronização automática ativada (a cada 2 minutos)');
        }
        
        function pararSincronizacaoAutomatica() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
                console.log('⏸️ Sincronização automática pausada');
            }
        }
        
        // Verificar se deve sincronizar ao inicializar
        async function verificarSincronizacaoInicial() {
            // Verificar se há dados locais
            const eventosLocais = DB.get('eventos');
            const clientesLocais = DB.get('clientes');
            const temDadosLocais = eventosLocais.length > 0 || clientesLocais.length > 0;
            
            try {
                // Verificar se há dados na nuvem
                const snapshot = await firebaseDatabase.ref('eventprodj/lastSync').once('value');
                const lastSync = snapshot.val();
                
                if (!lastSync) {
                    // Não há dados na nuvem
                    console.log('Nuvem vazia');
                    
                    if (temDadosLocais) {
                        // Tem dados locais, enviar para nuvem
                        console.log('Enviando dados locais para nuvem...');
                        await sincronizarAgora();
                    }
                } else {
                    // Há dados na nuvem
                    console.log('Dados encontrados na nuvem, última sync:', lastSync);
                    
                    if (!temDadosLocais) {
                        // Não tem dados locais, baixar da nuvem automaticamente
                        console.log('Baixando dados da nuvem automaticamente...');
                        await baixarDaNuvemSilencioso();
                    } else {
                        // Tem dados locais e na nuvem
                        // Verificar qual é mais recente
                        const lastSyncLocal = localStorage.getItem('lastSyncLocal');
                        
                        if (!lastSyncLocal || new Date(lastSync) > new Date(lastSyncLocal)) {
                            // Nuvem mais recente
                            mostrarDialogoSincronizacao();
                        }
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar sincronização:', error);
            }
        }
        
        // Baixar dados da nuvem sem confirmação (usado na inicialização)
        async function baixarDaNuvemSilencioso() {
            try {
                const snapshot = await firebaseDatabase.ref('eventprodj').once('value');
                const dados = snapshot.val();
                
                if (!dados) {
                    console.log('Nenhum dado na nuvem');
                    return;
                }
                
                // Restaurar todos os dados
                if (dados.eventos) DB.set('eventos', dados.eventos);
                if (dados.clientes) DB.set('clientes', dados.clientes);
                if (dados.receitas) DB.set('receitas', dados.receitas);
                if (dados.despesas) DB.set('despesas', dados.despesas);
                if (dados.contas) DB.set('contas', dados.contas);
                if (dados.servicos) DB.set('servicos', dados.servicos);
                if (dados.custosGerais) DB.set('custosGerais', dados.custosGerais);
                if (dados.custosEventos) DB.set('custosEventos', dados.custosEventos);
                if (dados.receitasPessoais) DB.set('receitasPessoais', dados.receitasPessoais);
                if (dados.despesasPessoais) DB.set('despesasPessoais', dados.despesasPessoais);
                if (dados.contasPessoais) DB.set('contasPessoais', dados.contasPessoais);
                if (dados.contasPagar) DB.set('contasPagar', dados.contasPagar);
                if (dados.configuracoes) DB.set('configuracoes', dados.configuracoes);
                
                // Salvar timestamp local
                localStorage.setItem('lastSyncLocal', dados.lastSync || new Date().toISOString());
                
                // Atualizar interface
                updateDashboard();
                renderClientsList();
                renderEventsList();
                atualizarFinanceiroPorPeriodo();
                
                console.log('✅ Dados baixados da nuvem automaticamente');
                
                // Mostrar notificação discreta
                atualizarStatusSync('online', 'Sincronizado');
            } catch (error) {
                console.error('Erro ao baixar dados:', error);
            }
        }
        
        // Mostrar diálogo perguntando qual versão usar
        function mostrarDialogoSincronizacao() {
            const modal = document.createElement('div');
            modal.id = 'syncModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 999999;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg); border-radius: 16px; padding: 32px; max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">☁️</div>
                        <h2 style="font-family: 'Syne', sans-serif; margin-bottom: 8px;">Dados Encontrados na Nuvem</h2>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Encontramos dados mais recentes na nuvem. O que deseja fazer?
                        </p>
                    </div>
                    
                    <div style="display: grid; gap: 12px;">
                        <button onclick="baixarDaNuvemEFechar()" class="btn btn-primary" style="width: 100%;">
                            ☁️ Baixar da Nuvem
                            <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">Substituir dados locais pelos da nuvem</div>
                        </button>
                        <button onclick="enviarParaNuvemEFechar()" class="btn btn-secondary" style="width: 100%;">
                            ⬆️ Enviar para Nuvem
                            <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">Manter dados locais e enviar para nuvem</div>
                        </button>
                        <button onclick="fecharModalSync()" class="btn" style="width: 100%; background: transparent; border: 1px solid var(--border);">
                            ❌ Manter Local
                            <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">Não sincronizar agora</div>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Fechar modal de sincronização
        function fecharModalSync() {
            const modal = document.getElementById('syncModal');
            if (modal) {
                modal.remove();
            }
            localStorage.setItem('lastSyncLocal', new Date().toISOString());
        }
        
        // Baixar da nuvem e fechar modal
        async function baixarDaNuvemEFechar() {
            await baixarDaNuvemSilencioso();
            fecharModalSync();
        }
        
        // Enviar para nuvem e fechar modal
        async function enviarParaNuvemEFechar() {
            await sincronizarAgora();
            fecharModalSync();
        }
        
        // Baixar dados da nuvem
        async function baixarDaNuvem() {
            if (!isFirebaseConnected) {
                alert('⚠️ Firebase não está conectado!');
                return;
            }
            
            if (!confirm('⚠️ ATENÇÃO!\n\nIsso vai SUBSTITUIR todos os seus dados locais pelos dados da nuvem.\n\nDeseja continuar?')) {
                return;
            }
            
            atualizarStatusSync('syncing', 'Baixando...');
            
            try {
                const snapshot = await firebaseDatabase.ref('eventprodj').once('value');
                const dados = snapshot.val();
                
                if (!dados) {
                    alert('ℹ️ Não há dados na nuvem para baixar.');
                    atualizarStatusSync('online', 'Conectado');
                    return;
                }
                
                // Restaurar todos os dados
                if (dados.eventos) DB.set('eventos', dados.eventos);
                if (dados.clientes) DB.set('clientes', dados.clientes);
                if (dados.receitas) DB.set('receitas', dados.receitas);
                if (dados.despesas) DB.set('despesas', dados.despesas);
                if (dados.contas) DB.set('contas', dados.contas);
                if (dados.servicos) DB.set('servicos', dados.servicos);
                if (dados.custosGerais) DB.set('custosGerais', dados.custosGerais);
                if (dados.custosEventos) DB.set('custosEventos', dados.custosEventos);
                if (dados.receitasPessoais) DB.set('receitasPessoais', dados.receitasPessoais);
                if (dados.despesasPessoais) DB.set('despesasPessoais', dados.despesasPessoais);
                if (dados.contasPessoais) DB.set('contasPessoais', dados.contasPessoais);
                if (dados.contasPagar) DB.set('contasPagar', dados.contasPagar);
                if (dados.configuracoes) DB.set('configuracoes', dados.configuracoes);
                
                // Salvar timestamp local
                localStorage.setItem('lastSyncLocal', dados.lastSync || new Date().toISOString());
                
                // Atualizar interface
                updateDashboard();
                renderClientsList();
                renderEventsList();
                atualizarFinanceiroPorPeriodo();
                
                atualizarStatusSync('online', 'Conectado');
                alert('✅ Dados baixados da nuvem com sucesso!\n\nÚltima sincronização: ' + (dados.lastSync ? new Date(dados.lastSync).toLocaleString('pt-BR') : 'Desconhecido'));
            } catch (error) {
                console.error('Erro ao baixar dados:', error);
                atualizarStatusSync('error', 'Erro ao baixar');
                alert('❌ Erro ao baixar dados:\n\n' + error.message);
            }
        }
        
        // Enviar dados para nuvem
        async function enviarParaNuvem() {
            if (!isFirebaseConnected) {
                alert('⚠️ Firebase não está conectado!');
                return;
            }
            
            await sincronizarAgora();
        }
        
        // Salvar configuração do Firebase
        function salvarConfigFirebase(e) {
            e.preventDefault();
            
            const config = {
                apiKey: document.getElementById('firebaseApiKey').value.trim(),
                authDomain: document.getElementById('firebaseAuthDomain').value.trim(),
                databaseURL: document.getElementById('firebaseDatabaseURL').value.trim(),
                projectId: document.getElementById('firebaseProjectId').value.trim(),
                storageBucket: document.getElementById('firebaseStorageBucket').value.trim(),
                messagingSenderId: document.getElementById('firebaseMessagingSenderId').value.trim(),
                appId: document.getElementById('firebaseAppId').value.trim()
            };
            
            // Validar campos obrigatórios
            if (!config.apiKey || !config.databaseURL || !config.projectId || !config.appId) {
                alert('❌ Preencha todos os campos obrigatórios (*)');
                return;
            }
            
            // Salvar no localStorage
            localStorage.setItem('firebaseConfig', JSON.stringify(config));
            
            // Tentar conectar
            if (initFirebase()) {
                alert('✅ Configuração salva com sucesso!\n\nFirebase conectado e pronto para sincronizar.');
                atualizarStatusFirebase();
            } else {
                alert('⚠️ Configuração salva, mas houve um erro ao conectar.\n\nVerifique os dados e tente novamente.');
            }
        }
        
        // Testar conexão
        async function testarConexaoFirebase() {
            const config = localStorage.getItem('firebaseConfig');
            if (!config) {
                alert('⚠️ Configure o Firebase primeiro!');
                return;
            }
            
            if (isFirebaseConnected) {
                alert('✅ Firebase está conectado e funcionando!');
            } else {
                alert('❌ Firebase não está conectado.\n\nVerifique as configurações e sua conexão com a internet.');
            }
        }
        
        // Limpar configuração
        function limparConfigFirebase() {
            if (!confirm('⚠️ Isso vai remover a configuração do Firebase.\n\nSeus dados locais não serão afetados.\n\nDeseja continuar?')) {
                return;
            }
            
            localStorage.removeItem('firebaseConfig');
            
            // Limpar campos
            document.getElementById('firebaseApiKey').value = '';
            document.getElementById('firebaseAuthDomain').value = '';
            document.getElementById('firebaseDatabaseURL').value = '';
            document.getElementById('firebaseProjectId').value = '';
            document.getElementById('firebaseStorageBucket').value = '';
            document.getElementById('firebaseMessagingSenderId').value = '';
            document.getElementById('firebaseAppId').value = '';
            
            isFirebaseConnected = false;
            atualizarStatusSync('offline', 'Não configurado');
            atualizarStatusFirebase();
            
            alert('✅ Configuração removida!');
        }
        
        // Atualizar status visual na página de configurações
        function atualizarStatusFirebase() {
            const statusDiv = document.getElementById('firebaseStatus');
            if (!statusDiv) return;
            
            const config = localStorage.getItem('firebaseConfig');
            
            if (config && isFirebaseConnected) {
                statusDiv.style.backgroundColor = 'rgba(6, 214, 160, 0.1)';
                statusDiv.style.borderLeftColor = 'var(--success)';
                statusDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 32px;">✅</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--success);">Firebase Conectado</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">
                                Seus dados estão sendo sincronizados automaticamente
                            </div>
                        </div>
                    </div>
                `;
            } else if (config) {
                statusDiv.style.backgroundColor = 'rgba(255, 210, 63, 0.1)';
                statusDiv.style.borderLeftColor = 'var(--accent)';
                statusDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 32px;">⏳</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px; color: var(--accent);">Conectando...</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">
                                Firebase configurado, aguardando conexão
                            </div>
                        </div>
                    </div>
                `;
            } else {
                statusDiv.style.backgroundColor = 'rgba(239, 71, 111, 0.1)';
                statusDiv.style.borderLeftColor = 'var(--danger)';
                statusDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 32px;">❌</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 4px;">Firebase não configurado</div>
                            <div style="font-size: 13px; color: var(--text-secondary);">
                                Preencha os dados abaixo para ativar a sincronização
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Carregar configurações do Firebase nos campos
        function carregarConfigFirebase() {
            const config = localStorage.getItem('firebaseConfig');
            if (!config) return;
            
            try {
                const dados = JSON.parse(config);
                document.getElementById('firebaseApiKey').value = dados.apiKey || '';
                document.getElementById('firebaseAuthDomain').value = dados.authDomain || '';
                document.getElementById('firebaseDatabaseURL').value = dados.databaseURL || '';
                document.getElementById('firebaseProjectId').value = dados.projectId || '';
                document.getElementById('firebaseStorageBucket').value = dados.storageBucket || '';
                document.getElementById('firebaseMessagingSenderId').value = dados.messagingSenderId || '';
                document.getElementById('firebaseAppId').value = dados.appId || '';
            } catch (error) {
                console.error('Erro ao carregar config Firebase:', error);
            }
        }
        
        // Função para alternar seção de config (adicionar sync)
        function mostrarConfigSecao(secao) {
            // Esconder todas as seções
            document.getElementById('configPerfilSecao').style.display = 'none';
            document.getElementById('configDocumentosSecao').style.display = 'none';
            document.getElementById('configLogoSecao').style.display = 'none';
            document.getElementById('configSyncSecao').style.display = 'none';
            
            // Remover active de todos os botões
            document.getElementById('btnConfigPerfil').classList.remove('btn-primary');
            document.getElementById('btnConfigPerfil').classList.add('btn-secondary');
            document.getElementById('btnConfigDocumentos').classList.remove('btn-primary');
            document.getElementById('btnConfigDocumentos').classList.add('btn-secondary');
            document.getElementById('btnConfigLogo').classList.remove('btn-primary');
            document.getElementById('btnConfigLogo').classList.add('btn-secondary');
            document.getElementById('btnConfigSync').classList.remove('btn-primary');
            document.getElementById('btnConfigSync').classList.add('btn-secondary');
            
            // Mostrar seção selecionada
            if (secao === 'perfil') {
                document.getElementById('configPerfilSecao').style.display = 'block';
                document.getElementById('btnConfigPerfil').classList.add('btn-primary');
                document.getElementById('btnConfigPerfil').classList.remove('btn-secondary');
            } else if (secao === 'documentos') {
                document.getElementById('configDocumentosSecao').style.display = 'block';
                document.getElementById('btnConfigDocumentos').classList.add('btn-primary');
                document.getElementById('btnConfigDocumentos').classList.remove('btn-secondary');
            } else if (secao === 'logo') {
                document.getElementById('configLogoSecao').style.display = 'block';
                document.getElementById('btnConfigLogo').classList.add('btn-primary');
                document.getElementById('btnConfigLogo').classList.remove('btn-secondary');
            } else if (secao === 'sync') {
                document.getElementById('configSyncSecao').style.display = 'block';
                document.getElementById('btnConfigSync').classList.add('btn-primary');
                document.getElementById('btnConfigSync').classList.remove('btn-secondary');
                carregarConfigFirebase();
                atualizarStatusFirebase();
            }
        }
        
        // ============================================
        // INICIALIZAÇÃO DO SISTEMA
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('🚀 Inicializando EventProDJ...');
                
                // Verificar menu mobile
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileToggle = document.querySelector('.mobile-menu-toggle');
                console.log('📱 Menu mobile:', mobileMenu ? 'Encontrado' : '❌ NÃO ENCONTRADO');
                console.log('🍔 Botão toggle:', mobileToggle ? 'Encontrado' : '❌ NÃO ENCONTRADO');
                
                // Verificar estilos do botão
                if (mobileToggle) {
                    const styles = getComputedStyle(mobileToggle);
                    console.log('🔍 Estilos do botão hamburguer:');
                    console.log('  display:', styles.display);
                    console.log('  visibility:', styles.visibility);
                    console.log('  opacity:', styles.opacity);
                    console.log('  color:', styles.color);
                    console.log('  font-size:', styles.fontSize);
                    console.log('  position:', styles.position);
                    
                    const rect = mobileToggle.getBoundingClientRect();
                    console.log('📐 Posição e tamanho:');
                    console.log('  top:', rect.top, 'left:', rect.left);
                    console.log('  width:', rect.width, 'height:', rect.height);
                    console.log('  visível na tela:', rect.width > 0 && rect.height > 0);
                }
                
                console.log('📱 Largura da tela:', window.innerWidth, 'px');
                
                // Inicializar tema
                initTheme();
                
                // MOVER TODOS OS MODAIS PARA O FINAL DO BODY
                // Isso garante que fiquem na frente de tudo
                console.log('📦 Movendo modais para frente...');
                document.querySelectorAll('.modal').forEach(modal => {
                    document.body.appendChild(modal);
                });
                console.log('✅ Modais reposicionados');
                
                // Initialize data
                initSampleData();
                
                // 🔄 Migração de dados: adicionar tipoDespesa nas despesas antigas
                console.log('🔄 Verificando migração de dados...');
                const despesas = DB.get('despesas');
                let migrados = 0;
                despesas.forEach(despesa => {
                    if (!despesa.tipoDespesa) {
                        // Identificar tipo pela descrição
                        if (despesa.descricao.includes('[Custo Evento:')) {
                            despesa.tipoDespesa = 'custo_evento';
                            migrados++;
                        } else if (despesa.descricao.includes('[Custo Geral]')) {
                            despesa.tipoDespesa = 'custo_geral';
                            migrados++;
                        }
                    }
                });
                if (migrados > 0) {
                    DB.set('despesas', despesas);
                    console.log(`✅ ${migrados} despesas migradas com sucesso`);
                }
                
                carregarContasNosSelects();
                inicializarFiltrosFinanceiro();
                updateDashboard();
                atualizarFinanceiroPorPeriodo();
                
                // Renderizar clientes inicialmente
                renderClientsList();
                updateClientsStats();
                
                // Event listeners para cálculo de duração
                const horaInicio = document.getElementById('eventoHoraInicio');
                const horaFim = document.getElementById('eventoHoraFim');
                if (horaInicio) horaInicio.addEventListener('change', calcularDuracaoEvento);
                if (horaFim) horaFim.addEventListener('change', calcularDuracaoEvento);
                
                // Event listener para carregar valor do cliente
                const clienteInput = document.getElementById('eventoCliente');
                if (clienteInput) {
                    clienteInput.addEventListener('blur', carregarValorCliente);
                }
                
                // Observer para orçamento
                const orcamentoModal = document.getElementById('modalOrcamento');
                if (orcamentoModal) {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.target.classList.contains('active')) {
                                definirDatasOrcamento();
                            }
                        });
                    });
                    observer.observe(orcamentoModal, { attributes: true, attributeFilter: ['class'] });
                }
                
                // Toggle indicação field
                const clienteOrigemSelect = document.getElementById('clienteOrigem');
                if (clienteOrigemSelect) {
                    clienteOrigemSelect.addEventListener('change', function(e) {
                        const indicacaoField = document.getElementById('indicacaoDetalhes');
                        if (e.target.value === 'indicacao') {
                            indicacaoField.style.display = 'block';
                        } else {
                            indicacaoField.style.display = 'none';
                            document.getElementById('clienteIndicacao').value = '';
                        }
                    });
                }

                // Close modal on outside click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                            modal.style.display = 'none';
                        }
                    });
                });
                
                // Inicializar Firebase
                console.log('🔥 Inicializando Firebase...');
                initFirebase();
                
                console.log('✅ EventProDJ inicializado com sucesso!');
            } catch (error) {
                console.error('❌ Erro ao inicializar EventProDJ:', error);
                alert('Erro ao inicializar o sistema. Por favor, recarregue a página.\n\nErro: ' + error.message);
            }
        });

        // Função utilitária para remover clientes duplicados (pode ser chamada no console)
        window.limparClientesDuplicados = function() {
            const clientes = DB.get('clientes');
            const clientesUnicos = [];
            const nomesVistos = new Set();
            
            clientes.forEach(cliente => {
                const chave = `${cliente.nome}-${cliente.email}-${cliente.telefone}`;
                if (!nomesVistos.has(chave)) {
                    nomesVistos.add(chave);
                    clientesUnicos.push(cliente);
                }
            });
            
            const removidos = clientes.length - clientesUnicos.length;
            
            if (removidos > 0) {
                DB.set('clientes', clientesUnicos);
                renderClientsList();
                updateClientsStats();
                checkBirthdays();
                updateOrigemStats();
                console.log(`✅ ${removidos} cliente(s) duplicado(s) removido(s)!`);
                alert(`✅ ${removidos} cliente(s) duplicado(s) removido(s)!`);
            } else {
                console.log('✅ Nenhum cliente duplicado encontrado!');
                alert('✅ Nenhum cliente duplicado encontrado!');
            }
        };

        // Custos Management
        let currentCustosView = 'gerais';
        let currentEventoId = null;

        // Toggle between custos views
        function toggleCustosView(view) {
            currentCustosView = view;
            
            // Update buttons
            document.querySelectorAll('#custosTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Toggle views
            document.getElementById('custosGeraisView').style.display = view === 'gerais' ? 'block' : 'none';
            document.getElementById('custosEventosView').style.display = view === 'eventos' ? 'block' : 'none';
            
            if (view === 'gerais') {
                renderCustosGerais();
                updateCustosGeraisStats();
            } else {
                populateEventosSelect();
            }
        }

        // Populate eventos select
        function populateEventosSelect() {
            const eventos = DB.get('eventos');
            const select = document.getElementById('eventoSelecionado');
            
            select.innerHTML = '<option value="">Selecione um evento...</option>';
            eventos.forEach(e => {
                select.innerHTML += `<option value="${e.id}">${e.nome} - ${formatDate(e.data)}</option>`;
            });
        }

        // Render custos do evento
        function renderCustosEvento() {
            // ✅ CALCULAR TOTAL GERAL DE TODOS OS EVENTOS
            const todosCustosEventos = DB.get('custosEventos');
            const totalGeral = todosCustosEventos.reduce((sum, c) => sum + c.valor, 0);
            const eventosComCustos = [...new Set(todosCustosEventos.map(c => c.eventoId))].length;
            
            document.getElementById('totalGeralCustosEventos').textContent = formatMoney(totalGeral);
            document.getElementById('quantidadeEventosComCustos').textContent = `${eventosComCustos} evento${eventosComCustos !== 1 ? 's' : ''} com custos`;
            
            const valorSelect = document.getElementById('eventoSelecionado').value;
            
            // Se selecionou "todos", mostrar lista de todos os eventos com custos
            if (valorSelect === 'todos') {
                mostrarTodosEventosComCustos();
                return;
            }
            
            const eventoId = parseInt(valorSelect);
            
            if (!eventoId) {
                document.getElementById('custoEventoContent').style.display = 'none';
                document.getElementById('custoEventoEmpty').style.display = 'block';
                return;
            }
            
            currentEventoId = eventoId;
            const evento = DB.get('eventos').find(e => e.id === eventoId);
            const custos = DB.get('custosEventos').filter(c => c.eventoId === eventoId);
            
            document.getElementById('custoEventoContent').style.display = 'block';
            document.getElementById('custoEventoEmpty').style.display = 'none';
            
            // Update evento info
            document.getElementById('eventoNome').textContent = evento.nome;
            document.getElementById('eventoInfo').textContent = `${evento.cliente} • ${formatDate(evento.data)} • ${evento.local}`;
            
            // Calculate totals
            const totalCustos = custos.reduce((sum, c) => sum + c.valor, 0);
            const lucro = evento.valor - totalCustos;
            const margem = evento.valor > 0 ? ((lucro / evento.valor) * 100).toFixed(1) : 0;
            
            document.getElementById('eventoValorTotal').textContent = formatMoney(evento.valor);
            document.getElementById('eventoTotalCustos').textContent = formatMoney(totalCustos);
            document.getElementById('eventoLucro').textContent = formatMoney(lucro);
            document.getElementById('eventoLucro').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            document.getElementById('eventoMargem').textContent = margem + '%';
            document.getElementById('eventoMargem').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Render custos list
            const container = document.getElementById('custosEventoList');
            if (custos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum custo registrado para este evento.</p>';
                return;
            }
            
            const categoriaIcons = {
                'ajudantes': '👷',
                'equipamentos': '📦',
                'materiais': '🛠️',
                'transporte': '🚚',
                'alimentacao': '🍽️',
                'decoracao': '🎨',
                'terceiros': '🤝',
                'outros': '📌'
            };
            
            const html = custos.sort((a, b) => new Date(b.data) - new Date(a.data)).map(c => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon bg-danger">
                            ${categoriaIcons[c.categoria] || '💸'}
                        </div>
                        <div class="transaction-details">
                            <h4>${c.descricao}</h4>
                            <div class="transaction-date">${formatDate(c.data)} ${c.observacoes ? '• ' + c.observacoes : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="transaction-amount negative">${formatMoney(c.valor)}</div>
                        <button class="btn btn-small" onclick="deleteCustoEvento(${c.id})" style="padding: 6px 12px; background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Nova função para mostrar todos os eventos com custos
        function mostrarTodosEventosComCustos() {
            const eventos = DB.get('eventos');
            const custosEventos = DB.get('custosEventos');
            
            document.getElementById('custoEventoContent').style.display = 'none';
            document.getElementById('custoEventoEmpty').style.display = 'block';
            
            // Agrupar custos por evento
            const eventosPorId = {};
            custosEventos.forEach(custo => {
                if (!eventosPorId[custo.eventoId]) {
                    eventosPorId[custo.eventoId] = {
                        custos: [],
                        total: 0
                    };
                }
                eventosPorId[custo.eventoId].custos.push(custo);
                eventosPorId[custo.eventoId].total += custo.valor;
            });
            
            const html = Object.keys(eventosPorId).map(eventoId => {
                const evento = eventos.find(e => e.id === parseInt(eventoId));
                if (!evento) return '';
                
                const totalCustos = eventosPorId[eventoId].total;
                const lucro = evento.valor - totalCustos;
                const margem = evento.valor > 0 ? ((lucro / evento.valor) * 100).toFixed(1) : 0;
                
                return `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="padding: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <div>
                                    <h3 style="font-size: 18px; margin-bottom: 4px;">${evento.nome || evento.tipo}</h3>
                                    <div style="font-size: 13px; color: var(--text-secondary);">
                                        👤 ${evento.cliente} • 📅 ${formatDate(evento.data)}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; background: rgba(255, 255, 255, 0.02); padding: 16px; border-radius: 8px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--primary);">${formatMoney(evento.valor)}</div>
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Valor do Evento</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--danger);">${formatMoney(totalCustos)}</div>
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Total em Custos</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: ${lucro >= 0 ? 'var(--success)' : 'var(--danger)'};">${formatMoney(lucro)}</div>
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Lucro (${margem}%)</div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                                    ${eventosPorId[eventoId].custos.length} custo(s) registrado(s)
                                </div>
                                <button class="btn btn-secondary" onclick="document.getElementById('eventoSelecionado').value='${eventoId}'; renderCustosEvento();" style="font-size: 12px; padding: 8px 16px;">
                                    Ver Detalhes →
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('custoEventoEmpty').innerHTML = html || '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum evento com custos registrados.</p>';
        }

        // Render custos gerais
        function renderCustosGerais() {
            const custosGerais = DB.get('custosGerais');
            const container = document.getElementById('custosGeraisList');
            
            if (custosGerais.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum custo geral registrado.</p>';
                return;
            }
            
            const categoriaIcons = {
                'combustivel': '⛽',
                'impostos': '📋',
                'aluguel': '🏢',
                'manutencao': '🔧',
                'equipamentos': '📦',
                'marketing': '📢',
                'administrativo': '📊',
                'pessoal': '👥',
                'outros': '📌'
            };
            
            const html = custosGerais.sort((a, b) => new Date(b.data) - new Date(a.data)).map(c => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon bg-danger">
                            ${categoriaIcons[c.categoria] || '💸'}
                        </div>
                        <div class="transaction-details">
                            <h4>${c.descricao}</h4>
                            <div class="transaction-date">${formatDate(c.data)} ${c.observacoes ? '• ' + c.observacoes : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="transaction-amount negative">${formatMoney(c.valor)}</div>
                        <button class="btn btn-small" onclick="editCustoGeral(${c.id})" style="padding: 6px 12px; background: rgba(255, 193, 7, 0.2); color: #ffc107; border: 1px solid #ffc107;">
                            ✏️
                        </button>
                        <button class="btn btn-small" onclick="deleteCustoGeral(${c.id})" style="padding: 6px 12px; background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                            🗑️
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Update custos gerais stats
        function updateCustosGeraisStats() {
            const custosGerais = DB.get('custosGerais');
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            const custosMes = custosGerais.filter(c => {
                const data = new Date(c.data);
                return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
            });
            
            const total = custosMes.reduce((sum, c) => sum + c.valor, 0);
            const combustivel = custosMes.filter(c => c.categoria === 'combustivel').reduce((sum, c) => sum + c.valor, 0);
            const impostos = custosMes.filter(c => c.categoria === 'impostos').reduce((sum, c) => sum + c.valor, 0);
            const marketing = custosMes.filter(c => c.categoria === 'marketing').reduce((sum, c) => sum + c.valor, 0);
            const outros = total - combustivel - impostos - marketing;
            
            document.getElementById('totalCustosGeraisMes').textContent = formatMoney(total);
            document.getElementById('totalCombustivel').textContent = formatMoney(combustivel);
            document.getElementById('totalImpostos').textContent = formatMoney(impostos);
            document.getElementById('totalMarketing').textContent = formatMoney(marketing);
            document.getElementById('totalOutrosCustos').textContent = formatMoney(outros);
        }

        // ============================================
        // FILTROS DE PERÍODO PARA CUSTOS
        // ============================================
        
        function atualizarCustosPorPeriodo() {
            renderCustosGerais();
            renderCustosEvento();
            updateCustosGeraisStats();
        }
        
        function resetarFiltrosCustos() {
            const hoje = new Date();
            document.getElementById('filtroMesCustos').value = (hoje.getMonth() + 1).toString();
            document.getElementById('filtroAnoCustos').value = hoje.getFullYear().toString();
            document.getElementById('tipoVisualizacaoCustos').value = 'mensal';
            atualizarCustosPorPeriodo();
        }
        
        function preencherAnosCustos() {
            const selectAno = document.getElementById('filtroAnoCustos');
            const selectMes = document.getElementById('filtroMesCustos');
            const anoAtual = new Date().getFullYear();
            const mesAtual = new Date().getMonth() + 1;
            
            // Preencher anos
            selectAno.innerHTML = '';
            for (let ano = anoAtual; ano >= anoAtual - 5; ano--) {
                const option = document.createElement('option');
                option.value = ano;
                option.textContent = ano;
                if (ano === anoAtual) option.selected = true;
                selectAno.appendChild(option);
            }
            
            // Selecionar mês atual
            selectMes.value = mesAtual.toString();
        }

        // ============================================
        // FILTROS DE PERÍODO PARA SERVIÇOS
        // ============================================
        
        function atualizarServicosPorPeriodo() {
            renderServicosPerformance();
        }
        
        function resetarFiltrosServicos() {
            const hoje = new Date();
            document.getElementById('filtroMesServicos').value = (hoje.getMonth() + 1).toString();
            document.getElementById('filtroAnoServicos').value = hoje.getFullYear().toString();
            document.getElementById('tipoVisualizacaoServicos').value = 'mensal';
            atualizarServicosPorPeriodo();
        }
        
        function preencherAnosServicos() {
            const selectAno = document.getElementById('filtroAnoServicos');
            const selectMes = document.getElementById('filtroMesServicos');
            const anoAtual = new Date().getFullYear();
            const mesAtual = new Date().getMonth() + 1;
            
            // Preencher anos
            selectAno.innerHTML = '';
            for (let ano = anoAtual; ano >= anoAtual - 5; ano--) {
                const option = document.createElement('option');
                option.value = ano;
                option.textContent = ano;
                if (ano === anoAtual) option.selected = true;
                selectAno.appendChild(option);
            }
            
            // Selecionar mês atual
            selectMes.value = mesAtual.toString();
        }

        // Add custo geral
        function addCustoGeral(e) {
            e.preventDefault();
            
            // Verificar se está editando
            const form = e.target;
            const editingId = form.getAttribute('data-editing-id');
            const isEditing = !!editingId;
            
            const contaId = document.getElementById('custoGeralConta').value;
            const valor = parseFloat(document.getElementById('custoGeralValor').value);
            const descricao = document.getElementById('custoGeralDescricao').value;
            const categoria = document.getElementById('custoGeralCategoria').value;
            const data = document.getElementById('custoGeralData').value;
            const observacoes = document.getElementById('custoGeralObs').value;
            
            const custo = {
                descricao: descricao,
                categoria: categoria,
                valor: valor,
                data: data,
                observacoes: observacoes,
                contaId: contaId || null
            };
            
            if (isEditing) {
                // EDITANDO custo existente
                const custosGerais = DB.get('custosGerais');
                const index = custosGerais.findIndex(c => c.id == editingId);
                
                if (index !== -1) {
                    const custoAntigo = custosGerais[index];
                    custo.id = custoAntigo.id;
                    custosGerais[index] = custo;
                    DB.set('custosGerais', custosGerais);
                    
                    // Atualizar despesa correspondente se houver conta
                    const despesas = DB.get('despesas');
                    
                    // Se tinha conta antes, remover despesa antiga
                    if (custoAntigo.contaId) {
                        // Buscar pela ID do custo (mais confiável)
                        let despesaIndex = despesas.findIndex(d => d.custoGeralId === custoAntigo.id);
                        
                        // Se não encontrou pelo ID, buscar pela descrição (custos antigos)
                        if (despesaIndex === -1) {
                            const descricaoAntiga = `[Custo Geral] ${custoAntigo.descricao}`;
                            despesaIndex = despesas.findIndex(d => 
                                d.descricao === descricaoAntiga &&
                                d.tipoDespesa === 'custo_geral' &&
                                Math.abs(d.valor - custoAntigo.valor) < 0.01 &&
                                d.data === custoAntigo.data
                            );
                        }
                        
                        if (despesaIndex !== -1) {
                            despesas.splice(despesaIndex, 1);
                            // Restaurar saldo da conta antiga
                            atualizarSaldoConta(custoAntigo.contaId, custoAntigo.valor, 'credito');
                        }
                    }
                    
                    // Se tem conta nova, criar nova despesa
                    if (contaId && contaId !== '') {
                        const despesa = {
                            descricao: `[Custo Geral] ${descricao}`,
                            valor: valor,
                            data: data,
                            categoria: categoria,
                            contaId: contaId,
                            formaPagamento: 'transferencia',
                            observacoes: observacoes || 'Custo geral da empresa',
                            tipoDespesa: 'custo_geral',
                            custoGeralId: custo.id // Vincular à despesa
                        };
                        
                        despesas.push({ ...despesa, id: Date.now() });
                        
                        // Debitar da nova conta
                        atualizarSaldoConta(contaId, valor, 'debito');
                    }
                    
                    DB.set('despesas', despesas);
                    
                    alert('✅ Custo atualizado com sucesso!');
                    
                    // Limpar flag de edição
                    form.removeAttribute('data-editing-id');
                    
                    // Restaurar botão
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.textContent = '+ Adicionar Custo';
                    }
                }
            } else {
                // CRIANDO novo custo
                const novoCusto = DB.add('custosGerais', custo);
                
                // Se foi selecionada uma conta, criar uma despesa correspondente
                if (contaId && contaId !== '') {
                    const despesa = {
                        descricao: `[Custo Geral] ${descricao}`,
                        valor: valor,
                        data: data,
                        categoria: categoria,
                        contaId: contaId,
                        formaPagamento: 'transferencia',
                        observacoes: observacoes || 'Custo geral da empresa',
                        tipoDespesa: 'custo_geral',
                        custoGeralId: novoCusto.id // Vincular ao custo criado
                    };
                    
                    DB.add('despesas', despesa);
                    
                    // Atualizar saldo da conta
                    atualizarSaldoConta(contaId, valor, 'debito');
                }
                
                alert('✅ Custo geral adicionado com sucesso!');
            }
            
            closeModal('custoGeral');
            e.target.reset();
            renderCustosGerais();
            updateCustosGeraisStats();
            updateDashboard();
            
            // Atualizar financeiro se estiver visível
            if (document.getElementById('financeiroTab').classList.contains('active')) {
                renderFinanceiro();
                atualizarFinanceiroPorPeriodo();
            }
        }

        // Add custo evento
        function addCustoEvento(e) {
            e.preventDefault();
            const eventoId = parseInt(document.getElementById('custoEventoId').value);
            const contaId = document.getElementById('custoEventoConta').value;
            const valor = parseFloat(document.getElementById('custoEventoValor').value);
            const descricao = document.getElementById('custoEventoDescricao').value;
            const categoria = document.getElementById('custoEventoCategoria').value;
            const data = document.getElementById('custoEventoData').value;
            const observacoes = document.getElementById('custoEventoObs').value;
            
            // Buscar nome do evento
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === eventoId);
            const nomeEvento = evento ? evento.nome || evento.cliente : 'Evento';
            
            const custo = {
                eventoId: eventoId,
                descricao: descricao,
                categoria: categoria,
                valor: valor,
                data: data,
                observacoes: observacoes,
                contaId: contaId || null
            };
            
            DB.add('custosEventos', custo);
            
            // Se foi selecionada uma conta, criar uma despesa correspondente
            if (contaId && contaId !== '') {
                const despesa = {
                    descricao: `[Custo Evento: ${nomeEvento}] ${descricao}`,
                    valor: valor,
                    data: data,
                    categoria: categoria,
                    contaId: contaId,
                    formaPagamento: 'transferencia',
                    observacoes: observacoes || `Custo do evento ${nomeEvento}`,
                    tipoDespesa: 'custo_evento' // ✅ Flag para identificar tipo
                };
                
                DB.add('despesas', despesa);
                
                // Atualizar saldo da conta
                atualizarSaldoConta(contaId, valor, 'debito');
            }
            
            alert('✅ Custo do evento adicionado com sucesso!');
            closeModal('custoEvento');
            e.target.reset();
            renderCustosEvento();
            updateDashboard();
            
            // Atualizar financeiro se estiver visível
            if (document.getElementById('financeiroTab').classList.contains('active')) {
                renderFinanceiro();
                atualizarFinanceiroPorPeriodo();
            }
        }

        // Delete custo geral
        function editCustoGeral(id) {
            const custo = DB.get('custosGerais').find(c => c.id === id);
            if (!custo) return;
            
            // Preencher formulário
            document.getElementById('custoGeralDescricao').value = custo.descricao || '';
            document.getElementById('custoGeralCategoria').value = custo.categoria || '';
            document.getElementById('custoGeralValor').value = custo.valor || '';
            document.getElementById('custoGeralData').value = custo.data || '';
            document.getElementById('custoGeralObs').value = custo.observacoes || '';
            document.getElementById('custoGeralConta').value = custo.contaId || '';
            
            // Marcar formulário como editando
            const form = document.querySelector('#modalCustoGeral form');
            if (form) {
                form.setAttribute('data-editing-id', id);
            }
            
            // Mudar texto do botão
            const submitBtn = document.querySelector('#modalCustoGeral button[type="submit"]');
            if (submitBtn) {
                submitBtn.textContent = '💾 Salvar Alterações';
            }
            
            // Abrir modal
            openModal('custoGeral');
        }

        function deleteCustoGeral(id) {
            if (confirm('Deseja realmente excluir este custo?')) {
                const custosGerais = DB.get('custosGerais');
                const custo = custosGerais.find(c => c.id === id);
                
                if (custo) {
                    // Se tinha conta, remover despesa correspondente e restaurar saldo
                    if (custo.contaId) {
                        // Remover despesa correspondente
                        const despesas = DB.get('despesas');
                        const despesaIndex = despesas.findIndex(d => 
                            d.descricao.includes('[Custo Geral]') && 
                            d.valor === custo.valor && 
                            d.data === custo.data &&
                            d.contaId === custo.contaId
                        );
                        
                        if (despesaIndex !== -1) {
                            despesas.splice(despesaIndex, 1);
                            DB.set('despesas', despesas);
                        }
                        
                        // Restaurar saldo da conta
                        atualizarSaldoConta(custo.contaId, custo.valor, 'credito');
                    }
                    
                    // Remover custo
                    const novoscustos = custosGerais.filter(c => c.id !== id);
                    DB.set('custosGerais', novoscustos);
                }
                
                renderCustosGerais();
                updateCustosGeraisStats();
                updateDashboard();
                
                // Atualizar financeiro se estiver visível
                if (document.getElementById('financeiroTab').classList.contains('active')) {
                    renderFinanceiro();
                    atualizarFinanceiroPorPeriodo();
                }
            }
        }

        // Delete custo evento
        function deleteCustoEvento(id) {
            if (confirm('Deseja realmente excluir este custo?')) {
                const custosEventos = DB.get('custosEventos');
                const custo = custosEventos.find(c => c.id === id);
                
                if (custo) {
                    // Se tinha conta, remover despesa correspondente e restaurar saldo
                    if (custo.contaId) {
                        // Remover despesa correspondente
                        const despesas = DB.get('despesas');
                        const despesaIndex = despesas.findIndex(d => 
                            d.descricao.includes('[Custo Evento:') && 
                            d.valor === custo.valor && 
                            d.data === custo.data &&
                            d.contaId === custo.contaId
                        );
                        
                        if (despesaIndex !== -1) {
                            despesas.splice(despesaIndex, 1);
                            DB.set('despesas', despesas);
                        }
                        
                        // Restaurar saldo da conta
                        atualizarSaldoConta(custo.contaId, custo.valor, 'credito');
                    }
                    
                    // Remover custo
                    const novoscustos = custosEventos.filter(c => c.id !== id);
                    DB.set('custosEventos', novoscustos);
                }
                
                renderCustosEvento();
                updateDashboard();
                
                // Atualizar financeiro se estiver visível
                if (document.getElementById('financeiroTab').classList.contains('active')) {
                    renderFinanceiro();
                    atualizarFinanceiroPorPeriodo();
                }
            }
        }

        // Open modal custo evento
        function openModalCustoEvento() {
            const evento = DB.get('eventos').find(e => e.id === currentEventoId);
            if (!evento) return;
            
            document.getElementById('custoEventoNome').textContent = `🎉 ${evento.nome}`;
            document.getElementById('custoEventoId').value = currentEventoId;
            openModal('custoEvento');
        }

        // Open custos do evento direto (atalho da aba eventos)
        function openCustosEventoDireto(eventoId) {
            // ✅ Abrir DIRETAMENTE o modal de adicionar custo
            currentEventoId = eventoId;
            
            // Preencher o evento no modal
            document.getElementById('custoEventoId').value = eventoId;
            
            // Abrir o modal
            openModal('custoEvento');
        }

        // Tab switching
        // ============================================
        // MENU MOBILE
        // ============================================
        
        function toggleMobileMenu() {
            console.log('🍔 Toggle menu mobile chamado');
            const menu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('mobileMenuOverlay');
            
            if (!menu || !overlay) {
                console.error('❌ Elementos do menu não encontrados!');
                return;
            }
            
            menu.classList.toggle('active');
            overlay.classList.toggle('active');
            
            console.log('📱 Menu active:', menu.classList.contains('active'));
            
            // Prevenir scroll do body quando menu aberto
            if (menu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
        
        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const overlay = document.getElementById('mobileMenuOverlay');
            menu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function switchTabMobile(tabName) {
            switchTab(tabName);
            closeMobileMenu();
        }
        
        // Sincronizar indicadores mobile e desktop
        function atualizarStatusSync(status, texto) {
            const indicators = [
                document.getElementById('syncIndicator'),
                document.getElementById('syncIndicatorMobile')
            ];
            const textElements = [
                document.getElementById('syncText'),
                document.getElementById('syncTextMobile')
            ];
            
            indicators.forEach(indicator => {
                if (!indicator) return;
                
                switch(status) {
                    case 'online':
                        indicator.style.background = 'var(--success)';
                        indicator.style.boxShadow = '0 0 8px var(--success)';
                        break;
                    case 'syncing':
                        indicator.style.background = 'var(--accent)';
                        indicator.style.boxShadow = '0 0 8px var(--accent)';
                        break;
                    case 'error':
                        indicator.style.background = 'var(--danger)';
                        indicator.style.boxShadow = '0 0 8px var(--danger)';
                        break;
                    default: // offline
                        indicator.style.background = '#666';
                        indicator.style.boxShadow = 'none';
                }
            });
            
            textElements.forEach(textElement => {
                if (!textElement) return;
                textElement.textContent = texto || 'Offline';
                
                switch(status) {
                    case 'online':
                        textElement.style.color = 'var(--success)';
                        break;
                    case 'syncing':
                        textElement.style.color = 'var(--accent)';
                        break;
                    case 'error':
                        textElement.style.color = 'var(--danger)';
                        break;
                    default:
                        textElement.style.color = 'var(--text-secondary)';
                }
            });
        }
        
        // ============================================
        // TABS
        // ============================================
        
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Se chamado programaticamente, encontrar o botão correto
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(tabName)) {
                        tab.classList.add('active');
                    }
                });
            }
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Atualizar dashboard sempre para dados mais recentes
            if (tabName === 'dashboard') {
                updateDashboard();
            }
            
            // Load tab-specific content
            if (tabName === 'eventos') {
                renderEventsList();
                renderKanbanView();
            } else if (tabName === 'clientes') {
                renderClientsList();
                updateClientsStats();
                checkBirthdays();
                updateOrigemStats();
            } else if (tabName === 'custos') {
                preencherAnosCustos();
                toggleCustosView('gerais');
            } else if (tabName === 'financeiro') {
                mostrarFinanceiroVisaoGeral();
            } else if (tabName === 'servicos') {
                preencherAnosServicos();
                renderServicosPerformance();
                renderServicos();
            } else if (tabName === 'configuracoes') {
                carregarConfigEmpresa();
            } else if (tabName === 'pessoal') {
                renderReceitasPessoais();
                renderDespesasPessoais();
                renderContasPessoais();
                renderDespesasPorCategoria();
                updateStatsPessoal();
                renderContasPagar();
                updateResumoContasPagar();
            }
        }

        // Events page variables
        let currentView = 'list';
        let currentFilter = 'andamento';
        let currentMonth = new Date();

        // Switch event view
        function switchEventView(view) {
            currentView = view;
            
            // Update buttons
            document.querySelectorAll('.view-toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Toggle views
            document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
            document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
            document.getElementById('kanbanView').style.display = view === 'kanban' ? 'block' : 'none';
            
            // Render appropriate view
            if (view === 'calendar') renderCalendar();
            if (view === 'kanban') renderKanbanView();
        }

        // Filter events
        function filterEvents(status) {
            currentFilter = status;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Re-render current view
            if (currentView === 'list') renderEventsList();
            if (currentView === 'kanban') renderKanbanView();
        }

        // Render events list
        // Ir para aba de clientes e filtrar por nome
        function irParaCliente(nomeCliente) {
            // Mudar para aba de clientes
            switchTab('clientes');
            
            // Aguardar tab carregar
            setTimeout(() => {
                // Filtrar por nome do cliente
                const searchInput = document.getElementById('clientSearch');
                if (searchInput) {
                    searchInput.value = nomeCliente;
                    renderClientsList(nomeCliente);
                }
            }, 100);
        }
        
        // Ir para aba de eventos e abrir evento específico
        function irParaEvento(eventoId) {
            // Mudar para aba de eventos
            switchTab('eventos');
            
            // Aguardar tab carregar e destacar evento
            setTimeout(() => {
                const evento = DB.get('eventos').find(e => e.id === eventoId);
                if (evento) {
                    // Filtrar para mostrar o evento
                    currentFilter = evento.status || 'todos';
                    renderEventsList();
                    
                    // Scroll até o card do evento
                    const cards = document.querySelectorAll('.event-card-full');
                    cards.forEach(card => {
                        if (card.textContent.includes(evento.cliente)) {
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            // Highlight temporário
                            card.style.background = 'rgba(255, 107, 53, 0.2)';
                            setTimeout(() => {
                                card.style.background = '';
                            }, 2000);
                        }
                    });
                }
            }, 100);
        }
        
        function renderEventsList() {
            const eventos = DB.get('eventos');
            const container = document.getElementById('eventsListFull');
            
            const filteredEvents = currentFilter === 'todos' 
                ? eventos 
                : eventos.filter(e => e.status === currentFilter);
            
            if (filteredEvents.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">📅</div>
                        <h3 style="color: var(--text-secondary); margin-bottom: 8px;">Nenhum evento encontrado</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            ${currentFilter === 'todos' ? 'Comece adicionando seu primeiro evento' : 'Não há eventos com este status'}
                        </p>
                    </div>
                `;
                return;
            }
            
            const html = filteredEvents
                .sort((a, b) => new Date(a.data) - new Date(b.data))
                .map(e => {
                    // Verificar se tem custos cadastrados
                    const custosEvento = DB.get('custosEventos').filter(c => c.eventoId === e.id);
                    const totalCustos = custosEvento.reduce((sum, c) => sum + c.valor, 0);
                    const temCustos = custosEvento.length > 0;
                    
                    // Mapear status para cores e textos
                    const statusMap = {
                        'aguardando': { class: 'status-pending', text: 'AGUARDANDO', emoji: '⏳' },
                        'andamento': { class: 'status-confirmed', text: 'EM ANDAMENTO', emoji: '🔄' },
                        'concluido': { class: 'status-success', text: 'CONCLUÍDO', emoji: '✅' },
                        'cancelado': { class: 'status-canceled', text: 'CANCELADO', emoji: '❌' },
                        // Compatibilidade com status antigos
                        'pendente': { class: 'status-pending', text: 'AGUARDANDO', emoji: '⏳' },
                        'confirmado': { class: 'status-confirmed', text: 'EM ANDAMENTO', emoji: '🔄' }
                    };
                    
                    const statusInfo = statusMap[e.status] || statusMap['aguardando'];
                    
                    // Determinar texto do botão de ação
                    let botaoAcao = '🔄 Reabrir';
                    if (e.status === 'aguardando' || e.status === 'pendente') {
                        botaoAcao = '🔄 Iniciar';
                    } else if (e.status === 'andamento' || e.status === 'confirmado') {
                        botaoAcao = '✅ Concluir';
                    }
                    
                    return `
                    <div class="event-card-full status-${e.status}">
                        <div class="event-card-main">
                            <div class="event-card-info">
                                <h3>${e.tipo || e.nome}</h3>
                                <div class="event-card-client" onclick="event.stopPropagation(); irParaCliente('${e.cliente.replace(/'/g, "\\'")}');" style="cursor: pointer; text-decoration: underline;">
                                    👤 ${e.cliente}
                                </div>
                                
                                <!-- LINHA 1: Data, Horários e Duração -->
                                <div style="display: flex; gap: 16px; flex-wrap: wrap; margin: 8px 0; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        📅 <strong>${formatDate(e.data)}</strong>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        🕐 <strong>${e.horaInicio || e.horario}</strong> - <strong>${e.horaFim || '...'}</strong>
                                    </div>
                                    ${e.duracao ? `
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            ⏱️ <strong>${e.duracao}</strong>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <!-- LINHA 2: Endereço -->
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        📍 <strong>${e.local}</strong>
                                    </div>
                                </div>
                                
                                <!-- LINHA 3: Valores -->
                                <div style="display: flex; gap: 16px; flex-wrap: wrap; margin: 8px 0; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        💰 <strong>${formatMoney(e.valor)}</strong>
                                    </div>
                                    ${temCustos ? `
                                        <div style="display: flex; align-items: center; gap: 6px; color: var(--danger);">
                                            💸 <strong>${formatMoney(totalCustos)}</strong> em custos
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 6px; color: var(--success);">
                                            📊 Lucro: <strong>${formatMoney(e.valor - totalCustos)}</strong>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="event-status ${statusInfo.class}">
                                ${statusInfo.emoji} ${statusInfo.text}
                            </div>
                        </div>
                        ${e.observacoes ? `
                            <div class="event-observations">
                                <div class="event-observations-text">
                                    📋 ${e.observacoes.replace(/\n/g, '<br>')}
                                </div>
                            </div>
                        ` : ''}
                        <div class="event-card-actions">
                            <button class="event-action-btn" onclick="editEvent(${e.id})">✏️ Editar</button>
                            <button class="event-action-btn ${temCustos ? 'style="background: rgba(255, 107, 53, 0.2); border-color: var(--primary); color: var(--primary);"' : ''}" onclick="openCustosEventoDireto(${e.id})">
                                💰 Custos ${temCustos ? `(${custosEvento.length})` : ''}
                            </button>
                            <button class="event-action-btn" onclick="toggleEventStatus(${e.id})">
                                ${botaoAcao}
                            </button>
                            <button class="event-action-btn" onclick="deleteEvent(${e.id})">🗑️ Excluir</button>
                        </div>
                    </div>
                `}).join('');
            
            container.innerHTML = html;
        }

        // Render kanban view
        function renderKanbanView() {
            const eventos = DB.get('eventos');
            
            const statusMap = {
                'aguardando': { label: 'Pendente', id: 'Pendente' },
                'andamento': { label: 'Confirmado', id: 'Confirmado' },
                'cancelado': { label: 'Cancelado', id: 'Cancelado' }
            };
            
            ['aguardando', 'andamento', 'cancelado'].forEach(status => {
                const statusInfo = statusMap[status];
                const statusEvents = eventos.filter(e => e.status === status);
                const container = document.getElementById('kanban' + statusInfo.id);
                const countEl = document.getElementById('kanban' + statusInfo.id + 'Count');
                
                if (countEl) countEl.textContent = statusEvents.length;
                
                if (!container) return;
                
                if (statusEvents.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum evento</div>';
                    return;
                }
                
                const html = statusEvents
                    .sort((a, b) => new Date(a.data) - new Date(b.data))
                    .map(e => `
                        <div class="kanban-card">
                            <div class="kanban-card-title">${e.nome}</div>
                            <div class="kanban-card-info">👤 ${e.cliente}</div>
                            <div class="kanban-card-info">📅 ${formatDate(e.data)} • ${e.horario}</div>
                            <div class="kanban-card-info">📍 ${e.local}</div>
                            <div class="kanban-card-info" style="color: var(--success); font-weight: 600; margin-top: 8px;">
                                💰 ${formatMoney(e.valor)}
                            </div>
                            <div style="display: flex; gap: 6px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                <button class="event-action-btn" onclick="event.stopPropagation(); openCustosEventoDireto(${e.id})" style="flex: 1; font-size: 11px; padding: 6px 10px;">
                                    💰 Custos
                                </button>
                                <button class="event-action-btn" onclick="event.stopPropagation(); viewEventDetails(${e.id})" style="flex: 1; font-size: 11px; padding: 6px 10px;">
                                    👁️ Ver
                                </button>
                            </div>
                        </div>
                    `).join('');
                
                container.innerHTML = html;
            });
        }

        // Render calendar
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            // Update month title
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                              'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            
            const eventos = DB.get('eventos');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            // Day headers
            ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // Previous month days
            const prevMonthDays = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${prevMonthDays - i}</div></div>`;
            }
            
            // Current month days
            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(year, month, day);
                date.setHours(0, 0, 0, 0);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayEvents = eventos.filter(e => e.data === dateStr);
                const isToday = date.getTime() === today.getTime();
                const hasEvent = dayEvents.length > 0;
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (hasEvent) classes += ' has-event';
                
                html += `
                    <div class="${classes}" onclick="viewDayEvents('${dateStr}')">
                        <div class="calendar-day-number">${day}</div>
                        ${hasEvent ? `<div class="calendar-day-events">${dayEvents.length} evento${dayEvents.length > 1 ? 's' : ''}</div>` : ''}
                    </div>
                `;
            }
            
            // Next month days
            const remainingDays = 42 - (startDay + totalDays);
            for (let day = 1; day <= remainingDays; day++) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        // Calendar navigation
        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function todayMonth() {
            currentMonth = new Date();
            renderCalendar();
        }

        // Event actions
        function changeEventStatus(id, newStatus) {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                evento.status = newStatus;
                DB.set('eventos', eventos);
                renderEventsList();
                renderKanbanView();
                updateDashboard();
            }
        }

        // Toggle status do evento (aguardando → andamento → concluido)
        function toggleEventStatus(id) {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === id);
            
            if (!evento) return;
            
            // Ciclo de status: aguardando → andamento → concluído → aguardando
            if (evento.status === 'aguardando') {
                evento.status = 'andamento';
            } else if (evento.status === 'andamento') {
                evento.status = 'concluido';
            } else if (evento.status === 'concluido') {
                evento.status = 'aguardando';
            } else {
                // Se tiver status antigo/inválido, corrigir para aguardando
                evento.status = 'aguardando';
            }
            
            DB.set('eventos', eventos);
            renderEventsList();
            renderKanbanView();
            updateDashboard();
        }

        // Editar evento
        function editEvent(id) {
            const evento = DB.get('eventos').find(e => e.id === id);
            if (!evento) return;
            
            // Buscar cliente relacionado
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.nome === evento.cliente || c.id === evento.clienteId);
            
            // Abrir modal de orçamento completo
            openModal('orcamento');
            
            setTimeout(() => {
                // Preencher dados do cliente
                if (document.getElementById('orcCliente')) {
                    if (cliente) {
                        document.getElementById('orcCliente').value = cliente.nome || '';
                    } else {
                        document.getElementById('orcCliente').value = evento.cliente || '';
                    }
                }
                
                // Preencher dados do evento
                if (document.getElementById('orcTipoEvento')) {
                    document.getElementById('orcTipoEvento').value = evento.tipo || '';
                }
                if (document.getElementById('orcData')) {
                    document.getElementById('orcData').value = evento.data || '';
                }
                if (document.getElementById('orcHoraInicio')) {
                    document.getElementById('orcHoraInicio').value = evento.horaInicio || '';
                }
                if (document.getElementById('orcHoraFim')) {
                    document.getElementById('orcHoraFim').value = evento.horaFim || '';
                }
                
                // Calcular duração
                if (evento.horaInicio && evento.horaFim) {
                    calcularDuracaoOrcamento();
                }
                
                // Preencher endereço do evento
                if (document.getElementById('orcCep')) {
                    document.getElementById('orcCep').value = evento.cep || '';
                }
                if (document.getElementById('orcRua')) {
                    document.getElementById('orcRua').value = evento.rua || '';
                }
                if (document.getElementById('orcNumero')) {
                    document.getElementById('orcNumero').value = evento.numero || '';
                }
                if (document.getElementById('orcComplemento')) {
                    document.getElementById('orcComplemento').value = evento.complemento || '';
                }
                if (document.getElementById('orcBairro')) {
                    document.getElementById('orcBairro').value = evento.bairro || '';
                }
                if (document.getElementById('orcCidade')) {
                    document.getElementById('orcCidade').value = evento.cidade || '';
                }
                if (document.getElementById('orcEstado')) {
                    document.getElementById('orcEstado').value = evento.estado || '';
                }
                
                // Limpar serviços e taxas anteriores
                servicosSelecionados = [];
                outrasTaxas = [];
                
                // Extrair e preencher serviços das observações
                if (evento.observacoes) {
                    const servicosMatch = evento.observacoes.match(/Serviços:\n([\s\S]*?)(?:\n\nOutras Taxas:|\n\nObservações:|$)/);
                    if (servicosMatch && servicosMatch[1]) {
                        const servicosTexto = servicosMatch[1].trim();
                        const servicosLinhas = servicosTexto.split('\n').filter(l => l.trim().startsWith('•'));
                        
                        servicosLinhas.forEach(linha => {
                            const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                            if (match) {
                                const nome = match[1].trim();
                                const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                                const valor = parseFloat(valorStr);
                                
                                servicosSelecionados.push({
                                    id: 'servico_' + Date.now() + Math.random(),
                                    nome: nome,
                                    valor: valor
                                });
                            }
                        });
                        
                        // Marcar checkboxes dos serviços
                        const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]');
                        checkboxes.forEach(cb => {
                            const nomeServico = cb.dataset.nome;
                            const servicoSelecionado = servicosSelecionados.find(s => s.nome === nomeServico);
                            if (servicoSelecionado) {
                                cb.checked = true;
                            }
                        });
                        
                        atualizarListaServicos();
                    }
                    
                    // Extrair e preencher outras taxas
                    const taxasMatch = evento.observacoes.match(/Outras Taxas:\n([\s\S]*?)(?:\n\nObservações:|$)/);
                    if (taxasMatch && taxasMatch[1]) {
                        const taxasTexto = taxasMatch[1].trim();
                        const taxasLinhas = taxasTexto.split('\n').filter(l => l.trim().startsWith('•'));
                        
                        taxasLinhas.forEach(linha => {
                            const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                            if (match) {
                                const descricao = match[1].trim();
                                const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                                const valor = parseFloat(valorStr);
                                
                                outrasTaxas.push({
                                    id: 'taxa_' + Date.now() + Math.random(),
                                    descricao: descricao,
                                    valor: valor
                                });
                            }
                        });
                        
                        atualizarListaTaxas();
                    }
                }
                
                // Marcar que estamos editando um evento
                const form = document.getElementById('orcamentoForm');
                if (form) {
                    form.setAttribute('data-editing-event-id', id);
                    if (cliente) {
                        form.setAttribute('data-cliente-id', cliente.id);
                    }
                }
                
                // Mudar texto do botão para "Salvar Alterações"
                const btnSubmit = document.getElementById('btnSubmitOrcamento');
                if (btnSubmit) {
                    btnSubmit.innerHTML = '💾 Salvar Alterações do Evento';
                }
                
                // Atualizar resumo financeiro (chamar duas vezes para garantir)
                setTimeout(() => {
                    atualizarTotalOrcamento();
                    // Atualizar campo de valor total também
                    const totalServicos = servicosSelecionados.reduce((sum, s) => sum + s.valor, 0);
                    const totalTaxas = outrasTaxas.reduce((sum, t) => sum + t.valor, 0);
                    const total = totalServicos + totalTaxas;
                    const valorTotalInput = document.getElementById('orcValorTotal');
                    if (valorTotalInput) {
                        valorTotalInput.value = total.toFixed(2);
                    }
                }, 100);
                
                console.log('✓ Modal de edição aberto para evento:', evento.tipo, 'Cliente:', evento.cliente);
            }, 200);
        }

        // Salvar edição do evento
        function salvarEdicaoEvento() {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === window.eventoEditandoId);
            
            if (!evento) return;
            
            // Montar endereço completo
            const cep = document.getElementById('eventoCep').value;
            const rua = document.getElementById('eventoRua').value;
            const numero = document.getElementById('eventoNumero').value;
            const complemento = document.getElementById('eventoComplemento').value;
            const bairro = document.getElementById('eventoBairro').value;
            const cidade = document.getElementById('eventoCidade').value;
            const estado = document.getElementById('eventoEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento + '\n';
                if (bairro) enderecoCompleto += bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            // Atualizar dados do evento
            evento.tipo = document.getElementById('eventoTipo').value;
            evento.nome = document.getElementById('eventoTipo').value;
            evento.cliente = document.getElementById('eventoCliente').value;
            evento.data = document.getElementById('eventoData').value;
            evento.horaInicio = document.getElementById('eventoHoraInicio').value;
            evento.horaFim = document.getElementById('eventoHoraFim').value;
            evento.duracao = document.getElementById('eventoDuracao').value;
            evento.horario = document.getElementById('eventoHoraInicio').value;
            evento.local = enderecoCompleto;
            evento.cep = cep;
            evento.rua = rua;
            evento.numero = numero;
            evento.complemento = complemento;
            evento.bairro = bairro;
            evento.cidade = cidade;
            evento.estado = estado;
            evento.valor = parseFloat(document.getElementById('eventoValor').value);
            evento.status = document.getElementById('eventoStatus').value;
            evento.observacoes = document.getElementById('eventoObservacoes').value;
            
            DB.set('eventos', eventos);
            
            // Resetar modal
            window.eventoEditandoId = null;
            document.querySelector('#modalEvento .modal-title').textContent = 'Novo Evento';
            const submitBtn = document.querySelector('#modalEvento button[type="submit"]');
            submitBtn.textContent = 'Cadastrar Evento';
            submitBtn.onclick = null;
            
            // Limpar formulário e fechar
            document.querySelector('#modalEvento form').reset();
            limparCamposEnderecoEvento();
            closeModal('evento');
            
            // Atualizar interface
            renderEventsList();
            renderKanbanView();
            updateDashboard();
            
            alert('✅ Evento atualizado com sucesso!');
        }

        function deleteEvent(id) {
            if (confirm('Deseja realmente excluir este evento?')) {
                const eventos = DB.get('eventos').filter(e => e.id !== id);
                DB.set('eventos', eventos);
                renderEventsList();
                renderKanbanView();
                updateDashboard();
            }
        }

        function viewEventDetails(id) {
            const evento = DB.get('eventos').find(e => e.id === id);
            if (evento) {
                alert(`Detalhes do Evento:\n\n${evento.nome}\nCliente: ${evento.cliente}\nData: ${formatDate(evento.data)}\nHorário: ${evento.horario}\nLocal: ${evento.local}\nValor: ${formatMoney(evento.valor)}\nStatus: ${evento.status.toUpperCase()}`);
            }
        }

        function viewDayEvents(date) {
            const eventos = DB.get('eventos').filter(e => e.data === date);
            if (eventos.length > 0) {
                const list = eventos.map(e => `• ${e.nome} - ${e.horario} (${e.cliente})`).join('\n');
                alert(`Eventos em ${formatDate(date)}:\n\n${list}`);
            }
        }

        // Clients Page Functions
        let currentClientSearch = '';

        // Render clients list
        function renderClientsList(searchTerm = '') {
            const clientes = DB.get('clientes');
            const container = document.getElementById('clientsList');
            
            // Migrar clientes antigos sem financeiro
            let needsUpdate = false;
            clientes.forEach(c => {
                if (!c.financeiro) {
                    c.financeiro = {
                        valorTotal: 0,
                        sinalValor: 0,
                        sinalData: '',
                        valorPagar: 0,
                        vencimento: ''
                    };
                    needsUpdate = true;
                }
            });
            if (needsUpdate) {
                DB.set('clientes', clientes);
            }
            
            let filteredClients = clientes;
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredClients = clientes.filter(c => 
                    c.nome.toLowerCase().includes(term) ||
                    c.email.toLowerCase().includes(term) ||
                    c.telefone.toLowerCase().includes(term)
                );
            }
            
            if (filteredClients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <h3 class="empty-state-title">${searchTerm ? 'Nenhum cliente encontrado' : 'Nenhum cliente cadastrado'}</h3>
                        <p class="empty-state-text">
                            ${searchTerm ? 'Tente outro termo de busca' : 'Comece adicionando seu primeiro cliente'}
                        </p>
                        ${!searchTerm ? '<button class="btn btn-primary" onclick="openModal(\'cliente\')">+ Adicionar Cliente</button>' : ''}
                    </div>
                `;
                return;
            }
            
            const html = filteredClients.map(c => {
                const initials = c.nome.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const hoje = new Date();
                const aniversario = c.aniversario ? new Date(c.aniversario + 'T00:00:00') : null;
                const isBirthdayMonth = aniversario && aniversario.getMonth() === hoje.getMonth();
                
                // Buscar evento do cliente
                const eventos = DB.get('eventos');
                const eventoCliente = eventos.find(e => e.cliente === c.nome);
                
                const origemLabels = {
                    'facebook': '📘 Facebook',
                    'instagram': '📸 Instagram',
                    'google': '🔍 Google',
                    'indicacao': '👥 Indicação',
                    'outros': '📌 Outros'
                };
                
                // Informações financeiras
                let financialSection = '';
                if (c.financeiro && c.financeiro.valorTotal > 0) {
                    // Calcular total de pagamentos adicionais
                    const totalPagamentosAdicionais = c.financeiro.pagamentosAdicionais ? 
                        c.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0) : 0;
                    
                    const totalPago = c.financeiro.sinalValor + totalPagamentosAdicionais;
                    const percentPaid = (totalPago / c.financeiro.valorTotal) * 100;
                    const isPaid = c.financeiro.valorPagar <= 0;
                    const isOverdue = c.financeiro.vencimento && new Date(c.financeiro.vencimento + 'T00:00:00') < hoje && !isPaid;
                    
                    let statusClass = 'status-pending';
                    let statusText = 'Pendente';
                    if (isPaid) {
                        statusClass = 'status-paid';
                        statusText = 'Pago';
                    } else if (isOverdue) {
                        statusClass = 'status-overdue';
                        statusText = 'Vencido';
                    }
                    
                    financialSection = `
                        <div class="client-financial" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})" style="cursor: pointer;">
                            <div class="financial-header">
                                <span class="financial-title">💰 Financeiro</span>
                                <span class="financial-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="financial-grid">
                                <div class="financial-item">
                                    <div class="financial-label">Valor Total</div>
                                    <div class="financial-value total">${formatMoney(c.financeiro.valorTotal)}</div>
                                </div>
                                <div class="financial-item">
                                    <div class="financial-label">Total Pago</div>
                                    <div class="financial-value paid">${formatMoney(totalPago)}</div>
                                    ${c.financeiro.sinalData ? `<div class="financial-date">Sinal: ${formatDate(c.financeiro.sinalData)}</div>` : ''}
                                </div>
                                <div class="financial-item">
                                    <div class="financial-label">Saldo Devedor</div>
                                    <div class="financial-value pending">${formatMoney(c.financeiro.valorPagar)}</div>
                                    ${c.financeiro.vencimento ? `<div class="financial-date">Venc: ${formatDate(c.financeiro.vencimento)}</div>` : ''}
                                </div>
                            </div>
                            <div class="payment-progress">
                                <div class="progress-label">
                                    <span>Progresso do Pagamento</span>
                                    <span>${percentPaid.toFixed(0)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentPaid}%;"></div>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 12px;">
                                👆 Clique para editar informações financeiras
                            </div>
                        </div>
                    `;
                } else {
                    // Mostrar card para adicionar financeiro
                    financialSection = `
                        <div class="client-financial" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})" style="cursor: pointer; border: 2px dashed var(--border); background: rgba(255, 255, 255, 0.01);">
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.5;">💰</div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">Nenhuma informação financeira</div>
                                <div style="font-size: 13px; color: var(--primary); font-weight: 600;">
                                    👆 Clique para adicionar dados financeiros
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="client-card" onclick="viewClientDetails(${c.id})">
                        <div class="client-card-header">
                            <div class="client-main-info">
                                <div class="client-avatar">${initials}</div>
                                <div class="client-details-main">
                                    <h3>${c.nome}</h3>
                                    ${eventoCliente ? `
                                        <div onclick="event.stopPropagation(); irParaEvento(${eventoCliente.id});" style="font-size: 13px; color: var(--primary); margin-top: 4px; cursor: pointer; text-decoration: underline;">
                                            🎉 ${eventoCliente.tipo || eventoCliente.nome}
                                        </div>
                                    ` : ''}
                                    <div class="client-email">📧 ${c.email || 'Não informado'}</div>
                                    <div class="client-phone">📱 ${c.telefone}</div>
                                </div>
                            </div>
                            <div class="client-badges">
                                ${isBirthdayMonth ? '<span class="client-badge badge-birthday">🎂 Aniversário Este Mês</span>' : ''}
                                ${c.origem ? `<span class="client-badge badge-origem">${origemLabels[c.origem] || c.origem}</span>` : ''}
                            </div>
                        </div>
                        
                        ${financialSection}
                        
                        <div class="client-info-grid">
                            ${c.aniversario ? `
                                <div class="client-info-item">
                                    🎂 <strong>${formatDate(c.aniversario)}</strong>
                                </div>
                            ` : ''}
                            ${c.cpf ? `
                                <div class="client-info-item">
                                    📄 <strong>${c.cpf}</strong>
                                </div>
                            ` : ''}
                            ${c.endereco ? `
                                <div class="client-info-item">
                                    📍 <strong>${c.endereco}</strong>
                                </div>
                            ` : ''}
                            ${c.origem === 'indicacao' && c.indicacao ? `
                                <div class="client-info-item">
                                    🤝 Indicado por <strong>${c.indicacao}</strong>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${c.observacoes ? `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 13px;">
                                📝 ${c.observacoes}
                            </div>
                        ` : ''}
                        
                        <div class="client-actions">
                            <button class="client-action-btn" onclick="event.stopPropagation(); editClient('${c.id}')">✏️ Editar</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); abrirModalDocumentos(${c.id})">📄 Gerar Documento</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})">💰 Financeiro</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); createEventForClient(${c.id})">🎉 Novo Evento</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); sendMessage(${c.id})">💬 Mensagem</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); deleteClient(${c.id})">🗑️ Excluir</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Update clients stats
        function updateClientsStats() {
            const clientes = DB.get('clientes');
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            
            // Total de clientes
            document.getElementById('totalClientes').textContent = clientes.length;
            
            // Aniversariantes este mês
            const aniversariantesMes = clientes.filter(c => {
                if (!c.aniversario) return false;
                const aniv = new Date(c.aniversario + 'T00:00:00');
                return aniv.getMonth() === mesAtual;
            }).length;
            document.getElementById('aniversariantesProximos').textContent = aniversariantesMes;
            
            // Clientes via Instagram
            const instagram = clientes.filter(c => c.origem === 'instagram').length;
            document.getElementById('clientesInstagram').textContent = instagram;
            
            // Clientes via Facebook
            const facebook = clientes.filter(c => c.origem === 'facebook').length;
            document.getElementById('clientesFacebook').textContent = facebook;
        }

        // Search clients
        function searchClients() {
            const searchTerm = document.getElementById('clientSearch').value;
            currentClientSearch = searchTerm;
            renderClientsList(searchTerm);
        }

        // Client actions
        // ========================================
        // FUNÇÕES DE DOCUMENTOS
        // ========================================
        
        function abrirModalDocumentos(clienteId) {
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            if (!cliente) return;
            
            document.getElementById('documentosClienteId').value = clienteId;
            document.getElementById('documentosClienteNome').textContent = cliente.nome;
            
            // Mostrar botão de compartilhar se houver documento gerado
            const btnCompartilhar = document.getElementById('compartilharDocArea');
            if (btnCompartilhar) {
                btnCompartilhar.style.display = window.ultimoPDFGerado ? 'block' : 'none';
            }
            
            openModal('documentos');
        }
        
        
        // Variável global para armazenar o PDF gerado
        let pdfBlobGlobal = null;
        let pdfNomeGlobal = '';
        
        window.mostrarModalCompartilhar = function(blob, nomeArquivo) {
            pdfBlobGlobal = blob;
            pdfNomeGlobal = nomeArquivo;
            
            // Mostrar botão de compartilhar
            const btnCompartilhar = document.getElementById('compartilharDocArea');
            if (btnCompartilhar) {
                btnCompartilhar.style.display = 'block';
            }
            
            // Abrir modal
            const modal = document.getElementById('modalCompartilhar');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        window.fecharModalCompartilhar = function() {
            const modal = document.getElementById('modalCompartilhar');
            if (modal) {
                modal.style.display = 'none';
            }
        
        window.compartilharPDF = async function() {
            if (!pdfBlobGlobal || !pdfNomeGlobal) {
                alert('Nenhum documento foi gerado ainda.');
                return;
            }
            
            // Fechar modal de documentos primeiro
            closeModal('documentos');
            
            try {
                if (navigator.share && navigator.canShare) {
                    const file = new File([pdfBlobGlobal], pdfNomeGlobal, { type: 'application/pdf' });
                    
                    if (navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: 'Compartilhar Documento',
                            text: 'Documento gerado pelo EventProDJ'
                        });
                        alert('✅ Documento compartilhado com sucesso!');
                        return;
                    }
                }
                
                // Fallback: baixar
                alert('ℹ️ Compartilhamento não disponível. Baixando documento...');
                baixarPDF();
                
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Erro ao compartilhar:', error);
                    alert('❌ Erro ao compartilhar. Baixando documento...');
                    baixarPDF();
                }
            }
        }

            pdfBlobGlobal = null;
            pdfNomeGlobal = '';
        }
        
        window.baixarPDF = function() {
            if (pdfBlobGlobal && pdfNomeGlobal) {
                const url = URL.createObjectURL(pdfBlobGlobal);
                const a = document.createElement('a');
                a.href = url;
                a.download = pdfNomeGlobal;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                fecharModalCompartilhar();
            }
        }

        async function gerarDocumento(tipo) {
            const clienteId = parseInt(document.getElementById('documentosClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            if (!cliente) return;
            
            const configuracoes = DB.get('configuracoes');
            const config = configuracoes.length > 0 ? configuracoes[0] : {};
            
            // Buscar evento do cliente
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.cliente === cliente.nome);
            
            let nomeArquivo = '';
            
            try {
                if (tipo === 'orcamento') {
                    // Usar função específica para orçamento profissional
                    nomeArquivo = `Orcamento_${cliente.nome.replace(/\s/g, '_')}.pdf`;
                    await gerarOrcamentoProfissional(cliente, evento, config, nomeArquivo);
                } else if (tipo === 'contrato') {
                    nomeArquivo = `Contrato_${cliente.nome.replace(/\s/g, '_')}.pdf`;
                    await gerarContratoProfissional(cliente, evento, config, nomeArquivo);
                } else if (tipo === 'recibo') {
                    nomeArquivo = `Recibo_${cliente.nome.replace(/\s/g, '_')}.pdf`;
                    await gerarReciboProfissional(cliente, evento, config, nomeArquivo);
                }
                
                closeModal('documentos');
            } catch (error) {
                console.error('Erro ao gerar documento:', error);
                alert('❌ Erro ao gerar documento. Verifique os dados e tente novamente.');
            }
        }
        
        // ============================================
        // FUNÇÃO DE CABEÇALHO PADRONIZADO PARA PDFs
        // ============================================
        function criarCabecalhoPDF(doc, config) {
            const margemEsquerda = 15;
            const margemDireita = 195;
            let y = 15;
            
            // LADO ESQUERDO: Logo
            if (config.logoBase64) {
                try {
                    doc.addImage(config.logoBase64, 'PNG', margemEsquerda, y, 35, 35);
                } catch (e) {
                    console.log('Logo não adicionada');
                }
            }
            
            // LADO DIREITO: Informações da empresa (alinhadas à direita)
            let yDireita = y;
            
            // Nome da empresa
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'EVENTPRODJ', margemDireita, yDireita, { align: 'right' });
            yDireita += 6;
            
            // Nome completo (se diferente)
            if (config.nomeCorporativo && config.nomeCorporativo !== config.nomeEmpresa) {
                doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
                doc.text(config.nomeCorporativo, margemDireita, yDireita, { align: 'right' });
                yDireita += 5;
            }
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            
            // CNPJ
            if (config.cnpj) {
                doc.text(`CNPJ: ${config.cnpj}`, margemDireita, yDireita, { align: 'right' });
                yDireita += 4;
            }
            
            // Email
            if (config.email) {
                doc.text(`Email: ${config.email}`, margemDireita, yDireita, { align: 'right' });
                yDireita += 4;
            }
            
            // Telefone
            if (config.telefone) {
                doc.text(`Tel: ${config.telefone}`, margemDireita, yDireita, { align: 'right' });
                yDireita += 4;
            }
            
            // WhatsApp
            if (config.whatsapp) {
                doc.text(`WhatsApp: ${config.whatsapp}`, margemDireita, yDireita, { align: 'right' });
                yDireita += 4;
            }
            
            // Posição após logo/info (o que for maior)
            y = Math.max(y + (config.logoBase64 ? 40 : 25), yDireita + 5);
            
            // Linha separadora
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 3;
            
            // REDES SOCIAIS com ícones
            doc.setFontSize(10);
            doc.setTextColor(80, 80, 80);
            
            let xRede = margemEsquerda;
            const espacoRede = 50;
            
            if (config.instagram) {
                doc.text('📷 ' + config.instagram, xRede, y);
                xRede += espacoRede;
            }
            
            if (config.facebook) {
                doc.text('👥 ' + config.facebook, xRede, y);
                xRede += espacoRede;
            }
            
            if (xRede > margemEsquerda) y += 4;
            xRede = margemEsquerda;
            
            if (config.youtube) {
                doc.text('▶️ ' + config.youtube, xRede, y);
                xRede += espacoRede;
            }
            
            if (config.site) {
                doc.text('🌐 ' + config.site, xRede, y);
            }
            
            // Reset cor do texto
            doc.setTextColor(0, 0, 0);
            
            // Linha separadora final
            y += 5;
            doc.setDrawColor(200, 200, 200);
            doc.line(margemEsquerda, y, margemDireita, y);
            
            return y + 5; // Retorna posição Y após o cabeçalho
        }
        
        // Função para gerar orçamento profissional (modelo completo)
        async function gerarOrcamentoProfissional(cliente, evento, config, nomeArquivo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configurações
            const margemEsquerda = 15;
            const margemDireita = 195;
            const larguraPagina = margemDireita - margemEsquerda;
            let y = 20;
            
            // ===== CABEÇALHO =====
            if (config.logoBase64) {
                try {
                    doc.addImage(config.logoBase64, 'PNG', margemEsquerda, y, 30, 30);
                } catch (e) {
                    console.log('Erro ao adicionar logo:', e);
                }
            }
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', 50, y + 5);
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            if (config.cnpj) doc.text(`CNPJ: ${config.cnpj}`, 50, y + 10);
            if (config.email) doc.text(`Email: ${config.email}`, 50, y + 14);
            if (config.telefone) doc.text(`Tel: ${config.telefone}`, 50, y + 18);
            if (config.whatsapp) doc.text(`WhatsApp: ${config.whatsapp}`, 50, y + 22);
            
            const enderecoLines = [];
            if (config.endereco) enderecoLines.push(config.endereco);
            if (config.cidade && config.estado) enderecoLines.push(`${config.cidade}/${config.estado}`);
            if (config.cep) enderecoLines.push(`CEP: ${config.cep}`);
            
            let yEnd = y + 26;
            enderecoLines.forEach(linha => {
                doc.text(linha, 50, yEnd);
                yEnd += 4;
            });
            
            y = yEnd + 5;
            doc.setLineWidth(0.5);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 10;
            
            // ===== TÍTULO =====
            doc.setFillColor(220, 220, 220);
            doc.rect(margemEsquerda, y, larguraPagina, 8, 'F');
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Orçamento', margemEsquerda + 2, y + 5.5);
            y += 15;
            
            // ===== DADOS DO CLIENTE =====
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(`Cliente: ${cliente.nome}`, margemEsquerda, y);
            y += 5;
            
            doc.setFont('helvetica', 'normal');
            if (cliente.cpf) {
                doc.text(`CPF: ${cliente.cpf}`, margemEsquerda, y);
                y += 5;
            }
            
            if (cliente.telefone) {
                doc.text(`Telefone: ${cliente.telefone}`, margemEsquerda, y);
                y += 5;
            }
            
            if (cliente.email) {
                doc.text(`Email: ${cliente.email}`, margemEsquerda, y);
                y += 5;
            }
            
            // Endereço completo em 2 linhas
            if (cliente.endereco || cliente.bairro || cliente.cidade) {
                // LINHA 1: SOMENTE Rua + número
                let linha1 = '';
                if (cliente.endereco) {
                    linha1 = cliente.endereco;
                    if (cliente.numero) linha1 += ', ' + cliente.numero;
                }
                if (linha1) {
                    doc.text(linha1, margemEsquerda, y);
                    y += 4;
                }
                
                // LINHA 2: Bairro - Cidade/Estado - CEP
                let linha2 = '';
                if (cliente.bairro) {
                    linha2 = cliente.bairro;
                }
                if (cliente.cidade && cliente.estado) {
                    if (linha2) linha2 += ' - ';
                    linha2 += cliente.cidade + '/' + cliente.estado;
                }
                if (cliente.cep) {
                    if (linha2) linha2 += ' - ';
                    linha2 += 'CEP: ' + cliente.cep;
                }
                if (linha2) {
                    doc.text(linha2, margemEsquerda, y);
                    y += 4;
                }
            }
            
            // ===== INFORMAÇÕES DO EVENTO =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Informações do Evento', margemEsquerda + 2, y + 4);
            y += 10;
            
            doc.setFontSize(10);
            
            // LINHA 1
            doc.setFont('helvetica', 'bold');
            doc.text('Tipo de evento: ', margemEsquerda, y);
            const w1 = doc.getTextWidth('Tipo de evento: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? evento.tipo : 'A definir', margemEsquerda + w1, y);
            
            doc.setFont('helvetica', 'bold');
            doc.text('Data do evento: ', 105, y);
            const w2 = doc.getTextWidth('Data do evento: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? formatDate(evento.data) : 'A definir', 105 + w2, y);
            y += 5;
            
            // LINHA 2
            doc.setFont('helvetica', 'bold');
            doc.text('Horário: ', margemEsquerda, y);
            const w3 = doc.getTextWidth('Horário: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? `${evento.horaInicio} - ${evento.horaFim}` : 'A definir', margemEsquerda + w3, y);
            
            doc.setFont('helvetica', 'bold');
            doc.text('Duração do Serviço: ', 105, y);
            const w4 = doc.getTextWidth('Duração do Serviço: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento && evento.duracao ? evento.duracao : '5h', 105 + w4, y);
            y += 5;
            
            // LINHA 3
            doc.setFont('helvetica', 'bold');
            doc.text('Local do evento: ', margemEsquerda, y);
            const w5 = doc.getTextWidth('Local do evento: ');
            doc.setFont('helvetica', 'normal');
            const localEvento = evento && evento.complemento ? evento.complemento : (evento ? evento.local : 'A definir');
            const localLines = doc.splitTextToSize(localEvento, 140);
            doc.text(localLines, margemEsquerda + w5, y);
            y += Math.max(5, localLines.length * 4);
            
            // ===== SERVIÇOS =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Serviços', margemEsquerda + 2, y + 4);
            y += 10;
            
            // Cabeçalho da tabela
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Descrição', margemEsquerda, y);
            doc.text('Valor', margemDireita, y, { align: 'right' });
            y += 4;
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 5;
            
            let totalServicos = 0;
            
            // Extrair serviços do evento.observacoes
            doc.setFont('helvetica', 'normal');
            if (evento && evento.observacoes) {
                const servicosMatch = evento.observacoes.match(/Serviços:\n([\s\S]*?)(?:\n\nOutras Taxas:|\n\nObservações:|$)/);
                if (servicosMatch && servicosMatch[1]) {
                    const servicosTexto = servicosMatch[1].trim();
                    const servicosLinhas = servicosTexto.split('\n').filter(l => l.trim().startsWith('•'));
                    
                    servicosLinhas.forEach(linha => {
                        const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                        if (match) {
                            const nome = match[1].trim();
                            const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                            const valor = parseFloat(valorStr);
                            
                            doc.setFontSize(10);
                            doc.text(nome, margemEsquerda, y);
                            doc.setFont('helvetica', 'bold');
                            doc.text(formatMoney(valor), margemDireita, y, { align: 'right' });
                            doc.setFont('helvetica', 'normal');
                            totalServicos += valor;
                            y += 4;
                        }
                    });
                    y += 2;
                }
            }
            
            // ===== OUTRAS TAXAS =====
            if (evento && evento.observacoes) {
                const taxasMatch = evento.observacoes.match(/Outras Taxas:\n([\s\S]*?)(?:\n\nObservações:|$)/);
                if (taxasMatch && taxasMatch[1]) {
                    const taxasTexto = taxasMatch[1].trim();
                    const taxasLinhas = taxasTexto.split('\n').filter(l => l.trim().startsWith('•'));
                    
                    if (taxasLinhas.length > 0) {
                        doc.setLineWidth(0.2);
                        doc.line(margemEsquerda, y, margemDireita, y);
                        y += 6;
                        
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.text('Outras Taxas', margemEsquerda, y);
                        y += 6;
                        
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        
                        taxasLinhas.forEach(linha => {
                            const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                            if (match) {
                                const descricao = match[1].trim();
                                const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                                const valor = parseFloat(valorStr);
                                
                                doc.text(descricao, margemEsquerda, y);
                                doc.setFont('helvetica', 'bold');
                                doc.text(formatMoney(valor), margemDireita, y, { align: 'right' });
                                doc.setFont('helvetica', 'normal');
                                totalServicos += valor;
                                y += 4;
                            }
                        });
                        y += 2;
                    }
                }
            }
            
            // ===== TOTAL =====
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 6;
            
            const valorTotal = cliente.financeiro?.valorTotal || totalServicos;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('VALOR TOTAL', 115, y);
            doc.text(formatMoney(valorTotal), margemDireita, y, { align: 'right' });
            
            y += 8;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Pagamento', margemEsquerda + 2, y + 4);
            y += 10;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('Formas de pagamento: Pix, Transferência, Dinheiro, Cartão de Crédito/Débito', margemEsquerda, y);
            
            // ===== ASSINATURA =====
            y += 35;
            
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda + 50, y, margemDireita - 50, y);
            
            if (config.assinaturaBase64) {
                try {
                    doc.addImage(config.assinaturaBase64, 'PNG', 75, y - 10, 60, 10);
                } catch (e) {
                    console.log('Erro ao adicionar assinatura:', e);
                }
            }
            
            y += 4;
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Assinatura do responsável da empresa', 105, y, { align: 'center' });
            
            y += 4;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', 105, y, { align: 'center' });
            
            y += 5;
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            const dataExtenso = new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
            doc.text(`Rio de Janeiro, ${dataExtenso}`, 105, y, { align: 'center' });
            
            // RODAPÉ
            doc.setFontSize(9);
            doc.setTextColor(150);
            doc.text(`Página 1/1`, 105, 280, { align: 'center' });
            doc.setFontSize(10);
            doc.setTextColor(0);
            doc.text(`Esse orçamento tem uma validade de 30 dias a partir da data que foi gerado.`, 105, 287, { align: 'center' });
            
            const pdfBlob = doc.output('blob');
            mostrarModalCompartilhar(pdfBlob, nomeArquivo || `Orcamento_${cliente.nome}.pdf`);
        }

        async function gerarContratoProfissional(cliente, evento, config, nomeArquivo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configurações
            const margemEsquerda = 15;
            const margemDireita = 195;
            const larguraPagina = margemDireita - margemEsquerda;
            let y = 20;
            
            // ===== CABEÇALHO =====
            if (config.logoBase64) {
                try {
                    doc.addImage(config.logoBase64, 'PNG', margemEsquerda, y, 30, 30);
                } catch (e) {
                    console.log('Erro ao adicionar logo:', e);
                }
            }
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', 50, y + 5);
            
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            if (config.cnpj) doc.text(`CNPJ: ${config.cnpj}`, 50, y + 10);
            if (config.email) doc.text(`Email: ${config.email}`, 50, y + 14);
            if (config.telefone) doc.text(`Tel: ${config.telefone}`, 50, y + 18);
            if (config.whatsapp) doc.text(`WhatsApp: ${config.whatsapp}`, 50, y + 22);
            
            const enderecoLines = [];
            if (config.endereco) enderecoLines.push(config.endereco);
            if (config.cidade && config.estado) enderecoLines.push(`${config.cidade}/${config.estado}`);
            if (config.cep) enderecoLines.push(`CEP: ${config.cep}`);
            
            let yEnd = y + 26;
            enderecoLines.forEach(linha => {
                doc.text(linha, 50, yEnd);
                yEnd += 4;
            });
            
            y = yEnd + 5;
            doc.setLineWidth(0.5);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 10;
            
            // ===== TÍTULO =====
            doc.setFillColor(220, 220, 220);
            doc.rect(margemEsquerda, y, larguraPagina, 8, 'F');
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Contrato', margemEsquerda + 2, y + 5.5);
            y += 15;
            
            // ===== DADOS DO CLIENTE =====
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(`Cliente: ${cliente.nome}`, margemEsquerda, y);
            y += 5;
            
            doc.setFont('helvetica', 'normal');
            if (cliente.cpf) {
                doc.text(`CPF: ${cliente.cpf}`, margemEsquerda, y);
                y += 5;
            }
            
            if (cliente.telefone) {
                doc.text(`Telefone: ${cliente.telefone}`, margemEsquerda, y);
                y += 5;
            }
            
            if (cliente.email) {
                doc.text(`Email: ${cliente.email}`, margemEsquerda, y);
                y += 5;
            }
            
            // Endereço completo em 2 linhas
            if (cliente.endereco || cliente.bairro || cliente.cidade) {
                // LINHA 1: SOMENTE Rua + número
                let linha1 = '';
                if (cliente.endereco) {
                    linha1 = cliente.endereco;
                    if (cliente.numero) linha1 += ', ' + cliente.numero;
                }
                if (linha1) {
                    doc.text(linha1, margemEsquerda, y);
                    y += 4;
                }
                
                // LINHA 2: Bairro - Cidade/Estado - CEP
                let linha2 = '';
                if (cliente.bairro) {
                    linha2 = cliente.bairro;
                }
                if (cliente.cidade && cliente.estado) {
                    if (linha2) linha2 += ' - ';
                    linha2 += cliente.cidade + '/' + cliente.estado;
                }
                if (cliente.cep) {
                    if (linha2) linha2 += ' - ';
                    linha2 += 'CEP: ' + cliente.cep;
                }
                if (linha2) {
                    doc.text(linha2, margemEsquerda, y);
                    y += 4;
                }
            }
            
            // ===== INFORMAÇÕES DO EVENTO =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Informações do Evento', margemEsquerda + 2, y + 4);
            y += 10;
            
            doc.setFontSize(10);
            
            // LINHA 1
            doc.setFont('helvetica', 'bold');
            doc.text('Tipo de evento: ', margemEsquerda, y);
            const w1 = doc.getTextWidth('Tipo de evento: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? evento.tipo : 'A definir', margemEsquerda + w1, y);
            
            doc.setFont('helvetica', 'bold');
            doc.text('Data do evento: ', 105, y);
            const w2 = doc.getTextWidth('Data do evento: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? formatDate(evento.data) : 'A definir', 105 + w2, y);
            y += 5;
            
            // LINHA 2
            doc.setFont('helvetica', 'bold');
            doc.text('Horário: ', margemEsquerda, y);
            const w3 = doc.getTextWidth('Horário: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? `${evento.horaInicio} - ${evento.horaFim}` : 'A definir', margemEsquerda + w3, y);
            
            doc.setFont('helvetica', 'bold');
            doc.text('Duração do Serviço: ', 105, y);
            const w4 = doc.getTextWidth('Duração do Serviço: ');
            doc.setFont('helvetica', 'normal');
            doc.text(evento && evento.duracao ? evento.duracao : '5h', 105 + w4, y);
            y += 5;
            
            // LINHA 3
            doc.setFont('helvetica', 'bold');
            doc.text('Local do evento: ', margemEsquerda, y);
            const w5 = doc.getTextWidth('Local do evento: ');
            doc.setFont('helvetica', 'normal');
            const localEvento = evento && evento.complemento ? evento.complemento : (evento ? evento.local : 'A definir');
            const localLines = doc.splitTextToSize(localEvento, 140);
            doc.text(localLines, margemEsquerda + w5, y);
            y += Math.max(5, localLines.length * 4);
            
            // ===== SERVIÇOS =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Serviços', margemEsquerda + 2, y + 4);
            y += 10;
            
            // Cabeçalho da tabela
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Descrição', margemEsquerda, y);
            doc.text('Valor', margemDireita, y, { align: 'right' });
            y += 4;
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 5;
            
            let totalServicos = 0;
            
            // Extrair serviços do evento.observacoes
            doc.setFont('helvetica', 'normal');
            if (evento && evento.observacoes) {
                const servicosMatch = evento.observacoes.match(/Serviços:\n([\s\S]*?)(?:\n\nOutras Taxas:|\n\nObservações:|$)/);
                if (servicosMatch && servicosMatch[1]) {
                    const servicosTexto = servicosMatch[1].trim();
                    const servicosLinhas = servicosTexto.split('\n').filter(l => l.trim().startsWith('•'));
                    
                    servicosLinhas.forEach(linha => {
                        const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                        if (match) {
                            const nome = match[1].trim();
                            const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                            const valor = parseFloat(valorStr);
                            
                            doc.setFontSize(10);
                            doc.text(nome, margemEsquerda, y);
                            doc.setFont('helvetica', 'bold');
                            doc.text(formatMoney(valor), margemDireita, y, { align: 'right' });
                            doc.setFont('helvetica', 'normal');
                            totalServicos += valor;
                            y += 4;
                        }
                    });
                    y += 2;
                }
            }
            
            // ===== OUTRAS TAXAS =====
            if (evento && evento.observacoes) {
                const taxasMatch = evento.observacoes.match(/Outras Taxas:\n([\s\S]*?)(?:\n\nObservações:|$)/);
                if (taxasMatch && taxasMatch[1]) {
                    const taxasTexto = taxasMatch[1].trim();
                    const taxasLinhas = taxasTexto.split('\n').filter(l => l.trim().startsWith('•'));
                    
                    if (taxasLinhas.length > 0) {
                        doc.setLineWidth(0.2);
                        doc.line(margemEsquerda, y, margemDireita, y);
                        y += 6;
                        
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.text('Outras Taxas', margemEsquerda, y);
                        y += 6;
                        
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        
                        taxasLinhas.forEach(linha => {
                            const match = linha.match(/•\s*(.+?)\s*-\s*R?\$?\s*([\d.,]+)/);
                            if (match) {
                                const descricao = match[1].trim();
                                const valorStr = match[2].replace(/\./g, '').replace(',', '.');
                                const valor = parseFloat(valorStr);
                                
                                doc.text(descricao, margemEsquerda, y);
                                doc.setFont('helvetica', 'bold');
                                doc.text(formatMoney(valor), margemDireita, y, { align: 'right' });
                                doc.setFont('helvetica', 'normal');
                                totalServicos += valor;
                                y += 4;
                            }
                        });
                        y += 2;
                    }
                }
            }
            
            // ===== TOTAL =====
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 6;
            
            const valorTotal = cliente.financeiro?.valorTotal || totalServicos;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('VALOR TOTAL', 115, y);
            doc.text(formatMoney(valorTotal), margemDireita, y, { align: 'right' });
            
            // ===== TABELA DE PAGAMENTOS =====
            y += 8;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 7, 'F');
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('PAGAMENTOS', margemEsquerda + 2, y + 5);
            doc.text('Vencimento', 115, y + 5);
            doc.text('Valor', margemDireita, y + 5, { align: 'right' });
            
            y += 7;
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            
            const sinalValor = cliente.financeiro?.sinalValor || 0;
            const sinalData = cliente.financeiro?.sinalData ? formatDate(cliente.financeiro.sinalData) : formatDate(new Date());
            const saldoAPagar = valorTotal - sinalValor;
            const vencimento = cliente.financeiro?.vencimento ? formatDate(cliente.financeiro.vencimento) : (evento ? formatDate(evento.data) : formatDate(new Date()));
            
            y += 5;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('Entrada', margemEsquerda + 2, y);
            doc.text(sinalData, 115, y);
            doc.setFont('helvetica', 'bold');
            doc.text(formatMoney(sinalValor), margemDireita, y, { align: 'right' });
            doc.setFont('helvetica', 'normal');
            
            y += 5;
            
            doc.text('A receber', margemEsquerda + 2, y);
            doc.text(vencimento, 115, y);
            doc.setFont('helvetica', 'bold');
            doc.text(formatMoney(saldoAPagar), margemDireita, y, { align: 'right' });
            doc.setFont('helvetica', 'normal');
            
            y += 6;
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            
            y += 10;
            
            // ===== PÁGINA 2: CLÁUSULAS =====
            doc.addPage();
            y = 20;
            
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Cláusulas Contratuais', 105, y, { align: 'center' });
            y += 15;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            
            const clausulas = config.clausulasContratuais || 'Nenhuma cláusula configurada. Configure em: Configurações → Documentos → Contratos';
            
            const clausulasLines = doc.splitTextToSize(clausulas, larguraPagina);
            
            clausulasLines.forEach((linha) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                doc.text(linha, margemEsquerda, y);
                y += 4;
            });
            
            // ===== ASSINATURAS NA ÚLTIMA PÁGINA =====
            if (y > 200) {
                doc.addPage();
                y = 20;
            } else {
                y += 20;
            }
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('Assinaturas', 105, y, { align: 'center' });
            y += 15;
            
            const yInicial = y;
            
            // EMPRESA (ESQUERDA)
            doc.setFontSize(10);
            doc.setLineWidth(0.3);
            doc.line(15, yInicial, 90, yInicial);
            
            if (config.assinaturaBase64) {
                try {
                    doc.addImage(config.assinaturaBase64, 'PNG', 22, yInicial - 10, 60, 10);
                } catch (e) {
                    console.log('Erro ao adicionar assinatura:', e);
                }
            }
            
            doc.setFont('helvetica', 'normal');
            doc.text('Assinatura do responsável da empresa', 52, yInicial + 4, { align: 'center' });
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', 52, yInicial + 8, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            const dataExtenso = new Date().toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
            doc.text(`Rio de Janeiro, ${dataExtenso}`, 52, yInicial + 12, { align: 'center' });
            
            // CLIENTE (DIREITA)
            doc.setFontSize(10);
            doc.setLineWidth(0.3);
            doc.line(120, yInicial, 195, yInicial);
            doc.setFont('helvetica', 'bold');
            doc.text(cliente.nome, 157, yInicial + 4, { align: 'center' });
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            if (cliente.cpf) {
                doc.text(`CPF: ${cliente.cpf}`, 157, yInicial + 8, { align: 'center' });
            }
            
            // Rodapé com paginação dinâmica
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(9);
                doc.setTextColor(150);
                doc.text(`Página ${i}/${totalPages}`, 105, 285, { align: 'center' });
                doc.setTextColor(0);
            }
            
            const pdfBlob = doc.output('blob');
            mostrarModalCompartilhar(pdfBlob, nomeArquivo || `Contrato_${cliente.nome}.pdf`);
        }

        async function gerarReciboProfissional(cliente, evento, config, nomeArquivo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const margemEsquerda = 15;
            const margemDireita = 195;
            const larguraPagina = 180;
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            
            // Obter cidade da empresa ou do config
            const cidadeEmpresa = config.cidade || 'Rio de Janeiro';
            const dataExtenso = `${cidadeEmpresa}, ${dataAtual}`;
            
            let y = 15;
            
            // ===== CABEÇALHO CUSTOMIZADO PARA RECIBO =====
            // Logo à esquerda
            if (config.logoBase64) {
                try {
                    doc.addImage(config.logoBase64, 'PNG', margemEsquerda, y, 35, 35);
                } catch (e) {
                    console.log('Logo não adicionada');
                }
            }
            
            // Informações da empresa ao lado da logo (alinhadas à esquerda E MESMA ALTURA)
            let yEmpresa = y + 2; // Ajuste para alinhar com o topo da logo
            let xEmpresa = margemEsquerda + 40; // Ao lado da logo
            
            // Nome da empresa (apenas uma vez)
            doc.setFontSize(12);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', xEmpresa, yEmpresa);
            yEmpresa += 6;
            
            // REMOVER DATA AQUI (estava ao lado da logo)
            // doc.text(`${dataAtual}`, xEmpresa, yEmpresa);
            // yEmpresa += 5;
            
            // CNPJ
            if (config.cnpj) {
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text(`CNPJ: ${config.cnpj}`, xEmpresa, yEmpresa);
                yEmpresa += 4;
            }
            
            // Email
            if (config.email) {
                doc.text(`Email: ${config.email}`, xEmpresa, yEmpresa);
                yEmpresa += 4;
            }
            
            // Telefone
            if (config.telefone) {
                doc.text(`Tel: ${config.telefone}`, xEmpresa, yEmpresa);
                yEmpresa += 4;
            }
            
            // WhatsApp
            if (config.whatsapp) {
                doc.text(`WhatsApp: ${config.whatsapp}`, xEmpresa, yEmpresa);
                yEmpresa += 4;
            }
            
            // REMOVER REDES SOCIAIS (todas)
            y = Math.max(y + 40, yEmpresa + 3);
            
            // Reset cor
            doc.setTextColor(0, 0, 0);
            
            // Linha separadora
            y += 5;
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda, y, margemDireita, y);
            y += 8;
            
            // ===== TÍTULO: RECIBO =====
            doc.setFillColor(220, 220, 220);
            doc.rect(margemEsquerda, y, larguraPagina, 8, 'F');
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Recibo', margemEsquerda + 2, y + 5.5);
            
            
            y += 15;
            
            // ===== DECLARAÇÃO (TEXTO ATUALIZADO) =====
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            
            const valorRecebido = cliente.financeiro?.sinalValor || 0;
            const dataRecebimento = cliente.financeiro?.sinalData ? formatDate(cliente.financeiro.sinalData) : dataAtual;
            
            // Montar endereço sem duplicação
            let enderecoCompleto = '';
            if (cliente.rua && cliente.numero) {
                enderecoCompleto = `${cliente.rua}, ${cliente.numero}`;
                if (cliente.complemento) enderecoCompleto += ` - ${cliente.complemento}`;
                if (cliente.bairro) enderecoCompleto += ` - ${cliente.bairro}`;
                if (cliente.cidade && cliente.estado) enderecoCompleto += ` - ${cliente.cidade}-${cliente.estado}`;
                if (cliente.cep) enderecoCompleto += `, CEP ${cliente.cep}`;
            } else if (cliente.endereco) {
                enderecoCompleto = cliente.endereco;
            } else {
                enderecoCompleto = 'não informado';
            }
            
            const declaracao = `Declaro que recebi de ${cliente.nome}, inscrito no CPF sob o n. ${cliente.cpf || '000.000.000-00'}, com endereço em ${enderecoCompleto}, o valor de R$ ${formatMoney(valorRecebido)} (${numeroParaExtenso(valorRecebido)}) em ${dataRecebimento}, referente ao Sinal para os Serviços abaixo listados e agendamento da data para o Evento solicitado.`;
            
            const declaracaoLines = doc.splitTextToSize(declaracao, larguraPagina);
            declaracaoLines.forEach(linha => {
                doc.text(linha, margemEsquerda, y);
                y += 5;
            });
            
            // ===== SERVIÇOS (COM ESPAÇO ANTES DOS ITENS) =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text('Serviços', margemEsquerda + 2, y + 4);
            
            y += 10; // Espaço de uma linha antes dos itens
            
            // Listar serviços do evento (descrição do orçamento)
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            if (evento && evento.observacoes) {
                // Extrair serviços das observações (formato do orçamento)
                const servicosMatch = evento.observacoes.match(/Serviços:\n([\s\S]*?)(?:Outras Taxas:|Observações:|$)/);
                if (servicosMatch && servicosMatch[1]) {
                    const servicosTexto = servicosMatch[1].trim();
                    const servicosLinhas = servicosTexto.split('\n').filter(l => l.trim().startsWith('•'));
                    servicosLinhas.forEach(linha => {
                        // Remover valores, manter apenas descrição
                        const descricao = linha.replace(/\s*-\s*R\$.*$/, '').trim();
                        doc.setFontSize(10);
                    doc.text(descricao, margemEsquerda, y);
                        y += 5;
                    });
                } else {
                    doc.text(`• ${evento.tipo || 'Serviços de DJ e Sonorização'}`, margemEsquerda, y);
                    y += 5;
                }
            } else {
                doc.text('• Serviços de DJ e Sonorização', margemEsquerda, y);
                y += 5;
            }
            
            // ===== EVENTO (COM ESPAÇO ANTES DOS ITENS) =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Evento', margemEsquerda + 2, y + 4);
            
            y += 10; // Espaço de uma linha antes dos itens
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            
            // Tipo de evento
            if (evento && evento.tipo) {
                doc.setFont('helvetica', 'bold');
            doc.text('Tipo de evento:', margemEsquerda, y);
            doc.setFont('helvetica', 'bold');
            doc.text('Tipo de evento:', margemEsquerda, y);
            doc.setFont('helvetica', 'normal');
            doc.text(evento ? evento.tipo : 'A definir', 55, y);
                y += 5;
            }
            
            // Data do evento
            if (evento && evento.data) {
                doc.text(`Data do evento: ${formatDate(evento.data)}`, margemEsquerda, y);
                y += 5;
            }
            
            // ===== PAGAMENTO (COM ESPAÇO ANTES DOS ITENS) =====
            y += 5;
            doc.setFillColor(240, 240, 240);
            doc.rect(margemEsquerda, y, larguraPagina, 6, 'F');
            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text('Pagamento', margemEsquerda + 2, y + 4);
            
            y += 10; // Espaço de uma linha antes dos itens
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Meios de pagamento', margemEsquerda, y);
            y += 5;
            doc.setFont('helvetica', 'normal');
            
            // Forma de pagamento do cliente
            const formaPagamento = cliente.financeiro?.sinalFormaPagamento || 'pix';
            const formasLabels = {
                'pix': 'Pix',
                'dinheiro': 'Dinheiro',
                'debito': 'Cartão de Débito',
                'credito': 'Cartão de Crédito',
                'transferencia': 'Transferência Bancária',
                'boleto': 'Boleto'
            };
            doc.text(formasLabels[formaPagamento] || 'Pix', margemEsquerda, y);
            
            // ===== ASSINATURA =====
            y += 35;
            
            // Linha de assinatura
            doc.setLineWidth(0.3);
            doc.line(margemEsquerda + 50, y, margemDireita - 50, y);
            
            // Adicionar assinatura digital se configurada
            if (config.assinaturaBase64) {
                try {
                    doc.addImage(config.assinaturaBase64, 'PNG', 75, y - 10, 60, 10);
                } catch (e) {
                    console.log('Erro ao adicionar assinatura:', e);
                }
            }
            
            y += 4;
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.setFontSize(9);
            doc.text('Assinatura do responsável da empresa', 105, y, { align: 'center' });
            
            y += 4;
            doc.setFontSize(12);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text(config.nomeEmpresa || 'CRISTIAN DJ SONORIZAÇÃO', 105, y, { align: 'center' });
            
            y += 5;
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text(dataExtenso, 105, y, { align: 'center' });
            
            // Rodapé
            doc.setFontSize(10);
            doc.setTextColor(150);
            doc.text(`Página 1/1`, 105, 285, { align: 'center' });
            
            // Salvar e mostrar modal
            const pdfBlob = doc.output('blob');
            mostrarModalCompartilhar(pdfBlob, nomeArquivo || `Recibo_${cliente.nome}.pdf`);
        }
        
        // Função auxiliar para converter número em extenso (simplificada)
        function numeroParaExtenso(valor) {
            // Simplificação - retorna formato básico
            const valorInteiro = Math.floor(valor);
            const centavos = Math.round((valor - valorInteiro) * 100);
            
            const unidades = ['', 'um', 'dois', 'três', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
            const dezenas = ['', '', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
            const especiais = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
            const centenas = ['', 'cento', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];
            
            if (valorInteiro === 0) return 'zero reais';
            if (valorInteiro < 10) return unidades[valorInteiro] + ' reais';
            if (valorInteiro < 20) return especiais[valorInteiro - 10] + ' reais';
            if (valorInteiro < 100) {
                const dez = Math.floor(valorInteiro / 10);
                const uni = valorInteiro % 10;
                return dezenas[dez] + (uni ? ' e ' + unidades[uni] : '') + ' reais';
            }
            if (valorInteiro < 1000) {
                const cen = Math.floor(valorInteiro / 100);
                const resto = valorInteiro % 100;
                let texto = (valorInteiro === 100) ? 'cem' : centenas[cen];
                if (resto > 0) {
                    if (resto < 10) texto += ' e ' + unidades[resto];
                    else if (resto < 20) texto += ' e ' + especiais[resto - 10];
                    else {
                        const dez = Math.floor(resto / 10);
                        const uni = resto % 10;
                        texto += ' e ' + dezenas[dez] + (uni ? ' e ' + unidades[uni] : '');
                    }
                }
                return texto + ' reais';
            }
            
            // Para valores maiores, formato simplificado
            return formatMoney(valor);
        }
        
        async function gerarPDF(conteudo, nomeArquivo, config) {
            // Importar jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Usar cabeçalho padronizado
            let yPos = criarCabecalhoPDF(doc, config);
            yPos += 10;
            
            // Adicionar conteúdo
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            
            const linhas = doc.splitTextToSize(conteudo, 180);
            linhas.forEach(linha => {
                if (yPos > 280) {
                    doc.addPage();
                    yPos = criarCabecalhoPDF(doc, config) + 10;
                }
                doc.text(linha, 15, yPos);
                yPos += 5;
            });
            
            // Adicionar rodapé
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text(`Página ${i} de ${totalPages}`, 105, 290, { align: 'center' });
                doc.text(`Gerado em ${new Date().toLocaleDateString('pt-BR')}`, 15, 290);
            }
            
            // Retornar o blob para compartilhamento
            const pdfBlob = doc.output('blob');
            const pdfFile = new File([pdfBlob], nomeArquivo, { type: 'application/pdf' });
            
            // Armazenar para compartilhamento
            window.ultimoPDFGerado = pdfFile;
            
            // Salvar PDF
            // doc.save(nomeArquivo); // Comentado - não fazer download automático
            
            // Mostrar opções de compartilhamento
            // Documento gerado com sucesso
        }

        function viewClientDetails(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            const origemLabels = {
                'facebook': 'Facebook',
                'instagram': 'Instagram',
                'google': 'Google',
                'indicacao': 'Indicação',
                'outros': 'Outros'
            };
            
            let details = `👤 DETALHES DO CLIENTE\n\n`;
            details += `Nome: ${cliente.nome}\n`;
            details += `Email: ${cliente.email}\n`;
            details += `Telefone: ${cliente.telefone}\n`;
            if (cliente.cpf) details += `CPF/CNPJ: ${cliente.cpf}\n`;
            if (cliente.aniversario) details += `Aniversário: ${formatDate(cliente.aniversario)}\n`;
            if (cliente.origem) details += `Como conheceu: ${origemLabels[cliente.origem] || cliente.origem}\n`;
            if (cliente.origem === 'indicacao' && cliente.indicacao) details += `Indicado por: ${cliente.indicacao}\n`;
            if (cliente.endereco) details += `Endereço: ${cliente.endereco}\n`;
            
            // Informações financeiras
            if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                details += `\n💰 INFORMAÇÕES FINANCEIRAS\n`;
                details += `Valor Total: ${formatMoney(cliente.financeiro.valorTotal)}\n`;
                details += `Sinal Pago: ${formatMoney(cliente.financeiro.sinalValor)}`;
                if (cliente.financeiro.sinalData) details += ` (${formatDate(cliente.financeiro.sinalData)})`;
                details += `\nSaldo Devedor: ${formatMoney(cliente.financeiro.valorPagar)}`;
                if (cliente.financeiro.vencimento) {
                    details += `\nVencimento: ${formatDate(cliente.financeiro.vencimento)}`;
                    const hoje = new Date();
                    const venc = new Date(cliente.financeiro.vencimento);
                    if (venc < hoje && cliente.financeiro.valorPagar > 0) {
                        details += ` ⚠️ VENCIDO`;
                    }
                }
                const percentPaid = (cliente.financeiro.sinalValor / cliente.financeiro.valorTotal) * 100;
                details += `\nProgresso: ${percentPaid.toFixed(0)}%`;
            }
            
            if (cliente.observacoes) details += `\n\nObservações:\n${cliente.observacoes}`;
            
            alert(details);
        }

        function editClient(id) {
            // Converter ID para número se for string
            const clienteId = typeof id === 'string' ? parseInt(id) : id;
            const cliente = DB.get('clientes').find(c => c.id == clienteId);
            if (!cliente) {
                console.error('Cliente não encontrado. ID recebido:', id, 'Tipo:', typeof id);
                return alert('Cliente não encontrado!');
            }
            
            document.getElementById('clienteNome').value = cliente.nome || '';
            document.getElementById('clienteEmail').value = cliente.email || '';
            document.getElementById('clienteTelefone').value = cliente.telefone || '';
            document.getElementById('clienteCpf').value = cliente.cpf || '';
            document.getElementById('clienteAniversario').value = cliente.aniversario || '';
            document.getElementById('clienteOrigem').value = cliente.origem || '';
            
            if (cliente.origem === 'indicacao') {
                document.getElementById('indicacaoDetalhes').style.display = 'block';
                document.getElementById('clienteIndicacao').value = cliente.indicacao || '';
            }
            
            document.getElementById('clienteCep').value = cliente.cep || '';
            document.getElementById('clienteRua').value = cliente.rua || '';
            document.getElementById('clienteNumero').value = cliente.numero || '';
            document.getElementById('clienteComplemento').value = cliente.complemento || '';
            document.getElementById('clienteBairro').value = cliente.bairro || '';
            document.getElementById('clienteCidade').value = cliente.cidade || '';
            document.getElementById('clienteEstado').value = cliente.estado || '';
            document.getElementById('clienteObservacoes').value = cliente.observacoes || '';
            
            const form = document.querySelector('#modalCliente form');
            if (form) form.setAttribute('data-editing-id', clienteId);
            
            openModal('cliente');
        }
        
        function deleteClient(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            // Verificar quantos eventos o cliente possui
            const eventos = DB.get('eventos');
            const eventosDoCliente = eventos.filter(e => e.cliente === cliente.nome);
            
            let mensagemConfirmacao = `Deseja realmente excluir o cliente "${cliente.nome}"?\n\n⚠️ ATENÇÃO: Esta ação irá apagar:\n`;
            mensagemConfirmacao += `• O cliente\n`;
            
            if (eventosDoCliente.length > 0) {
                mensagemConfirmacao += `• ${eventosDoCliente.length} evento(s) relacionado(s)\n`;
                mensagemConfirmacao += `• Todos os custos destes eventos\n`;
            }
            
            if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                mensagemConfirmacao += `• Dados financeiros (R$ ${formatMoney(cliente.financeiro.valorTotal)})\n`;
            }
            
            mensagemConfirmacao += `\n❌ Esta ação NÃO pode ser desfeita!`;
            
            if (confirm(mensagemConfirmacao)) {
                console.log('🗑️ Excluindo cliente e dados relacionados:', cliente.nome);
                
                // 1. Excluir eventos do cliente
                if (eventosDoCliente.length > 0) {
                    console.log(`🗑️ Excluindo ${eventosDoCliente.length} eventos...`);
                    
                    eventosDoCliente.forEach(evento => {
                        // Excluir custos do evento
                        const custosEventos = DB.get('custosEventos');
                        const custosFiltrados = custosEventos.filter(c => c.eventoId !== evento.id);
                        DB.set('custosEventos', custosFiltrados);
                        console.log(`  ✅ Custos do evento "${evento.nome || evento.tipo}" excluídos`);
                    });
                    
                    // Remover eventos
                    const eventosAtualizados = eventos.filter(e => e.cliente !== cliente.nome);
                    DB.set('eventos', eventosAtualizados);
                    console.log(`✅ ${eventosDoCliente.length} eventos excluídos`);
                }
                
                // 2. Excluir receitas do cliente (se houver)
                const receitas = DB.get('receitas');
                const receitasAtualizadas = receitas.filter(r => r.cliente !== cliente.nome);
                if (receitas.length !== receitasAtualizadas.length) {
                    DB.set('receitas', receitasAtualizadas);
                    console.log(`✅ Receitas do cliente excluídas`);
                }
                
                // 3. Excluir despesas relacionadas ao cliente (se houver)
                const despesas = DB.get('despesas');
                const despesasAtualizadas = despesas.filter(d => !d.descricao || !d.descricao.includes(cliente.nome));
                if (despesas.length !== despesasAtualizadas.length) {
                    DB.set('despesas', despesasAtualizadas);
                    console.log(`✅ Despesas relacionadas excluídas`);
                }
                
                // 4. Excluir o cliente
                const clientes = DB.get('clientes').filter(c => c.id !== id);
                DB.set('clientes', clientes);
                console.log(`✅ Cliente "${cliente.nome}" excluído`);
                
                // 5. Atualizar interface
                renderClientsList(currentClientSearch);
                updateClientsStats();
                checkBirthdays();
                updateOrigemStats();
                updateDashboard(); // Atualizar dashboard também
                
                alert(`✅ Cliente "${cliente.nome}" e todos os dados relacionados foram excluídos com sucesso!`);
            }
        }

        function createEventForClient(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            // Abrir modal de orçamento completo
            openModal('orcamento');
            
            setTimeout(() => {
                if (document.getElementById('nomeCliente')) {
                    document.getElementById('nomeCliente').value = cliente.nome;
                }
                if (document.getElementById('emailCliente')) {
                    document.getElementById('emailCliente').value = cliente.email || '';
                }
                if (document.getElementById('telefoneCliente')) {
                    document.getElementById('telefoneCliente').value = cliente.telefone || '';
                }
                if (document.getElementById('cpfCliente')) {
                    document.getElementById('cpfCliente').value = cliente.cpf || '';
                }
                
                if (cliente.cep) {
                    if (document.getElementById('cepEvento')) document.getElementById('cepEvento').value = cliente.cep;
                    if (document.getElementById('ruaEvento')) document.getElementById('ruaEvento').value = cliente.rua || '';
                    if (document.getElementById('numeroEvento')) document.getElementById('numeroEvento').value = cliente.numero || '';
                    if (document.getElementById('complementoEvento')) document.getElementById('complementoEvento').value = cliente.complemento || '';
                    if (document.getElementById('bairroEvento')) document.getElementById('bairroEvento').value = cliente.bairro || '';
                    if (document.getElementById('cidadeEvento')) document.getElementById('cidadeEvento').value = cliente.cidade || '';
                    if (document.getElementById('estadoEvento')) document.getElementById('estadoEvento').value = cliente.estado || '';
                }
                
                const form = document.getElementById('orcamentoForm');
                if (form) form.setAttribute('data-cliente-id', id);
            }, 100);
        }

        function sendMessage(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            const message = `Olá ${cliente.nome.split(' ')[0]}! Tudo bem?`;
            const whatsappNumber = cliente.telefone.replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/55${whatsappNumber}?text=${encodeURIComponent(message)}`;
            
            if (confirm(`Enviar mensagem para ${cliente.nome}?\n\n"${message}"\n\nSerá aberto no WhatsApp.`)) {
                window.open(whatsappUrl, '_blank');
            }
        }

        // Aguardar DOM estar pronto antes de adicionar event listeners
    </script>

    <!-- Modal de Compartilhar Documento -->
    <div id="modalCompartilhar" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h2 style="margin-bottom: 20px;">📄 Documento Gerado</h2>
            <p style="margin-bottom: 30px; color: var(--text-secondary);">
                Seu documento foi gerado com sucesso! Escolha uma opção:
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button onclick="compartilharPDF()" class="btn" style="
                    width: 100%;
                    padding: 15px;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    background: var(--success);
                    color: white;
                ">
                    <span style="font-size: 20px;">🔗</span>
                    Compartilhar
                </button>
                
                <button onclick="baixarPDF()" class="btn btn-primary" style="
                    width: 100%;
                    padding: 15px;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                ">
                    <span style="font-size: 20px;">💾</span>
                    Baixar
                </button>
                
                <button onclick="fecharModalCompartilhar()" class="btn" style="
                    width: 100%;
                    padding: 15px;
                    background: transparent;
                    color: var(--text-secondary);
                    border: 1px solid var(--border);
                ">
                    Fechar
                </button>
            </div>
        </div>
    </div>

</body>
</html>
