<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventPro - Gest√£o Financeira para Eventos</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B35;
            --primary-dark: #E85A2B;
            --secondary: #004E89;
            --accent: #FFD23F;
            --success: #06D6A0;
            --danger: #EF476F;
            --bg-dark: #0A0E27;
            --bg-card: #141B3D;
            --bg-card-hover: #1A2249;
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --border: #2D3561;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 78, 137, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(20, 27, 61, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .main-nav {
            display: flex;
            gap: 5px;
            flex: 1;
            max-width: 400px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-tab.active {
            color: var(--primary);
            background: rgba(255, 107, 53, 0.15);
        }

        .logo {
            font-family: 'Syne', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: -1px;
            flex-shrink: 0;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }
        
        @media (max-width: 1024px) {
            .header-content {
                justify-content: center;
            }
            
            .logo {
                width: 100%;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .main-nav {
                max-width: 100%;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .nav-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-buttons .btn {
                width: 100%;
            }
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Dashboard Grid */
        .dashboard {
            margin-top: 30px;
            animation: fadeIn 0.6s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-family: 'Syne', sans-serif;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeIn 0.6s ease-out both;
        }

        .stat-card:nth-child(2) { animation-delay: 0.1s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.3s; }

        .stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            animation: fadeIn 0.6s ease-out 0.4s both;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-family: 'Syne', sans-serif;
            font-size: 22px;
            font-weight: 600;
        }

        /* Transactions */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .transaction-details h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .transaction-date {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .transaction-amount {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 600;
        }

        .transaction-amount.positive { color: var(--success); }
        .transaction-amount.negative { color: var(--danger); }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            gap: 12px;
        }

        .action-btn {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .action-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .action-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .action-text h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .action-text p {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* Events Section */
        .events-grid {
            display: grid;
            gap: 15px;
        }

        .event-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 18px;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .event-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .event-client {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .event-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-confirmed {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        .status-pending {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }
        
        .status-completed {
            background: rgba(79, 70, 229, 0.2);
            color: #4F46E5;
        }
        
        .status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
        }

        .event-details {
            display: flex;
            gap: 20px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .event-detail {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-submit {
            width: 100%;
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-title {
                font-size: 32px;
            }
        }

        /* Color variants */
        .bg-primary { background: rgba(255, 107, 53, 0.15); color: var(--primary); }
        .bg-secondary { background: rgba(0, 78, 137, 0.15); color: var(--secondary); }
        .bg-success { background: rgba(6, 214, 160, 0.15); color: var(--success); }
        .bg-accent { background: rgba(255, 210, 63, 0.15); color: var(--accent); }
        .bg-danger { background: rgba(239, 71, 111, 0.15); color: var(--danger); }

        /* Servi√ßos Styles */
        .servico-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .servico-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .servico-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .servico-nome {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .servico-categoria {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(255, 107, 53, 0.2);
            color: var(--primary);
            border-radius: 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .servico-valor {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--success);
        }

        .servico-descricao {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 8px;
            line-height: 1.5;
        }

        .servico-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .btn-delete {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .btn-delete:hover {
            background: var(--danger);
            color: white;
        }

        /* Checkbox personalizado */
        .servico-checkbox {
            display: flex;
            align-items: start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .servico-checkbox:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .servico-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .servico-checkbox-content {
            flex: 1;
        }

        .servico-checkbox-nome {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .servico-checkbox-info {
            display: flex;
            gap: 15px;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .servico-selecionado-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(6, 214, 160, 0.2);
            font-size: 13px;
        }

        .servico-selecionado-item:last-child {
            border-bottom: none;
        }

        /* Birthday Alert */
        /* Origem Stats */
        .origem-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .origem-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(3px);
        }

        .origem-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .origem-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .origem-label {
            font-weight: 600;
            font-size: 14px;
        }

        .origem-count {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .origem-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 8px;
            overflow: hidden;
        }

        .origem-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Birthday Card Compact */
        .birthday-card-compact {
            background: linear-gradient(135deg, rgba(255, 210, 63, 0.15), rgba(255, 107, 53, 0.15));
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 20px;
        }

        .birthday-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 210, 63, 0.3);
        }

        .birthday-icon {
            font-size: 32px;
            animation: bounce 2s infinite;
        }

        .birthday-card-title {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }

        .birthday-list {
            display: grid;
            gap: 10px;
        }

        .birthday-item-compact {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .birthday-item-compact:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .birthday-item-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .birthday-item-contact {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .birthday-badge-compact {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .badge-today {
            background: var(--accent);
            color: #0A0E27;
        }

        .badge-tomorrow {
            background: rgba(255, 210, 63, 0.3);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .badge-soon {
            background: rgba(255, 210, 63, 0.2);
            color: var(--text-secondary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Events Page */
        .events-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .events-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .events-view-toggle {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 8px;
        }

        .view-toggle-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Calendar View */
        .calendar-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 12px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
        }

        .calendar-day.today {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .calendar-day.has-event {
            border-color: var(--success);
            background: rgba(6, 214, 160, 0.1);
        }

        .calendar-day-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day-events {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .calendar-event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            display: inline-block;
            margin-right: 2px;
        }

        /* List View */
        .events-list-container {
            display: grid;
            gap: 15px;
        }

        .event-card-full {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .event-card-full:hover {
            background: var(--bg-card-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .event-card-full.status-confirmado {
            border-left-color: var(--success);
        }

        .event-card-full.status-pendente {
            border-left-color: var(--accent);
        }

        .event-card-full.status-cancelado {
            border-left-color: var(--danger);
        }

        .event-card-main {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .event-card-info h3 {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .event-card-client {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
        }

        .event-card-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
        }

        .event-detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .event-detail-item strong {
            color: var(--text-primary);
        }

        .event-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .event-action-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Kanban View */
        .kanban-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .kanban-column {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }

        .kanban-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .kanban-title {
            font-family: 'Syne', sans-serif;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kanban-count {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .kanban-cards {
            display: grid;
            gap: 12px;
            min-height: 200px;
        }

        .kanban-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            cursor: move;
            transition: all 0.3s ease;
        }

        .kanban-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: scale(1.02);
        }

        .kanban-card-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .kanban-card-info {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        /* Clientes Page */
        .clients-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-bar {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        .clients-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .client-stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .client-stat-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .client-stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .client-stat-info {
            flex: 1;
        }

        .client-stat-value {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .client-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clients-grid {
            display: grid;
            gap: 15px;
        }

        .client-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .client-card:hover {
            background: var(--bg-card-hover);
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .client-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .client-avatar {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .client-main-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .client-details-main h3 {
            font-family: 'Syne', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .client-email {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 4px;
        }

        .client-phone {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .client-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .client-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-birthday {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }

        .badge-origem {
            background: rgba(0, 78, 137, 0.2);
            color: var(--secondary);
        }

        .client-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .client-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .client-info-item strong {
            color: var(--text-primary);
        }

        .client-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .client-action-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .client-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-family: 'Syne', sans-serif;
            font-size: 24px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .empty-state-text {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* Client Financial Info */
        .client-financial {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-top: 16px;
            transition: all 0.3s ease;
        }

        .client-financial:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
        }

        .financial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .financial-title {
            font-family: 'Syne', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }

        .financial-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: rgba(6, 214, 160, 0.2);
            color: var(--success);
        }

        .status-pending {
            background: rgba(255, 210, 63, 0.2);
            color: var(--accent);
        }

        .status-overdue {
            background: rgba(239, 71, 111, 0.2);
            color: var(--danger);
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .financial-item {
            text-align: center;
        }

        .financial-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .financial-value {
            font-family: 'Syne', sans-serif;
            font-size: 18px;
            font-weight: 700;
        }

        .financial-value.total {
            color: var(--text-primary);
        }

        .financial-value.paid {
            color: var(--success);
        }

        .financial-value.pending {
            color: var(--primary);
        }

        .financial-date {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .payment-progress {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">EventPro</div>
            <nav class="main-nav">
                <button class="nav-tab active" onclick="switchTab('dashboard')">üè¢ Empresa</button>
                <button class="nav-tab" onclick="switchTab('pessoal')">üë§ Pessoal</button>
                <button class="nav-tab" onclick="switchTab('eventos')">Eventos</button>
                <button class="nav-tab" onclick="switchTab('clientes')">Clientes</button>
                <button class="nav-tab" onclick="switchTab('financeiro')">üí∞ Financeiro</button>
                <button class="nav-tab" onclick="switchTab('custos')">Custos</button>
                <button class="nav-tab" onclick="switchTab('servicos')">üì¶ Servi√ßos</button>
                <button class="nav-tab" onclick="switchTab('configuracoes')">‚öôÔ∏è Config</button>
            </nav>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="exportData()">üìä Relat√≥rios</button>
                <button class="btn" onclick="resetarDados()" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                    üóëÔ∏è Resetar
                </button>
                <button class="btn btn-primary" onclick="openModal('receita')">+ Nova Receita</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
        <div class="dashboard">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard Financeiro</h1>
                <p class="dashboard-subtitle">Gest√£o completa para sua empresa MEI de eventos</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                <div class="stat-card">
                    <div class="stat-icon bg-success">üí∞</div>
                    <div class="stat-label">Receitas do M√™s</div>
                    <div class="stat-value" id="totalReceitas">R$ 0,00</div>
                    <div class="stat-change positive">
                        <span>‚Üó</span>
                        <span id="percentReceitas">0%</span> vs m√™s anterior
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(79, 70, 229, 0.2); color: #4F46E5;">‚è≥</div>
                    <div class="stat-label">Valores a Receber</div>
                    <div class="stat-value" id="valoresAReceberDashboard">R$ 0,00</div>
                    <div class="stat-change" style="color: #4F46E5;">
                        <span>üìÖ</span>
                        <span id="numClientesPendentes">0</span> clientes
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-danger">üí∏</div>
                    <div class="stat-label">Despesas do M√™s</div>
                    <div class="stat-value" id="totalDespesas">R$ 0,00</div>
                    <div class="stat-change negative">
                        <span>‚Üò</span>
                        <span id="percentDespesas">0%</span> vs m√™s anterior
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(255, 107, 53, 0.2); color: var(--primary);">üéØ</div>
                    <div class="stat-label">Custos de Eventos</div>
                    <div class="stat-value" id="totalCustosEventos">R$ 0,00</div>
                    <div class="stat-change" style="color: var(--primary);">
                        <span>üìä</span>
                        <span id="numeroCustosEventos">0</span> lan√ßamentos
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-primary">üìà</div>
                    <div class="stat-label">Lucro L√≠quido</div>
                    <div class="stat-value" id="lucroLiquido">R$ 0,00</div>
                    <div class="stat-change positive">
                        <span>‚Üó</span>
                        <span id="percentLucro">0%</span> margem
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-accent">üéâ</div>
                    <div class="stat-label">Eventos do M√™s</div>
                    <div class="stat-value" id="totalEventos">0</div>
                    <div class="stat-change positive">
                        <span>‚Üó</span>
                        <span id="eventosConfirmados">0</span> confirmados
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="content-grid">
                <!-- Transactions -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Transa√ß√µes Recentes</h2>
                        <button class="btn btn-secondary" onclick="openModal('custoGeral')">+ Despesa</button>
                    </div>
                    <div id="transactionsList">
                        <!-- Transactions will be inserted here -->
                    </div>
                </div>

                <!-- Quick Actions & Events -->
                <div>
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <h2 class="card-title">A√ß√µes R√°pidas</h2>
                        </div>
                        <div class="quick-actions">
                            <button class="action-btn" onclick="openModal('evento')">
                                <div class="action-icon bg-primary">üéâ</div>
                                <div class="action-text">
                                    <h4>Novo Evento</h4>
                                    <p>Cadastrar evento</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('orcamento')">
                                <div class="action-icon bg-secondary">üìã</div>
                                <div class="action-text">
                                    <h4>Or√ßamento</h4>
                                    <p>Criar or√ßamento</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('cliente')">
                                <div class="action-icon bg-accent">üë•</div>
                                <div class="action-text">
                                    <h4>Cliente</h4>
                                    <p>Cadastrar cliente</p>
                                </div>
                            </button>
                            <button class="action-btn" onclick="openModal('servico')">
                                <div class="action-icon bg-success">üõ†Ô∏è</div>
                                <div class="action-text">
                                    <h4>Servi√ßos</h4>
                                    <p>Gerenciar servi√ßos</p>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Pr√≥ximos Eventos</h2>
                        </div>
                        <div class="events-grid" id="eventsList">
                            <!-- Events will be inserted here -->
                        </div>
                    </div>

                    <!-- Origem dos Clientes -->
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h2 class="card-title">Origem dos Clientes</h2>
                        </div>
                        <div id="origemStats">
                            <!-- Origem stats will be inserted here -->
                        </div>
                    </div>

                    <!-- Aniversariantes Card Compacto -->
                    <div id="birthdayAlertsCompact" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>
        </div>
        <!-- End Dashboard Tab -->

        <!-- Eventos Tab -->
        <div id="eventosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gest√£o de Eventos</h1>
                    <p class="dashboard-subtitle">Organize e gerencie todos os seus eventos</p>
                </div>

                <div class="events-header">
                    <div class="events-filters">
                        <button class="filter-btn active" onclick="filterEvents('todos')">Todos</button>
                        <button class="filter-btn" onclick="filterEvents('confirmado')">Confirmados</button>
                        <button class="filter-btn" onclick="filterEvents('pendente')">Pendentes</button>
                        <button class="filter-btn" onclick="filterEvents('cancelado')">Cancelados</button>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="events-view-toggle">
                            <button class="view-toggle-btn active" onclick="switchEventView('list')" title="Lista">üìã</button>
                            <button class="view-toggle-btn" onclick="switchEventView('calendar')" title="Calend√°rio">üìÖ</button>
                            <button class="view-toggle-btn" onclick="switchEventView('kanban')" title="Kanban">üìä</button>
                        </div>
                        <button class="btn btn-primary" onclick="openModal('evento')">+ Novo Evento</button>
                    </div>
                </div>

                <!-- Calendar View -->
                <div id="calendarView" style="display: none;">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h3 class="calendar-month" id="calendarMonth">Janeiro 2026</h3>
                            <div class="calendar-nav">
                                <button class="calendar-nav-btn" onclick="previousMonth()">‚óÄ</button>
                                <button class="calendar-nav-btn" onclick="todayMonth()">Hoje</button>
                                <button class="calendar-nav-btn" onclick="nextMonth()">‚ñ∂</button>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- List View -->
                <div id="listView">
                    <div class="events-list-container" id="eventsListFull">
                        <!-- Events will be rendered here -->
                    </div>
                </div>

                <!-- Kanban View -->
                <div id="kanbanView" style="display: none;">
                    <div class="kanban-container">
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--accent);">‚è≥ Pendentes</span>
                                <span class="kanban-count" id="kanbanPendenteCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanPendente">
                                <!-- Pendente cards -->
                            </div>
                        </div>
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--success);">‚úÖ Confirmados</span>
                                <span class="kanban-count" id="kanbanConfirmadoCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanConfirmado">
                                <!-- Confirmado cards -->
                            </div>
                        </div>
                        <div class="kanban-column">
                            <div class="kanban-header">
                                <span class="kanban-title" style="color: var(--danger);">‚ùå Cancelados</span>
                                <span class="kanban-count" id="kanbanCanceladoCount">0</span>
                            </div>
                            <div class="kanban-cards" id="kanbanCancelado">
                                <!-- Cancelado cards -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Eventos Tab -->

        <!-- Clientes Tab -->
        <div id="clientesTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gest√£o de Clientes</h1>
                    <p class="dashboard-subtitle">Mantenha todos os seus clientes organizados</p>
                </div>

                <div class="clients-header">
                    <div class="search-bar">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="clientSearch" placeholder="Buscar cliente por nome, email ou telefone..." oninput="searchClients()">
                    </div>
                    <button class="btn btn-primary" onclick="openModal('cliente')">+ Novo Cliente</button>
                </div>

                <!-- Client Stats -->
                <div class="clients-stats">
                    <div class="client-stat-card">
                        <div class="client-stat-icon bg-primary">üë•</div>
                        <div class="client-stat-info">
                            <div class="client-stat-value" id="totalClientes">0</div>
                            <div class="client-stat-label">Total de Clientes</div>
                        </div>
                    </div>
                    <div class="client-stat-card">
                        <div class="client-stat-icon bg-success">üéÇ</div>
                        <div class="client-stat-info">
                            <div class="client-stat-value" id="aniversariantesProximos">0</div>
                            <div class="client-stat-label">Anivers√°rios Este M√™s</div>
                        </div>
                    </div>
                    <div class="client-stat-card">
                        <div class="client-stat-icon bg-accent">üì∏</div>
                        <div class="client-stat-info">
                            <div class="client-stat-value" id="clientesInstagram">0</div>
                            <div class="client-stat-label">Via Instagram</div>
                        </div>
                    </div>
                    <div class="client-stat-card">
                        <div class="client-stat-icon bg-secondary">ü§ù</div>
                        <div class="client-stat-info">
                            <div class="client-stat-value" id="clientesIndicacao">0</div>
                            <div class="client-stat-label">Via Indica√ß√£o</div>
                        </div>
                    </div>
                </div>

                <!-- Clients List -->
                <div class="clients-grid" id="clientsList">
                    <!-- Clients will be rendered here -->
                </div>
            </div>
        </div>
        <!-- End Clientes Tab -->

        <!-- Financeiro Tab -->
        <div id="financeiroTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üí∞ Gest√£o Financeira</h1>
                    <p class="dashboard-subtitle">Controle completo de receitas, despesas e contas banc√°rias</p>
                </div>
                
                <!-- Filtros de Per√≠odo -->
                <div style="background: var(--card-bg); padding: 16px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 12px; align-items: end;">
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">üìÖ M√™s</label>
                            <select id="filtroMesFinanceiro" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <option value="todos">Todos os meses</option>
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Mar√ßo</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">üìÜ Ano</label>
                            <select id="filtroAnoFinanceiro" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <!-- Ser√° preenchido dinamicamente -->
                            </select>
                        </div>
                        <div>
                            <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">üìä Visualiza√ß√£o</label>
                            <select id="tipoVisualizacao" class="form-select" onchange="atualizarFinanceiroPorPeriodo()">
                                <option value="mensal">Mensal</option>
                                <option value="anual">Anual</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="resetarFiltrosFinanceiro()" style="height: 42px;">
                            üîÑ Limpar
                        </button>
                    </div>
                </div>

                <!-- Sub-navega√ß√£o Financeira -->
                <div style="display: flex; gap: 12px; margin-bottom: 24px; background: var(--card-bg); padding: 16px; border-radius: 12px;">
                    <button class="btn btn-primary" id="btnFinanceiroVisaoGeral" onclick="mostrarFinanceiroVisaoGeral()" style="flex: 1;">
                        üìä Vis√£o Geral
                    </button>
                    <button class="btn btn-secondary" id="btnFinanceiroPorConta" onclick="mostrarFinanceiroPorConta()" style="flex: 1;">
                        üè¶ Por Conta
                    </button>
                    <button class="btn btn-secondary" id="btnFinanceiroContas" onclick="mostrarFinanceiroContas()" style="flex: 1;">
                        ‚öôÔ∏è Gerenciar Contas
                    </button>
                </div>

                <!-- Vis√£o Geral -->
                <div id="financeiroVisaoGeral">
                    <!-- Cards de Resumo -->
                    <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(6, 214, 160, 0.2), rgba(6, 214, 160, 0.05));">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-info">
                                <div class="stat-label">Total de Receitas</div>
                                <div class="stat-value" id="financeiroTotalReceitas">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(79, 70, 229, 0.05));">
                            <div class="stat-icon">‚è≥</div>
                            <div class="stat-info">
                                <div class="stat-label">Valores a Receber</div>
                                <div class="stat-value" id="financeiroValoresAReceber">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(239, 71, 111, 0.2), rgba(239, 71, 111, 0.05));">
                            <div class="stat-icon">üí∏</div>
                            <div class="stat-info">
                                <div class="stat-label">Total de Despesas</div>
                                <div class="stat-value" id="financeiroTotalDespesas">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.05));">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-info">
                                <div class="stat-label">Custos de Eventos</div>
                                <div class="stat-value" id="financeiroCustosEventos">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 210, 63, 0.2), rgba(255, 210, 63, 0.05));">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-info">
                                <div class="stat-label">Lucro L√≠quido</div>
                                <div class="stat-value" id="financeiroLucro">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, rgba(0, 78, 137, 0.2), rgba(0, 78, 137, 0.05));">
                            <div class="stat-icon">üè¶</div>
                            <div class="stat-info">
                                <div class="stat-label">Contas Cadastradas</div>
                                <div class="stat-value" id="financeiroTotalContas">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card de Origem dos Pagamentos -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h2 class="card-title">üí≥ Origem dos Pagamentos</h2>
                        </div>
                        <div id="origemPagamentosContainer" style="padding: 0 20px 20px;">
                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>
                        </div>
                    </div>
                    
                    <!-- Breakdown Anual (quando filtrar por ano) -->
                    <div id="breakdownAnual" style="display: none;"></div>

                    <!-- Gr√°fico de Pizza Formas de Pagamento -->
                    <div class="card" style="margin-top: 24px;">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">üìä Receitas por Forma de Pagamento</h3>
                        <div id="graficoFormasPagamento" style="display: grid; gap: 12px;">
                            <!-- Ser√° preenchido dinamicamente -->
                        </div>
                    </div>

                    <!-- √öltimas Transa√ß√µes -->
                    <div class="card" style="margin-top: 24px;">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">üìù √öltimas Transa√ß√µes</h3>
                        <div id="ultimasTransacoes">
                            <!-- Ser√° preenchido dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Vis√£o Por Conta -->
                <div id="financeiroPorConta" style="display: none;">
                    <div class="card">
                        <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;">üí≥ Saldo por Conta Banc√°ria</h3>
                        <div id="listaContasComSaldo">
                            <!-- Ser√° preenchido dinamicamente -->
                        </div>
                    </div>

                    <!-- Detalhes da Conta Selecionada -->
                    <div id="detalhesConta" style="margin-top: 24px; display: none;">
                        <div class="card">
                            <h3 style="font-family: 'Syne', sans-serif; margin-bottom: 16px;" id="detalheContaTitulo">
                                <!-- Nome da conta -->
                            </h3>
                            
                            <div class="stats-grid" style="margin-bottom: 24px;">
                                <div class="stat-card" style="background: rgba(6, 214, 160, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Total Recebido</div>
                                        <div class="stat-value" id="detalheContaReceitas">R$ 0,00</div>
                                    </div>
                                </div>
                                <div class="stat-card" style="background: rgba(239, 71, 111, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Total Pago</div>
                                        <div class="stat-value" id="detalheContaDespesas">R$ 0,00</div>
                                    </div>
                                </div>
                                <div class="stat-card" style="background: rgba(255, 210, 63, 0.1);">
                                    <div class="stat-info">
                                        <div class="stat-label">Saldo Atual</div>
                                        <div class="stat-value" id="detalheContaSaldo">R$ 0,00</div>
                                    </div>
                                </div>
                            </div>

                            <h4 style="font-size: 16px; margin-bottom: 12px; color: var(--text-secondary);">Transa√ß√µes desta Conta</h4>
                            <div id="detalheContaTransacoes">
                                <!-- Ser√° preenchido dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gerenciar Contas -->
                <div id="financeiroContas" style="display: none;">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="font-family: 'Syne', sans-serif;">üè¶ Contas Banc√°rias</h3>
                            <button class="btn btn-primary" onclick="openModal('conta')">+ Nova Conta</button>
                        </div>
                        <div id="listaContasBancarias">
                            <!-- Ser√° preenchido dinamicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Financeiro Tab -->

        <!-- Custos Tab -->
        <div id="custosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Gest√£o de Custos</h1>
                    <p class="dashboard-subtitle">Controle todos os gastos da empresa e dos eventos</p>
                </div>

                <!-- Toggle entre Custos Gerais e Por Evento -->
                <div style="display: flex; gap: 15px; margin-bottom: 25px; background: var(--bg-card); padding: 8px; border-radius: 12px; width: fit-content;">
                    <button class="filter-btn active" onclick="toggleCustosView('gerais')">
                        üè¢ Custos Gerais da Empresa
                    </button>
                    <button class="filter-btn" onclick="toggleCustosView('eventos')">
                        üéâ Custos por Evento
                    </button>
                </div>

                <!-- Custos Gerais View -->
                <div id="custosGeraisView">
                    <div class="events-header" style="margin-bottom: 20px;">
                        <h2 style="font-family: 'Syne', sans-serif; font-size: 22px; color: var(--primary);">
                            üíº Custos Gerais da Empresa
                        </h2>
                        <button class="btn btn-primary" onclick="openModal('custoGeral')">+ Novo Custo</button>
                    </div>

                    <!-- Stats Custos Gerais -->
                    <div class="stats-grid" style="margin-bottom: 25px;">
                        <div class="stat-card">
                            <div class="stat-icon bg-danger">üí∏</div>
                            <div class="stat-label">Total do M√™s</div>
                            <div class="stat-value" id="totalCustosGeraisMes">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-accent">‚õΩ</div>
                            <div class="stat-label">Combust√≠vel</div>
                            <div class="stat-value" id="totalCombustivel">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-secondary">üìã</div>
                            <div class="stat-label">Impostos</div>
                            <div class="stat-value" id="totalImpostos">R$ 0,00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">üè™</div>
                            <div class="stat-label">Outros</div>
                            <div class="stat-value" id="totalOutrosCustos">R$ 0,00</div>
                        </div>
                    </div>

                    <!-- Lista de Custos Gerais -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Hist√≥rico de Custos Gerais</h3>
                        </div>
                        <div id="custosGeraisList" style="display: grid; gap: 12px;">
                            <!-- Custos gerais ser√£o renderizados aqui -->
                        </div>
                    </div>
                </div>

                <!-- Custos por Evento View -->
                <div id="custosEventosView" style="display: none;">
                    <div class="events-header" style="margin-bottom: 20px;">
                        <h2 style="font-family: 'Syne', sans-serif; font-size: 22px; color: var(--primary);">
                            üéâ Custos por Evento
                        </h2>
                        <select class="form-select" id="eventoSelecionado" onchange="renderCustosEvento()" style="max-width: 400px; background: var(--bg-card); color: var(--text-primary);">
                            <option value="">Selecione um evento...</option>
                        </select>
                    </div>

                    <div id="custoEventoContent" style="display: none;">
                        <!-- Info do Evento Selecionado -->
                        <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 210, 63, 0.1));">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h3 id="eventoNome" style="font-family: 'Syne', sans-serif; font-size: 20px; margin-bottom: 8px;"></h3>
                                    <div id="eventoInfo" style="color: var(--text-secondary); font-size: 14px;"></div>
                                </div>
                                <button class="btn btn-primary" onclick="openModalCustoEvento()">+ Adicionar Custo</button>
                            </div>
                        </div>

                        <!-- Resumo Financeiro do Evento -->
                        <div class="stats-grid" style="margin-bottom: 25px;">
                            <div class="stat-card">
                                <div class="stat-icon bg-success">üí∞</div>
                                <div class="stat-label">Valor do Evento</div>
                                <div class="stat-value" id="eventoValorTotal">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-danger">üí∏</div>
                                <div class="stat-label">Total de Custos</div>
                                <div class="stat-value" id="eventoTotalCustos">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-primary">üìä</div>
                                <div class="stat-label">Lucro L√≠quido</div>
                                <div class="stat-value" id="eventoLucro">R$ 0,00</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon bg-accent">üìà</div>
                                <div class="stat-label">Margem de Lucro</div>
                                <div class="stat-value" id="eventoMargem">0%</div>
                            </div>
                        </div>

                        <!-- Lista de Custos do Evento -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Detalhamento de Custos</h3>
                            </div>
                            <div id="custosEventoList" style="display: grid; gap: 12px;">
                                <!-- Custos do evento ser√£o renderizados aqui -->
                            </div>
                        </div>
                    </div>

                    <div id="custoEventoEmpty" style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.5;">üìä</div>
                        <h3 style="color: var(--text-secondary); margin-bottom: 8px;">Selecione um evento</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            Escolha um evento acima para ver e gerenciar seus custos
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Custos Tab -->
        <!-- End Custos Tab -->

        <!-- Servi√ßos Tab -->
        <div id="servicosTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üì¶ Gest√£o de Servi√ßos</h1>
                    <p class="dashboard-subtitle">An√°lise completa de performance e rentabilidade dos seus servi√ßos</p>
                </div>

                <!-- Cards de Resumo -->
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(6, 214, 160, 0.2), rgba(6, 214, 160, 0.05));">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-info">
                            <div class="stat-label">Total de Servi√ßos</div>
                            <div class="stat-value" id="totalServicos">0</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 210, 63, 0.2), rgba(255, 210, 63, 0.05));">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <div class="stat-label">Total de Loca√ß√µes</div>
                            <div class="stat-value" id="totalLocacoes">0</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(79, 70, 229, 0.05));">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <div class="stat-label">Receita Total</div>
                            <div class="stat-value" id="receitaTotalServicos">R$ 0,00</div>
                        </div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.05));">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-info">
                            <div class="stat-label">Servi√ßo Mais Popular</div>
                            <div class="stat-value" id="servicoMaisPopular" style="font-size: 16px;">-</div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Servi√ßos com Estat√≠sticas -->
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 class="card-title">üìä Performance dos Servi√ßos</h2>
                        <button class="btn btn-primary" onclick="openModal('servico')">+ Novo Servi√ßo</button>
                    </div>
                    <div id="servicosPerformanceList">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>
                </div>

                <!-- Top 5 Servi√ßos -->
                <div class="content-grid" style="margin-top: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üèÜ Top 5 Mais Contratados</h2>
                        </div>
                        <div id="topServicosContratados"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üíé Top 5 Mais Rent√°veis</h2>
                        </div>
                        <div id="topServicosRentaveis"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Servi√ßos Tab -->

        <!-- Configura√ß√µes Tab -->
        <div id="configuracoesTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">‚öôÔ∏è Configura√ß√µes</h1>
                    <p class="dashboard-subtitle">Personalize seu sistema e configure dados da empresa</p>
                </div>

                <!-- Sub-navega√ß√£o Configura√ß√µes -->
                <div style="display: flex; gap: 12px; margin-bottom: 24px; background: var(--card-bg); padding: 16px; border-radius: 12px; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="btnConfigPerfil" onclick="mostrarConfigSecao('perfil')" style="flex: 1; min-width: 150px;">
                        üë§ Perfil da Empresa
                    </button>
                    <button class="btn btn-secondary" id="btnConfigDocumentos" onclick="mostrarConfigSecao('documentos')" style="flex: 1; min-width: 150px;">
                        üìÑ Documentos
                    </button>
                    <button class="btn btn-secondary" id="btnConfigLogo" onclick="mostrarConfigSecao('logo')" style="flex: 1; min-width: 150px;">
                        üé® Logo
                    </button>
                </div>

                <!-- Se√ß√£o: Perfil da Empresa -->
                <div id="configPerfilSecao">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üë§ Perfil da Empresa</h2>
                        </div>
                        <form onsubmit="salvarConfigEmpresa(event)" style="padding: 24px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Nome da Empresa *</label>
                                    <input type="text" class="form-input" id="configNomeEmpresa" required placeholder="Ex: EventPro Produ√ß√µes">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nome Corporativo</label>
                                    <input type="text" class="form-input" id="configNomeCorporativo" placeholder="Ex: EventPro Produ√ß√µes LTDA">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">CNPJ</label>
                                    <input type="text" class="form-input" id="configCNPJ" placeholder="00.000.000/0000-00" maxlength="18" oninput="formatCNPJ(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telefone *</label>
                                    <input type="text" class="form-input" id="configTelefone" required placeholder="(00) 00000-0000" maxlength="15" oninput="formatTelefone(this)">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">WhatsApp Business</label>
                                    <input type="text" class="form-input" id="configWhatsapp" placeholder="(00) 00000-0000" maxlength="15" oninput="formatTelefone(this)">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">E-mail</label>
                                    <input type="email" class="form-input" id="configEmail" placeholder="contato@eventpro.com">
                                </div>
                            </div>

                            <div style="background: rgba(79, 70, 229, 0.1); padding: 16px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #4F46E5;">
                                <h4 style="margin-bottom: 12px; color: #4F46E5;">üåê Redes Sociais</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Instagram</label>
                                        <input type="text" class="form-input" id="configInstagram" placeholder="@eventpro">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Facebook</label>
                                        <input type="text" class="form-input" id="configFacebook" placeholder="facebook.com/eventpro">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">YouTube</label>
                                        <input type="text" class="form-input" id="configYoutube" placeholder="youtube.com/@eventpro">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="url" class="form-input" id="configSite" placeholder="https://eventpro.com">
                                    </div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end;">
                                <button type="submit" class="btn btn-primary">
                                    ‚úÖ Salvar Configura√ß√µes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Se√ß√£o: Documentos -->
                <div id="configDocumentosSecao" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìÑ Cl√°usulas Contratuais</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Configure o texto do contrato que ser√° enviado aos seus clientes
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <div class="form-group">
                                <label class="form-label">Texto do Contrato</label>
                                <textarea 
                                    id="configClausulasContratuais" 
                                    class="form-input" 
                                    rows="20" 
                                    style="font-family: 'IBM Plex Mono', monospace; font-size: 13px; line-height: 1.6;"
                                    placeholder="Digite aqui as cl√°usulas do contrato...

Exemplo:

CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS DE EVENTOS

1. DO OBJETO
O presente contrato tem por objeto a presta√ß√£o de servi√ßos de [TIPO DE SERVI√áO] pela CONTRATADA em favor do CONTRATANTE.

2. DAS CONDI√á√ïES
2.1. Data do Evento: [DATA]
2.2. Hor√°rio: [HOR√ÅRIO]
2.3. Local: [ENDERE√áO]

3. DO VALOR E FORMA DE PAGAMENTO
3.1. O valor total do servi√ßo √© de R$ [VALOR]
3.2. Sinal de R$ [SINAL] pago em [DATA]
3.3. Restante de R$ [RESTANTE] at√© [VENCIMENTO]

4. DAS OBRIGA√á√ïES DA CONTRATADA
...

5. DAS OBRIGA√á√ïES DO CONTRATANTE
...

6. DO CANCELAMENTO
...

7. DISPOSI√á√ïES GERAIS
..."
                                ></textarea>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                                    üí° Dica: Use placeholders como [DATA], [VALOR], [CLIENTE] que ser√£o substitu√≠dos automaticamente ao gerar o contrato
                                </div>
                            </div>

                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="salvarClausulasContratuais()" class="btn btn-primary">
                                    ‚úÖ Salvar Cl√°usulas
                                </button>
                                <button onclick="resetarClausulas()" class="btn btn-secondary">
                                    üîÑ Resetar para Padr√£o
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o: Logo -->
                <div id="configLogoSecao" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üé® Logo da Empresa</h2>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                                Adicione a logo da sua empresa para usar em or√ßamentos e documentos
                            </p>
                        </div>
                        <div style="padding: 24px;">
                            <!-- Preview da Logo -->
                            <div style="text-align: center; margin-bottom: 30px;">
                                <div id="logoPreview" style="min-height: 200px; background: rgba(255, 255, 255, 0.05); border: 2px dashed var(--border); border-radius: 12px; display: flex; align-items: center; justify-content: center; padding: 40px;">
                                    <div id="logoPlaceholder" style="text-align: center; color: var(--text-secondary);">
                                        <div style="font-size: 48px; margin-bottom: 16px;">üé®</div>
                                        <div style="font-size: 14px;">Nenhuma logo carregada</div>
                                        <div style="font-size: 12px; margin-top: 8px;">Clique no bot√£o abaixo para adicionar</div>
                                    </div>
                                    <img id="logoImage" style="max-width: 100%; max-height: 300px; display: none; border-radius: 8px;">
                                </div>
                            </div>

                            <!-- Upload -->
                            <div style="text-align: center;">
                                <input type="file" id="logoUpload" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                                <button onclick="document.getElementById('logoUpload').click()" class="btn btn-primary" style="margin-right: 12px;">
                                    üì§ Carregar Logo
                                </button>
                                <button onclick="removerLogo()" class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                                    üóëÔ∏è Remover Logo
                                </button>
                            </div>

                            <div style="background: rgba(255, 210, 63, 0.1); padding: 16px; border-radius: 8px; margin-top: 24px; border-left: 4px solid var(--accent);">
                                <strong style="color: var(--accent);">‚ö†Ô∏è Requisitos da Imagem:</strong>
                                <ul style="margin: 8px 0 0 20px; font-size: 13px; color: var(--text-secondary);">
                                    <li>Formato: JPG, PNG ou SVG</li>
                                    <li>Tamanho m√°ximo: 2MB</li>
                                    <li>Recomendado: Fundo transparente (PNG)</li>
                                    <li>Propor√ß√£o ideal: 2:1 (horizontal)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Configura√ß√µes Tab -->
        <!-- Pessoal Tab -->
        <div id="pessoalTab" class="tab-content">
            <div class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">üë§ Financeiro Pessoal</h1>
                    <p class="dashboard-subtitle">Controle suas finan√ßas pessoais separado da empresa</p>
                </div>

                <!-- Stats Cards Pessoal -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-icon bg-success">üíµ</div>
                        <div class="stat-label">Receitas Pessoais</div>
                        <div class="stat-value" id="receitasPessoais">R$ 0,00</div>
                        <div class="stat-change positive">
                            <span>‚Üó</span>
                            Este m√™s
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon bg-danger">üí≥</div>
                        <div class="stat-label">Despesas Pessoais</div>
                        <div class="stat-value" id="despesasPessoais">R$ 0,00</div>
                        <div class="stat-change negative">
                            <span>‚Üò</span>
                            Este m√™s
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(255, 107, 53, 0.2); color: var(--primary);">üìä</div>
                        <div class="stat-label">Saldo Pessoal</div>
                        <div class="stat-value" id="saldoPessoal">R$ 0,00</div>
                        <div class="stat-change" style="color: var(--primary);">
                            <span>üí∞</span>
                            Dispon√≠vel
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon bg-accent">üè¶</div>
                        <div class="stat-label">Contas/Cart√µes</div>
                        <div class="stat-value" id="totalContasPessoais">0</div>
                        <div class="stat-change" style="color: var(--accent);">
                            <span>üìã</span>
                            Ativas
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes R√°pidas -->
                <div class="content-grid" style="margin-top: 30px;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üí∞ Receitas Pessoais</h2>
                            <button class="btn btn-primary" onclick="openModal('receitaPessoal')">+ Nova Receita</button>
                        </div>
                        <div id="listaReceitasPessoais"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üí≥ Despesas Pessoais</h2>
                            <button class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);" onclick="openModal('despesaPessoal')">+ Nova Despesa</button>
                        </div>
                        <div id="listaDespesasPessoais"></div>
                    </div>
                </div>

                <!-- Contas e Cart√µes Pessoais -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">üè¶ Minhas Contas e Cart√µes</h2>
                        <button class="btn btn-primary" onclick="openModal('contaPessoal')">+ Nova Conta/Cart√£o</button>
                    </div>
                    <div id="listaContasPessoais"></div>
                </div>

                <!-- Despesas por Categoria -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <h2 class="card-title">üìä Despesas por Categoria</h2>
                    </div>
                    <div id="despesasPorCategoria" style="padding: 20px;"></div>
                </div>
            </div>
        </div>
        <!-- End Pessoal Tab -->
    </div>

    <!-- Modal Receita Pessoal -->
    <div id="modalReceitaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üíµ Nova Receita Pessoal</h2>
                <button class="close-btn" onclick="closeModal('receitaPessoal')">√ó</button>
            </div>
            <form onsubmit="addReceitaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="receitaPessoalDesc" required placeholder="Ex: Sal√°rio, Freelance, Venda">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="receitaPessoalCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="salario">üíº Sal√°rio</option>
                            <option value="freelance">üíª Freelance</option>
                            <option value="investimentos">üìà Investimentos</option>
                            <option value="aluguel">üè† Aluguel Recebido</option>
                            <option value="venda">üí∞ Venda</option>
                            <option value="retirada_empresa">üè¢ Retirada da Empresa</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="receitaPessoalValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="receitaPessoalData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta/Cart√£o</label>
                        <select class="form-select" id="receitaPessoalConta">
                            <option value="">N√£o informado</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Receita</button>
            </form>
        </div>
    </div>

    <!-- Modal Despesa Pessoal -->
    <div id="modalDespesaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí≥ Nova Despesa Pessoal</h2>
                <button class="close-btn" onclick="closeModal('despesaPessoal')">√ó</button>
            </div>
            <form onsubmit="addDespesaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="despesaPessoalDesc" required placeholder="Ex: Mercado, Conta de Luz, Aluguel">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="despesaPessoalCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="moradia">üè† Moradia</option>
                            <option value="alimentacao">üçî Alimenta√ß√£o</option>
                            <option value="transporte">üöó Transporte</option>
                            <option value="saude">‚öïÔ∏è Sa√∫de</option>
                            <option value="educacao">üìö Educa√ß√£o</option>
                            <option value="lazer">üéÆ Lazer</option>
                            <option value="vestuario">üëï Vestu√°rio</option>
                            <option value="contas">üìÑ Contas e Servi√ßos</option>
                            <option value="cartao">üí≥ Cart√£o de Cr√©dito</option>
                            <option value="prestacao">üìä Presta√ß√£o/Parcelamento</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="despesaPessoalValor" required placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="despesaPessoalData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta/Cart√£o</label>
                        <select class="form-select" id="despesaPessoalConta">
                            <option value="">N√£o informado</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="despesaPessoalObs" placeholder="Detalhes adicionais..." rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Despesa</button>
            </form>
        </div>
    </div>

    <!-- Modal Conta Pessoal -->
    <div id="modalContaPessoal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üè¶ Nova Conta/Cart√£o Pessoal</h2>
                <button class="close-btn" onclick="closeModal('contaPessoal')">√ó</button>
            </div>
            <form onsubmit="addContaPessoal(event)">
                <div class="form-group">
                    <label class="form-label">Nome da Conta/Cart√£o</label>
                    <input type="text" class="form-input" id="contaPessoalNome" required placeholder="Ex: Conta Corrente, Cart√£o Nubank">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="contaPessoalTipo" required>
                            <option value="">Selecione...</option>
                            <option value="corrente">üè¶ Conta Corrente</option>
                            <option value="poupanca">üí∞ Poupan√ßa</option>
                            <option value="cartao_credito">üí≥ Cart√£o de Cr√©dito</option>
                            <option value="cartao_debito">üí≥ Cart√£o de D√©bito</option>
                            <option value="investimento">üìà Investimento</option>
                            <option value="dinheiro">üíµ Dinheiro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Saldo Inicial</label>
                        <input type="number" step="0.01" class="form-input" id="contaPessoalSaldo" placeholder="0,00">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Banco/Institui√ß√£o</label>
                    <input type="text" class="form-input" id="contaPessoalBanco" placeholder="Ex: Nubank, Inter, Banco do Brasil">
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Conta/Cart√£o</button>
            </form>
        </div>
    </div>

    <!-- Modal Financeiro do Cliente -->
    <div id="modalFinanceiro" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí∞ Dados Financeiros</h2>
                <button class="close-btn" onclick="closeModal('financeiro')">√ó</button>
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(255, 107, 53, 0.1); border-radius: 8px;">
                <strong id="financeiroClienteNome" style="color: var(--primary); font-size: 16px;">Cliente</strong>
            </div>
            
            <!-- Mensagem informativa para novo cliente -->
            <div id="financeiroNovoClienteMsg" style="display: none; margin-bottom: 20px; padding: 16px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                    ‚úÖ Cliente cadastrado com sucesso!
                </div>
                <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.5;">
                    Escolha uma op√ß√£o:<br>
                    ‚Ä¢ <strong>Adicionar Financeiro:</strong> Registre valores e prazos<br>
                    ‚Ä¢ <strong>Criar Or√ßamento:</strong> Monte um or√ßamento completo com servi√ßos<br>
                    ‚Ä¢ <strong>Criar Evento:</strong> Cadastre direto sem or√ßamento<br>
                    ‚Ä¢ <strong>Pular:</strong> Adicione depois
                </div>
            </div>
            
            <form onsubmit="saveFinanceiro(event)">
                <input type="hidden" id="financeiroClienteId">
                
                <div class="form-group">
                    <label class="form-label">Valor Total do Servi√ßo</label>
                    <input type="number" step="0.01" class="form-input" id="financeiroValorTotal" placeholder="0,00" oninput="calcularSaldoFinanceiro()">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor do Sinal</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroSinalValor" placeholder="0,00" oninput="calcularSaldoFinanceiro()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data do Sinal</label>
                        <input type="date" class="form-input" id="financeiroSinalData">
                    </div>
                </div>

                <div class="form-group" id="formaPagamentoSinalGroup" style="display: none;">
                    <label class="form-label">Forma de Pagamento do Sinal üí≥</label>
                    <select class="form-select" id="financeiroSinalFormaPagamento">
                        <option value="">Selecione...</option>
                        <option value="pix">üí≥ PIX</option>
                        <option value="dinheiro">üíµ Dinheiro</option>
                        <option value="debito">üí≥ D√©bito</option>
                        <option value="credito">üí≥ Cart√£o de Cr√©dito</option>
                        <option value="transferencia">üè¶ Transfer√™ncia</option>
                        <option value="boleto">üìÑ Boleto</option>
                    </select>
                </div>
                
                <div class="form-group" id="contaSinalGroup" style="display: none;">
                    <label class="form-label">Conta Banc√°ria üè¶</label>
                    <select class="form-select" id="financeiroSinalConta">
                        <option value="">Selecione a conta...</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor a Pagar</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroValorPagar" placeholder="0,00" readonly style="background: rgba(255, 107, 53, 0.1); font-weight: 600; font-size: 18px; color: var(--primary);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Vencimento</label>
                        <input type="date" class="form-input" id="financeiroVencimento">
                    </div>
                </div>


                <!-- Se√ß√£o de Pagamento do Restante -->
                <div id="secaoPagamentoRestante" style="display: none; padding: 16px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-bottom: 16px;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 12px;">
                        üí∞ Registrar Pagamento
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Valor do Pagamento</label>
                        <input type="number" step="0.01" class="form-input" id="financeiroValorPagamentoRestante" placeholder="Digite o valor ou deixe vazio para pagar tudo" oninput="atualizarBotaoPagamentoRestante()">
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            üí° Deixe vazio para pagar o valor total restante (<strong id="valorRestanteDisplay">R$ 0,00</strong>)
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data do Pagamento</label>
                            <input type="date" class="form-input" id="financeiroDataPagamentoRestante">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Forma de Pagamento üí≥</label>
                            <select class="form-select" id="financeiroFormaPagamentoRestante">
                                <option value="">Selecione...</option>
                                <option value="pix">üí≥ PIX</option>
                                <option value="dinheiro">üíµ Dinheiro</option>
                                <option value="debito">üí≥ D√©bito</option>
                                <option value="credito">üí≥ Cart√£o de Cr√©dito</option>
                                <option value="transferencia">üè¶ Transfer√™ncia</option>
                                <option value="boleto">üìÑ Boleto</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Conta Banc√°ria üè¶</label>
                        <select class="form-select" id="financeiroContaPagamentoRestante">
                            <option value="">Selecione a conta...</option>
                        </select>
                    </div>
                    
                    <button type="button" onclick="registrarPagamentoRestante()" class="btn btn-primary" id="btnPagamentoRestante" style="width: 100%;">
                        ‚úÖ Confirmar Pagamento
                    </button>
                </div>
                <div id="resumoFinanceiroModal" style="background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; padding: 16px; margin-top: 16px; display: none;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 12px;">üìä Resumo Financeiro:</div>
                    <div style="display: grid; gap: 8px; font-size: 14px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Valor Total:</span>
                            <strong id="resumoTotalModal">R$ 0,00</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Sinal Recebido:</span>
                            <strong id="resumoSinalModal" style="color: var(--success);">R$ 0,00</strong>
                        </div>
                        
                        <!-- Hist√≥rico de Pagamentos Adicionais -->
                        <div id="historicoPagamentosAdicionais" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(6, 214, 160, 0.2);">
                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 600;">
                                üí∞ Pagamentos Adicionais:
                            </div>
                            <div id="listaPagamentosAdicionais" style="display: grid; gap: 4px; font-size: 12px;">
                                <!-- Ser√° preenchido dinamicamente -->
                            </div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid rgba(6, 214, 160, 0.3);">
                            <span style="font-weight: 600;">Total Pago:</span>
                            <strong id="resumoTotalPagoModal" style="color: var(--success); font-size: 16px;">R$ 0,00</strong>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between;">
                            <span>Saldo Devedor:</span>
                            <strong id="resumoSaldoModal" style="color: var(--primary); font-size: 16px;">R$ 0,00</strong>
                        </div>
                    </div>
                    <div class="progress-bar" style="margin-top: 12px; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                        <div id="progressBarModal" class="progress-fill" style="height: 100%; background: linear-gradient(90deg, var(--success), var(--accent)); transition: width 0.5s ease;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        <span id="progressPercentModal">0%</span> pago
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-submit" style="width: 100%; margin-top: 20px;">
                    üí∞ Salvar Dados Financeiros
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Custo Geral -->
    <div id="modalCustoGeral" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üíº Novo Custo Geral</h2>
                <button class="close-btn" onclick="closeModal('custoGeral')">√ó</button>
            </div>
            <form onsubmit="addCustoGeral(event)">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="custoGeralDescricao" required placeholder="Ex: Combust√≠vel, Impostos, Manuten√ß√£o">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="custoGeralCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="retirada_lucros">üí∞ Retirada de Lucros</option>
                            <option value="combustivel">‚õΩ Combust√≠vel</option>
                            <option value="impostos">üìã Impostos e Taxas</option>
                            <option value="aluguel">üè¢ Aluguel/Espa√ßo</option>
                            <option value="manutencao">üîß Manuten√ß√£o</option>
                            <option value="equipamentos">üì¶ Equipamentos/Materiais</option>
                            <option value="marketing">üì¢ Marketing</option>
                            <option value="administrativo">üìä Administrativo</option>
                            <option value="pessoal">üë• Pessoal Fixo</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="custoGeralValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta Banc√°ria üè¶</label>
                        <select class="form-select" id="custoGeralConta">
                            <option value="">N√£o informado</option>
                            <!-- Ser√° preenchido dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="custoGeralData" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="custoGeralObs" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Custo</button>
            </form>
        </div>
    </div>

    <!-- Modal Custo de Evento -->
    <div id="modalCustoEvento" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üéâ Novo Custo do Evento</h2>
                <button class="close-btn" onclick="closeModal('custoEvento')">√ó</button>
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(255, 107, 53, 0.1); border-radius: 8px;">
                <strong id="custoEventoNome" style="color: var(--primary); font-size: 16px;">Evento</strong>
            </div>
            <form onsubmit="addCustoEvento(event)">
                <input type="hidden" id="custoEventoId">
                
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="custoEventoDescricao" required placeholder="Ex: Ajudante, Equipamento, Material">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="custoEventoCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="ajudantes">üë∑ Ajudantes/Equipe</option>
                            <option value="equipamentos">üì¶ Equipamentos Alugados</option>
                            <option value="materiais">üõ†Ô∏è Materiais/Consum√≠veis</option>
                            <option value="transporte">üöö Transporte</option>
                            <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                            <option value="decoracao">üé® Decora√ß√£o</option>
                            <option value="terceiros">ü§ù Servi√ßos Terceiros</option>
                            <option value="outros">üìå Outros</option>
                        </select>
                    </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="custoEventoValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conta Banc√°ria üè¶</label>
                        <select class="form-select" id="custoEventoConta">
                            <option value="">N√£o informado</option>
                            <!-- Ser√° preenchido dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="custoEventoData" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="custoEventoObs" placeholder="Detalhes do custo..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Custo</button>
            </form>
        </div>
    </div>

    <!-- Modal Receita -->

    <!-- Modal Conta Banc√°ria -->
    <div id="modalConta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üè¶ Nova Conta Banc√°ria</h2>
                <button class="close-btn" onclick="closeModal('conta')">√ó</button>
            </div>
            <form onsubmit="addContaBancaria(event)">
                <div class="form-group">
                    <label class="form-label">Nome da Conta</label>
                    <input type="text" class="form-input" id="contaNome" required placeholder="Ex: Banco Inter - Conta Corrente">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Banco</label>
                        <input type="text" class="form-input" id="contaBanco" required placeholder="Ex: Banco Inter">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Conta</label>
                        <select class="form-select" id="contaTipo" required>
                            <option value="">Selecione...</option>
                            <option value="corrente">Conta Corrente</option>
                            <option value="poupanca">Conta Poupan√ßa</option>
                            <option value="digital">Conta Digital</option>
                            <option value="empresarial">Conta Empresarial</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ag√™ncia</label>
                        <input type="text" class="form-input" id="contaAgencia" placeholder="0000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">N√∫mero da Conta</label>
                        <input type="text" class="form-input" id="contaNumero" placeholder="00000-0">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Saldo Inicial (opcional)</label>
                    <input type="number" step="0.01" class="form-input" id="contaSaldoInicial" placeholder="0,00">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="contaObservacoes" placeholder="Ex: Conta principal para recebimentos"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Conta</button>
            </form>
        </div>
    </div>

    <!-- Modal Receita -->
    <div id="modalReceita" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Receita</h2>
                <button class="close-btn" onclick="closeModal('receita')">√ó</button>
            </div>
            <form onsubmit="addReceita(event)">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="receitaDescricao" required placeholder="Ex: Pagamento Evento - Jo√£o">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="receitaValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="receitaData" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="receitaCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="evento">Pagamento de Evento</option>
                            <option value="sinal">Sinal/Entrada</option>
                            <option value="extra">Servi√ßos Extras</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Forma de Pagamento üí≥</label>
                        <select class="form-select" id="receitaFormaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="pix">üí≥ PIX</option>
                            <option value="dinheiro">üíµ Dinheiro</option>
                            <option value="debito">üí≥ D√©bito</option>
                            <option value="credito">üí≥ Cart√£o de Cr√©dito</option>
                            <option value="transferencia">üè¶ Transfer√™ncia</option>
                            <option value="boleto">üìÑ Boleto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Conta Banc√°ria üè¶</label>
                    <select class="form-select" id="receitaConta" required>
                        <option value="">Selecione a conta...</option>
                        <!-- Ser√° preenchido dinamicamente -->
                    </select>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        N√£o tem conta cadastrada? <a href="#" onclick="event.preventDefault(); closeModal('receita'); openModal('conta');" style="color: var(--primary);">Cadastre aqui</a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="receitaObservacoes" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Receita</button>
            </form>
        </div>
    </div>

    <!-- Modal Despesa -->
    <div id="modalDespesa" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Despesa</h2>
                <button class="close-btn" onclick="closeModal('despesa')">√ó</button>
            </div>
            <form onsubmit="addDespesa(event)">
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <input type="text" class="form-input" id="despesaDescricao" required placeholder="Ex: Aluguel de Som">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-input" id="despesaValor" required placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="despesaData" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="despesaCategoria" required>
                            <option value="">Selecione...</option>
                            <option value="equipamento">Equipamentos</option>
                            <option value="pessoal">Pessoal/Equipe</option>
                            <option value="transporte">Transporte</option>
                            <option value="alimentacao">Alimenta√ß√£o</option>
                            <option value="marketing">Marketing</option>
                            <option value="aluguel">Aluguel/Local</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Forma de Pagamento üí≥</label>
                        <select class="form-select" id="despesaFormaPagamento" required>
                            <option value="">Selecione...</option>
                            <option value="pix">üí≥ PIX</option>
                            <option value="dinheiro">üíµ Dinheiro</option>
                            <option value="debito">üí≥ D√©bito</option>
                            <option value="credito">üí≥ Cart√£o de Cr√©dito</option>
                            <option value="transferencia">üè¶ Transfer√™ncia</option>
                            <option value="boleto">üìÑ Boleto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Conta Banc√°ria üè¶</label>
                    <select class="form-select" id="despesaConta" required>
                        <option value="">Selecione a conta...</option>
                        <!-- Ser√° preenchido dinamicamente -->
                    </select>
                    <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
                        N√£o tem conta cadastrada? <a href="#" onclick="event.preventDefault(); closeModal('despesa'); openModal('conta');" style="color: var(--primary);">Cadastre aqui</a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="despesaObservacoes" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-submit">Adicionar Despesa</button>
            </form>
        </div>
    </div>

    <!-- Modal Evento -->
    <div id="modalEvento" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Novo Evento</h2>
                <button class="close-btn" onclick="closeModal('evento')">√ó</button>
            </div>
            <form onsubmit="addEvento(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tipo de Evento</label>
                        <select class="form-select" id="eventoTipo" required>
                            <option value="">Selecione o tipo...</option>
                            <option value="Casamento">Casamento</option>
                            <option value="Anivers√°rio">Anivers√°rio</option>
                            <option value="Anivers√°rio 15 Anos">Anivers√°rio 15 Anos</option>
                            <option value="Formatura">Formatura</option>
                            <option value="Corporativo">Evento Corporativo</option>
                            <option value="Confraterniza√ß√£o">Confraterniza√ß√£o</option>
                            <option value="Batizado">Batizado</option>
                            <option value="Ch√° de Beb√™">Ch√° de Beb√™</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cliente</label>
                        <select class="form-select" id="eventoCliente" required onchange="mostrarEnderecoCliente()">
                            <option value="">Selecione um cliente...</option>
                        </select>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            üí° N√£o encontrou? <a href="#" onclick="event.preventDefault(); switchTab('clientes'); setTimeout(() => openModal('cliente'), 300);" style="color: var(--success);">Cadastre um novo cliente</a>
                        </div>
                    </div>
                </div>

                <!-- Data e Hor√°rios -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Data do Evento</label>
                        <input type="date" class="form-input" id="eventoData" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hora de In√≠cio</label>
                        <input type="time" class="form-input" id="eventoHoraInicio" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Hora de T√©rmino</label>
                        <input type="time" class="form-input" id="eventoHoraFim" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dura√ß√£o do Servi√ßo</label>
                        <input type="text" class="form-input" id="eventoDuracao" readonly style="background: rgba(255, 255, 255, 0.05);" placeholder="Calculado automaticamente">
                    </div>
                </div>

                <!-- Op√ß√µes de Endere√ßo -->
                <div id="opcoesEnderecoEvento" style="display: none; margin-bottom: 16px; padding: 12px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                    <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                        üìç Endere√ßo do Cliente Cadastrado
                    </div>
                    <div id="enderecoClienteDisplay" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                        <!-- Endere√ßo ser√° inserido aqui -->
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button type="button" onclick="usarEnderecoCliente()" class="btn btn-secondary" style="flex: 1;">
                            ‚úÖ Usar Este Endere√ßo
                        </button>
                        <button type="button" onclick="limparOpcoesEndereco()" class="btn" style="flex: 1; background: transparent; border: 1px solid var(--border);">
                            üìù Digitar Outro Endere√ßo
                        </button>
                    </div>
                </div>

                <!-- Endere√ßo com CEP -->
                <div class="form-group">
                    <label class="form-label">Endere√ßo do Evento</label>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">CEP üìÆ</label>
                            <input type="text" class="form-input" id="eventoCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCepEvento()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" class="form-input" id="eventoNumero" placeholder="N¬∫" required>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label class="form-label">Rua/Avenida</label>
                        <input type="text" class="form-input" id="eventoRua" placeholder="Digite a rua ou preencha pelo CEP" required>
                    </div>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Bairro</label>
                            <input type="text" class="form-input" id="eventoBairro" placeholder="Digite o bairro" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="eventoComplemento" placeholder="Sal√£o, Quadra, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Cidade</label>
                            <input type="text" class="form-input" id="eventoCidade" placeholder="Digite a cidade" required>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Estado</label>
                            <input type="text" class="form-input" id="eventoEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2" required>
                        </div>
                    </div>
                    <div id="cepEventoLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                        üîç Buscando endere√ßo...
                    </div>
                    <div id="cepEventoError" style="display: none; text-align: center; padding: 8px; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--danger);">
                        ‚ùå CEP n√£o encontrado. Verifique o n√∫mero digitado.
                    </div>
                    <div id="cepEventoSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                        ‚úÖ Endere√ßo encontrado!
                    </div>
                </div>

                <!-- Valor e Status -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Valor Total üí∞</label>
                        <input type="number" step="0.01" class="form-input" id="eventoValor" required placeholder="0,00">
                        <div id="valorClienteInfo" style="display: none; margin-top: 6px; padding: 8px; background: rgba(6, 214, 160, 0.1); border-radius: 6px; font-size: 12px; color: var(--success);">
                            üí° Valor do or√ßamento do cliente: <strong id="valorClienteDisplay">R$ 0,00</strong>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="eventoStatus" required>
                            <option value="aguardando">‚è≥ Aguardando Aprova√ß√£o</option>
                            <option value="andamento">üîÑ Em Andamento</option>
                            <option value="concluido">‚úÖ Conclu√≠do</option>
                            <option value="cancelado">‚ùå Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="eventoObservacoes" placeholder="Detalhes do evento..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal Or√ßamento -->
    <div id="modalOrcamento" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">üíº Novo Or√ßamento Completo</h2>
                <button class="close-btn" onclick="closeModal('orcamento')">√ó</button>
            </div>
            <form onsubmit="addOrcamento(event)">
                
                <!-- SE√á√ÉO 1: DADOS DO CLIENTE -->
                <div style="background: rgba(255, 107, 53, 0.1); border-left: 4px solid var(--primary); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--primary);">
                        üë§ Dados do Cliente
                    </h3>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Cliente</label>
                        <input type="text" class="form-input" id="orcCliente" required placeholder="Nome do cliente">
                    </div>
                </div>

                <!-- SE√á√ÉO 2: DADOS DO EVENTO -->
                <div style="background: rgba(0, 78, 137, 0.1); border-left: 4px solid var(--secondary); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--secondary);">
                        üéâ Dados do Evento
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Tipo de Evento</label>
                            <select class="form-select" id="orcTipoEvento" required>
                                <option value="">Selecione o tipo...</option>
                                <option value="Casamento">Casamento</option>
                                <option value="Anivers√°rio">Anivers√°rio</option>
                                <option value="Anivers√°rio 15 Anos">Anivers√°rio 15 Anos</option>
                                <option value="Formatura">Formatura</option>
                                <option value="Corporativo">Evento Corporativo</option>
                                <option value="Confraterniza√ß√£o">Confraterniza√ß√£o</option>
                                <option value="Batizado">Batizado</option>
                                <option value="Ch√° de Beb√™">Ch√° de Beb√™</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Prevista</label>
                            <input type="date" class="form-input" id="orcData" required>
                        </div>
                    </div>

                    <!-- Hor√°rios com Dura√ß√£o -->
                    <div style="background: rgba(0, 78, 137, 0.1); border: 1px solid var(--secondary); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                        <div style="font-size: 13px; color: var(--secondary); font-weight: 600; margin-bottom: 8px;">
                            ‚è∞ Hor√°rio do Evento
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Hora de In√≠cio</label>
                                <input type="time" class="form-input" id="orcHoraInicio" oninput="calcularDuracaoOrcamento()" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hora de T√©rmino</label>
                                <input type="time" class="form-input" id="orcHoraFim" oninput="calcularDuracaoOrcamento()" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Dura√ß√£o do Servi√ßo</label>
                                <input type="text" class="form-input" id="orcDuracao" readonly style="background: rgba(0, 78, 137, 0.2); font-weight: 600; color: var(--secondary);" placeholder="Autom√°tico">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Op√ß√µes de Endere√ßo do Cliente -->
                    <div id="opcoesEnderecoOrcamento" style="display: none; margin-bottom: 16px; padding: 12px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px;">
                        <div style="font-size: 14px; color: var(--success); font-weight: 600; margin-bottom: 8px;">
                            üìç Endere√ßo do Cliente Cadastrado
                        </div>
                        <div id="enderecoClienteDisplayOrc" style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                            <!-- Endere√ßo ser√° inserido aqui -->
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" onclick="usarEnderecoClienteOrcamento()" class="btn btn-secondary" style="flex: 1;">
                                ‚úÖ Usar Este Endere√ßo
                            </button>
                            <button type="button" onclick="limparOpcoesEnderecoOrcamento()" class="btn" style="flex: 1; background: transparent; border: 1px solid var(--border);">
                                üìù Digitar Outro Endere√ßo
                            </button>
                        </div>
                    </div>

                    <!-- Endere√ßo com CEP -->
                    <div class="form-group">
                        <label class="form-label">Endere√ßo do Evento</label>
                        <div class="form-row" style="margin-bottom: 12px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">CEP üìÆ</label>
                                <input type="text" class="form-input" id="orcCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCepOrcamento()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">N√∫mero</label>
                                <input type="text" class="form-input" id="orcNumero" placeholder="N¬∫" required>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom: 12px;">
                            <label class="form-label">Rua/Avenida</label>
                            <input type="text" class="form-input" id="orcRua" placeholder="Digite a rua ou preencha pelo CEP" required>
                        </div>
                        <div class="form-row" style="margin-bottom: 12px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Bairro</label>
                                <input type="text" class="form-input" id="orcBairro" placeholder="Digite o bairro" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Complemento</label>
                                <input type="text" class="form-input" id="orcComplemento" placeholder="Sal√£o, Quadra, etc.">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-input" id="orcCidade" placeholder="Digite a cidade" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Estado</label>
                                <input type="text" class="form-input" id="orcEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2" required>
                            </div>
                        </div>
                        <div id="cepOrcLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                            üîç Buscando endere√ßo...
                        </div>
                        <div id="cepOrcSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                            ‚úÖ Endere√ßo encontrado!
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 3: SERVI√áOS E VALORES -->
                <div style="background: rgba(6, 214, 160, 0.1); border-left: 4px solid var(--success); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--success);">
                        üí∞ Servi√ßos e Valores
                    </h3>
                    
                    <!-- Sele√ß√£o de Servi√ßos -->
                    <div class="form-group">
                        <label class="form-label">Servi√ßos Inclusos</label>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">Selecione os servi√ßos:</span>
                                <button type="button" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;" onclick="openModal('servico')">
                                    + Novo Servi√ßo
                                </button>
                            </div>
                            <div id="orcamentosServicosList" style="max-height: 300px; overflow-y: auto;">
                                <!-- Lista de checkboxes de servi√ßos -->
                            </div>
                        </div>
                        <div id="servicosSelecionados" style="background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; padding: 12px; display: none;">
                            <div style="font-size: 13px; color: var(--success); margin-bottom: 8px; font-weight: 600;">‚úì Servi√ßos Selecionados:</div>
                            <div id="servicosSelecionadosList"></div>
                        </div>
                    </div>

                    <!-- Outras Taxas -->
                    <div class="form-group">
                        <label class="form-label">Outras Taxas üìã</label>
                        <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 16px;">
                            <div id="outrasTaxasList">
                                <!-- Taxas adicionadas aparecer√£o aqui -->
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="adicionarTaxa()" style="width: 100%; margin-top: 8px;">
                                + Adicionar Taxa
                            </button>
                        </div>
                    </div>

                    <!-- Desconto -->
                    <div class="form-group">
                        <label class="form-label">Desconto üè∑Ô∏è</label>
                        <div class="form-row">
                            <div class="form-group" style="margin-bottom: 0;">
                                <input type="number" step="0.01" class="form-input" id="orcDesconto" placeholder="0,00" oninput="calcularTotalOrcamento()">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <select class="form-select" id="orcDescontoTipo" onchange="calcularTotalOrcamento()">
                                    <option value="valor">R$ (Valor)</option>
                                    <option value="percentual">% (Percentual)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Financeiro -->
                    <div style="background: rgba(255, 107, 53, 0.1); border: 2px solid var(--primary); border-radius: 12px; padding: 16px; margin-top: 16px;">
                        <div style="font-size: 14px; color: var(--primary); font-weight: 600; margin-bottom: 12px;">üí∞ Resumo Financeiro:</div>
                        <div style="display: grid; gap: 8px; font-size: 14px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Subtotal (Servi√ßos):</span>
                                <strong id="orcSubtotalServicos">R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Outras Taxas:</span>
                                <strong id="orcTotalTaxas">R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; color: var(--danger);">
                                <span>Desconto:</span>
                                <strong id="orcTotalDesconto">- R$ 0,00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-top: 12px; border-top: 2px solid var(--primary); font-size: 18px;">
                                <span style="font-weight: 700;">VALOR TOTAL:</span>
                                <strong id="orcValorTotalDisplay" style="color: var(--success);">R$ 0,00</strong>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="orcValorTotal">
                </div>

                <!-- SE√á√ÉO 4: INFORMA√á√ïES ADICIONAIS -->
                <div style="background: rgba(255, 210, 63, 0.1); border-left: 4px solid var(--accent); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 12px; color: var(--accent);">
                        üìù Informa√ß√µes Adicionais
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label">Status do Evento</label>
                        <select class="form-select" id="orcStatus" required>
                            <option value="confirmado">‚úÖ Confirmado</option>
                            <option value="pendente" selected>‚è≥ Pendente</option>
                            <option value="cancelado">‚ùå Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes do Or√ßamento</label>
                        <textarea class="form-textarea" id="orcObservacoes" placeholder="Detalhes, condi√ß√µes especiais, etc..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data de Cria√ß√£o</label>
                            <input type="date" class="form-input" id="orcDataCriacao" readonly style="background: rgba(255, 255, 255, 0.03);">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validade do Or√ßamento (30 dias)</label>
                            <input type="date" class="form-input" id="orcValidade" readonly style="background: rgba(255, 255, 255, 0.03);">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-submit">üíº Gerar Or√ßamento e Criar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal Sucesso Cliente -->
    <div id="modalSucessoCliente" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">‚úÖ Cliente Cadastrado!</h2>
                <button class="close-btn" onclick="document.getElementById('modalSucessoCliente').classList.remove('active')">√ó</button>
            </div>
            
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 64px; margin-bottom: 16px; animation: bounce 1s;">üéâ</div>
                <h3 style="font-family: 'Syne', sans-serif; font-size: 20px; margin-bottom: 8px; color: var(--success);">
                    Cliente cadastrado com sucesso!
                </h3>
                <p id="sucessoClienteNome" style="color: var(--text-secondary); margin-bottom: 24px; font-size: 16px;">
                    <!-- Nome do cliente ser√° inserido aqui -->
                </p>
                
                <div style="background: rgba(255, 210, 63, 0.1); border: 1px solid var(--accent); border-radius: 12px; padding: 16px; margin-bottom: 24px; text-align: left;">
                    <div style="font-size: 14px; color: var(--accent); font-weight: 600; margin-bottom: 8px;">
                        üí° Pr√≥ximo Passo
                    </div>
                    <div style="font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                        Escolha uma das op√ß√µes abaixo para continuar o cadastro:
                    </div>
                </div>
                
                <div style="display: grid; gap: 12px;">
                    <button onclick="atalhoOrcamento()" class="btn" style="background: linear-gradient(135deg, var(--accent), #FFA500); color: var(--bg-dark); font-weight: 600; padding: 16px; font-size: 15px; border: none;">
                        üíº Criar Or√ßamento Completo
                        <div style="font-size: 11px; opacity: 0.8; margin-top: 4px; font-weight: 400;">
                            Monte um or√ßamento com servi√ßos, taxas e descontos
                        </div>
                    </button>
                    
                    <button onclick="atalhoEvento()" class="btn btn-secondary" style="padding: 16px; font-size: 15px;">
                        üéâ Criar Evento Direto
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 4px; font-weight: 400;">
                            Cadastre o evento sem or√ßamento
                        </div>
                    </button>
                    
                    <button onclick="atalhoFinanceiro()" class="btn" style="background: rgba(0, 78, 137, 0.2); color: var(--secondary); border: 1px solid var(--secondary); padding: 16px; font-size: 15px;">
                        üí∞ Adicionar Dados Financeiros
                        <div style="font-size: 11px; opacity: 0.7; margin-top: 4px; font-weight: 400;">
                            Registre valores, sinais e prazos
                        </div>
                    </button>
                    
                    <button onclick="document.getElementById('modalSucessoCliente').classList.remove('active')" class="btn" style="background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 12px;">
                        ‚è≠Ô∏è Adicionar Depois
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Cliente</h2>
                <button class="close-btn" onclick="closeModal('cliente')">√ó</button>
            </div>
            <form onsubmit="addCliente(event)">
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="clienteNome" required placeholder="Nome do cliente">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="clienteEmail" required placeholder="email@exemplo.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-input" id="clienteTelefone" required placeholder="(00) 00000-0000">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">CPF/CNPJ</label>
                        <input type="text" class="form-input" id="clienteCpf" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Anivers√°rio üéÇ</label>
                        <input type="date" class="form-input" id="clienteAniversario" placeholder="DD/MM/AAAA">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Como nos conheceu? üì¢</label>
                        <select class="form-select" id="clienteOrigem" required>
                            <option value="">Selecione...</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="google">Google</option>
                            <option value="indicacao">Indica√ß√£o</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group" id="indicacaoDetalhes" style="display: none;">
                        <label class="form-label">Quem indicou?</label>
                        <input type="text" class="form-input" id="clienteIndicacao" placeholder="Nome de quem indicou">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Endere√ßo</label>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">CEP üìÆ</label>
                            <input type="text" class="form-input" id="clienteCep" placeholder="00000-000 (opcional)" maxlength="9" oninput="formatCep(this); buscarCep()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" class="form-input" id="clienteNumero" placeholder="N¬∫">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <label class="form-label">Rua/Avenida</label>
                        <input type="text" class="form-input" id="clienteRua" placeholder="Digite a rua ou preencha pelo CEP">
                    </div>
                    <div class="form-row" style="margin-bottom: 12px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Bairro</label>
                            <input type="text" class="form-input" id="clienteBairro" placeholder="Digite o bairro">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="clienteComplemento" placeholder="Apto, Bloco, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Cidade</label>
                            <input type="text" class="form-input" id="clienteCidade" placeholder="Digite a cidade">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Estado</label>
                            <input type="text" class="form-input" id="clienteEstado" placeholder="UF" style="text-transform: uppercase;" maxlength="2">
                        </div>
                    </div>
                    <div id="cepLoading" style="display: none; text-align: center; padding: 8px; background: rgba(255, 210, 63, 0.1); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--accent);">
                        üîç Buscando endere√ßo...
                    </div>
                    <div id="cepError" style="display: none; text-align: center; padding: 8px; background: rgba(239, 71, 111, 0.1); border: 1px solid var(--danger); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--danger);">
                        ‚ùå CEP n√£o encontrado. Verifique o n√∫mero digitado.
                    </div>
                    <div id="cepSuccess" style="display: none; text-align: center; padding: 8px; background: rgba(6, 214, 160, 0.1); border: 1px solid var(--success); border-radius: 8px; margin-top: 8px; font-size: 13px; color: var(--success);">
                        ‚úÖ Endere√ßo encontrado! Preencha o n√∫mero da resid√™ncia.
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="clienteObservacoes" placeholder="Informa√ß√µes adicionais sobre o cliente..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-submit">Cadastrar Cliente</button>
            </form>
        </div>
    </div>

    <!-- Modal Servi√ßos -->
    <div id="modalServico" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Gerenciar Servi√ßos</h2>
                <button class="close-btn" onclick="closeModal('servico')">√ó</button>
            </div>
            
            <!-- Form para adicionar servi√ßo -->
            <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 16px; color: var(--primary);">Adicionar Novo Servi√ßo</h3>
                <form onsubmit="addServico(event)">
                    <div class="form-group">
                        <label class="form-label">Nome do Servi√ßo</label>
                        <input type="text" class="form-input" id="servicoNome" required placeholder="Ex: DJ Profissional, Decora√ß√£o Completa">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select class="form-select" id="servicoCategoria" required>
                                <option value="">Selecione...</option>
                                <option value="som">Som e Ilumina√ß√£o</option>
                                <option value="decoracao">Decora√ß√£o</option>
                                <option value="buffet">Buffet</option>
                                <option value="fotografia">Fotografia/Filmagem</option>
                                <option value="animacao">Anima√ß√£o</option>
                                <option value="estrutura">Estrutura</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor Padr√£o</label>
                            <input type="number" step="0.01" class="form-input" id="servicoValor" required placeholder="0,00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea class="form-textarea" id="servicoDescricao" placeholder="Detalhes do servi√ßo, equipamentos inclusos, tempo de dura√ß√£o..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">+ Adicionar Servi√ßo</button>
                </form>
            </div>

            <!-- Lista de servi√ßos -->
            <div>
                <h3 style="font-family: 'Syne', sans-serif; font-size: 18px; margin-bottom: 16px;">Seus Servi√ßos Cadastrados</h3>
                <div id="servicosList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Servi√ßos ser√£o inseridos aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database simulation using localStorage
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem(key) || '[]'),
            set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
            add: (key, item) => {
                const data = DB.get(key);
                const newItem = { ...item, id: Date.now() };
                data.push(newItem);
                DB.set(key, data);
                return newItem; // RETORNAR O ITEM CRIADO
            }
        };

        // ============================================
        // FUN√á√ïES DO FINANCEIRO PESSOAL
        // ============================================

        function addReceitaPessoal(e) {
            e.preventDefault();
            
            const receita = {
                descricao: document.getElementById('receitaPessoalDesc').value,
                categoria: document.getElementById('receitaPessoalCategoria').value,
                valor: parseFloat(document.getElementById('receitaPessoalValor').value),
                data: document.getElementById('receitaPessoalData').value,
                contaId: document.getElementById('receitaPessoalConta').value || null
            };
            
            DB.add('receitasPessoais', receita);
            
            // Atualizar saldo da conta se selecionada
            if (receita.contaId) {
                const contas = DB.get('contasPessoais');
                const conta = contas.find(c => c.id === parseInt(receita.contaId));
                if (conta) {
                    conta.saldoAtual = (conta.saldoAtual || conta.saldoInicial || 0) + receita.valor;
                    DB.set('contasPessoais', contas);
                }
            }
            
            alert('‚úÖ Receita pessoal adicionada com sucesso!');
            closeModal('receitaPessoal');
            e.target.reset();
            renderReceitasPessoais();
            updateStatsPessoal();
        }
        
        function addDespesaPessoal(e) {
            e.preventDefault();
            
            const despesa = {
                descricao: document.getElementById('despesaPessoalDesc').value,
                categoria: document.getElementById('despesaPessoalCategoria').value,
                valor: parseFloat(document.getElementById('despesaPessoalValor').value),
                data: document.getElementById('despesaPessoalData').value,
                contaId: document.getElementById('despesaPessoalConta').value || null,
                observacoes: document.getElementById('despesaPessoalObs').value
            };
            
            DB.add('despesasPessoais', despesa);
            
            // Atualizar saldo da conta se selecionada
            if (despesa.contaId) {
                const contas = DB.get('contasPessoais');
                const conta = contas.find(c => c.id === parseInt(despesa.contaId));
                if (conta) {
                    conta.saldoAtual = (conta.saldoAtual || conta.saldoInicial || 0) - despesa.valor;
                    DB.set('contasPessoais', contas);
                }
            }
            
            alert('‚úÖ Despesa pessoal adicionada com sucesso!');
            closeModal('despesaPessoal');
            e.target.reset();
            renderDespesasPessoais();
            updateStatsPessoal();
            renderDespesasPorCategoria();
        }
        
        function addContaPessoal(e) {
            e.preventDefault();
            
            const conta = {
                nome: document.getElementById('contaPessoalNome').value,
                tipo: document.getElementById('contaPessoalTipo').value,
                saldoInicial: parseFloat(document.getElementById('contaPessoalSaldo').value) || 0,
                saldoAtual: parseFloat(document.getElementById('contaPessoalSaldo').value) || 0,
                banco: document.getElementById('contaPessoalBanco').value,
                ativa: true
            };
            
            DB.add('contasPessoais', conta);
            
            alert('‚úÖ Conta/Cart√£o adicionado com sucesso!');
            closeModal('contaPessoal');
            e.target.reset();
            renderContasPessoais();
            carregarContasPessoaisNosSelects();
            updateStatsPessoal();
        }
        
        function renderReceitasPessoais() {
            const receitas = DB.get('receitasPessoais');
            const container = document.getElementById('listaReceitasPessoais');
            
            if (!container) return;
            
            if (receitas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma receita pessoal cadastrada.</p>';
                return;
            }
            
            // Ordenar por data decrescente
            const receitasOrdenadas = receitas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            container.innerHTML = receitasOrdenadas.map(r => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${r.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(r.data)} ‚Ä¢ ${getCategoriaLabelPessoal(r.categoria, 'receita')}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--success);">
                        + ${formatMoney(r.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        function renderDespesasPessoais() {
            const despesas = DB.get('despesasPessoais');
            const container = document.getElementById('listaDespesasPessoais');
            
            if (!container) return;
            
            if (despesas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma despesa pessoal cadastrada.</p>';
                return;
            }
            
            // Ordenar por data decrescente
            const despesasOrdenadas = despesas.sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            container.innerHTML = despesasOrdenadas.map(d => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${d.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(d.data)} ‚Ä¢ ${getCategoriaLabelPessoal(d.categoria, 'despesa')}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: var(--danger);">
                        - ${formatMoney(d.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        function renderContasPessoais() {
            const contas = DB.get('contasPessoais');
            const container = document.getElementById('listaContasPessoais');
            
            if (!container) return;
            
            if (contas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma conta/cart√£o cadastrado.</p>';
                return;
            }
            
            container.innerHTML = contas.map(c => {
                const saldoColor = c.saldoAtual >= 0 ? 'var(--success)' : 'var(--danger)';
                const tipoIcons = {
                    'corrente': 'üè¶',
                    'poupanca': 'üí∞',
                    'cartao_credito': 'üí≥',
                    'cartao_debito': 'üí≥',
                    'investimento': 'üìà',
                    'dinheiro': 'üíµ'
                };
                
                return `
                    <div class="card" style="margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 8px;">${tipoIcons[c.tipo] || 'üè¶'} ${c.nome}</h4>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    ${c.banco || 'Sem banco informado'}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${saldoColor};">
                                    ${formatMoney(c.saldoAtual || 0)}
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Saldo Atual</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function renderDespesasPorCategoria() {
            const despesas = DB.get('despesasPessoais');
            const container = document.getElementById('despesasPorCategoria');
            
            if (!container) return;
            
            if (despesas.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Nenhuma despesa para an√°lise.</p>';
                return;
            }
            
            // Agrupar por categoria
            const porCategoria = {};
            let totalDespesas = 0;
            
            despesas.forEach(d => {
                if (!porCategoria[d.categoria]) {
                    porCategoria[d.categoria] = 0;
                }
                porCategoria[d.categoria] += d.valor;
                totalDespesas += d.valor;
            });
            
            // Ordenar por valor
            const categorias = Object.entries(porCategoria)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            container.innerHTML = categorias.map(([cat, valor]) => {
                const percent = ((valor / totalDespesas) * 100).toFixed(1);
                return `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${getCategoriaLabelPessoal(cat, 'despesa')}</span>
                            <span style="color: var(--danger); font-weight: 700;">${formatMoney(valor)} (${percent}%)</span>
                        </div>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                            <div style="width: ${percent}%; height: 100%; background: var(--danger); transition: width 0.3s;"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStatsPessoal() {
            const receitas = DB.get('receitasPessoais');
            const despesas = DB.get('despesasPessoais');
            const contas = DB.get('contasPessoais');
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const saldo = totalReceitas - totalDespesas;
            
            const receitasEl = document.getElementById('receitasPessoais');
            const despesasEl = document.getElementById('despesasPessoais');
            const saldoEl = document.getElementById('saldoPessoal');
            const contasEl = document.getElementById('totalContasPessoais');
            
            if (receitasEl) receitasEl.textContent = formatMoney(totalReceitas);
            if (despesasEl) despesasEl.textContent = formatMoney(totalDespesas);
            if (saldoEl) {
                saldoEl.textContent = formatMoney(saldo);
                saldoEl.style.color = saldo >= 0 ? 'var(--success)' : 'var(--danger)';
            }
            if (contasEl) contasEl.textContent = contas.filter(c => c.ativa).length;
        }
        
        function carregarContasPessoaisNosSelects() {
            const contas = DB.get('contasPessoais').filter(c => c.ativa);
            
            const selectReceita = document.getElementById('receitaPessoalConta');
            const selectDespesa = document.getElementById('despesaPessoalConta');
            
            if (selectReceita) {
                selectReceita.innerHTML = '<option value="">N√£o informado</option>';
                contas.forEach(c => {
                    selectReceita.innerHTML += `<option value="${c.id}">${c.nome}</option>`;
                });
            }
            
            if (selectDespesa) {
                selectDespesa.innerHTML = '<option value="">N√£o informado</option>';
                contas.forEach(c => {
                    selectDespesa.innerHTML += `<option value="${c.id}">${c.nome}</option>`;
                });
            }
        }
        
        function getCategoriaLabelPessoal(categoria, tipo) {
            const labelsReceita = {
                'salario': 'üíº Sal√°rio',
                'freelance': 'üíª Freelance',
                'investimentos': 'üìà Investimentos',
                'aluguel': 'üè† Aluguel',
                'venda': 'üí∞ Venda',
                'retirada_empresa': 'üè¢ Retirada da Empresa',
                'outros': 'üìå Outros'
            };
            
            const labelsDespesa = {
                'moradia': 'üè† Moradia',
                'alimentacao': 'üçî Alimenta√ß√£o',
                'transporte': 'üöó Transporte',
                'saude': '‚öïÔ∏è Sa√∫de',
                'educacao': 'üìö Educa√ß√£o',
                'lazer': 'üéÆ Lazer',
                'vestuario': 'üëï Vestu√°rio',
                'contas': 'üìÑ Contas',
                'cartao': 'üí≥ Cart√£o',
                'prestacao': 'üìä Presta√ß√£o',
                'outros': 'üìå Outros'
            };
            
            return tipo === 'receita' ? (labelsReceita[categoria] || categoria) : (labelsDespesa[categoria] || categoria);
        }
        
        // Inicializar dados pessoais se n√£o existirem
        if (!DB.get('receitasPessoais') || DB.get('receitasPessoais').length === 0) {
            DB.set('receitasPessoais', []);
        }
        if (!DB.get('despesasPessoais') || DB.get('despesasPessoais').length === 0) {
            DB.set('despesasPessoais', []);
        }
        if (!DB.get('contasPessoais') || DB.get('contasPessoais').length === 0) {
            DB.set('contasPessoais', []);
        }
        
        // Initialize sample data if empty
        function initSampleData() {
            // Inicializar estruturas vazias - SEM dados de exemplo
            if (!DB.get('receitas')) {
                DB.set('receitas', []);
            }
            if (!DB.get('despesas')) {
                DB.set('despesas', []);
            }
            if (!DB.get('eventos')) {
                DB.set('eventos', []);
            }
            if (!DB.get('clientes')) {
                DB.set('clientes', []);
            }
            if (!DB.get('servicos')) {
                DB.set('servicos', []);
            }
            if (!DB.get('custos')) {
                DB.set('custos', []);
            }
            
            // Criar contas banc√°rias padr√£o apenas se n√£o existirem
            if (!DB.get('contas') || DB.get('contas').length === 0) {
                DB.set('contas', [
                    { id: 1, nome: 'Conta Principal', banco: 'Banco', tipo: 'corrente', agencia: '0001', numero: '12345-6', saldoInicial: 0, observacoes: '', ativa: true }
                ]);
            }
            
            // Inicializar custos vazios
            if (!DB.get('custosGerais')) {
                DB.set('custosGerais', []);
            }
            if (!DB.get('custosEventos')) {
                DB.set('custosEventos', []);
            }
        }

        // Check birthdays
        function checkBirthdays() {
            const clientes = DB.get('clientes');
            const hoje = new Date();
            const em7dias = new Date(hoje);
            em7dias.setDate(em7dias.getDate() + 7);
            
            const aniversariantes = clientes.filter(cliente => {
                if (!cliente.aniversario) return false;
                
                const aniversario = new Date(cliente.aniversario + 'T00:00:00');
                const anivMesDia = `${aniversario.getMonth()}-${aniversario.getDate()}`;
                
                // Verificar pr√≥ximos 7 dias
                const proximosDias = [];
                for (let i = 0; i <= 7; i++) {
                    const dia = new Date(hoje);
                    dia.setDate(dia.getDate() + i);
                    proximosDias.push(`${dia.getMonth()}-${dia.getDate()}`);
                }
                
                return proximosDias.includes(anivMesDia);
            }).map(cliente => {
                const aniversario = new Date(cliente.aniversario + 'T00:00:00');
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                
                const anivEsteAno = new Date(hoje.getFullYear(), aniversario.getMonth(), aniversario.getDate());
                const diffDias = Math.ceil((anivEsteAno - hoje) / (1000 * 60 * 60 * 24));
                
                return {
                    ...cliente,
                    diasParaAniversario: diffDias,
                    isHoje: diffDias === 0,
                    isAmanha: diffDias === 1
                };
            }).sort((a, b) => a.diasParaAniversario - b.diasParaAniversario);
            
            renderBirthdayAlerts(aniversariantes);
        }

        // Render birthday alerts
        function renderBirthdayAlerts(aniversariantes) {
            const container = document.getElementById('birthdayAlertsCompact');
            
            if (aniversariantes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const items = aniversariantes.map(cliente => {
                let badgeClass = 'badge-soon';
                let badgeText = `EM ${cliente.diasParaAniversario} DIAS`;
                
                if (cliente.isHoje) {
                    badgeClass = 'badge-today';
                    badgeText = 'HOJE! üéä';
                } else if (cliente.isAmanha) {
                    badgeClass = 'badge-tomorrow';
                    badgeText = 'AMANH√É';
                }
                
                return `
                    <div class="birthday-item-compact">
                        <div class="birthday-item-info">
                            <h4>üéÇ ${cliente.nome}</h4>
                            <div class="birthday-item-contact">
                                üì± ${cliente.telefone} ‚Ä¢ üìß ${cliente.email}
                            </div>
                        </div>
                        <div class="birthday-badge-compact ${badgeClass}">
                            ${badgeText}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `
                <div class="birthday-card-compact">
                    <div class="birthday-card-header">
                        <div class="birthday-icon">üéâ</div>
                        <div>
                            <div class="birthday-card-title">Aniversariantes da Semana</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${aniversariantes.length} cliente${aniversariantes.length > 1 ? 's fazem' : ' faz'} anivers√°rio nos pr√≥ximos 7 dias
                            </div>
                        </div>
                    </div>
                    <div class="birthday-list">
                        ${items}
                    </div>
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255, 210, 63, 0.3); font-size: 12px; color: var(--text-secondary); text-align: center;">
                        üí° Envie uma mensagem de parab√©ns para fortalecer o relacionamento!
                    </div>
                </div>
            `;
        }

        // Update dashboard stats
        function updateStats() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const custosGerais = DB.get('custosGerais') || [];
            const custosEventos = DB.get('custosEventos') || [];
            const eventos = DB.get('eventos');
            const clientes = DB.get('clientes');

            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const totalCustosGerais = custosGerais.reduce((sum, c) => sum + c.valor, 0);
            const totalCustosEventos = custosEventos.reduce((sum, c) => sum + c.valor, 0);
            
            // Calcular valores a receber
            let valoresAReceber = 0;
            let clientesPendentes = 0;
            clientes.forEach(cliente => {
                if (cliente.financeiro && cliente.financeiro.valorPagar > 0) {
                    valoresAReceber += cliente.financeiro.valorPagar;
                    clientesPendentes++;
                }
            });
            
            // Lucro = Receitas - Despesas - Custos Gerais - Custos Eventos
            const lucro = totalReceitas - totalDespesas - totalCustosGerais - totalCustosEventos;
            const margemLucro = totalReceitas > 0 ? ((lucro / totalReceitas) * 100).toFixed(1) : 0;
            const eventosConfirmados = eventos.filter(e => e.status === 'confirmado' || e.status === 'andamento').length;

            document.getElementById('totalReceitas').textContent = formatMoney(totalReceitas);
            document.getElementById('totalDespesas').textContent = formatMoney(totalDespesas + totalCustosGerais);
            document.getElementById('totalCustosEventos').textContent = formatMoney(totalCustosEventos);
            document.getElementById('numeroCustosEventos').textContent = custosEventos.length;
            document.getElementById('lucroLiquido').textContent = formatMoney(lucro);
            document.getElementById('totalEventos').textContent = eventos.length;
            document.getElementById('percentLucro').textContent = margemLucro;
            document.getElementById('eventosConfirmados').textContent = eventosConfirmados;
            
            // Atualizar valores a receber
            if (document.getElementById('valoresAReceberDashboard')) {
                document.getElementById('valoresAReceberDashboard').textContent = formatMoney(valoresAReceber);
            }
            if (document.getElementById('numClientesPendentes')) {
                document.getElementById('numClientesPendentes').textContent = clientesPendentes;
            }
        }

        // Render transactions
        function renderTransactions() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const transactions = [
                ...receitas.map(r => ({ ...r, type: 'receita' })),
                ...despesas.map(d => ({ ...d, type: 'despesa' }))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 6);

            const html = transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon ${t.type === 'receita' ? 'bg-success' : 'bg-danger'}">
                            ${t.type === 'receita' ? 'üí∞' : 'üí∏'}
                        </div>
                        <div class="transaction-details">
                            <h4>${t.descricao}</h4>
                            <div class="transaction-date">${formatDate(t.data)}</div>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type === 'receita' ? 'positive' : 'negative'}">
                        ${t.type === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');

            document.getElementById('transactionsList').innerHTML = html;
        }

        // Render events
        function renderEvents() {
            const eventos = DB.get('eventos')
                .sort((a, b) => new Date(a.data) - new Date(b.data))
                .slice(0, 3);

            const html = eventos.map(e => {
                // Definir classe CSS baseada no status
                let statusClass = 'status-pending';
                let statusText = e.status;
                
                if (e.status === 'confirmado' || e.status === 'andamento') {
                    statusClass = 'status-confirmed';
                    statusText = e.status === 'andamento' ? 'Em Andamento' : 'Confirmado';
                } else if (e.status === 'concluido' || e.status === 'finalizado') {
                    statusClass = 'status-completed';
                    statusText = 'Conclu√≠do';
                } else if (e.status === 'cancelado') {
                    statusClass = 'status-cancelled';
                    statusText = 'Cancelado';
                } else if (e.status === 'aguardando' || e.status === 'pendente') {
                    statusClass = 'status-pending';
                    statusText = 'Aguardando';
                }
                
                return `
                <div class="event-card" onclick="switchTab('eventos'); setTimeout(() => editEvent(${e.id}), 100);" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div class="event-header">
                        <div>
                            <div class="event-title">${e.nome}</div>
                            <div class="event-client">${e.cliente}</div>
                        </div>
                        <div class="event-status ${statusClass}">
                            ${statusText}
                        </div>
                    </div>
                    <div class="event-details">
                        <div class="event-detail">
                            <span>üìÖ</span>
                            <span>${formatDate(e.data)}</span>
                        </div>
                        <div class="event-detail">
                            <span>üïê</span>
                            <span>${e.horario || e.horaInicio || '-'}</span>
                        </div>
                        <div class="event-detail">
                            <span>üí∞</span>
                            <span>${e.valor ? formatMoney(e.valor) : 'R$ 0,00'}</span>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            document.getElementById('eventsList').innerHTML = html || '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">Nenhum evento cadastrado</p>';
        }

        // Update origem stats
        function updateOrigemStats() {
            const clientes = DB.get('clientes');
            const container = document.getElementById('origemStats');
            
            if (clientes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum cliente cadastrado ainda.</p>';
                return;
            }

            // Contar origens
            const origens = {
                facebook: { label: 'Facebook', icon: 'üìò', count: 0, color: 'rgba(0, 78, 137, 0.15)' },
                instagram: { label: 'Instagram', icon: 'üì∏', count: 0, color: 'rgba(255, 107, 53, 0.15)' },
                google: { label: 'Google', icon: 'üîç', count: 0, color: 'rgba(6, 214, 160, 0.15)' },
                indicacao: { label: 'Indica√ß√£o', icon: 'üë•', count: 0, color: 'rgba(255, 210, 63, 0.15)' },
                outros: { label: 'Outros', icon: 'üìå', count: 0, color: 'rgba(160, 174, 192, 0.15)' }
            };

            clientes.forEach(cliente => {
                if (cliente.origem && origens[cliente.origem]) {
                    origens[cliente.origem].count++;
                }
            });

            const total = clientes.length;
            const html = Object.entries(origens)
                .filter(([key, data]) => data.count > 0)
                .sort((a, b) => b[1].count - a[1].count)
                .map(([key, data]) => {
                    const percentage = ((data.count / total) * 100).toFixed(1);
                    return `
                        <div class="origem-item">
                            <div class="origem-info">
                                <div class="origem-icon" style="background: ${data.color};">
                                    ${data.icon}
                                </div>
                                <div>
                                    <div class="origem-label">${data.label}</div>
                                    <div class="origem-bar" style="width: 150px;">
                                        <div class="origem-bar-fill" style="width: ${percentage}%;"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="origem-count">${data.count}</div>
                                <div style="font-size: 11px; color: var(--text-secondary); text-align: right;">
                                    ${percentage}%
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            container.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhuma origem registrada.</p>';
        }

        // Modal functions
        // Add receita
        function addReceita(e) {
            e.preventDefault();
            const receita = {
                descricao: document.getElementById('receitaDescricao').value,
                valor: parseFloat(document.getElementById('receitaValor').value),
                data: document.getElementById('receitaData').value,
                categoria: document.getElementById('receitaCategoria').value,
                formaPagamento: document.getElementById('receitaFormaPagamento').value,
                contaId: parseInt(document.getElementById('receitaConta').value),
                observacoes: document.getElementById('receitaObservacoes').value
            };
            DB.add('receitas', receita);
            e.target.reset();
            closeModal('receita');
            updateDashboard();
            renderFinanceiro();
        }

        // Add despesa
        function addDespesa(e) {
            e.preventDefault();
            const despesa = {
                descricao: document.getElementById('despesaDescricao').value,
                valor: parseFloat(document.getElementById('despesaValor').value),
                data: document.getElementById('despesaData').value,
                categoria: document.getElementById('despesaCategoria').value,
                formaPagamento: document.getElementById('despesaFormaPagamento').value,
                contaId: parseInt(document.getElementById('despesaConta').value),
                observacoes: document.getElementById('despesaObservacoes').value
            };
            
            DB.add('despesas', despesa);
            
            // ‚úÖ Atualizar saldo da conta (D√âBITO)
            if (despesa.contaId && !isNaN(despesa.contaId)) {
                atualizarSaldoConta(despesa.contaId.toString(), despesa.valor, 'debito');
            }
            
            e.target.reset();
            closeModal('despesa');
            updateDashboard();
            renderFinanceiro();
        }

        // Add evento
        function addEvento(e) {
            e.preventDefault();
            
            // Se estiver editando, chamar fun√ß√£o de edi√ß√£o
            if (window.eventoEditandoId) {
                salvarEdicaoEvento();
                return;
            }
            
            // Montar endere√ßo completo do evento
            const cep = document.getElementById('eventoCep').value;
            const rua = document.getElementById('eventoRua').value;
            const numero = document.getElementById('eventoNumero').value;
            const complemento = document.getElementById('eventoComplemento').value;
            const bairro = document.getElementById('eventoBairro').value;
            const cidade = document.getElementById('eventoCidade').value;
            const estado = document.getElementById('eventoEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento;
                if (bairro) enderecoCompleto += ' - ' + bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            const evento = {
                tipo: document.getElementById('eventoTipo').value,
                nome: document.getElementById('eventoTipo').value, // Manter compatibilidade
                cliente: document.getElementById('eventoCliente').value,
                data: document.getElementById('eventoData').value,
                horaInicio: document.getElementById('eventoHoraInicio').value,
                horaFim: document.getElementById('eventoHoraFim').value,
                duracao: document.getElementById('eventoDuracao').value,
                horario: document.getElementById('eventoHoraInicio').value, // Manter compatibilidade
                local: enderecoCompleto,
                cep: cep,
                rua: rua,
                numero: numero,
                complemento: complemento,
                bairro: bairro,
                cidade: cidade,
                estado: estado,
                valor: parseFloat(document.getElementById('eventoValor').value),
                status: document.getElementById('eventoStatus').value,
                observacoes: document.getElementById('eventoObservacoes').value
            };
            
            DB.add('eventos', evento);
            e.target.reset();
            limparCamposEnderecoEvento();
            document.getElementById('valorClienteInfo').style.display = 'none';
            closeModal('evento');
            updateDashboard();
            renderEventsList();
            alert('‚úÖ Evento cadastrado com sucesso!');
        }

        // Add or√ßamento
        function addOrcamento(e) {
            e.preventDefault();
            
            // Coletar dados do or√ßamento
            const cliente = document.getElementById('orcCliente').value;
            const tipoEvento = document.getElementById('orcTipoEvento').value;
            const data = document.getElementById('orcData').value;
            const horaInicio = document.getElementById('orcHoraInicio').value;
            const horaFim = document.getElementById('orcHoraFim').value;
            
            // Calcular dura√ß√£o
            const [hI, mI] = horaInicio.split(':').map(Number);
            const [hF, mF] = horaFim.split(':').map(Number);
            let minutosInicio = hI * 60 + mI;
            let minutosFim = hF * 60 + mF;
            if (minutosFim < minutosInicio) minutosFim += 24 * 60;
            const diffMinutos = minutosFim - minutosInicio;
            const horas = Math.floor(diffMinutos / 60);
            const minutos = diffMinutos % 60;
            let duracao = '';
            if (horas > 0) duracao += `${horas}h`;
            if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
            
            // Montar endere√ßo
            const cep = document.getElementById('orcCep').value;
            const rua = document.getElementById('orcRua').value;
            const numero = document.getElementById('orcNumero').value;
            const complemento = document.getElementById('orcComplemento').value;
            const bairro = document.getElementById('orcBairro').value;
            const cidade = document.getElementById('orcCidade').value;
            const estado = document.getElementById('orcEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento;
                if (bairro) enderecoCompleto += ' - ' + bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            // Coletar servi√ßos selecionados
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            const servicosSelecionados = [];
            checkboxes.forEach(cb => {
                servicosSelecionados.push({
                    id: parseInt(cb.dataset.id),
                    nome: cb.dataset.nome,
                    valor: parseFloat(cb.dataset.valor)
                });
            });
            
            const valorTotal = parseFloat(document.getElementById('orcValorTotal').value);
            const observacoes = document.getElementById('orcObservacoes').value;
            const dataCriacao = document.getElementById('orcDataCriacao').value;
            const validade = document.getElementById('orcValidade').value;
            const status = document.getElementById('orcStatus').value; // ‚úÖ Novo campo
            
            // Criar or√ßamento
            const orcamento = {
                cliente,
                tipoEvento,
                data,
                horaInicio,
                horaFim,
                duracao,
                endereco: enderecoCompleto,
                cep, rua, numero, complemento, bairro, cidade, estado,
                servicos: servicosSelecionados,
                outrasTaxas: [...outrasTaxas],
                desconto: {
                    valor: parseFloat(document.getElementById('orcDesconto').value) || 0,
                    tipo: document.getElementById('orcDescontoTipo').value
                },
                valorTotal,
                observacoes,
                dataCriacao,
                validade,
                status: status // ‚úÖ Usar status selecionado
            };
            
            // Salvar or√ßamento (opcional - pode criar tabela de or√ßamentos)
            // DB.add('orcamentos', orcamento);
            
            // Criar evento automaticamente com dados do or√ßamento
            const evento = {
                tipo: tipoEvento,
                nome: tipoEvento,
                cliente,
                data,
                horaInicio,
                horaFim,
                duracao,
                horario: horaInicio,
                local: enderecoCompleto,
                cep, rua, numero, complemento, bairro, cidade, estado,
                valor: valorTotal,
                servicos: servicosSelecionados, // ‚úÖ Adicionar servi√ßos ao evento
                status: status, // ‚úÖ Usar status do or√ßamento
                observacoes: `Or√ßamento criado em ${formatDate(dataCriacao)}\n\nServi√ßos:\n${servicosSelecionados.map(s => `‚Ä¢ ${s.nome} - ${formatMoney(s.valor)}`).join('\n')}${outrasTaxas.length > 0 ? '\n\nOutras Taxas:\n' + outrasTaxas.map(t => `‚Ä¢ ${t.descricao} - ${formatMoney(t.valor)}`).join('\n') : ''}${observacoes ? '\n\nObserva√ß√µes:\n' + observacoes : ''}`
            };
            
            DB.add('eventos', evento);
            
            // Atualizar dados financeiros do cliente se j√° existir
            const clientes = DB.get('clientes');
            const clienteExistente = clientes.find(c => c.nome.toLowerCase() === cliente.toLowerCase());
            
            if (clienteExistente && (!clienteExistente.financeiro || clienteExistente.financeiro.valorTotal === 0)) {
                clienteExistente.financeiro = {
                    valorTotal,
                    sinalValor: 0,
                    sinalData: '',
                    valorPagar: valorTotal,
                    vencimento: data
                };
                DB.set('clientes', clientes);
            }
            
            // Limpar formul√°rio
            e.target.reset();
            outrasTaxas = [];
            document.getElementById('outrasTaxasList').innerHTML = '';
            limparCamposEnderecoOrcamento();
            closeModal('orcamento');
            
            // Mostrar sucesso e ir para eventos
            alert('‚úÖ Or√ßamento gerado e evento criado com sucesso!\n\nO evento foi criado com status "Aguardando Aprova√ß√£o".');
            
            switchTabProgramatically('eventos');
            renderEventsList();
            updateDashboard();
        }

        // Add cliente
        function addCliente(e) {
            e.preventDefault();
            
            const origem = document.getElementById('clienteOrigem').value;
            const nomeCliente = document.getElementById('clienteNome').value;
            
            // Montar endere√ßo completo
            const cep = document.getElementById('clienteCep').value;
            const rua = document.getElementById('clienteRua').value;
            const numero = document.getElementById('clienteNumero').value;
            const complemento = document.getElementById('clienteComplemento').value;
            const bairro = document.getElementById('clienteBairro').value;
            const cidade = document.getElementById('clienteCidade').value;
            const estado = document.getElementById('clienteEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento;
                if (bairro) enderecoCompleto += ' - ' + bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            const cliente = {
                nome: nomeCliente,
                email: document.getElementById('clienteEmail').value,
                telefone: document.getElementById('clienteTelefone').value,
                cpf: document.getElementById('clienteCpf').value,
                aniversario: document.getElementById('clienteAniversario').value,
                origem: origem,
                indicacao: origem === 'indicacao' ? document.getElementById('clienteIndicacao').value : '',
                endereco: enderecoCompleto,
                cep: cep,
                rua: rua,
                numero: numero,
                complemento: complemento,
                bairro: bairro,
                cidade: cidade,
                estado: estado,
                observacoes: document.getElementById('clienteObservacoes').value,
                financeiro: {
                    valorTotal: 0,
                    sinalValor: 0,
                    sinalData: '',
                    valorPagar: 0,
                    vencimento: ''
                }
            };
            
            // Salvar cliente
            const novoCliente = DB.add('clientes', cliente);
            window.ultimoClienteId = novoCliente.id;
            
            // Limpar formul√°rio
            e.target.reset();
            document.getElementById('indicacaoDetalhes').style.display = 'none';
            limparCamposEndereco();
            
            // Fechar modal
            closeModal('cliente');
            
            // Atualizar interface
            checkBirthdays();
            updateOrigemStats();
            
            // Ir para aba clientes
            switchTabProgramatically('clientes');
            
            // Abrir modal de sucesso
            setTimeout(function() {
                const modalSucesso = document.getElementById('modalSucessoCliente');
                const nomeElement = document.getElementById('sucessoClienteNome');
                
                if (modalSucesso && nomeElement) {
                    nomeElement.innerHTML = '<strong style="color: var(--primary);">' + nomeCliente + '</strong> foi adicionado √† sua base de clientes!';
                    modalSucesso.classList.add('active');
                }
            }, 500);
        }
        
        // Switch tab programatically (sem event)
        function switchTabProgramatically(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes(tabName)) {
                    tab.classList.add('active');
                }
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load tab-specific content
            if (tabName === 'eventos') {
                renderEventsList();
                renderKanbanView();
            } else if (tabName === 'clientes') {
                renderClientsList();
                updateClientsStats();
            } else if (tabName === 'custos') {
                toggleCustosView('gerais');
            }
        }

        // Format CEP
        function formatCep(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            input.value = value;
        }

        // Buscar CEP
        let cepTimeout;
        function buscarCep() {
            clearTimeout(cepTimeout);
            
            const cep = document.getElementById('clienteCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepLoading').style.display = 'none';
            document.getElementById('cepError').style.display = 'none';
            document.getElementById('cepSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEndereco();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepLoading').style.display = 'block';
            
            // Delay para n√£o fazer muitas requisi√ß√µes
            cepTimeout = setTimeout(() => {
                // Usar JSONP para evitar problemas de CORS em arquivo local
                const script = document.createElement('script');
                const callbackName = 'viaCepCallback' + Date.now();
                
                // Criar callback global tempor√°rio
                window[callbackName] = function(data) {
                    document.getElementById('cepLoading').style.display = 'none';
                    
                    if (data.erro) {
                        document.getElementById('cepError').style.display = 'block';
                        limparCamposEndereco();
                    } else {
                        // Preencher campos
                        document.getElementById('clienteRua').value = data.logradouro || '';
                        document.getElementById('clienteBairro').value = data.bairro || '';
                        document.getElementById('clienteCidade').value = data.localidade || '';
                        document.getElementById('clienteEstado').value = data.uf || '';
                        
                        // Mostrar sucesso
                        document.getElementById('cepSuccess').style.display = 'block';
                        
                        // Focar no campo de n√∫mero
                        document.getElementById('clienteNumero').focus();
                        
                        // Ocultar mensagem de sucesso ap√≥s 3 segundos
                        setTimeout(() => {
                            document.getElementById('cepSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    // Limpar script e callback
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                // Criar script com JSONP
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepLoading').style.display = 'none';
                    document.getElementById('cepError').style.display = 'block';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endere√ßo
        function limparCamposEndereco() {
            document.getElementById('clienteRua').value = '';
            document.getElementById('clienteBairro').value = '';
            document.getElementById('clienteCidade').value = '';
            document.getElementById('clienteEstado').value = '';
        }

        // Calcular dura√ß√£o do evento
        function calcularDuracaoEvento() {
            const horaInicio = document.getElementById('eventoHoraInicio').value;
            const horaFim = document.getElementById('eventoHoraFim').value;
            
            if (horaInicio && horaFim) {
                const [hI, mI] = horaInicio.split(':').map(Number);
                const [hF, mF] = horaFim.split(':').map(Number);
                
                let minutosInicio = hI * 60 + mI;
                let minutosFim = hF * 60 + mF;
                
                // Se fim for menor que in√≠cio, evento vai at√© dia seguinte
                if (minutosFim < minutosInicio) {
                    minutosFim += 24 * 60;
                }
                
                const diffMinutos = minutosFim - minutosInicio;
                const horas = Math.floor(diffMinutos / 60);
                const minutos = diffMinutos % 60;
                
                let duracao = '';
                if (horas > 0) duracao += `${horas}h`;
                if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
                
                document.getElementById('eventoDuracao').value = duracao || '0min';
            }
        }

        // Calcular dura√ß√£o no or√ßamento
        function calcularDuracaoOrcamento() {
            const horaInicio = document.getElementById('orcHoraInicio').value;
            const horaFim = document.getElementById('orcHoraFim').value;
            
            if (horaInicio && horaFim) {
                const [hI, mI] = horaInicio.split(':').map(Number);
                const [hF, mF] = horaFim.split(':').map(Number);
                
                let minutosInicio = hI * 60 + mI;
                let minutosFim = hF * 60 + mF;
                
                // Se fim for menor que in√≠cio, evento vai at√© dia seguinte
                if (minutosFim < minutosInicio) {
                    minutosFim += 24 * 60;
                }
                
                const diffMinutos = minutosFim - minutosInicio;
                const horas = Math.floor(diffMinutos / 60);
                const minutos = diffMinutos % 60;
                
                let duracao = '';
                if (horas > 0) duracao += `${horas}h`;
                if (minutos > 0) duracao += `${minutos > 0 && horas > 0 ? ' ' : ''}${minutos}min`;
                
                document.getElementById('orcDuracao').value = duracao || '0min';
            }
        }

        // Adicionar listeners para calcular dura√ß√£o

        // Buscar CEP para evento
        let cepEventoTimeout;
        function buscarCepEvento() {
            clearTimeout(cepEventoTimeout);
            
            const cep = document.getElementById('eventoCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepEventoLoading').style.display = 'none';
            document.getElementById('cepEventoError').style.display = 'none';
            document.getElementById('cepEventoSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEnderecoEvento();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepEventoLoading').style.display = 'block';
            
            // Delay para n√£o fazer muitas requisi√ß√µes
            cepEventoTimeout = setTimeout(() => {
                // Usar JSONP para evitar problemas de CORS em arquivo local
                const script = document.createElement('script');
                const callbackName = 'viaCepEventoCallback' + Date.now();
                
                // Criar callback global tempor√°rio
                window[callbackName] = function(data) {
                    document.getElementById('cepEventoLoading').style.display = 'none';
                    
                    if (data.erro) {
                        document.getElementById('cepEventoError').style.display = 'block';
                        limparCamposEnderecoEvento();
                    } else {
                        // Preencher campos
                        document.getElementById('eventoRua').value = data.logradouro || '';
                        document.getElementById('eventoBairro').value = data.bairro || '';
                        document.getElementById('eventoCidade').value = data.localidade || '';
                        document.getElementById('eventoEstado').value = data.uf || '';
                        
                        // Mostrar sucesso
                        document.getElementById('cepEventoSuccess').style.display = 'block';
                        
                        // Focar no campo de n√∫mero
                        document.getElementById('eventoNumero').focus();
                        
                        // Ocultar mensagem de sucesso ap√≥s 3 segundos
                        setTimeout(() => {
                            document.getElementById('cepEventoSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    // Limpar script e callback
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                // Criar script com JSONP
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepEventoLoading').style.display = 'none';
                    document.getElementById('cepEventoError').style.display = 'block';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endere√ßo do evento
        function limparCamposEnderecoEvento() {
            document.getElementById('eventoRua').value = '';
            document.getElementById('eventoBairro').value = '';
            document.getElementById('eventoCidade').value = '';
            document.getElementById('eventoEstado').value = '';
        }

        // Usar endere√ßo do cliente no evento
        function usarEnderecoCliente() {
            if (window.enderecoCliente) {
                document.getElementById('eventoCep').value = window.enderecoCliente.cep;
                document.getElementById('eventoRua').value = window.enderecoCliente.rua;
                document.getElementById('eventoNumero').value = window.enderecoCliente.numero;
                document.getElementById('eventoComplemento').value = window.enderecoCliente.complemento;
                document.getElementById('eventoBairro').value = window.enderecoCliente.bairro;
                document.getElementById('eventoCidade').value = window.enderecoCliente.cidade;
                document.getElementById('eventoEstado').value = window.enderecoCliente.estado;
                
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            }
        }

        // Limpar op√ß√µes de endere√ßo e permitir novo endere√ßo
        function limparOpcoesEndereco() {
            document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            // Focar no campo CEP
            document.getElementById('eventoCep').focus();
        }

        // Carregar valor do cliente no evento
        function carregarValorCliente() {
            const nomeCliente = document.getElementById('eventoCliente').value.trim();
            
            if (!nomeCliente) {
                document.getElementById('valorClienteInfo').style.display = 'none';
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.nome.toLowerCase() === nomeCliente.toLowerCase());
            
            if (cliente && cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                document.getElementById('valorClienteDisplay').textContent = formatMoney(cliente.financeiro.valorTotal);
                document.getElementById('valorClienteInfo').style.display = 'block';
                
                // Preencher automaticamente se campo estiver vazio
                const valorInput = document.getElementById('eventoValor');
                if (!valorInput.value || valorInput.value == 0) {
                    valorInput.value = cliente.financeiro.valorTotal;
                }
            } else {
                document.getElementById('valorClienteInfo').style.display = 'none';
            }
        }

        // Adicionar listener para verificar valor do cliente ao digitar

        // Definir datas do or√ßamento automaticamente
        function definirDatasOrcamento() {
            const hoje = new Date();
            const dataHoje = hoje.toISOString().split('T')[0];
            
            // Data de cria√ß√£o = hoje
            document.getElementById('orcDataCriacao').value = dataHoje;
            
            // Validade = hoje + 30 dias
            const validade = new Date(hoje);
            validade.setDate(validade.getDate() + 30);
            const dataValidade = validade.toISOString().split('T')[0];
            document.getElementById('orcValidade').value = dataValidade;
        }

        // Vari√°vel global para taxas
        let taxasCounter = 0;
        let outrasTaxas = [];

        // Adicionar nova taxa
        function adicionarTaxa() {
            taxasCounter++;
            const taxaId = 'taxa_' + taxasCounter;
            
            const taxaHtml = `
                <div class="taxa-item" id="${taxaId}" style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; gap: 8px; align-items: end;">
                        <div style="flex: 2;">
                            <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">Descri√ß√£o</label>
                            <input type="text" class="form-input" placeholder="Ex: Taxa de deslocamento" style="margin: 0;" onchange="atualizarTaxa('${taxaId}')">
                        </div>
                        <div style="flex: 1;">
                            <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">Valor</label>
                            <input type="number" step="0.01" class="form-input" placeholder="0,00" style="margin: 0;" oninput="atualizarTaxa('${taxaId}')">
                        </div>
                        <button type="button" onclick="removerTaxa('${taxaId}')" class="btn" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger); padding: 10px 16px; margin: 0;">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('outrasTaxasList').insertAdjacentHTML('beforeend', taxaHtml);
        }

        // Atualizar taxa no array
        function atualizarTaxa(taxaId) {
            const taxaDiv = document.getElementById(taxaId);
            const descricao = taxaDiv.querySelector('input[type="text"]').value;
            const valor = parseFloat(taxaDiv.querySelector('input[type="number"]').value) || 0;
            
            // Remover taxa antiga com mesmo ID
            outrasTaxas = outrasTaxas.filter(t => t.id !== taxaId);
            
            // Adicionar taxa atualizada
            if (descricao && valor > 0) {
                outrasTaxas.push({ id: taxaId, descricao, valor });
            }
            
            calcularTotalOrcamento();
        }

        // Remover taxa
        function removerTaxa(taxaId) {
            document.getElementById(taxaId).remove();
            outrasTaxas = outrasTaxas.filter(t => t.id !== taxaId);
            calcularTotalOrcamento();
        }

        // Calcular total do or√ßamento
        function calcularTotalOrcamento() {
            // Somar servi√ßos selecionados
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            let subtotalServicos = 0;
            checkboxes.forEach(cb => {
                subtotalServicos += parseFloat(cb.dataset.valor) || 0;
            });
            
            // Somar outras taxas
            const totalTaxas = outrasTaxas.reduce((sum, taxa) => sum + taxa.valor, 0);
            
            // Calcular desconto
            const descontoValor = parseFloat(document.getElementById('orcDesconto').value) || 0;
            const descontoTipo = document.getElementById('orcDescontoTipo').value;
            
            let desconto = 0;
            if (descontoTipo === 'percentual') {
                desconto = (subtotalServicos + totalTaxas) * (descontoValor / 100);
            } else {
                desconto = descontoValor;
            }
            
            // Calcular total
            const total = Math.max(0, subtotalServicos + totalTaxas - desconto);
            
            // Atualizar display
            document.getElementById('orcSubtotalServicos').textContent = formatMoney(subtotalServicos);
            document.getElementById('orcTotalTaxas').textContent = formatMoney(totalTaxas);
            document.getElementById('orcTotalDesconto').textContent = '- ' + formatMoney(desconto);
            document.getElementById('orcValorTotalDisplay').textContent = formatMoney(total);
            document.getElementById('orcValorTotal').value = total;
        }

        // Buscar CEP para or√ßamento
        let cepOrcTimeout;
        function buscarCepOrcamento() {
            clearTimeout(cepOrcTimeout);
            
            const cep = document.getElementById('orcCep').value.replace(/\D/g, '');
            
            // Ocultar mensagens anteriores
            document.getElementById('cepOrcLoading').style.display = 'none';
            document.getElementById('cepOrcSuccess').style.display = 'none';
            
            if (cep.length !== 8) {
                limparCamposEnderecoOrcamento();
                return;
            }
            
            // Mostrar loading
            document.getElementById('cepOrcLoading').style.display = 'block';
            
            cepOrcTimeout = setTimeout(() => {
                const script = document.createElement('script');
                const callbackName = 'viaCepOrcCallback' + Date.now();
                
                window[callbackName] = function(data) {
                    document.getElementById('cepOrcLoading').style.display = 'none';
                    
                    if (data.erro) {
                        limparCamposEnderecoOrcamento();
                    } else {
                        document.getElementById('orcRua').value = data.logradouro || '';
                        document.getElementById('orcBairro').value = data.bairro || '';
                        document.getElementById('orcCidade').value = data.localidade || '';
                        document.getElementById('orcEstado').value = data.uf || '';
                        
                        document.getElementById('cepOrcSuccess').style.display = 'block';
                        document.getElementById('orcNumero').focus();
                        
                        setTimeout(() => {
                            document.getElementById('cepOrcSuccess').style.display = 'none';
                        }, 3000);
                    }
                    
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                script.src = `https://viacep.com.br/ws/${cep}/json/?callback=${callbackName}`;
                script.onerror = function() {
                    document.getElementById('cepOrcLoading').style.display = 'none';
                    document.head.removeChild(script);
                    delete window[callbackName];
                };
                
                document.head.appendChild(script);
            }, 500);
        }

        // Limpar campos de endere√ßo do or√ßamento
        function limparCamposEnderecoOrcamento() {
            document.getElementById('orcRua').value = '';
            document.getElementById('orcBairro').value = '';
            document.getElementById('orcCidade').value = '';
            document.getElementById('orcEstado').value = '';
            document.getElementById('orcDuracao').value = '';
        }

        // Open financeiro modal
        function openFinanceiroModal(clienteId, isNewClient = false) {
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            if (!cliente) return;
            
            // Preencher nome do cliente
            document.getElementById('financeiroClienteNome').textContent = `üíº ${cliente.nome}`;
            document.getElementById('financeiroClienteId').value = clienteId;
            
            // Mostrar mensagem se for novo cliente
            if (isNewClient) {
                document.getElementById('financeiroNovoClienteMsg').style.display = 'block';
            } else {
                document.getElementById('financeiroNovoClienteMsg').style.display = 'none';
            }
            
            // Carregar contas banc√°rias nos selects
            carregarContasNosSelects();
            
            // Preencher dados financeiros se existirem
            if (cliente.financeiro) {
                document.getElementById('financeiroValorTotal').value = cliente.financeiro.valorTotal || '';
                document.getElementById('financeiroSinalValor').value = cliente.financeiro.sinalValor || '';
                document.getElementById('financeiroSinalData').value = cliente.financeiro.sinalData || '';
                document.getElementById('financeiroVencimento').value = cliente.financeiro.vencimento || '';
                
                // Preencher forma de pagamento do sinal se existir
                if (cliente.financeiro.sinalFormaPagamento && document.getElementById('financeiroSinalFormaPagamento')) {
                    document.getElementById('financeiroSinalFormaPagamento').value = cliente.financeiro.sinalFormaPagamento;
                }
                
                // Preencher conta do sinal se existir
                if (cliente.financeiro.sinalConta && document.getElementById('financeiroSinalConta')) {
                    document.getElementById('financeiroSinalConta').value = cliente.financeiro.sinalConta;
                }
                
                // Calcular e mostrar resumo
                calcularSaldoFinanceiro();
            } else {
                // Limpar campos
                document.getElementById('financeiroValorTotal').value = '';
                document.getElementById('financeiroSinalValor').value = '';
                document.getElementById('financeiroSinalData').value = '';
                document.getElementById('financeiroValorPagar').value = '';
                document.getElementById('financeiroVencimento').value = '';
                document.getElementById('resumoFinanceiroModal').style.display = 'none';
                
                // Limpar forma de pagamento
                if (document.getElementById('financeiroSinalFormaPagamento')) {
                    document.getElementById('financeiroSinalFormaPagamento').value = '';
                }
            }
            
            openModal('financeiro');
        }

        // Criar evento do cliente (atalho do modal financeiro)
        function criarEventoDoCliente() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal financeiro
            closeModal('financeiro');
            
            // Ir para aba de eventos
            switchTabProgramatically('eventos');
            
            // Abrir modal de novo evento
            setTimeout(() => {
                openModal('evento');
                
                // Pr√©-preencher APENAS nome do cliente
                const clienteInput = document.getElementById('eventoCliente');
                if (clienteInput) {
                    clienteInput.value = cliente.nome;
                }
                
                // Guardar dados do cliente para op√ß√£o de usar endere√ßo
                window.enderecoCliente = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar op√ß√£o de usar endere√ßo do cliente se ele tiver endere√ßo
                if (cliente.cep) {
                    document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                    document.getElementById('enderecoClienteDisplay').textContent = cliente.endereco || `${cliente.rua}, ${cliente.numero} - ${cliente.bairro}`;
                }
                
                // Pr√©-preencher valor se tiver financeiro
                if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                    document.getElementById('eventoValor').value = cliente.financeiro.valorTotal;
                    document.getElementById('valorClienteDisplay').textContent = formatMoney(cliente.financeiro.valorTotal);
                    document.getElementById('valorClienteInfo').style.display = 'block';
                }
            }, 300);
        }

        // Criar or√ßamento do cliente (atalho do modal financeiro)
        function criarOrcamentoDoCliente() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal financeiro
            closeModal('financeiro');
            
            // Pequeno delay para transi√ß√£o suave
            setTimeout(() => {
                // Abrir modal de or√ßamento
                openModal('orcamento');
                
                // Pr√©-preencher nome do cliente
                const clienteInput = document.getElementById('orcCliente');
                if (clienteInput) {
                    clienteInput.value = cliente.nome;
                }
                
                // Pr√©-preencher endere√ßo se dispon√≠vel
                if (cliente.cep) {
                    document.getElementById('orcCep').value = cliente.cep;
                    document.getElementById('orcRua').value = cliente.rua || '';
                    document.getElementById('orcNumero').value = cliente.numero || '';
                    document.getElementById('orcComplemento').value = cliente.complemento || '';
                    document.getElementById('orcBairro').value = cliente.bairro || '';
                    document.getElementById('orcCidade').value = cliente.cidade || '';
                    document.getElementById('orcEstado').value = cliente.estado || '';
                }
                
                // Carregar servi√ßos dispon√≠veis
                renderServicosOrcamento();
            }, 300);
        }

        // Atalhos do modal de sucesso de cliente
        function atalhoOrcamento() {
            const clienteId = window.ultimoClienteId;
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            setTimeout(function() {
                openModal('orcamento');
                
                // Pr√©-preencher APENAS o nome do cliente
                document.getElementById('orcCliente').value = cliente.nome;
                
                // Guardar dados do cliente para op√ß√£o de usar endere√ßo (se necess√°rio)
                window.enderecoClienteOrcamento = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar op√ß√£o de usar endere√ßo se cliente tiver endere√ßo
                if (cliente.endereco && cliente.endereco.trim() !== '') {
                    const opcoesDiv = document.getElementById('opcoesEnderecoOrcamento');
                    if (opcoesDiv) {
                        const enderecoDisplay = document.getElementById('enderecoClienteDisplayOrc');
                        if (enderecoDisplay) {
                            enderecoDisplay.innerHTML = `<strong>${cliente.endereco}</strong>`;
                            opcoesDiv.style.display = 'block';
                        }
                    }
                }
                
                renderServicosOrcamento();
            }, 300);
        }

        function atalhoEvento() {
            const clienteId = window.ultimoClienteId;
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            switchTabProgramatically('eventos');
            
            setTimeout(function() {
                openModal('evento');
                document.getElementById('eventoCliente').value = cliente.nome;
                
                // Guardar dados do cliente para op√ß√£o de usar endere√ßo
                window.enderecoCliente = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar op√ß√£o de usar endere√ßo do cliente
                if (cliente.cep) {
                    document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                    document.getElementById('enderecoClienteDisplay').textContent = cliente.endereco || `${cliente.rua}, ${cliente.numero} - ${cliente.bairro}`;
                }
            }, 300);
        }

        function atalhoFinanceiro() {
            const clienteId = window.ultimoClienteId;
            
            // Fechar modal diretamente
            document.getElementById('modalSucessoCliente').classList.remove('active');
            
            setTimeout(function() {
                openFinanceiroModal(clienteId, true);
            }, 300);
        }

        // Calcular saldo devedor no modal financeiro
        function calcularSaldoFinanceiro() {
            const valorTotal = parseFloat(document.getElementById('financeiroValorTotal').value) || 0;
            const sinalValor = parseFloat(document.getElementById('financeiroSinalValor').value) || 0;
            
            // Buscar cliente para pegar pagamentos adicionais
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const cliente = DB.get('clientes').find(c => c.id === clienteId);
            
            let totalPagamentosAdicionais = 0;
            if (cliente && cliente.financeiro && cliente.financeiro.pagamentosAdicionais) {
                totalPagamentosAdicionais = cliente.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            }
            
            const valorPagar = valorTotal - sinalValor - totalPagamentosAdicionais;
            
            document.getElementById('financeiroValorPagar').value = valorPagar.toFixed(2);
            
            // Mostrar forma de pagamento do sinal se tiver valor
            const formaPagamentoSinalGroup = document.getElementById('formaPagamentoSinalGroup');
            const contaSinalGroup = document.getElementById('contaSinalGroup');
            if (formaPagamentoSinalGroup) {
                formaPagamentoSinalGroup.style.display = sinalValor > 0 ? 'block' : 'none';
                if (contaSinalGroup) {
                    contaSinalGroup.style.display = sinalValor > 0 ? 'block' : 'none';
                }
            }
            
            // Mostrar se√ß√£o de pagamento do restante se j√° tiver sinal e houver saldo
            const secaoPagamento = document.getElementById('secaoPagamentoRestante');
            if (secaoPagamento) {
                if (cliente && cliente.financeiro && cliente.financeiro.sinalValor > 0 && valorPagar > 0) {
                    secaoPagamento.style.display = 'block';
                    // Atualizar display do valor restante
                    const valorRestanteDisplay = document.getElementById('valorRestanteDisplay');
                    if (valorRestanteDisplay) {
                        valorRestanteDisplay.textContent = formatMoney(valorPagar);
                    }
                } else {
                    secaoPagamento.style.display = 'none';
                }
            }
            
            // Mostrar resumo se houver valores
            if (valorTotal > 0) {
                const totalPago = sinalValor + totalPagamentosAdicionais;
                const percentPaid = (totalPago / valorTotal) * 100;
                
                document.getElementById('resumoFinanceiroModal').style.display = 'block';
                document.getElementById('resumoTotalModal').textContent = formatMoney(valorTotal);
                document.getElementById('resumoSinalModal').textContent = formatMoney(sinalValor);
                document.getElementById('resumoTotalPagoModal').textContent = formatMoney(totalPago);
                document.getElementById('resumoSaldoModal').textContent = formatMoney(valorPagar);
                document.getElementById('progressBarModal').style.width = percentPaid + '%';
                document.getElementById('progressPercentModal').textContent = percentPaid.toFixed(0) + '%';
                
                // Mostrar hist√≥rico de pagamentos adicionais
                const historico = document.getElementById('historicoPagamentosAdicionais');
                const lista = document.getElementById('listaPagamentosAdicionais');
                
                if (cliente && cliente.financeiro && cliente.financeiro.pagamentosAdicionais && cliente.financeiro.pagamentosAdicionais.length > 0) {
                    historico.style.display = 'block';
                    lista.innerHTML = cliente.financeiro.pagamentosAdicionais.map((p, index) => {
                        const nomeForma = {
                            'pix': 'üí≥ PIX',
                            'dinheiro': 'üíµ Dinheiro',
                            'debito': 'üí≥ D√©bito',
                            'credito': 'üí≥ Cr√©dito',
                            'transferencia': 'üè¶ Transfer√™ncia',
                            'boleto': 'üìÑ Boleto'
                        }[p.formaPagamento] || p.formaPagamento;
                        
                        return `
                            <div style="display: flex; justify-content: space-between; padding: 4px 0;">
                                <span>${formatDate(p.data)} - ${nomeForma}</span>
                                <strong style="color: var(--success);">+${formatMoney(p.valor)}</strong>
                            </div>
                        `;
                    }).join('');
                } else {
                    historico.style.display = 'none';
                }
            } else {
                document.getElementById('resumoFinanceiroModal').style.display = 'none';
            }
        }

        // Atualizar bot√£o de pagamento do restante
        function atualizarBotaoPagamentoRestante() {
            const valorDigitado = parseFloat(document.getElementById('financeiroValorPagamentoRestante').value) || 0;
            const btn = document.getElementById('btnPagamentoRestante');
            
            if (valorDigitado > 0) {
                btn.textContent = `‚úÖ Pagar ${formatMoney(valorDigitado)}`;
            } else {
                btn.textContent = '‚úÖ Pagar Valor Total Restante';
            }
        }

        // Registrar pagamento do restante
        function registrarPagamentoRestante() {
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const dataPagamento = document.getElementById('financeiroDataPagamentoRestante').value;
            const formaPagamento = document.getElementById('financeiroFormaPagamentoRestante').value;
            const contaId = document.getElementById('financeiroContaPagamentoRestante') ? document.getElementById('financeiroContaPagamentoRestante').value : '';
            const valorPagarTotal = parseFloat(document.getElementById('financeiroValorPagar').value) || 0;
            const valorPagamentoDigitado = parseFloat(document.getElementById('financeiroValorPagamentoRestante').value) || 0;
            
            // Se n√£o digitou valor, usa o total restante
            const valorPagamento = valorPagamentoDigitado > 0 ? valorPagamentoDigitado : valorPagarTotal;
            
            if (!dataPagamento || !formaPagamento) {
                alert('‚ö†Ô∏è Por favor, preencha a data e a forma de pagamento.');
                return;
            }
            
            if (valorPagarTotal <= 0) {
                alert('‚ö†Ô∏è N√£o h√° valor a pagar.');
                return;
            }
            
            if (valorPagamento > valorPagarTotal) {
                alert('‚ö†Ô∏è O valor do pagamento n√£o pode ser maior que o valor restante.');
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) return;
            
            // Inicializar array de pagamentos adicionais se n√£o existir
            if (!cliente.financeiro.pagamentosAdicionais) {
                cliente.financeiro.pagamentosAdicionais = [];
            }
            
            // Adicionar novo pagamento ao hist√≥rico
            cliente.financeiro.pagamentosAdicionais.push({
                valor: valorPagamento,
                data: dataPagamento,
                formaPagamento: formaPagamento,
                contaId: contaId,
                dataRegistro: new Date().toISOString()
            });
            
            // Registrar pagamento como receita
            const receitaPagamento = {
                descricao: `Pagamento - ${cliente.nome}`,
                valor: valorPagamento,
                data: dataPagamento,
                categoria: 'pagamento',
                clienteId: clienteId,
                formaPagamento: formaPagamento || 'nao-informado'
            };
            
            // Adicionar contaId apenas se foi selecionado
            if (contaId && contaId !== '') {
                receitaPagamento.contaId = contaId;
                console.log('Registrando pagamento com conta:', contaId);
            }
            
            DB.add('receitas', receitaPagamento);
            
            // Atualizar saldo da conta se houver conta selecionada
            if (contaId && contaId !== '') {
                atualizarSaldoConta(contaId, valorPagamento, 'credito');
            }
            
            // Calcular total de pagamentos adicionais
            const totalPagamentosAdicionais = cliente.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            
            // Atualizar valor a pagar
            cliente.financeiro.valorPagar = cliente.financeiro.valorTotal - cliente.financeiro.sinalValor - totalPagamentosAdicionais;
            
            // Se pagou tudo, marcar como pago completamente
            if (cliente.financeiro.valorPagar <= 0) {
                cliente.financeiro.valorPagar = 0;
                cliente.financeiro.pagamentoCompleto = true;
                cliente.financeiro.dataPagamentoCompleto = dataPagamento;
            }
            
            DB.set('clientes', clientes);
            
            // Limpar campos
            document.getElementById('financeiroValorPagamentoRestante').value = '';
            document.getElementById('financeiroDataPagamentoRestante').value = '';
            document.getElementById('financeiroFormaPagamentoRestante').value = '';
            
            // Recalcular
            calcularSaldoFinanceiro();
            
            // Atualizar visualiza√ß√£o
            renderClientsList();
            updateClientsStats();
            updateDashboard();
            atualizarFinanceiroPorPeriodo();
            
            alert(`‚úÖ Pagamento de ${formatMoney(valorPagamento)} registrado com sucesso!`);
        }

        // Save financeiro
        function saveFinanceiro(e) {
            e.preventDefault();
            
            // Prevenir m√∫ltiplas submiss√µes
            const submitBtn = e.target.querySelector('button[type="submit"]');
            if (submitBtn.disabled) return;
            submitBtn.disabled = true;
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Salvando...';
            
            const clienteId = parseInt(document.getElementById('financeiroClienteId').value);
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.id === clienteId);
            
            if (!cliente) {
                alert('‚ùå Erro: Cliente n√£o encontrado!');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                return;
            }
            
            const valorTotal = parseFloat(document.getElementById('financeiroValorTotal').value) || 0;
            const sinalValor = parseFloat(document.getElementById('financeiroSinalValor').value) || 0;
            const sinalFormaPagamento = document.getElementById('financeiroSinalFormaPagamento') ? document.getElementById('financeiroSinalFormaPagamento').value : '';
            const sinalContaElement = document.getElementById('financeiroSinalConta');
            const sinalConta = sinalContaElement ? sinalContaElement.value : '';
            
            console.log('Salvando financeiro - Conta selecionada:', sinalConta);
            
            // Preservar pagamentos adicionais existentes
            const pagamentosAdicionais = cliente.financeiro && cliente.financeiro.pagamentosAdicionais ? cliente.financeiro.pagamentosAdicionais : [];
            
            // Recalcular valor a pagar considerando pagamentos adicionais
            const totalPagamentosAdicionais = pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0);
            const valorPagar = valorTotal - sinalValor - totalPagamentosAdicionais;
            
            // Verificar se o sinal mudou (novo sinal ou valor diferente)
            const sinalAnterior = cliente.financeiro && cliente.financeiro.sinalValor ? cliente.financeiro.sinalValor : 0;
            const sinalMudou = sinalValor !== sinalAnterior;
            
            cliente.financeiro = {
                valorTotal: valorTotal,
                sinalValor: sinalValor,
                sinalData: document.getElementById('financeiroSinalData').value,
                sinalFormaPagamento: sinalFormaPagamento,
                sinalConta: sinalConta,
                pagamentosAdicionais: pagamentosAdicionais, // Preservar pagamentos
                valorPagar: valorPagar,
                vencimento: document.getElementById('financeiroVencimento').value,
                pagamentoCompleto: valorPagar <= 0,
                dataPagamentoCompleto: cliente.financeiro && cliente.financeiro.dataPagamentoCompleto ? cliente.financeiro.dataPagamentoCompleto : null,
                sinalReceitaRegistrada: cliente.financeiro && cliente.financeiro.sinalReceitaRegistrada ? cliente.financeiro.sinalReceitaRegistrada : false
            };
            
            // Registrar sinal como receita se houver valor e ainda n√£o foi registrado
            if (sinalValor > 0 && cliente.financeiro.sinalData && (sinalMudou || !cliente.financeiro.sinalReceitaRegistrada)) {
                // Se o sinal mudou e j√° tinha receita registrada, precisamos atualizar ou criar nova
                const receitaData = {
                    descricao: `Sinal - ${cliente.nome}`,
                    valor: sinalValor,
                    data: cliente.financeiro.sinalData,
                    categoria: 'sinal',
                    clienteId: clienteId,
                    formaPagamento: sinalFormaPagamento || 'nao-informado'
                };
                
                // Adicionar contaId apenas se foi selecionado
                if (sinalConta && sinalConta !== '') {
                    receitaData.contaId = sinalConta;
                    console.log('Registrando receita com conta:', sinalConta);
                }
                
                DB.add('receitas', receitaData);
                
                // Marcar que a receita foi registrada
                cliente.financeiro.sinalReceitaRegistrada = true;
                
                // Atualizar saldo da conta se houver conta selecionada
                if (sinalConta && sinalConta !== '') {
                    atualizarSaldoConta(sinalConta, sinalValor, 'credito');
                }
            }
            
            DB.set('clientes', clientes);
            
            closeModal('financeiro');
            renderClientsList(currentClientSearch);
            updateClientsStats();
            updateDashboard();
            atualizarFinanceiroPorPeriodo();
            
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            
            alert('‚úÖ Dados financeiros salvos com sucesso!');
        }

        // Render servi√ßos
        function renderServicos() {
            const servicos = DB.get('servicos');
            const container = document.getElementById('servicosList');

            if (servicos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum servi√ßo cadastrado ainda.</p>';
                return;
            }

            const html = servicos.map(s => `
                <div class="servico-item">
                    <div class="servico-header">
                        <div>
                            <div class="servico-nome">${s.nome}</div>
                            <span class="servico-categoria">${getCategoriaLabel(s.categoria)}</span>
                        </div>
                        <div class="servico-valor">${formatMoney(s.valor)}</div>
                    </div>
                    ${s.descricao ? `<div class="servico-descricao">${s.descricao}</div>` : ''}
                    <div class="servico-actions">
                        <button class="btn btn-small btn-delete" onclick="deleteServico(${s.id})">
                            üóëÔ∏è Excluir
                        </button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        // Add servico
        function addServico(e) {
            e.preventDefault();
            const servico = {
                nome: document.getElementById('servicoNome').value,
                categoria: document.getElementById('servicoCategoria').value,
                valor: parseFloat(document.getElementById('servicoValor').value),
                descricao: document.getElementById('servicoDescricao').value
            };
            DB.add('servicos', servico);
            e.target.reset();
            renderServicos();
            renderOrcamentoServicos();
            renderServicosPerformance(); // Atualizar aba de gest√£o de servi√ßos
            alert('‚úì Servi√ßo cadastrado com sucesso!');
        }

        // Delete servico
        function deleteServico(id) {
            if (confirm('Deseja realmente excluir este servi√ßo?')) {
                const servicos = DB.get('servicos').filter(s => s.id !== id);
                DB.set('servicos', servicos);
                renderServicos();
                renderOrcamentoServicos();
                renderServicosPerformance(); // Atualizar aba de gest√£o de servi√ßos
            }
        }

        // Get categoria label
        function getCategoriaLabel(categoria) {
            const labels = {
                'som': 'Som e Ilumina√ß√£o',
                'decoracao': 'Decora√ß√£o',
                'buffet': 'Buffet',
                'fotografia': 'Fotografia/Filmagem',
                'animacao': 'Anima√ß√£o',
                'estrutura': 'Estrutura',
                'outros': 'Outros'
            };
            return labels[categoria] || categoria;
        }

        // Render servicos no or√ßamento
        function renderOrcamentoServicos() {
            const servicos = DB.get('servicos');
            const container = document.getElementById('orcamentosServicosList');

            if (servicos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum servi√ßo cadastrado. Clique em "+ Novo Servi√ßo" para adicionar.</p>';
                return;
            }

            const html = servicos.map(s => `
                <label class="servico-checkbox">
                    <input type="checkbox" 
                           value="${s.id}" 
                           data-id="${s.id}"
                           data-nome="${s.nome}"
                           data-valor="${s.valor}"
                           onchange="updateOrcamentoTotal()">
                    <div class="servico-checkbox-content">
                        <div class="servico-checkbox-nome">${s.nome}</div>
                        <div class="servico-checkbox-info">
                            <span>${getCategoriaLabel(s.categoria)}</span>
                            <span>‚Ä¢</span>
                            <span style="color: var(--success); font-weight: 600;">${formatMoney(s.valor)}</span>
                        </div>
                    </div>
                </label>
            `).join('');

            container.innerHTML = html;
        }

        // Update or√ßamento total
        function updateOrcamentoTotal() {
            const checkboxes = document.querySelectorAll('#orcamentosServicosList input[type="checkbox"]:checked');
            let total = 0;
            const selecionados = [];

            checkboxes.forEach(cb => {
                const valor = parseFloat(cb.dataset.valor);
                const nome = cb.dataset.nome;
                total += valor;
                selecionados.push({ nome, valor });
            });

            document.getElementById('orcValorTotal').value = total.toFixed(2);

            // Mostrar servi√ßos selecionados
            const containerSelecionados = document.getElementById('servicosSelecionados');
            const listaSelecionados = document.getElementById('servicosSelecionadosList');

            if (selecionados.length > 0) {
                containerSelecionados.style.display = 'block';
                listaSelecionados.innerHTML = selecionados.map(s => `
                    <div class="servico-selecionado-item">
                        <span>${s.nome}</span>
                        <span style="font-weight: 600;">${formatMoney(s.valor)}</span>
                    </div>
                `).join('') + `
                    <div class="servico-selecionado-item" style="border-top: 2px solid var(--success); margin-top: 8px; padding-top: 8px; font-weight: 700; color: var(--success);">
                        <span>TOTAL:</span>
                        <span>${formatMoney(total)}</span>
                    </div>
                `;
            } else {
                containerSelecionados.style.display = 'none';
            }
        }

        // Modal functions
        function openModal(type) {
            console.log('üîµ openModal chamada com type:', type);
            
            try {
                if (type === 'servico') {
                    console.log('  ‚Üí Renderizando servi√ßos...');
                    renderServicos();
                } else if (type === 'orcamento') {
                    console.log('  ‚Üí Renderizando or√ßamento...');
                    renderOrcamentoServicos();
                    
                    // Adicionar taxa Deslocamento padr√£o se n√£o existir
                    setTimeout(() => {
                        const taxaNomeInput = document.getElementById('orcTaxaNome');
                        if (taxaNomeInput && !taxaNomeInput.value) {
                            taxaNomeInput.value = 'Deslocamento';
                        }
                    }, 100);
                } else if (type === 'cliente') {
                    console.log('  ‚Üí Preparando modal de cliente...');
                    // Reset indica√ß√£o field
                    const indicacaoField = document.getElementById('indicacaoDetalhes');
                    if (indicacaoField) {
                        indicacaoField.style.display = 'none';
                    }
                } else if (type === 'evento') {
                    console.log('  ‚Üí Carregando clientes no evento...');
                    // Carregar lista de clientes
                    carregarClientesNoEvento();
                } else if (type === 'custoGeral' || type === 'custoEvento') {
                    console.log('  ‚Üí Carregando contas...');
                    // Carregar contas nos selects de custo
                    carregarContasNosSelects();
                } else if (type === 'receitaPessoal' || type === 'despesaPessoal') {
                    console.log('  ‚Üí Carregando contas pessoais...');
                    // Carregar contas pessoais nos selects
                    carregarContasPessoaisNosSelects();
                }
                
                // Construir ID do modal
                const modalId = 'modal' + type.charAt(0).toUpperCase() + type.slice(1);
                console.log('  ‚Üí Procurando modal com ID:', modalId);
                
                const modalElement = document.getElementById(modalId);
                if (modalElement) {
                    console.log('  ‚Üí ‚úÖ Modal encontrado, abrindo...');
                    
                    // Adicionar classe
                    modalElement.classList.add('active');
                    
                    // For√ßar estilos
                    modalElement.style.cssText = `
                        display: flex !important;
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100vw !important;
                        height: 100vh !important;
                        z-index: 999999 !important;
                        background: rgba(0, 0, 0, 0.9) !important;
                        align-items: center !important;
                        justify-content: center !important;
                    `;
                    
                    console.log('  ‚Üí ‚úÖ Modal aberto com sucesso!');
                } else {
                    console.error('  ‚Üí ‚ùå ERRO: Modal n√£o encontrado! ID:', modalId);
                }
            } catch (error) {
                console.error('‚ùå Erro em openModal:', error);
                alert('Erro ao abrir modal: ' + error.message);
            }
        }

        function closeModal(type) {
            console.log('üîµ Fechando modal:', type);
            
            const modalId = 'modal' + type.charAt(0).toUpperCase() + type.slice(1);
            const modalElement = document.getElementById(modalId);
            
            if (modalElement) {
                // Remover classe active
                modalElement.classList.remove('active');
                
                // For√ßar display none com !important via cssText
                modalElement.style.cssText = 'display: none !important;';
                
                console.log('‚úÖ Modal fechado:', modalId);
            } else {
                console.error('‚ùå Modal n√£o encontrado:', modalId);
            }
            
            // Resetar campos espec√≠ficos ao fechar modal de cliente
            if (type === 'cliente') {
                const indicacaoField = document.getElementById('indicacaoDetalhes');
                if (indicacaoField) indicacaoField.style.display = 'none';
                
                limparCamposEndereco();
                
                const cepLoading = document.getElementById('cepLoading');
                const cepError = document.getElementById('cepError');
                const cepSuccess = document.getElementById('cepSuccess');
                if (cepLoading) cepLoading.style.display = 'none';
                if (cepError) cepError.style.display = 'none';
                if (cepSuccess) cepSuccess.style.display = 'none';
            }
            
            // Resetar campos ao fechar modal financeiro
            if (type === 'financeiro') {
                const resumo = document.getElementById('resumoFinanceiroModal');
                if (resumo) resumo.style.display = 'none';
            }
            
            // Resetar modal de evento ao fechar
            if (type === 'evento') {
                window.eventoEditandoId = null;
                document.querySelector('#modalEvento .modal-title').textContent = 'Novo Evento';
                const submitBtn = document.querySelector('#modalEvento button[type="submit"]');
                submitBtn.textContent = 'Cadastrar Evento';
                submitBtn.onclick = null;
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            }
        }

        // === SISTEMA FINANCEIRO ===
        
        // Adicionar Conta Banc√°ria
        function addContaBancaria(e) {
            e.preventDefault();
            const conta = {
                nome: document.getElementById('contaNome').value,
                banco: document.getElementById('contaBanco').value,
                tipo: document.getElementById('contaTipo').value,
                agencia: document.getElementById('contaAgencia').value,
                numero: document.getElementById('contaNumero').value,
                saldoInicial: parseFloat(document.getElementById('contaSaldoInicial').value) || 0,
                observacoes: document.getElementById('contaObservacoes').value,
                ativa: true
            };
            
            DB.add('contas', conta);
            e.target.reset();
            closeModal('conta');
            renderFinanceiro();
            carregarContasNosSelects();
            alert('‚úÖ Conta banc√°ria cadastrada com sucesso!');
        }
        
        // Carregar contas nos selects de receita e despesa
        function carregarContasNosSelects() {
            const contas = DB.get('contas');
            const contasAtivas = contas.filter(c => c.ativa);
            
            const selectReceita = document.getElementById('receitaConta');
            const selectDespesa = document.getElementById('despesaConta');
            const selectSinalConta = document.getElementById('financeiroSinalConta');
            const selectPagamentoConta = document.getElementById('financeiroContaPagamentoRestante');
            const selectCustoGeral = document.getElementById('custoGeralConta');
            const selectCustoEvento = document.getElementById('custoEventoConta');
            
            if (selectReceita) {
                selectReceita.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectReceita.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectDespesa) {
                selectDespesa.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectDespesa.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            // Carregar nos selects do modal financeiro
            if (selectSinalConta) {
                selectSinalConta.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectSinalConta.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectPagamentoConta) {
                selectPagamentoConta.innerHTML = '<option value="">Selecione a conta...</option>';
                contasAtivas.forEach(c => {
                    selectPagamentoConta.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            // Carregar nos selects de custo
            if (selectCustoGeral) {
                selectCustoGeral.innerHTML = '<option value="">N√£o informado</option>';
                contasAtivas.forEach(c => {
                    selectCustoGeral.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
            
            if (selectCustoEvento) {
                selectCustoEvento.innerHTML = '<option value="">N√£o informado</option>';
                contasAtivas.forEach(c => {
                    selectCustoEvento.innerHTML += `<option value="${c.id}">${c.nome} - ${c.banco}</option>`;
                });
            }
        }
        
        // Navega√ß√£o do Financeiro
        function mostrarFinanceiroVisaoGeral() {
            document.getElementById('financeiroVisaoGeral').style.display = 'block';
            document.getElementById('financeiroPorConta').style.display = 'none';
            document.getElementById('financeiroContas').style.display = 'none';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-secondary');
            
            renderFinanceiroVisaoGeral();
        }
        
        function mostrarFinanceiroPorConta() {
            document.getElementById('financeiroVisaoGeral').style.display = 'none';
            document.getElementById('financeiroPorConta').style.display = 'block';
            document.getElementById('financeiroContas').style.display = 'none';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-secondary');
            
            renderFinanceiroPorConta();
        }
        
        function mostrarFinanceiroContas() {
            document.getElementById('financeiroVisaoGeral').style.display = 'none';
            document.getElementById('financeiroPorConta').style.display = 'none';
            document.getElementById('financeiroContas').style.display = 'block';
            
            document.getElementById('btnFinanceiroVisaoGeral').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroVisaoGeral').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroPorConta').classList.remove('btn-primary');
            document.getElementById('btnFinanceiroPorConta').classList.add('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.remove('btn-secondary');
            document.getElementById('btnFinanceiroContas').classList.add('btn-primary');
            
            renderContasBancarias();
        }
        
        // Render Financeiro
        function renderFinanceiro() {
            if (document.getElementById('financeiroTab').classList.contains('active')) {
                if (document.getElementById('financeiroVisaoGeral').style.display !== 'none') {
                    renderFinanceiroVisaoGeral();
                } else if (document.getElementById('financeiroPorConta').style.display !== 'none') {
                    renderFinanceiroPorConta();
                } else {
                    renderContasBancarias();
                }
            }
        }
        
        // Render Vis√£o Geral
        function renderFinanceiroVisaoGeral() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const contas = DB.get('contas');
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const lucro = totalReceitas - totalDespesas;
            
            document.getElementById('financeiroTotalReceitas').textContent = formatMoney(totalReceitas);
            document.getElementById('financeiroTotalDespesas').textContent = formatMoney(totalDespesas);
            document.getElementById('financeiroLucro').textContent = formatMoney(lucro);
            document.getElementById('financeiroLucro').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            document.getElementById('financeiroTotalContas').textContent = contas.filter(c => c.ativa).length;
            
            // Formas de Pagamento
            const formasPagamento = {};
            receitas.forEach(r => {
                const forma = r.formaPagamento || 'nao-informado';
                formasPagamento[forma] = (formasPagamento[forma] || 0) + r.valor;
            });
            
            const graficoDiv = document.getElementById('graficoFormasPagamento');
            graficoDiv.innerHTML = '';
            
            Object.keys(formasPagamento).forEach(forma => {
                const valor = formasPagamento[forma];
                const percent = totalReceitas > 0 ? ((valor / totalReceitas) * 100).toFixed(1) : 0;
                
                const nomes = {
                    'pix': 'üí≥ PIX',
                    'dinheiro': 'üíµ Dinheiro',
                    'debito': 'üí≥ D√©bito',
                    'credito': 'üí≥ Cr√©dito',
                    'transferencia': 'üè¶ Transfer√™ncia',
                    'boleto': 'üìÑ Boleto',
                    'nao-informado': '‚ùì N√£o Informado'
                };
                
                graficoDiv.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; margin-bottom: 4px;">${nomes[forma] || forma}</div>
                            <div style="font-size: 20px; color: var(--primary);">${formatMoney(valor)}</div>
                        </div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--accent);">${percent}%</div>
                    </div>
                `;
            });
            
            // √öltimas Transa√ß√µes
            const todasTransacoes = [
                ...receitas.map(r => ({...r, tipo: 'receita'})),
                ...despesas.map(d => ({...d, tipo: 'despesa'}))
            ].sort((a, b) => new Date(b.data) - new Date(a.data)).slice(0, 10);
            
            const transacoesDiv = document.getElementById('ultimasTransacoes');
            transacoesDiv.innerHTML = todasTransacoes.map(t => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${t.tipo === 'receita' ? 'üí∞' : 'üí∏'} ${t.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(t.data)}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: ${t.tipo === 'receita' ? 'var(--success)' : 'var(--danger)'};">
                        ${t.tipo === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');
        }
        
        // Render Por Conta
        function renderFinanceiroPorConta() {
            const contas = DB.get('contas').filter(c => c.ativa);
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            
            const listaDiv = document.getElementById('listaContasComSaldo');
            listaDiv.innerHTML = contas.map(c => {
                // Comparar como string para garantir compatibilidade
                const receitasConta = receitas.filter(r => r.contaId && r.contaId.toString() === c.id.toString());
                const despesasConta = despesas.filter(d => d.contaId && d.contaId.toString() === c.id.toString());
                
                const totalReceitas = receitasConta.reduce((sum, r) => sum + r.valor, 0);
                const totalDespesas = despesasConta.reduce((sum, d) => sum + d.valor, 0);
                const saldo = (c.saldoInicial || 0) + totalReceitas - totalDespesas;
                
                return `
                    <div class="card" style="margin-bottom: 16px; cursor: pointer;" onclick="verDetalhesConta(${c.id})">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin-bottom: 4px;">${c.nome}</h4>
                                <div style="font-size: 13px; color: var(--text-secondary);">${c.banco} - ${c.tipo}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${saldo >= 0 ? 'var(--success)' : 'var(--danger)'};">
                                    ${formatMoney(saldo)}
                                </div>
                                <div style="font-size: 12px; color: var(--text-secondary);">Saldo Atual</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Ver Detalhes da Conta
        function verDetalhesConta(contaId) {
            const conta = DB.get('contas').find(c => c.id === contaId);
            if (!conta) return;
            
            // Comparar como string para garantir compatibilidade
            const receitas = DB.get('receitas').filter(r => r.contaId && r.contaId.toString() === contaId.toString());
            const despesas = DB.get('despesas').filter(d => d.contaId && d.contaId.toString() === contaId.toString());
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            const saldo = (conta.saldoInicial || 0) + totalReceitas - totalDespesas;
            
            document.getElementById('detalheContaTitulo').innerHTML = `üè¶ ${conta.nome}`;
            document.getElementById('detalheContaReceitas').textContent = formatMoney(totalReceitas);
            document.getElementById('detalheContaDespesas').textContent = formatMoney(totalDespesas);
            document.getElementById('detalheContaSaldo').textContent = formatMoney(saldo);
            document.getElementById('detalheContaSaldo').style.color = saldo >= 0 ? 'var(--success)' : 'var(--danger)';
            
            const transacoes = [
                ...receitas.map(r => ({...r, tipo: 'receita'})),
                ...despesas.map(d => ({...d, tipo: 'despesa'}))
            ].sort((a, b) => new Date(b.data) - new Date(a.data));
            
            document.getElementById('detalheContaTransacoes').innerHTML = transacoes.map(t => `
                <div style="display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">${t.tipo === 'receita' ? 'üí∞' : 'üí∏'} ${t.descricao}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${formatDate(t.data)} ‚Ä¢ ${t.formaPagamento || 'N/A'}</div>
                    </div>
                    <div style="font-size: 18px; font-weight: 700; color: ${t.tipo === 'receita' ? 'var(--success)' : 'var(--danger)'};">
                        ${t.tipo === 'receita' ? '+' : '-'} ${formatMoney(t.valor)}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('detalhesConta').style.display = 'block';
        }
        
        // Render Contas Banc√°rias
        function renderContasBancarias() {
            const contas = DB.get('contas');
            const listaDiv = document.getElementById('listaContasBancarias');
            
            if (contas.length === 0) {
                listaDiv.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma conta cadastrada. Clique em "+ Nova Conta" para come√ßar.</p>';
                return;
            }
            
            listaDiv.innerHTML = contas.map(c => {
                // Calcular saldo atual baseado em receitas e despesas
                const saldoAtual = calcularSaldoRealConta(c.id);
                const saldoColor = saldoAtual >= 0 ? 'var(--success)' : 'var(--danger)';
                
                return `
                <div class="card" style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="margin-bottom: 12px;">
                                <h4 style="margin: 0 0 4px 0;">${c.nome}</h4>
                                <div style="font-size: 24px; font-weight: 700; color: ${saldoColor};">
                                    ${formatMoney(saldoAtual)}
                                </div>
                            </div>
                            <div style="display: grid; gap: 4px; font-size: 13px; color: var(--text-secondary);">
                                <div>üè¶ <strong>${c.banco}</strong> - ${c.tipo}</div>
                                ${c.agencia ? `<div>Ag√™ncia: ${c.agencia}</div>` : ''}
                                ${c.numero ? `<div>Conta: ${c.numero}</div>` : ''}
                                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); display: grid; grid-template-columns: auto auto; gap: 8px 16px; width: fit-content;">
                                    <span style="color: var(--text-secondary);">Saldo Inicial:</span>
                                    <strong>${formatMoney(c.saldoInicial || 0)}</strong>
                                    <span style="color: var(--text-secondary);">Saldo Atual:</span>
                                    <strong style="color: ${saldoColor};">${formatMoney(saldoAtual)}</strong>
                                </div>
                                ${c.observacoes ? `<div style="margin-top: 8px;">üìù ${c.observacoes}</div>` : ''}
                            </div>
                        </div>
                        <button class="btn" onclick="toggleContaAtiva(${c.id})" style="background: ${c.ativa ? 'rgba(239, 71, 111, 0.2)' : 'rgba(6, 214, 160, 0.2)'}; color: ${c.ativa ? 'var(--danger)' : 'var(--success)'}; border: 1px solid ${c.ativa ? 'var(--danger)' : 'var(--success)'}; flex-shrink: 0;">
                            ${c.ativa ? 'üóëÔ∏è Desativar' : '‚úÖ Ativar'}
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }
        
        // Toggle Conta Ativa
        function toggleContaAtiva(contaId) {
            const contas = DB.get('contas');
            const conta = contas.find(c => c.id === contaId);
            if (conta) {
                conta.ativa = !conta.ativa;
                DB.set('contas', contas);
                renderContasBancarias();
                carregarContasNosSelects();
            }
        }

        // Export data
        function exportData() {
            const data = {
                receitas: DB.get('receitas'),
                despesas: DB.get('despesas'),
                eventos: DB.get('eventos'),
                servicos: DB.get('servicos'),
                clientes: DB.get('clientes'),
                custosGerais: DB.get('custosGerais'),
                custosEventos: DB.get('custosEventos'),
                contas: DB.get('contas')
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `eventpro-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('üì• Backup exportado com sucesso!');
        }

        // Resetar todos os dados
        function resetarDados() {
            const confirmar = confirm(
                '‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° APAGAR TODOS OS DADOS do sistema!\n\n' +
                'Isso inclui:\n' +
                '‚Ä¢ Todos os clientes\n' +
                '‚Ä¢ Todos os eventos\n' +
                '‚Ä¢ Todas as receitas e despesas\n' +
                '‚Ä¢ Todos os custos\n' +
                '‚Ä¢ Todos os servi√ßos\n\n' +
                '‚ùó Esta a√ß√£o N√ÉO PODE ser desfeita!\n\n' +
                'Deseja continuar?'
            );
            
            if (!confirmar) return;
            
            const confirmarNovamente = confirm(
                'üö® √öLTIMA CONFIRMA√á√ÉO!\n\n' +
                'Tem certeza ABSOLUTA que deseja apagar TUDO?\n\n' +
                'Recomendamos fazer um backup antes (bot√£o üìä Relat√≥rios).'
            );
            
            if (!confirmarNovamente) return;
            
            // Limpar localStorage
            localStorage.clear();
            
            // Recarregar p√°gina
            alert('‚úÖ Todos os dados foram apagados!\n\nA p√°gina ser√° recarregada com dados de exemplo.');
            location.reload();
        }

        // Helper functions
        function formatMoney(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        function formatDate(date) {
            return new Date(date + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function updateDashboard() {
            updateStats();
            renderTransactions();
            renderEvents();
            checkBirthdays();
            updateOrigemStats();
        }

        // ========================================
        // FUN√á√ïES DE ENDERE√áO DO EVENTO
        // ========================================
        
        function carregarClientesNoEvento() {
            const clientes = DB.get('clientes');
            const select = document.getElementById('eventoCliente');
            
            if (select) {
                select.innerHTML = '<option value="">Selecione um cliente...</option>';
                clientes.forEach(c => {
                    select.innerHTML += `<option value="${c.nome}" data-cliente-id="${c.id}">${c.nome}</option>`;
                });
            }
        }
        
        function mostrarEnderecoCliente() {
            const select = document.getElementById('eventoCliente');
            const clienteNome = select.value;
            
            if (!clienteNome) {
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                return;
            }
            
            const clientes = DB.get('clientes');
            const cliente = clientes.find(c => c.nome === clienteNome);
            
            if (cliente && cliente.endereco && cliente.endereco.trim() !== '') {
                // Mostrar op√ß√£o de usar endere√ßo do cliente
                const enderecoDisplay = document.getElementById('enderecoClienteDisplay');
                enderecoDisplay.innerHTML = `<strong>${cliente.endereco}</strong>`;
                document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                
                // Salvar dados do cliente para uso posterior
                window.clienteSelecionadoEndereco = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
            } else {
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                limparCamposEnderecoEvento();
            }
        }
        
        function usarEnderecoCliente() {
            if (window.clienteSelecionadoEndereco) {
                const end = window.clienteSelecionadoEndereco;
                document.getElementById('eventoCep').value = end.cep;
                document.getElementById('eventoRua').value = end.rua;
                document.getElementById('eventoNumero').value = end.numero;
                document.getElementById('eventoComplemento').value = end.complemento;
                document.getElementById('eventoBairro').value = end.bairro;
                document.getElementById('eventoCidade').value = end.cidade;
                document.getElementById('eventoEstado').value = end.estado;
                
                document.getElementById('opcoesEnderecoEvento').style.display = 'none';
                
                // Scroll suave at√© os campos de endere√ßo
                document.getElementById('eventoCep').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function limparOpcoesEndereco() {
            document.getElementById('opcoesEnderecoEvento').style.display = 'none';
            limparCamposEnderecoEvento();
            document.getElementById('eventoCep').focus();
        }
        
        function limparCamposEnderecoEvento() {
            document.getElementById('eventoCep').value = '';
            document.getElementById('eventoRua').value = '';
            document.getElementById('eventoNumero').value = '';
            document.getElementById('eventoComplemento').value = '';
            document.getElementById('eventoBairro').value = '';
            document.getElementById('eventoCidade').value = '';
            document.getElementById('eventoEstado').value = '';
        }
        
        function usarEnderecoClienteOrcamento() {
            if (window.enderecoClienteOrcamento) {
                const end = window.enderecoClienteOrcamento;
                document.getElementById('orcCep').value = end.cep;
                document.getElementById('orcRua').value = end.rua;
                document.getElementById('orcNumero').value = end.numero;
                document.getElementById('orcComplemento').value = end.complemento;
                document.getElementById('orcBairro').value = end.bairro;
                document.getElementById('orcCidade').value = end.cidade;
                document.getElementById('orcEstado').value = end.estado;
                
                document.getElementById('opcoesEnderecoOrcamento').style.display = 'none';
                document.getElementById('orcCep').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function limparOpcoesEnderecoOrcamento() {
            document.getElementById('opcoesEnderecoOrcamento').style.display = 'none';
            document.getElementById('orcCep').value = '';
            document.getElementById('orcRua').value = '';
            document.getElementById('orcNumero').value = '';
            document.getElementById('orcComplemento').value = '';
            document.getElementById('orcBairro').value = '';
            document.getElementById('orcCidade').value = '';
            document.getElementById('orcEstado').value = '';
            document.getElementById('orcCep').focus();
        }
        
        // ========================================
        // FUN√á√ïES DE SALDO DAS CONTAS
        // ========================================
        
        function atualizarSaldoConta(contaId, valor, tipo) {
            if (!contaId || valor <= 0) return;
            
            const contas = DB.get('contas');
            const conta = contas.find(c => c.id === parseInt(contaId));
            
            if (!conta) return;
            
            // Inicializar saldo atual se n√£o existir
            if (typeof conta.saldoAtual === 'undefined') {
                conta.saldoAtual = conta.saldoInicial || 0;
            }
            
            // Atualizar saldo
            if (tipo === 'credito') {
                conta.saldoAtual += valor;
            } else if (tipo === 'debito') {
                conta.saldoAtual -= valor;
            }
            
            DB.set('contas', contas);
            
            // Atualizar visualiza√ß√£o se estiver na aba financeiro
            if (document.getElementById('listaContasBancarias')) {
                renderContasBancarias();
            }
        }
        
        function calcularSaldoRealConta(contaId) {
            const conta = DB.get('contas').find(c => c.id === parseInt(contaId));
            if (!conta) return 0;
            
            const receitas = DB.get('receitas').filter(r => r.contaId === contaId.toString());
            const despesas = DB.get('despesas').filter(d => d.contaId === contaId.toString());
            
            const totalReceitas = receitas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesas.reduce((sum, d) => sum + d.valor, 0);
            
            return (conta.saldoInicial || 0) + totalReceitas - totalDespesas;
        }

        // ========================================
        // FILTROS FINANCEIROS POR PER√çODO
        // ========================================
        
        function inicializarFiltrosFinanceiro() {
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const todasTransacoes = [...receitas, ...despesas];
            
            const anos = new Set();
            const anoAtual = new Date().getFullYear();
            anos.add(anoAtual);
            
            todasTransacoes.forEach(t => {
                if (t.data) {
                    const ano = new Date(t.data).getFullYear();
                    anos.add(ano);
                }
            });
            
            const selectAno = document.getElementById('filtroAnoFinanceiro');
            if (selectAno) {
                selectAno.innerHTML = '<option value="todos">Todos os anos</option>';
                Array.from(anos).sort((a, b) => b - a).forEach(ano => {
                    selectAno.innerHTML += `<option value="${ano}"${ano === anoAtual ? ' selected' : ''}>${ano}</option>`;
                });
            }
            
            const mesAtual = new Date().getMonth() + 1;
            const selectMes = document.getElementById('filtroMesFinanceiro');
            if (selectMes) {
                selectMes.value = 'todos';
            }
        }
        
        function atualizarFinanceiroPorPeriodo() {
            const mesSelecionado = document.getElementById('filtroMesFinanceiro')?.value;
            const anoSelecionado = document.getElementById('filtroAnoFinanceiro')?.value;
            const tipoVis = document.getElementById('tipoVisualizacao')?.value || 'mensal';
            
            const receitas = DB.get('receitas');
            const despesas = DB.get('despesas');
            const custosGerais = DB.get('custosGerais') || [];
            const custosEventos = DB.get('custosEventos') || [];
            const clientes = DB.get('clientes');
            
            const filtrarPorPeriodo = (transacao) => {
                if (!transacao.data) return false;
                const data = new Date(transacao.data);
                const mes = data.getMonth() + 1;
                const ano = data.getFullYear();
                
                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                
                return mesMatch && anoMatch;
            };
            
            const receitasFiltradas = receitas.filter(filtrarPorPeriodo);
            const despesasFiltradas = despesas.filter(filtrarPorPeriodo);
            const custosGeraisFiltrados = custosGerais.filter(filtrarPorPeriodo);
            const custosEventosFiltrados = custosEventos.filter(filtrarPorPeriodo);
            
            const totalReceitas = receitasFiltradas.reduce((sum, r) => sum + r.valor, 0);
            const totalDespesas = despesasFiltradas.reduce((sum, d) => sum + d.valor, 0);
            const totalCustosGerais = custosGeraisFiltrados.reduce((sum, c) => sum + c.valor, 0);
            const totalCustosEventos = custosEventosFiltrados.reduce((sum, c) => sum + c.valor, 0);
            const lucro = totalReceitas - totalDespesas - totalCustosGerais - totalCustosEventos;
            
            let valoresAReceber = 0;
            clientes.forEach(cliente => {
                if (cliente.financeiro && cliente.financeiro.valorPagar > 0) {
                    if (cliente.financeiro.vencimento) {
                        const dataVenc = new Date(cliente.financeiro.vencimento);
                        const mes = dataVenc.getMonth() + 1;
                        const ano = dataVenc.getFullYear();
                        
                        const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                        const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                        
                        if (mesMatch && anoMatch) {
                            valoresAReceber += cliente.financeiro.valorPagar;
                        }
                    }
                }
            });
            
            if (document.getElementById('financeiroTotalReceitas')) {
                document.getElementById('financeiroTotalReceitas').textContent = formatMoney(totalReceitas);
            }
            if (document.getElementById('financeiroTotalDespesas')) {
                document.getElementById('financeiroTotalDespesas').textContent = formatMoney(totalDespesas);
            }
            if (document.getElementById('financeiroLucro')) {
                document.getElementById('financeiroLucro').textContent = formatMoney(lucro);
            }
            if (document.getElementById('financeiroValoresAReceber')) {
                document.getElementById('financeiroValoresAReceber').textContent = formatMoney(valoresAReceber);
            }
            if (document.getElementById('financeiroCustosEventos')) {
                document.getElementById('financeiroCustosEventos').textContent = formatMoney(totalCustosEventos);
            }
            
            atualizarOrigemPagamentos(clientes, mesSelecionado, anoSelecionado);
            
            if (tipoVis === 'anual' && anoSelecionado !== 'todos') {
                mostrarBreakdownAnual(anoSelecionado);
            } else {
                const container = document.getElementById('breakdownAnual');
                if (container) container.style.display = 'none';
            }
        }
        
        function resetarFiltrosFinanceiro() {
            const anoAtual = new Date().getFullYear();
            document.getElementById('filtroMesFinanceiro').value = 'todos';
            document.getElementById('filtroAnoFinanceiro').value = anoAtual;
            document.getElementById('tipoVisualizacao').value = 'mensal';
            atualizarFinanceiroPorPeriodo();
        }
        
        function atualizarOrigemPagamentos(clientes, mesSelecionado, anoSelecionado) {
            const origens = {
                'pix': { count: 0, valor: 0, label: 'PIX', icon: 'üí≥' },
                'dinheiro': { count: 0, valor: 0, label: 'Dinheiro', icon: 'üíµ' },
                'debito': { count: 0, valor: 0, label: 'D√©bito', icon: 'üí≥' },
                'credito': { count: 0, valor: 0, label: 'Cr√©dito', icon: 'üí≥' },
                'transferencia': { count: 0, valor: 0, label: 'Transfer√™ncia', icon: 'üè¶' },
                'boleto': { count: 0, valor: 0, label: 'Boleto', icon: 'üìÑ' }
            };
            
            let totalPagamentos = 0;
            
            clientes.forEach(cliente => {
                if (cliente.financeiro) {
                    if (cliente.financeiro.sinalValor > 0 && cliente.financeiro.sinalFormaPagamento) {
                        const forma = cliente.financeiro.sinalFormaPagamento;
                        const valor = cliente.financeiro.sinalValor;
                        
                        let incluir = true;
                        if (cliente.financeiro.sinalData) {
                            const data = new Date(cliente.financeiro.sinalData);
                            const mes = data.getMonth() + 1;
                            const ano = data.getFullYear();
                            
                            const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                            const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                            
                            incluir = mesMatch && anoMatch;
                        }
                        
                        if (incluir && origens[forma]) {
                            origens[forma].count++;
                            origens[forma].valor += valor;
                            totalPagamentos += valor;
                        }
                    }
                    
                    if (cliente.financeiro.pagamentosAdicionais) {
                        cliente.financeiro.pagamentosAdicionais.forEach(pag => {
                            let incluir = true;
                            if (pag.data) {
                                const data = new Date(pag.data);
                                const mes = data.getMonth() + 1;
                                const ano = data.getFullYear();
                                
                                const mesMatch = mesSelecionado === 'todos' || mes === parseInt(mesSelecionado);
                                const anoMatch = anoSelecionado === 'todos' || ano === parseInt(anoSelecionado);
                                
                                incluir = mesMatch && anoMatch;
                            }
                            
                            if (incluir && pag.formaPagamento && origens[pag.formaPagamento]) {
                                origens[pag.formaPagamento].count++;
                                origens[pag.formaPagamento].valor += pag.valor;
                                totalPagamentos += pag.valor;
                            }
                        });
                    }
                }
            });
            
            const container = document.getElementById('origemPagamentosContainer');
            if (container && totalPagamentos > 0) {
                const html = Object.entries(origens)
                    .filter(([_, data]) => data.count > 0)
                    .sort((a, b) => b[1].valor - a[1].valor)
                    .map(([forma, data]) => {
                        const percent = ((data.valor / totalPagamentos) * 100).toFixed(1);
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 24px;">${data.icon}</span>
                                    <div>
                                        <div style="font-weight: 600; color: var(--text-primary);">${data.label}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">${data.count} pagamento${data.count > 1 ? 's' : ''}</div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: var(--success);">${formatMoney(data.valor)}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">${percent}%</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                
                container.innerHTML = html || '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>';
            } else if (container) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhum pagamento registrado</p>';
            }
        }
        
        function mostrarBreakdownAnual(ano) {
            // Implementa√ß√£o simplificada - mostrar apenas totais do ano
            const breakdownDiv = document.getElementById('breakdownAnual');
            if (breakdownDiv) {
                breakdownDiv.innerHTML = `<div style="margin-top: 20px; padding: 20px; background: var(--card-bg); border-radius: 12px;"><h3>üìä Visualiza√ß√£o Anual ${ano}</h3><p style="color: var(--text-secondary);">Breakdown detalhado por m√™s em desenvolvimento</p></div>`;
                breakdownDiv.style.display = 'block';
            }
        }


// ============================================
// FUN√á√ïES DA ABA DE SERVI√áOS
// ============================================

function renderServicosPerformance() {
    const servicos = DB.get('servicos');
    const eventos = DB.get('eventos');
    const clientes = DB.get('clientes');
    
    if (servicos.length === 0) {
        document.getElementById('servicosPerformanceList').innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum servi√ßo cadastrado ainda.</p>';
        return;
    }
    
    // Calcular estat√≠sticas de cada servi√ßo
    const servicosComStats = servicos.map(servico => {
        let vezesContratado = 0;
        let receitaTotal = 0;
        
        // Contar em eventos
        eventos.forEach(evento => {
            if (evento.servicos && Array.isArray(evento.servicos)) {
                evento.servicos.forEach(s => {
                    // Comparar por nome (mais confi√°vel) ou ID
                    if (s.nome === servico.nome || s.id === servico.id) {
                        vezesContratado++;
                        receitaTotal += (s.valor || servico.valor);
                    }
                });
            }
        });
        
        // Contar em or√ßamentos salvos nos clientes
        clientes.forEach(cliente => {
            if (cliente.orcamento && cliente.orcamento.servicos && Array.isArray(cliente.orcamento.servicos)) {
                cliente.orcamento.servicos.forEach(s => {
                    if (s.nome === servico.nome || s.id === servico.id) {
                        vezesContratado++;
                        receitaTotal += (s.valor || servico.valor);
                    }
                });
            }
        });
        
        return {
            ...servico,
            vezesContratado,
            receitaTotal,
            ticketMedio: vezesContratado > 0 ? receitaTotal / vezesContratado : servico.valor
        };
    });
    
    // Ordenar por mais contratado
    servicosComStats.sort((a, b) => b.vezesContratado - a.vezesContratado);
    
    const html = servicosComStats.map(s => `
        <div style="border-bottom: 1px solid var(--border); padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                <div style="flex: 1;">
                    <h3 style="margin-bottom: 8px; font-size: 18px;">${s.nome}</h3>
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <span style="font-size: 13px; color: var(--text-secondary);">
                            üì¶ ${getCategoriaLabel(s.categoria)}
                        </span>
                        <span style="font-size: 13px; color: var(--text-secondary);">
                            üí∞ Valor: ${formatMoney(s.valor)}
                        </span>
                    </div>
                </div>
                <button onclick="deleteServico(${s.id})" class="btn btn-small" style="background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                    üóëÔ∏è Excluir
                </button>
            </div>
            
            <!-- Estat√≠sticas -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; background: rgba(255, 255, 255, 0.03); padding: 16px; border-radius: 8px;">
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--success);">${s.vezesContratado}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Vezes Contratado</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--accent);">${formatMoney(s.receitaTotal)}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Receita Total</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 24px; font-weight: 700; color: var(--primary);">${formatMoney(s.ticketMedio)}</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Ticket M√©dio</div>
                </div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('servicosPerformanceList').innerHTML = html;
    
    // Atualizar cards de resumo
    const totalServicos = servicos.length;
    const totalLocacoes = servicosComStats.reduce((sum, s) => sum + s.vezesContratado, 0);
    const receitaTotal = servicosComStats.reduce((sum, s) => sum + s.receitaTotal, 0);
    const maisPopular = servicosComStats[0];
    
    document.getElementById('totalServicos').textContent = totalServicos;
    document.getElementById('totalLocacoes').textContent = totalLocacoes;
    document.getElementById('receitaTotalServicos').textContent = formatMoney(receitaTotal);
    document.getElementById('servicoMaisPopular').textContent = maisPopular ? maisPopular.nome : '-';
    
    // Renderizar tops
    renderTopServicos(servicosComStats);
}

function renderTopServicos(servicosComStats) {
    // Top 5 Mais Contratados
    const topContratados = servicosComStats
        .filter(s => s.vezesContratado > 0)
        .slice(0, 5);
    
    const htmlContratados = topContratados.map((s, index) => {
        const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
        return `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border);">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <span style="font-size: 24px;">${medals[index]}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${s.nome}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${s.vezesContratado} contrata√ß√µes</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 600; color: var(--success);">${formatMoney(s.receitaTotal)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('topServicosContratados').innerHTML = htmlContratados || '<p style="text-align: center; padding: 20px; color: var(--text-secondary);">Nenhuma contrata√ß√£o ainda</p>';
    
    // Top 5 Mais Rent√°veis
    const topRentaveis = [...servicosComStats]
        .filter(s => s.receitaTotal > 0)
        .sort((a, b) => b.receitaTotal - a.receitaTotal)
        .slice(0, 5);
    
    const htmlRentaveis = topRentaveis.map((s, index) => {
        const medals = ['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'];
        return `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border);">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                    <span style="font-size: 24px;">${medals[index]}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${s.nome}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">${s.vezesContratado} contrata√ß√µes</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: 600; color: var(--accent);">${formatMoney(s.receitaTotal)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    document.getElementById('topServicosRentaveis').innerHTML = htmlRentaveis || '<p style="text-align: center; padding: 20px; color: var(--text-secondary);">Nenhuma receita ainda</p>';
}

// ============================================
// FUN√á√ïES DA ABA DE CONFIGURA√á√ïES
// ============================================

function mostrarConfigSecao(secao) {
    // Esconder todas as se√ß√µes
    document.getElementById('configPerfilSecao').style.display = 'none';
    document.getElementById('configDocumentosSecao').style.display = 'none';
    document.getElementById('configLogoSecao').style.display = 'none';
    
    // Resetar bot√µes
    document.getElementById('btnConfigPerfil').classList.remove('btn-primary');
    document.getElementById('btnConfigPerfil').classList.add('btn-secondary');
    document.getElementById('btnConfigDocumentos').classList.remove('btn-primary');
    document.getElementById('btnConfigDocumentos').classList.add('btn-secondary');
    document.getElementById('btnConfigLogo').classList.remove('btn-primary');
    document.getElementById('btnConfigLogo').classList.add('btn-secondary');
    
    // Mostrar se√ß√£o selecionada
    if (secao === 'perfil') {
        document.getElementById('configPerfilSecao').style.display = 'block';
        document.getElementById('btnConfigPerfil').classList.remove('btn-secondary');
        document.getElementById('btnConfigPerfil').classList.add('btn-primary');
    } else if (secao === 'documentos') {
        document.getElementById('configDocumentosSecao').style.display = 'block';
        document.getElementById('btnConfigDocumentos').classList.remove('btn-secondary');
        document.getElementById('btnConfigDocumentos').classList.add('btn-primary');
    } else if (secao === 'logo') {
        document.getElementById('configLogoSecao').style.display = 'block';
        document.getElementById('btnConfigLogo').classList.remove('btn-secondary');
        document.getElementById('btnConfigLogo').classList.add('btn-primary');
    }
}

function carregarConfigEmpresa() {
    const config = DB.get('configuracoes')[0] || {};
    
    document.getElementById('configNomeEmpresa').value = config.nomeEmpresa || '';
    document.getElementById('configNomeCorporativo').value = config.nomeCorporativo || '';
    document.getElementById('configCNPJ').value = config.cnpj || '';
    document.getElementById('configTelefone').value = config.telefone || '';
    document.getElementById('configWhatsapp').value = config.whatsapp || '';
    document.getElementById('configEmail').value = config.email || '';
    document.getElementById('configInstagram').value = config.instagram || '';
    document.getElementById('configFacebook').value = config.facebook || '';
    document.getElementById('configYoutube').value = config.youtube || '';
    document.getElementById('configSite').value = config.site || '';
    document.getElementById('configClausulasContratuais').value = config.clausulasContratuais || '';
    
    // Carregar logo se existir
    if (config.logoBase64) {
        document.getElementById('logoImage').src = config.logoBase64;
        document.getElementById('logoImage').style.display = 'block';
        document.getElementById('logoPlaceholder').style.display = 'none';
    }
}

function salvarConfigEmpresa(e) {
    e.preventDefault();
    
    const config = {
        nomeEmpresa: document.getElementById('configNomeEmpresa').value,
        nomeCorporativo: document.getElementById('configNomeCorporativo').value,
        cnpj: document.getElementById('configCNPJ').value,
        telefone: document.getElementById('configTelefone').value,
        whatsapp: document.getElementById('configWhatsapp').value,
        email: document.getElementById('configEmail').value,
        instagram: document.getElementById('configInstagram').value,
        facebook: document.getElementById('configFacebook').value,
        youtube: document.getElementById('configYoutube').value,
        site: document.getElementById('configSite').value
    };
    
    // Preservar logo e cl√°usulas se existirem
    const configExistente = DB.get('configuracoes')[0];
    if (configExistente) {
        config.logoBase64 = configExistente.logoBase64 || null;
        config.clausulasContratuais = configExistente.clausulasContratuais || '';
    }
    
    // Salvar (sobrescrever ou criar)
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0] = { ...configuracoes[0], ...config };
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [config]);
    }
    
    alert('‚úÖ Configura√ß√µes salvas com sucesso!');
}

function salvarClausulasContratuais() {
    const texto = document.getElementById('configClausulasContratuais').value;
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].clausulasContratuais = texto;
        DB.set('configuracoes', configuracoes);
    } else {
        DB.set('configuracoes', [{ clausulasContratuais: texto }]);
    }
    
    alert('‚úÖ Cl√°usulas contratuais salvas com sucesso!');
}

function resetarClausulas() {
    const textoDefault = `CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS DE EVENTOS

1. DO OBJETO
O presente contrato tem por objeto a presta√ß√£o de servi√ßos de [TIPO DE SERVI√áO] pela CONTRATADA em favor do CONTRATANTE.

2. DAS CONDI√á√ïES
2.1. Data do Evento: [DATA]
2.2. Hor√°rio: [HOR√ÅRIO]
2.3. Local: [ENDERE√áO]

3. DO VALOR E FORMA DE PAGAMENTO
3.1. O valor total do servi√ßo √© de R$ [VALOR]
3.2. Sinal de R$ [SINAL] pago em [DATA_SINAL]
3.3. Restante de R$ [RESTANTE] at√© [VENCIMENTO]

4. DAS OBRIGA√á√ïES DA CONTRATADA
4.1. Fornecer os servi√ßos contratados com qualidade e pontualidade
4.2. Disponibilizar os equipamentos e materiais necess√°rios

5. DAS OBRIGA√á√ïES DO CONTRATANTE
5.1. Efetuar os pagamentos nas datas acordadas
5.2. Fornecer as informa√ß√µes necess√°rias para execu√ß√£o do servi√ßo

6. DO CANCELAMENTO
6.1. Em caso de cancelamento pela CONTRATANTE com at√© 30 dias de anteced√™ncia, haver√° devolu√ß√£o de 50% do sinal
6.2. Cancelamentos com menos de 30 dias n√£o haver√° devolu√ß√£o do sinal

7. DISPOSI√á√ïES GERAIS
Este contrato √© regido pelas leis brasileiras.

Data: [DATA_CONTRATO]

_________________________________
CONTRATADA

_________________________________
CONTRATANTE`;

    if (confirm('Deseja resetar as cl√°usulas para o texto padr√£o?')) {
        document.getElementById('configClausulasContratuais').value = textoDefault;
    }
}

function handleLogoUpload(event) {
    const file = event.target.files[0];
    
    if (!file) return;
    
    // Validar tamanho (2MB)
    if (file.size > 2 * 1024 * 1024) {
        alert('‚ùå Arquivo muito grande! M√°ximo 2MB.');
        return;
    }
    
    // Validar tipo
    if (!file.type.match('image.*')) {
        alert('‚ùå Apenas imagens s√£o permitidas!');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const base64 = e.target.result;
        
        // Mostrar preview
        document.getElementById('logoImage').src = base64;
        document.getElementById('logoImage').style.display = 'block';
        document.getElementById('logoPlaceholder').style.display = 'none';
        
        // Salvar no DB
        const configuracoes = DB.get('configuracoes');
        if (configuracoes.length > 0) {
            configuracoes[0].logoBase64 = base64;
            DB.set('configuracoes', configuracoes);
        } else {
            DB.set('configuracoes', [{ logoBase64: base64 }]);
        }
        
        alert('‚úÖ Logo carregada com sucesso!');
    };
    
    reader.readAsDataURL(file);
}

function removerLogo() {
    if (!confirm('Deseja realmente remover a logo?')) return;
    
    document.getElementById('logoImage').style.display = 'none';
    document.getElementById('logoPlaceholder').style.display = 'block';
    document.getElementById('logoImage').src = '';
    document.getElementById('logoUpload').value = '';
    
    const configuracoes = DB.get('configuracoes');
    if (configuracoes.length > 0) {
        configuracoes[0].logoBase64 = null;
        DB.set('configuracoes', configuracoes);
    }
    
    alert('‚úÖ Logo removida!');
}

function formatCNPJ(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 14) {
        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
        value = value.replace(/(\d{4})(\d)/, '$1-$2');
        input.value = value;
    }
}

function formatTelefone(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
        value = value.replace(/(\d)(\d{4})$/, '$1-$2');
        input.value = value;
    }
}

// Inicializar configura√ß√µes ao carregar
if (!DB.get('configuracoes')) {
    DB.set('configuracoes', []);
}
        // Aguardar DOM estar completamente carregado
        // ============================================
        // FUN√á√ÉO DE TESTE GLOBAL
        // ============================================
        window.testarModal = function() {
            console.log('üß™ TESTE MANUAL DE MODAL');
            const modal = document.getElementById('modalCliente');
            
            if (!modal) {
                console.error('‚ùå Modal n√£o encontrado!');
                return;
            }
            
            console.log('‚úÖ Modal encontrado');
            
            // Aplicar estilos agressivos
            console.log('Aplicando estilos...');
            modal.style.cssText = `
                display: flex !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                z-index: 999999 !important;
                opacity: 1 !important;
                visibility: visible !important;
                background: red !important;
                align-items: center !important;
                justify-content: center !important;
            `;
            
            console.log('‚úÖ Estilos aplicados');
            console.log('VOC√ä V√ä UMA TELA VERMELHA?');
        };
        
        console.log('üí° Para testar: digite testarModal() no console');
        
        // ============================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('üöÄ Inicializando EventPro...');
                
                // MOVER TODOS OS MODAIS PARA O FINAL DO BODY
                // Isso garante que fiquem na frente de tudo
                console.log('üì¶ Movendo modais para frente...');
                document.querySelectorAll('.modal').forEach(modal => {
                    document.body.appendChild(modal);
                });
                console.log('‚úÖ Modais reposicionados');
                
                // Initialize data
                initSampleData();
                carregarContasNosSelects();
                inicializarFiltrosFinanceiro();
                updateDashboard();
                atualizarFinanceiroPorPeriodo();
                
                // Renderizar clientes inicialmente
                renderClientsList();
                updateClientsStats();
                
                // Event listeners para c√°lculo de dura√ß√£o
                const horaInicio = document.getElementById('eventoHoraInicio');
                const horaFim = document.getElementById('eventoHoraFim');
                if (horaInicio) horaInicio.addEventListener('change', calcularDuracaoEvento);
                if (horaFim) horaFim.addEventListener('change', calcularDuracaoEvento);
                
                // Event listener para carregar valor do cliente
                const clienteInput = document.getElementById('eventoCliente');
                if (clienteInput) {
                    clienteInput.addEventListener('blur', carregarValorCliente);
                }
                
                // Observer para or√ßamento
                const orcamentoModal = document.getElementById('modalOrcamento');
                if (orcamentoModal) {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.target.classList.contains('active')) {
                                definirDatasOrcamento();
                            }
                        });
                    });
                    observer.observe(orcamentoModal, { attributes: true, attributeFilter: ['class'] });
                }
                
                // Toggle indica√ß√£o field
                const clienteOrigemSelect = document.getElementById('clienteOrigem');
                if (clienteOrigemSelect) {
                    clienteOrigemSelect.addEventListener('change', function(e) {
                        const indicacaoField = document.getElementById('indicacaoDetalhes');
                        if (e.target.value === 'indicacao') {
                            indicacaoField.style.display = 'block';
                        } else {
                            indicacaoField.style.display = 'none';
                            document.getElementById('clienteIndicacao').value = '';
                        }
                    });
                }

                // Close modal on outside click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('active');
                            modal.style.display = 'none';
                        }
                    });
                });
                
                console.log('‚úÖ EventPro inicializado com sucesso!');
            } catch (error) {
                console.error('‚ùå Erro ao inicializar EventPro:', error);
                alert('Erro ao inicializar o sistema. Por favor, recarregue a p√°gina.\n\nErro: ' + error.message);
            }
        });

        // Fun√ß√£o utilit√°ria para remover clientes duplicados (pode ser chamada no console)
        window.limparClientesDuplicados = function() {
            const clientes = DB.get('clientes');
            const clientesUnicos = [];
            const nomesVistos = new Set();
            
            clientes.forEach(cliente => {
                const chave = `${cliente.nome}-${cliente.email}-${cliente.telefone}`;
                if (!nomesVistos.has(chave)) {
                    nomesVistos.add(chave);
                    clientesUnicos.push(cliente);
                }
            });
            
            const removidos = clientes.length - clientesUnicos.length;
            
            if (removidos > 0) {
                DB.set('clientes', clientesUnicos);
                renderClientsList();
                updateClientsStats();
                checkBirthdays();
                updateOrigemStats();
                console.log(`‚úÖ ${removidos} cliente(s) duplicado(s) removido(s)!`);
                alert(`‚úÖ ${removidos} cliente(s) duplicado(s) removido(s)!`);
            } else {
                console.log('‚úÖ Nenhum cliente duplicado encontrado!');
                alert('‚úÖ Nenhum cliente duplicado encontrado!');
            }
        };

        // Custos Management
        let currentCustosView = 'gerais';
        let currentEventoId = null;

        // Toggle between custos views
        function toggleCustosView(view) {
            currentCustosView = view;
            
            // Update buttons
            document.querySelectorAll('#custosTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Toggle views
            document.getElementById('custosGeraisView').style.display = view === 'gerais' ? 'block' : 'none';
            document.getElementById('custosEventosView').style.display = view === 'eventos' ? 'block' : 'none';
            
            if (view === 'gerais') {
                renderCustosGerais();
                updateCustosGeraisStats();
            } else {
                populateEventosSelect();
            }
        }

        // Populate eventos select
        function populateEventosSelect() {
            const eventos = DB.get('eventos');
            const select = document.getElementById('eventoSelecionado');
            
            select.innerHTML = '<option value="">Selecione um evento...</option>';
            eventos.forEach(e => {
                select.innerHTML += `<option value="${e.id}">${e.nome} - ${formatDate(e.data)}</option>`;
            });
        }

        // Render custos do evento
        function renderCustosEvento() {
            const eventoId = parseInt(document.getElementById('eventoSelecionado').value);
            
            if (!eventoId) {
                document.getElementById('custoEventoContent').style.display = 'none';
                document.getElementById('custoEventoEmpty').style.display = 'block';
                return;
            }
            
            currentEventoId = eventoId;
            const evento = DB.get('eventos').find(e => e.id === eventoId);
            const custos = DB.get('custosEventos').filter(c => c.eventoId === eventoId);
            
            document.getElementById('custoEventoContent').style.display = 'block';
            document.getElementById('custoEventoEmpty').style.display = 'none';
            
            // Update evento info
            document.getElementById('eventoNome').textContent = evento.nome;
            document.getElementById('eventoInfo').textContent = `${evento.cliente} ‚Ä¢ ${formatDate(evento.data)} ‚Ä¢ ${evento.local}`;
            
            // Calculate totals
            const totalCustos = custos.reduce((sum, c) => sum + c.valor, 0);
            const lucro = evento.valor - totalCustos;
            const margem = evento.valor > 0 ? ((lucro / evento.valor) * 100).toFixed(1) : 0;
            
            document.getElementById('eventoValorTotal').textContent = formatMoney(evento.valor);
            document.getElementById('eventoTotalCustos').textContent = formatMoney(totalCustos);
            document.getElementById('eventoLucro').textContent = formatMoney(lucro);
            document.getElementById('eventoLucro').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            document.getElementById('eventoMargem').textContent = margem + '%';
            document.getElementById('eventoMargem').style.color = lucro >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Render custos list
            const container = document.getElementById('custosEventoList');
            if (custos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum custo registrado para este evento.</p>';
                return;
            }
            
            const categoriaIcons = {
                'ajudantes': 'üë∑',
                'equipamentos': 'üì¶',
                'materiais': 'üõ†Ô∏è',
                'transporte': 'üöö',
                'alimentacao': 'üçΩÔ∏è',
                'decoracao': 'üé®',
                'terceiros': 'ü§ù',
                'outros': 'üìå'
            };
            
            const html = custos.sort((a, b) => new Date(b.data) - new Date(a.data)).map(c => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon bg-danger">
                            ${categoriaIcons[c.categoria] || 'üí∏'}
                        </div>
                        <div class="transaction-details">
                            <h4>${c.descricao}</h4>
                            <div class="transaction-date">${formatDate(c.data)} ${c.observacoes ? '‚Ä¢ ' + c.observacoes : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="transaction-amount negative">${formatMoney(c.valor)}</div>
                        <button class="btn btn-small" onclick="deleteCustoEvento(${c.id})" style="padding: 6px 12px; background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Render custos gerais
        function renderCustosGerais() {
            const custosGerais = DB.get('custosGerais');
            const container = document.getElementById('custosGeraisList');
            
            if (custosGerais.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhum custo geral registrado.</p>';
                return;
            }
            
            const categoriaIcons = {
                'combustivel': '‚õΩ',
                'impostos': 'üìã',
                'aluguel': 'üè¢',
                'manutencao': 'üîß',
                'equipamentos': 'üì¶',
                'marketing': 'üì¢',
                'administrativo': 'üìä',
                'pessoal': 'üë•',
                'outros': 'üìå'
            };
            
            const html = custosGerais.sort((a, b) => new Date(b.data) - new Date(a.data)).map(c => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-icon bg-danger">
                            ${categoriaIcons[c.categoria] || 'üí∏'}
                        </div>
                        <div class="transaction-details">
                            <h4>${c.descricao}</h4>
                            <div class="transaction-date">${formatDate(c.data)} ${c.observacoes ? '‚Ä¢ ' + c.observacoes : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="transaction-amount negative">${formatMoney(c.valor)}</div>
                        <button class="btn btn-small" onclick="deleteCustoGeral(${c.id})" style="padding: 6px 12px; background: rgba(239, 71, 111, 0.2); color: var(--danger); border: 1px solid var(--danger);">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Update custos gerais stats
        function updateCustosGeraisStats() {
            const custosGerais = DB.get('custosGerais');
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();
            
            const custosMes = custosGerais.filter(c => {
                const data = new Date(c.data);
                return data.getMonth() === mesAtual && data.getFullYear() === anoAtual;
            });
            
            const total = custosMes.reduce((sum, c) => sum + c.valor, 0);
            const combustivel = custosMes.filter(c => c.categoria === 'combustivel').reduce((sum, c) => sum + c.valor, 0);
            const impostos = custosMes.filter(c => c.categoria === 'impostos').reduce((sum, c) => sum + c.valor, 0);
            const outros = total - combustivel - impostos;
            
            document.getElementById('totalCustosGeraisMes').textContent = formatMoney(total);
            document.getElementById('totalCombustivel').textContent = formatMoney(combustivel);
            document.getElementById('totalImpostos').textContent = formatMoney(impostos);
            document.getElementById('totalOutrosCustos').textContent = formatMoney(outros);
        }

        // Add custo geral
        function addCustoGeral(e) {
            e.preventDefault();
            const contaId = document.getElementById('custoGeralConta').value;
            const valor = parseFloat(document.getElementById('custoGeralValor').value);
            
            const custo = {
                descricao: document.getElementById('custoGeralDescricao').value,
                categoria: document.getElementById('custoGeralCategoria').value,
                valor: valor,
                data: document.getElementById('custoGeralData').value,
                observacoes: document.getElementById('custoGeralObs').value,
                contaId: contaId || null
            };
            
            DB.add('custosGerais', custo);
            
            // Atualizar saldo da conta se foi selecionada
            if (contaId && contaId !== '') {
                atualizarSaldoConta(contaId, valor, 'debito');
            }
            
            alert('‚úÖ Custo geral adicionado com sucesso!');
            closeModal('custoGeral');
            e.target.reset();
            renderCustosGerais();
            updateCustosGeraisStats();
            updateDashboard();
        }

        // Add custo evento
        function addCustoEvento(e) {
            e.preventDefault();
            const eventoId = parseInt(document.getElementById('custoEventoId').value);
            const contaId = document.getElementById('custoEventoConta').value;
            const valor = parseFloat(document.getElementById('custoEventoValor').value);
            
            const custo = {
                eventoId: eventoId,
                descricao: document.getElementById('custoEventoDescricao').value,
                categoria: document.getElementById('custoEventoCategoria').value,
                valor: valor,
                data: document.getElementById('custoEventoData').value,
                observacoes: document.getElementById('custoEventoObs').value,
                contaId: contaId || null
            };
            
            DB.add('custosEventos', custo);
            
            // Atualizar saldo da conta se foi selecionada
            if (contaId && contaId !== '') {
                atualizarSaldoConta(contaId, valor, 'debito');
            }
            
            alert('‚úÖ Custo do evento adicionado com sucesso!');
            closeModal('custoEvento');
            e.target.reset();
            renderCustosEvento();
            updateDashboard();
        }

        // Delete custo geral
        function deleteCustoGeral(id) {
            if (confirm('Deseja realmente excluir este custo?')) {
                const custos = DB.get('custosGerais').filter(c => c.id !== id);
                DB.set('custosGerais', custos);
                renderCustosGerais();
                updateCustosGeraisStats();
            }
        }

        // Delete custo evento
        function deleteCustoEvento(id) {
            if (confirm('Deseja realmente excluir este custo?')) {
                const custos = DB.get('custosEventos').filter(c => c.id !== id);
                DB.set('custosEventos', custos);
                renderCustosEvento();
            }
        }

        // Open modal custo evento
        function openModalCustoEvento() {
            const evento = DB.get('eventos').find(e => e.id === currentEventoId);
            if (!evento) return;
            
            document.getElementById('custoEventoNome').textContent = `üéâ ${evento.nome}`;
            document.getElementById('custoEventoId').value = currentEventoId;
            openModal('custoEvento');
        }

        // Open custos do evento direto (atalho da aba eventos)
        function openCustosEventoDireto(eventoId) {
            // Mudar para aba de custos
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Ativar aba custos
            document.querySelectorAll('.nav-tab').forEach(tab => {
                if (tab.textContent.toLowerCase().includes('custos')) {
                    tab.classList.add('active');
                }
            });
            document.getElementById('custosTab').classList.add('active');
            
            // Mudar para view de custos por evento
            currentCustosView = 'eventos';
            document.getElementById('custosGeraisView').style.display = 'none';
            document.getElementById('custosEventosView').style.display = 'block';
            
            // Atualizar bot√µes de toggle
            document.querySelectorAll('#custosTab .filter-btn').forEach(btn => {
                if (btn.textContent.includes('Evento')) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Popular select de eventos
            populateEventosSelect();
            
            // Selecionar o evento espec√≠fico
            document.getElementById('eventoSelecionado').value = eventoId;
            
            // Renderizar custos do evento
            renderCustosEvento();
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Se chamado programaticamente, encontrar o bot√£o correto
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(tabName)) {
                        tab.classList.add('active');
                    }
                });
            }
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load tab-specific content
            if (tabName === 'eventos') {
                renderEventsList();
                renderKanbanView();
            } else if (tabName === 'clientes') {
                renderClientsList();
                updateClientsStats();
            } else if (tabName === 'custos') {
                toggleCustosView('gerais');
            } else if (tabName === 'financeiro') {
                mostrarFinanceiroVisaoGeral();
            } else if (tabName === 'servicos') {
                renderServicosPerformance();
            } else if (tabName === 'configuracoes') {
                carregarConfigEmpresa();
            } else if (tabName === 'pessoal') {
                renderReceitasPessoais();
                renderDespesasPessoais();
                renderContasPessoais();
                renderDespesasPorCategoria();
                updateStatsPessoal();
            }
        }

        // Events page variables
        let currentView = 'list';
        let currentFilter = 'todos';
        let currentMonth = new Date();

        // Switch event view
        function switchEventView(view) {
            currentView = view;
            
            // Update buttons
            document.querySelectorAll('.view-toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Toggle views
            document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
            document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
            document.getElementById('kanbanView').style.display = view === 'kanban' ? 'block' : 'none';
            
            // Render appropriate view
            if (view === 'calendar') renderCalendar();
            if (view === 'kanban') renderKanbanView();
        }

        // Filter events
        function filterEvents(status) {
            currentFilter = status;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Re-render current view
            if (currentView === 'list') renderEventsList();
            if (currentView === 'kanban') renderKanbanView();
        }

        // Render events list
        function renderEventsList() {
            const eventos = DB.get('eventos');
            const container = document.getElementById('eventsListFull');
            
            const filteredEvents = currentFilter === 'todos' 
                ? eventos 
                : eventos.filter(e => e.status === currentFilter);
            
            if (filteredEvents.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 64px; margin-bottom: 16px;">üìÖ</div>
                        <h3 style="color: var(--text-secondary); margin-bottom: 8px;">Nenhum evento encontrado</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">
                            ${currentFilter === 'todos' ? 'Comece adicionando seu primeiro evento' : 'N√£o h√° eventos com este status'}
                        </p>
                    </div>
                `;
                return;
            }
            
            const html = filteredEvents
                .sort((a, b) => new Date(a.data) - new Date(b.data))
                .map(e => {
                    // Verificar se tem custos cadastrados
                    const custosEvento = DB.get('custosEventos').filter(c => c.eventoId === e.id);
                    const totalCustos = custosEvento.reduce((sum, c) => sum + c.valor, 0);
                    const temCustos = custosEvento.length > 0;
                    
                    // Mapear status para cores e textos
                    const statusMap = {
                        'aguardando': { class: 'status-pending', text: 'AGUARDANDO', emoji: '‚è≥' },
                        'andamento': { class: 'status-confirmed', text: 'EM ANDAMENTO', emoji: 'üîÑ' },
                        'concluido': { class: 'status-success', text: 'CONCLU√çDO', emoji: '‚úÖ' },
                        'cancelado': { class: 'status-canceled', text: 'CANCELADO', emoji: '‚ùå' },
                        // Compatibilidade com status antigos
                        'pendente': { class: 'status-pending', text: 'AGUARDANDO', emoji: '‚è≥' },
                        'confirmado': { class: 'status-confirmed', text: 'EM ANDAMENTO', emoji: 'üîÑ' }
                    };
                    
                    const statusInfo = statusMap[e.status] || statusMap['aguardando'];
                    
                    // Determinar texto do bot√£o de a√ß√£o
                    let botaoAcao = 'üîÑ Reabrir';
                    if (e.status === 'aguardando' || e.status === 'pendente') {
                        botaoAcao = 'üîÑ Iniciar';
                    } else if (e.status === 'andamento' || e.status === 'confirmado') {
                        botaoAcao = '‚úÖ Concluir';
                    }
                    
                    return `
                    <div class="event-card-full status-${e.status}">
                        <div class="event-card-main">
                            <div class="event-card-info">
                                <h3>${e.tipo || e.nome}</h3>
                                <div class="event-card-client">üë§ ${e.cliente}</div>
                                <div class="event-card-details">
                                    <div class="event-detail-item">
                                        üìÖ <strong>${formatDate(e.data)}</strong>
                                    </div>
                                    <div class="event-detail-item">
                                        üïê <strong>${e.horaInicio || e.horario}${e.horaFim ? ' - ' + e.horaFim : ''}</strong>
                                    </div>
                                    ${e.duracao ? `
                                        <div class="event-detail-item">
                                            ‚è±Ô∏è <strong>${e.duracao}</strong>
                                        </div>
                                    ` : ''}
                                    <div class="event-detail-item">
                                        üìç <strong>${e.local}</strong>
                                    </div>
                                    <div class="event-detail-item">
                                        üí∞ <strong>${formatMoney(e.valor)}</strong>
                                    </div>
                                    ${temCustos ? `
                                        <div class="event-detail-item" style="color: var(--danger);">
                                            üí∏ <strong>${formatMoney(totalCustos)}</strong> em custos
                                        </div>
                                        <div class="event-detail-item" style="color: var(--success);">
                                            üìä Lucro: <strong>${formatMoney(e.valor - totalCustos)}</strong>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="event-status ${statusInfo.class}">
                                ${statusInfo.emoji} ${statusInfo.text}
                            </div>
                        </div>
                        ${e.observacoes ? `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 13px;">
                                üìù ${e.observacoes}
                            </div>
                        ` : ''}
                        <div class="event-card-actions">
                            <button class="event-action-btn" onclick="editEvent(${e.id})">‚úèÔ∏è Editar</button>
                            <button class="event-action-btn ${temCustos ? 'style="background: rgba(255, 107, 53, 0.2); border-color: var(--primary); color: var(--primary);"' : ''}" onclick="openCustosEventoDireto(${e.id})">
                                üí∞ Custos ${temCustos ? `(${custosEvento.length})` : ''}
                            </button>
                            <button class="event-action-btn" onclick="toggleEventStatus(${e.id})">
                                ${botaoAcao}
                            </button>
                            <button class="event-action-btn" onclick="deleteEvent(${e.id})">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `}).join('');
            
            container.innerHTML = html;
        }

        // Render kanban view
        function renderKanbanView() {
            const eventos = DB.get('eventos');
            
            ['pendente', 'confirmado', 'cancelado'].forEach(status => {
                const statusEvents = eventos.filter(e => e.status === status);
                const container = document.getElementById('kanban' + status.charAt(0).toUpperCase() + status.slice(1));
                const countEl = document.getElementById('kanban' + status.charAt(0).toUpperCase() + status.slice(1) + 'Count');
                
                countEl.textContent = statusEvents.length;
                
                if (statusEvents.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px; font-size: 13px;">Nenhum evento</div>';
                    return;
                }
                
                const html = statusEvents
                    .sort((a, b) => new Date(a.data) - new Date(b.data))
                    .map(e => `
                        <div class="kanban-card">
                            <div class="kanban-card-title">${e.nome}</div>
                            <div class="kanban-card-info">üë§ ${e.cliente}</div>
                            <div class="kanban-card-info">üìÖ ${formatDate(e.data)} ‚Ä¢ ${e.horario}</div>
                            <div class="kanban-card-info">üìç ${e.local}</div>
                            <div class="kanban-card-info" style="color: var(--success); font-weight: 600; margin-top: 8px;">
                                üí∞ ${formatMoney(e.valor)}
                            </div>
                            <div style="display: flex; gap: 6px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                <button class="event-action-btn" onclick="event.stopPropagation(); openCustosEventoDireto(${e.id})" style="flex: 1; font-size: 11px; padding: 6px 10px;">
                                    üí∞ Custos
                                </button>
                                <button class="event-action-btn" onclick="event.stopPropagation(); viewEventDetails(${e.id})" style="flex: 1; font-size: 11px; padding: 6px 10px;">
                                    üëÅÔ∏è Ver
                                </button>
                            </div>
                        </div>
                    `).join('');
                
                container.innerHTML = html;
            });
        }

        // Render calendar
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            // Update month title
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                              'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            
            const eventos = DB.get('eventos');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            // Day headers
            ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'].forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // Previous month days
            const prevMonthDays = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${prevMonthDays - i}</div></div>`;
            }
            
            // Current month days
            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(year, month, day);
                date.setHours(0, 0, 0, 0);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayEvents = eventos.filter(e => e.data === dateStr);
                const isToday = date.getTime() === today.getTime();
                const hasEvent = dayEvents.length > 0;
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (hasEvent) classes += ' has-event';
                
                html += `
                    <div class="${classes}" onclick="viewDayEvents('${dateStr}')">
                        <div class="calendar-day-number">${day}</div>
                        ${hasEvent ? `<div class="calendar-day-events">${dayEvents.length} evento${dayEvents.length > 1 ? 's' : ''}</div>` : ''}
                    </div>
                `;
            }
            
            // Next month days
            const remainingDays = 42 - (startDay + totalDays);
            for (let day = 1; day <= remainingDays; day++) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = html;
        }

        // Calendar navigation
        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }

        function todayMonth() {
            currentMonth = new Date();
            renderCalendar();
        }

        // Event actions
        function changeEventStatus(id, newStatus) {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                evento.status = newStatus;
                DB.set('eventos', eventos);
                renderEventsList();
                renderKanbanView();
                updateDashboard();
            }
        }

        // Toggle status do evento (aguardando ‚Üí andamento ‚Üí concluido)
        function toggleEventStatus(id) {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === id);
            
            if (!evento) return;
            
            // Ciclo de status: aguardando ‚Üí andamento ‚Üí conclu√≠do
            if (evento.status === 'aguardando' || evento.status === 'pendente') {
                evento.status = 'andamento';
            } else if (evento.status === 'andamento' || evento.status === 'confirmado') {
                evento.status = 'concluido';
            } else if (evento.status === 'concluido') {
                evento.status = 'aguardando';
            }
            
            DB.set('eventos', eventos);
            renderEventsList();
            renderKanbanView();
            updateDashboard();
        }

        // Editar evento
        function editEvent(id) {
            const evento = DB.get('eventos').find(e => e.id === id);
            if (!evento) return;
            
            // Preencher modal com dados do evento
            document.getElementById('eventoTipo').value = evento.tipo || '';
            document.getElementById('eventoCliente').value = evento.cliente || '';
            document.getElementById('eventoData').value = evento.data || '';
            document.getElementById('eventoHoraInicio').value = evento.horaInicio || evento.horario || '';
            document.getElementById('eventoHoraFim').value = evento.horaFim || '';
            document.getElementById('eventoCep').value = evento.cep || '';
            document.getElementById('eventoRua').value = evento.rua || '';
            document.getElementById('eventoNumero').value = evento.numero || '';
            document.getElementById('eventoComplemento').value = evento.complemento || '';
            document.getElementById('eventoBairro').value = evento.bairro || '';
            document.getElementById('eventoCidade').value = evento.cidade || '';
            document.getElementById('eventoEstado').value = evento.estado || '';
            document.getElementById('eventoValor').value = evento.valor || '';
            document.getElementById('eventoStatus').value = evento.status || 'aguardando';
            document.getElementById('eventoObservacoes').value = evento.observacoes || '';
            
            // Calcular dura√ß√£o se tiver hor√°rios
            if (evento.horaInicio && evento.horaFim) {
                calcularDuracaoEvento();
            }
            
            // Guardar ID do evento sendo editado
            window.eventoEditandoId = id;
            
            // Mudar t√≠tulo do modal
            document.querySelector('#modalEvento .modal-title').textContent = 'Editar Evento';
            
            // Mudar texto do bot√£o
            const submitBtn = document.querySelector('#modalEvento button[type="submit"]');
            submitBtn.textContent = 'Salvar Altera√ß√µes';
            submitBtn.onclick = function(e) {
                e.preventDefault();
                salvarEdicaoEvento();
            };
            
            // Abrir modal
            openModal('evento');
        }

        // Salvar edi√ß√£o do evento
        function salvarEdicaoEvento() {
            const eventos = DB.get('eventos');
            const evento = eventos.find(e => e.id === window.eventoEditandoId);
            
            if (!evento) return;
            
            // Montar endere√ßo completo
            const cep = document.getElementById('eventoCep').value;
            const rua = document.getElementById('eventoRua').value;
            const numero = document.getElementById('eventoNumero').value;
            const complemento = document.getElementById('eventoComplemento').value;
            const bairro = document.getElementById('eventoBairro').value;
            const cidade = document.getElementById('eventoCidade').value;
            const estado = document.getElementById('eventoEstado').value;
            
            let enderecoCompleto = '';
            if (rua) {
                enderecoCompleto = rua;
                if (numero) enderecoCompleto += ', ' + numero;
                if (complemento) enderecoCompleto += ' - ' + complemento;
                if (bairro) enderecoCompleto += ' - ' + bairro;
                if (cidade && estado) enderecoCompleto += ' - ' + cidade + '/' + estado;
            }
            
            // Atualizar dados do evento
            evento.tipo = document.getElementById('eventoTipo').value;
            evento.nome = document.getElementById('eventoTipo').value;
            evento.cliente = document.getElementById('eventoCliente').value;
            evento.data = document.getElementById('eventoData').value;
            evento.horaInicio = document.getElementById('eventoHoraInicio').value;
            evento.horaFim = document.getElementById('eventoHoraFim').value;
            evento.duracao = document.getElementById('eventoDuracao').value;
            evento.horario = document.getElementById('eventoHoraInicio').value;
            evento.local = enderecoCompleto;
            evento.cep = cep;
            evento.rua = rua;
            evento.numero = numero;
            evento.complemento = complemento;
            evento.bairro = bairro;
            evento.cidade = cidade;
            evento.estado = estado;
            evento.valor = parseFloat(document.getElementById('eventoValor').value);
            evento.status = document.getElementById('eventoStatus').value;
            evento.observacoes = document.getElementById('eventoObservacoes').value;
            
            DB.set('eventos', eventos);
            
            // Resetar modal
            window.eventoEditandoId = null;
            document.querySelector('#modalEvento .modal-title').textContent = 'Novo Evento';
            const submitBtn = document.querySelector('#modalEvento button[type="submit"]');
            submitBtn.textContent = 'Cadastrar Evento';
            submitBtn.onclick = null;
            
            // Limpar formul√°rio e fechar
            document.querySelector('#modalEvento form').reset();
            limparCamposEnderecoEvento();
            closeModal('evento');
            
            // Atualizar interface
            renderEventsList();
            renderKanbanView();
            updateDashboard();
            
            alert('‚úÖ Evento atualizado com sucesso!');
        }

        function deleteEvent(id) {
            if (confirm('Deseja realmente excluir este evento?')) {
                const eventos = DB.get('eventos').filter(e => e.id !== id);
                DB.set('eventos', eventos);
                renderEventsList();
                renderKanbanView();
                updateDashboard();
            }
        }

        function viewEventDetails(id) {
            const evento = DB.get('eventos').find(e => e.id === id);
            if (evento) {
                alert(`Detalhes do Evento:\n\n${evento.nome}\nCliente: ${evento.cliente}\nData: ${formatDate(evento.data)}\nHor√°rio: ${evento.horario}\nLocal: ${evento.local}\nValor: ${formatMoney(evento.valor)}\nStatus: ${evento.status.toUpperCase()}`);
            }
        }

        function viewDayEvents(date) {
            const eventos = DB.get('eventos').filter(e => e.data === date);
            if (eventos.length > 0) {
                const list = eventos.map(e => `‚Ä¢ ${e.nome} - ${e.horario} (${e.cliente})`).join('\n');
                alert(`Eventos em ${formatDate(date)}:\n\n${list}`);
            }
        }

        function editEvent(id) {
            alert('Funcionalidade de edi√ß√£o em desenvolvimento!');
        }

        // Clients Page Functions
        let currentClientSearch = '';

        // Render clients list
        function renderClientsList(searchTerm = '') {
            const clientes = DB.get('clientes');
            const container = document.getElementById('clientsList');
            
            // Migrar clientes antigos sem financeiro
            let needsUpdate = false;
            clientes.forEach(c => {
                if (!c.financeiro) {
                    c.financeiro = {
                        valorTotal: 0,
                        sinalValor: 0,
                        sinalData: '',
                        valorPagar: 0,
                        vencimento: ''
                    };
                    needsUpdate = true;
                }
            });
            if (needsUpdate) {
                DB.set('clientes', clientes);
            }
            
            let filteredClients = clientes;
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredClients = clientes.filter(c => 
                    c.nome.toLowerCase().includes(term) ||
                    c.email.toLowerCase().includes(term) ||
                    c.telefone.toLowerCase().includes(term)
                );
            }
            
            if (filteredClients.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <h3 class="empty-state-title">${searchTerm ? 'Nenhum cliente encontrado' : 'Nenhum cliente cadastrado'}</h3>
                        <p class="empty-state-text">
                            ${searchTerm ? 'Tente outro termo de busca' : 'Comece adicionando seu primeiro cliente'}
                        </p>
                        ${!searchTerm ? '<button class="btn btn-primary" onclick="openModal(\'cliente\')">+ Adicionar Cliente</button>' : ''}
                    </div>
                `;
                return;
            }
            
            const html = filteredClients.map(c => {
                const initials = c.nome.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                const hoje = new Date();
                const aniversario = c.aniversario ? new Date(c.aniversario + 'T00:00:00') : null;
                const isBirthdayMonth = aniversario && aniversario.getMonth() === hoje.getMonth();
                
                const origemLabels = {
                    'facebook': 'üìò Facebook',
                    'instagram': 'üì∏ Instagram',
                    'google': 'üîç Google',
                    'indicacao': 'üë• Indica√ß√£o',
                    'outros': 'üìå Outros'
                };
                
                // Informa√ß√µes financeiras
                let financialSection = '';
                if (c.financeiro && c.financeiro.valorTotal > 0) {
                    // Calcular total de pagamentos adicionais
                    const totalPagamentosAdicionais = c.financeiro.pagamentosAdicionais ? 
                        c.financeiro.pagamentosAdicionais.reduce((sum, p) => sum + p.valor, 0) : 0;
                    
                    const totalPago = c.financeiro.sinalValor + totalPagamentosAdicionais;
                    const percentPaid = (totalPago / c.financeiro.valorTotal) * 100;
                    const isPaid = c.financeiro.valorPagar <= 0;
                    const isOverdue = c.financeiro.vencimento && new Date(c.financeiro.vencimento + 'T00:00:00') < hoje && !isPaid;
                    
                    let statusClass = 'status-pending';
                    let statusText = 'Pendente';
                    if (isPaid) {
                        statusClass = 'status-paid';
                        statusText = 'Pago';
                    } else if (isOverdue) {
                        statusClass = 'status-overdue';
                        statusText = 'Vencido';
                    }
                    
                    financialSection = `
                        <div class="client-financial" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})" style="cursor: pointer;">
                            <div class="financial-header">
                                <span class="financial-title">üí∞ Financeiro</span>
                                <span class="financial-status ${statusClass}">${statusText}</span>
                            </div>
                            <div class="financial-grid">
                                <div class="financial-item">
                                    <div class="financial-label">Valor Total</div>
                                    <div class="financial-value total">${formatMoney(c.financeiro.valorTotal)}</div>
                                </div>
                                <div class="financial-item">
                                    <div class="financial-label">Total Pago</div>
                                    <div class="financial-value paid">${formatMoney(totalPago)}</div>
                                    ${c.financeiro.sinalData ? `<div class="financial-date">Sinal: ${formatDate(c.financeiro.sinalData)}</div>` : ''}
                                </div>
                                <div class="financial-item">
                                    <div class="financial-label">Saldo Devedor</div>
                                    <div class="financial-value pending">${formatMoney(c.financeiro.valorPagar)}</div>
                                    ${c.financeiro.vencimento ? `<div class="financial-date">Venc: ${formatDate(c.financeiro.vencimento)}</div>` : ''}
                                </div>
                            </div>
                            <div class="payment-progress">
                                <div class="progress-label">
                                    <span>Progresso do Pagamento</span>
                                    <span>${percentPaid.toFixed(0)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentPaid}%;"></div>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 12px;">
                                üëÜ Clique para editar informa√ß√µes financeiras
                            </div>
                        </div>
                    `;
                } else {
                    // Mostrar card para adicionar financeiro
                    financialSection = `
                        <div class="client-financial" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})" style="cursor: pointer; border: 2px dashed var(--border); background: rgba(255, 255, 255, 0.01);">
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.5;">üí∞</div>
                                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">Nenhuma informa√ß√£o financeira</div>
                                <div style="font-size: 13px; color: var(--primary); font-weight: 600;">
                                    üëÜ Clique para adicionar dados financeiros
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="client-card" onclick="viewClientDetails(${c.id})">
                        <div class="client-card-header">
                            <div class="client-main-info">
                                <div class="client-avatar">${initials}</div>
                                <div class="client-details-main">
                                    <h3>${c.nome}</h3>
                                    <div class="client-email">üìß ${c.email}</div>
                                    <div class="client-phone">üì± ${c.telefone}</div>
                                </div>
                            </div>
                            <div class="client-badges">
                                ${isBirthdayMonth ? '<span class="client-badge badge-birthday">üéÇ Anivers√°rio Este M√™s</span>' : ''}
                                ${c.origem ? `<span class="client-badge badge-origem">${origemLabels[c.origem] || c.origem}</span>` : ''}
                            </div>
                        </div>
                        
                        ${financialSection}
                        
                        <div class="client-info-grid">
                            ${c.aniversario ? `
                                <div class="client-info-item">
                                    üéÇ <strong>${formatDate(c.aniversario)}</strong>
                                </div>
                            ` : ''}
                            ${c.cpf ? `
                                <div class="client-info-item">
                                    üìÑ <strong>${c.cpf}</strong>
                                </div>
                            ` : ''}
                            ${c.endereco ? `
                                <div class="client-info-item">
                                    üìç <strong>${c.endereco}</strong>
                                </div>
                            ` : ''}
                            ${c.origem === 'indicacao' && c.indicacao ? `
                                <div class="client-info-item">
                                    ü§ù Indicado por <strong>${c.indicacao}</strong>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${c.observacoes ? `
                            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); color: var(--text-secondary); font-size: 13px;">
                                üìù ${c.observacoes}
                            </div>
                        ` : ''}
                        
                        <div class="client-actions">
                            <button class="client-action-btn" onclick="event.stopPropagation(); openFinanceiroModal(${c.id})">üí∞ Financeiro</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); createEventForClient(${c.id})">üéâ Novo Evento</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); sendMessage(${c.id})">üí¨ Mensagem</button>
                            <button class="client-action-btn" onclick="event.stopPropagation(); deleteClient(${c.id})">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Update clients stats
        function updateClientsStats() {
            const clientes = DB.get('clientes');
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            
            // Total de clientes
            document.getElementById('totalClientes').textContent = clientes.length;
            
            // Aniversariantes este m√™s
            const aniversariantesMes = clientes.filter(c => {
                if (!c.aniversario) return false;
                const aniv = new Date(c.aniversario + 'T00:00:00');
                return aniv.getMonth() === mesAtual;
            }).length;
            document.getElementById('aniversariantesProximos').textContent = aniversariantesMes;
            
            // Clientes via Instagram
            const instagram = clientes.filter(c => c.origem === 'instagram').length;
            document.getElementById('clientesInstagram').textContent = instagram;
            
            // Clientes via Indica√ß√£o
            const indicacao = clientes.filter(c => c.origem === 'indicacao').length;
            document.getElementById('clientesIndicacao').textContent = indicacao;
        }

        // Search clients
        function searchClients() {
            const searchTerm = document.getElementById('clientSearch').value;
            currentClientSearch = searchTerm;
            renderClientsList(searchTerm);
        }

        // Client actions
        function viewClientDetails(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            const origemLabels = {
                'facebook': 'Facebook',
                'instagram': 'Instagram',
                'google': 'Google',
                'indicacao': 'Indica√ß√£o',
                'outros': 'Outros'
            };
            
            let details = `üë§ DETALHES DO CLIENTE\n\n`;
            details += `Nome: ${cliente.nome}\n`;
            details += `Email: ${cliente.email}\n`;
            details += `Telefone: ${cliente.telefone}\n`;
            if (cliente.cpf) details += `CPF/CNPJ: ${cliente.cpf}\n`;
            if (cliente.aniversario) details += `Anivers√°rio: ${formatDate(cliente.aniversario)}\n`;
            if (cliente.origem) details += `Como conheceu: ${origemLabels[cliente.origem] || cliente.origem}\n`;
            if (cliente.origem === 'indicacao' && cliente.indicacao) details += `Indicado por: ${cliente.indicacao}\n`;
            if (cliente.endereco) details += `Endere√ßo: ${cliente.endereco}\n`;
            
            // Informa√ß√µes financeiras
            if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                details += `\nüí∞ INFORMA√á√ïES FINANCEIRAS\n`;
                details += `Valor Total: ${formatMoney(cliente.financeiro.valorTotal)}\n`;
                details += `Sinal Pago: ${formatMoney(cliente.financeiro.sinalValor)}`;
                if (cliente.financeiro.sinalData) details += ` (${formatDate(cliente.financeiro.sinalData)})`;
                details += `\nSaldo Devedor: ${formatMoney(cliente.financeiro.valorPagar)}`;
                if (cliente.financeiro.vencimento) {
                    details += `\nVencimento: ${formatDate(cliente.financeiro.vencimento)}`;
                    const hoje = new Date();
                    const venc = new Date(cliente.financeiro.vencimento);
                    if (venc < hoje && cliente.financeiro.valorPagar > 0) {
                        details += ` ‚ö†Ô∏è VENCIDO`;
                    }
                }
                const percentPaid = (cliente.financeiro.sinalValor / cliente.financeiro.valorTotal) * 100;
                details += `\nProgresso: ${percentPaid.toFixed(0)}%`;
            }
            
            if (cliente.observacoes) details += `\n\nObserva√ß√µes:\n${cliente.observacoes}`;
            
            alert(details);
        }

        function editClient(id) {
            alert('Funcionalidade de edi√ß√£o em desenvolvimento!\nEm breve voc√™ poder√° editar os dados do cliente.');
        }

        function deleteClient(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            if (confirm(`Deseja realmente excluir o cliente "${cliente.nome}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                const clientes = DB.get('clientes').filter(c => c.id !== id);
                DB.set('clientes', clientes);
                renderClientsList(currentClientSearch);
                updateClientsStats();
                checkBirthdays();
                updateOrigemStats();
            }
        }

        function createEventForClient(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            // Ir para aba de eventos
            switchTabProgramatically('eventos');
            
            // Abrir modal de novo evento com pequeno delay
            setTimeout(() => {
                openModal('evento');
                
                // Pr√©-preencher APENAS nome do cliente
                const nomeInput = document.getElementById('eventoCliente');
                if (nomeInput) {
                    nomeInput.value = cliente.nome;
                }
                
                // Guardar dados do cliente para op√ß√£o de usar endere√ßo
                window.enderecoCliente = {
                    cep: cliente.cep || '',
                    rua: cliente.rua || '',
                    numero: cliente.numero || '',
                    complemento: cliente.complemento || '',
                    bairro: cliente.bairro || '',
                    cidade: cliente.cidade || '',
                    estado: cliente.estado || ''
                };
                
                // Mostrar op√ß√£o de usar endere√ßo do cliente se ele tiver endere√ßo
                if (cliente.cep) {
                    document.getElementById('opcoesEnderecoEvento').style.display = 'block';
                    document.getElementById('enderecoClienteDisplay').textContent = cliente.endereco || `${cliente.rua}, ${cliente.numero} - ${cliente.bairro}`;
                }
                
                // Se tiver valor financeiro, preencher tamb√©m
                if (cliente.financeiro && cliente.financeiro.valorTotal > 0) {
                    const valorInput = document.getElementById('eventoValor');
                    if (valorInput) {
                        valorInput.value = cliente.financeiro.valorTotal;
                        document.getElementById('valorClienteDisplay').textContent = formatMoney(cliente.financeiro.valorTotal);
                        document.getElementById('valorClienteInfo').style.display = 'block';
                    }
                }
            }, 300);
        }

        function sendMessage(id) {
            const cliente = DB.get('clientes').find(c => c.id === id);
            if (!cliente) return;
            
            const message = `Ol√° ${cliente.nome.split(' ')[0]}! Tudo bem?`;
            const whatsappNumber = cliente.telefone.replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/55${whatsappNumber}?text=${encodeURIComponent(message)}`;
            
            if (confirm(`Enviar mensagem para ${cliente.nome}?\n\n"${message}"\n\nSer√° aberto no WhatsApp.`)) {
                window.open(whatsappUrl, '_blank');
            }
        }

        // Aguardar DOM estar pronto antes de adicionar event listeners
    </script>
</body>
</html>
